{"pages":[{"title":"","text":"google-site-verification: googlede5fd50279499fe2.html","link":"/googlede5fd50279499fe2.html"}],"posts":[{"title":"ã€Œè¯‘ã€Kotlin æ–°ç§€ Coil VS  Glide and Picasso","text":"å‰è¨€ åŸæ ‡é¢˜: Coil vs Picasso vs Glide: Get Readyâ€¦ Go! åŸæ–‡åœ°å€: https://proandroiddev.com/coil-vs-picassoâ€¦ åŸæ–‡ä½œè€…ï¼šMiguel Ãngel Ruiz LÃ³pez è¿™ç¯‡æ–‡ç« åœ¨ Medium ä¸Šåˆ°ç›®å‰ä¸ºæ­¢è·å¾—äº† 1.4K+ Starï¼Œéå¸¸å¥½çš„ä¸€ç¯‡æ–‡ç«  è¿™ç¯‡æ–‡ç« åœ¨ Medium ä¸Šåˆ°ç›®å‰ä¸ºæ­¢è·å¾—äº† 1.4K+ Starï¼Œéå¸¸å¥½çš„ä¸€ç¯‡æ–‡ç« ï¼ŒCoil ä½œä¸ºå›¾ç‰‡åŠ è½½åº“çš„æ–°ç§€ï¼Œå’Œ Glideã€Picasso è¿™äº›è€ç‰Œå›¾ç‰‡åº“ç›¸æ¯”ï¼Œå®ƒä»¬çš„ä¼˜ç¼ºç‚¹æ˜¯ä»€ä¹ˆä»¥åŠ Coil æœªæ¥çš„å±•æœ›ï¼Ÿå…ˆæ¥äº†è§£ä¸€ä¸‹ä»€ä¹ˆæ˜¯ Coilã€‚ Coil æ˜¯åŸºäº Kotlin å¼€å‘çš„é¦–ä¸ªå›¾ç‰‡åŠ è½½åº“ï¼Œæ¥è‡ª Instacart å›¢é˜Ÿï¼Œæ¥çœ‹çœ‹å®˜ç½‘å¯¹å®ƒçš„æœ€æ–°çš„ä»‹ç»ã€‚ R8ï¼šCoil ä¸‹å®Œå…¨å…¼å®¹ R8ï¼Œæ‰€ä»¥ä¸éœ€è¦æ·»åŠ ä»»ä½•ä¸ Coil ç›¸å…³çš„æ··æ·†å™¨è§„åˆ™ã€‚ Fastï¼šCoil è¿›è¡Œäº†è®¸å¤šä¼˜åŒ–ï¼ŒåŒ…æ‹¬å†…å­˜å’Œç£ç›˜ç¼“å­˜ï¼Œå¯¹å†…å­˜ä¸­çš„å›¾ç‰‡è¿›è¡Œé‡‡æ ·ï¼Œé‡æ–°ä½¿ç”¨ä½å›¾ï¼Œè‡ªåŠ¨æš‚åœ/å–æ¶ˆè¯·æ±‚ç­‰ç­‰ã€‚ Lightweightï¼šCoil ä¸ºä½ çš„ APK å¢åŠ äº† 2000 ä¸ªæ–¹æ³•(å¯¹äºå·²ç»ä½¿ç”¨äº† OkHttp å’Œåç¨‹çš„åº”ç”¨ç¨‹åº)ï¼Œè¿™ä¸ Picasso ç›¸å½“ï¼Œæ˜æ˜¾å°‘äº Glide å’Œ Frescoã€‚ Easy to useï¼šCoil åˆ©ç”¨äº† Kotlin çš„è¯­è¨€ç‰¹æ€§å‡å°‘äº†æ ·ç‰ˆä»£ç ã€‚ Modernï¼šä½¿ç”¨äº†å¤§é‡çš„é«˜çº§ç‰¹æ€§ï¼Œä¾‹å¦‚åç¨‹ã€OkHttpã€å’Œ androidX lifecycle è·Ÿè¸ªç”Ÿå‘½å‘¨æœŸçŠ¶æ€çš„ï¼ŒCoil æ˜¯ç›®å‰å”¯ä¸€æ”¯æŒ androidX lifecycle çš„åº“ã€‚ é€šè¿‡è¿™ç¯‡æ–‡ç« ä½ å°†å­¦ä¹ åˆ°ä»¥ä¸‹å†…å®¹ï¼Œå°†åœ¨è¯‘è€…æ€è€ƒéƒ¨åˆ†ä¼šç»™å‡ºç›¸åº”çš„ç­”æ¡ˆ Kotlin å¦‚ä½•ä½¿ç”¨ä¸€è¡Œä»£ç äº¤æ¢ä¸¤ä¸ªå˜é‡? Coil å’Œ Glide å’Œ Picasso æ¯”è¾ƒï¼Œå®ƒä»¬ä¼˜ç¼ºç‚¹æ˜¯ä»€ä¹ˆï¼Ÿ Kotlin ä½œä¸º Android å¼€å‘çš„é¦–é€‰è¯­è¨€ï¼Œæˆ‘ä»¬è¯¥å¦‚ä½•è¿›è¡Œé€‰æ‹© Coilã€Glide å’Œ Picassoï¼Ÿ å¦‚ä½•åœ¨é¡¹ç›®ä¸­ä½¿ç”¨ Coilï¼Ÿ Coilã€Glide å’Œ Picasso ä½¿ç”¨ä¸Šå¤§æ¯”æ‹¼ï¼Ÿ Coil çš„åŠ¨æ€å›¾ç‰‡é‡‡æ ·æ˜¯ä»€ä¹ˆï¼Ÿ æ¥ä¸‹æ¥æ¼”ç¤ºä¸­è¡¨æ ¼ä¸­çš„æ•°å­—ï¼Œå¯èƒ½å¾ˆéš¾ç†è§£ï¼Œä½†æ˜¯ä¸ºäº†æ›´å¥½åœ°ç†è§£ï¼Œåœ¨æœ€åçš„éƒ¨åˆ†ï¼Œä¼šä»¥æŸ±çŠ¶å›¾æ¸…æ™°çš„å±•ç¤ºæ¯ä¸ªåº“çš„æ€§èƒ½çš„å¯¹æ¯”ï¼Œåœ¨è¯‘è€…æ€è€ƒéƒ¨åˆ†ä¼šæ›´æ·±å…¥çš„åˆ†æè¿™ä¸‰ä¸ªå›¾ç‰‡åŠ è½½åº“çš„æ€§èƒ½ï¼Œè¯·è€å¿ƒå¤šè¯»å‡ éï¼Œåº”è¯¥å¯ä»¥ä»ä¸­å­¦åˆ°å¾ˆå¤šæŠ€å·§ã€‚ è¯‘æ–‡Coil ä½œä¸ºå›¾ç‰‡åº“çš„æ–°ç§€ï¼Œè¶Šæ¥è¶Šå—æ¬¢è¿äº†ï¼Œä½†æ˜¯ä¸ºä»€ä¹ˆä¼šå¼•èµ·è¿™ä¹ˆå¤šäººçš„å…³æ³¨ï¼Ÿåœ¨å½“ä»Šä¸»æµçš„å›¾ç‰‡åŠ è½½åº“ç¯å¢ƒä¸­ Coil æ˜¯ä¸€è‚¡æ¸…æµï¼Œå®ƒæ˜¯è½»é‡çº§çš„ï¼Œå› ä¸ºå®ƒä½¿ç”¨äº†è®¸å¤š Android å¼€å‘è€…å·²ç»åœ¨ä»–ä»¬çš„é¡¹ç›®ä¸­åŒ…å«çš„å…¶ä»–åº“ï¼ˆåç¨‹ã€Okhttpï¼‰ã€‚ å½“æˆ‘ç¬¬ä¸€æ¬¡çœ‹åˆ°è¿™ä¸ªåº“æ—¶ï¼Œæˆ‘è®¤ä¸ºè¿™äº›éƒ½æ˜¯å¾ˆå¥½çš„æ”¹è¿›ï¼Œä½†æ˜¯æˆ‘å¾ˆæƒ³çŸ¥é“å’Œå…¶ä»–ä¸»æµçš„å›¾ç‰‡åŠ è½½åº“ç›¸æ¯”ï¼Œè¿™ä¸ªåº“èƒ½å¸¦æ¥å“ªäº›å¥½å¤„ï¼Œè¿™ç¯‡æ–‡ç« çš„ä¸»è¦ç›®çš„æ˜¯åˆ†æä¸€ä¸‹ Coil çš„æ€§èƒ½ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬æ¥å¯¹æ¯”ä¸€ä¸‹ Coilã€ Glide å’Œ Picassoã€‚ æˆ‘ä»¬å¦‚ä½•æµ‹é‡ä¸ºäº†å¼„æ¸…æ¥šè¿™äº›åº“çš„æ€§èƒ½å¦‚ä½•ï¼Œæˆ‘ä»¬åˆ†åˆ«ç”¨å®ƒä»¬å®ç°äº†ä¸€ä¸ªåº”ç”¨ç¨‹åºï¼Œè¿™æ˜¯ä¸€ä¸ªç®€å•çš„åº”ç”¨ç¨‹åºï¼Œå®ƒä¸‹è½½ 10 å¼ å›¾ç‰‡å¹¶ä»¥ç½‘æ ¼å¸ƒå±€æ˜¾ç¤ºå®ƒä»¬ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚ æ‰€æœ‰å›¾ç‰‡éƒ½æ˜¯åœ¨åŒä¸€æ—¶é—´å¯è§çš„ï¼Œå‡ ä¹æ˜¯åœ¨åŒä¸€æ—¶é—´è¢«è¯·æ±‚çš„ï¼Œå› æ­¤ï¼Œå¯ä»¥è®¤ä¸ºå®ƒä»¬æ˜¯å¹¶è¡ŒåŠ è½½ã€‚ æµ‹è¯•åŠ è½½æ¯å¼ å›¾ç‰‡æ‰€éœ€çš„æ—¶é—´ï¼šä¸ºäº†è·å¾—æ›´å‡†ç¡®çš„æ•°æ®ï¼Œå›¾ç‰‡è¢«ä¸‹è½½äº†åæ¬¡å°†å–å¹³å‡å€¼ã€‚ è®¡ç®—åŠ è½½å›¾ç‰‡åˆ—è¡¨æ‰€éœ€çš„æ—¶é—´ï¼šè¿™ä¸ªæ•°å­—å¾ˆé‡è¦ï¼Œå› ä¸ºå›¾ç‰‡æ˜¯å¹¶è¡ŒåŠ è½½çš„ï¼Œæ‰€ä»¥ä¸èƒ½ä»å•ä¸ªå›¾ç‰‡æ¨æ–­ã€‚è¿™ä¸ªæµ‹è¯•ä¹Ÿåšäº†åæ¬¡æµ‹è¯•å°†å–å¹³å‡å€¼ã€‚ å¦ä¸€ä¸ªéœ€è¦æµ‹è¯•çš„é‡è¦ç‚¹æ˜¯ç¬¬ä¸€æ¬¡åŠ è½½å›¾ç‰‡å’Œä»ç¼“å­˜ä¸­åŠ è½½å®ƒä»¬æ‰€èŠ±è´¹çš„æ—¶é—´ï¼Œå·²ç»è¿›è¡Œäº†å¤šæ¬¡æµ‹è¯•ï¼Œè¦†ç›–äº†ä¸Šé¢çš„åœºæ™¯ã€‚ ä»ç½‘ç»œä¸‹è½½æˆ‘ä»¬å¼€å§‹ç¬¬ä¸€ä¸ªåœºæ™¯ï¼Œå½“ç¼“å­˜ä¸ºç©ºæ—¶ï¼Œä»ç½‘ç»œä¸­ä¸‹è½½å›¾ç‰‡ã€‚ Glide åœ¨ä¸‹é¢çš„è¡¨ä¸­ï¼Œæ‚¨å¯ä»¥çœ‹åˆ°å½“ç¼“å­˜ä¸ºç©ºæ—¶ï¼Œä»ç½‘ç»œä¸­ä¸‹è½½å›¾ç‰‡æ‰€ç”¨çš„æ—¶é—´ã€‚æ³¨æ„ï¼Œè¿™äº›æ—¶é—´æ˜¯æµ‹è¯• 10 æ¬¡ä¹‹åçš„å¹³å‡å€¼ã€‚ ä¸‹è¡¨å±•ç¤ºäº†åŠ è½½å®Œæ•´çš„å›¾ç‰‡åˆ—è¡¨æ‰€éœ€çš„æ—¶é—´ï¼Œä»¥åŠå¹³å‡æ—¶é—´ã€‚ Picasso Picasso çš„æµ‹è¯•å’Œ Glide ç›¸åŒï¼Œå½“ç¼“å­˜ä¸ºç©ºæ—¶ï¼Œä»ç½‘ç»œä¸­ä¸‹è½½å›¾ç‰‡ï¼Œæµ‹è¯• 10 æ¬¡å·¦å³æ‰€ç”¨çš„æ—¶é—´çš„å¹³å‡å€¼ã€‚ ä»¥åŠåŠ è½½å®Œæ•´çš„å›¾ç‰‡åˆ—è¡¨æ‰€éœ€è¦çš„æ—¶é—´ï¼Œä»¥åŠå¹³å‡æ—¶é—´ã€‚ Coil ç°åœ¨æ¥çœ‹ä¸€ä¸‹ä»Šå¤©ä¸»è§’ Coil ï¼Œå’Œ Picassoã€Glide åšç›¸åŒçš„æµ‹è¯•ï¼Œå½“ç¼“å­˜ä¸ºç©ºæ—¶ï¼Œä»ç½‘ç»œä¸‹è½½ 10 æ¬¡å·¦å³æ‰€ç”¨çš„æ—¶é—´çš„å¹³å‡å€¼ã€‚ ä»¥åŠåŠ è½½å®Œæ•´çš„å›¾ç‰‡åˆ—è¡¨æ‰€éœ€çš„æ—¶é—´ï¼Œä»¥åŠå¹³å‡æ—¶é—´ã€‚ ä»ç¼“å­˜ä¸­åŠ è½½ç°åœ¨å¼€å§‹å¦å¤–ä¸€ä¸ªåœºæ™¯æµ‹è¯•ï¼Œå½“ç¼“å­˜ä¸ä¸ºç©ºæ—¶ï¼ŒåŠ è½½å›¾ç‰‡æ‰€éœ€è¦çš„æ—¶é—´ã€‚ Glide ä»ç¼“å­˜ä¸­åŠ è½½å›¾ç‰‡æ‰€ç”¨æ—¶é—´ï¼Œå¦‚ä¸‹è¡¨æ‰€ç¤ºã€‚ ä»ç¼“å­˜ä¸­åŠ è½½å®Œæ•´çš„å›¾ç‰‡åˆ—è¡¨æ‰€éœ€çš„æ—¶é—´ï¼Œä»¥åŠå¹³å‡æ—¶é—´ã€‚ Picasso æµ‹è¯•ç”¨ä¾‹å’Œ Glide ç›¸åŒï¼Œä»ç¼“å­˜ä¸­åŠ è½½å›¾ç‰‡æ‰€ç”¨æ—¶é—´ï¼Œå¦‚ä¸‹è¡¨æ‰€ç¤ºã€‚ ä»¥åŠä»ç¼“å­˜ä¸­åŠ è½½å®Œæ•´çš„å›¾ç‰‡åˆ—è¡¨æ‰€éœ€çš„æ—¶é—´ï¼Œä»¥åŠå¹³å‡æ—¶é—´ã€‚ Coil æœ€åæˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹ Coil å¦‚ä½•å‘¢ï¼Œä»ç¼“å­˜ä¸­åŠ è½½å›¾ç‰‡æ‰€ç”¨æ—¶é—´ï¼Œå¦‚ä¸‹è¡¨æ‰€ç¤ºã€‚ åŒæ ·çš„ä»ç¼“å­˜ä¸­åŠ è½½å®Œæ•´çš„å›¾ç‰‡åˆ—è¡¨æ‰€éœ€çš„æ—¶é—´ï¼Œä»¥åŠå¹³å‡æ—¶é—´ã€‚ ç»“è®ºä¸ºäº†æ›´å¥½åœ°ç†è§£æˆ‘ä»¬åœ¨æµ‹è¯•ä¸­å¾—åˆ°çš„ç»“æœï¼Œæˆ‘ä»¬å¯ä»¥ä»ä¸‹é¢å›¾è¡¨ä¸­çœ‹åˆ°è¿™äº›æ•°å­—ï¼Œååº”äº†ä»ç½‘ç»œä¸‹è½½æ¯ä¸ªå›¾ç‰‡æ—¶çš„ç»“æœã€‚ Glide æœ€å¿« Picasso å’Œ Coil å‡ ä¹ç›¸åŒã€‚ ä½†æ˜¯å½“æˆ‘ä»¬ä»ç¼“å­˜ä¸­åŠ è½½çš„æ—¶å€™ï¼Œæ­£å¦‚ä½ åœ¨ä¸‹é¢çš„å›¾ç‰‡ä¸­çœ‹åˆ°çš„ï¼Œåœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼ŒGlide æœ€å¿«ï¼ŒCoil å…¶æ¬¡ï¼ŒPicasso æœ€æ…¢ã€‚ å¦ä¸€ä¸ªé‡è¦çš„æµ‹è¯•åŠ è½½å®Œæ•´çš„å›¾ç‰‡åˆ—è¡¨æ‰€èŠ±è´¹çš„æ—¶é—´ï¼Œè¿™äº›æ•°å­—éå¸¸é‡è¦ï¼Œå› ä¸ºè¿™æ˜¯ç”¨æˆ·ç­‰å¾…çœ‹åˆ°æ•´ä¸ªå›¾ç‰‡åˆ—è¡¨çš„æ—¶é—´ã€‚å½“å›¾ç‰‡ä»ç½‘ç»œåŠ è½½æ—¶ï¼ŒGlide æ˜¯æœ€å¿«çš„ï¼Œå…¶æ¬¡æ˜¯Picassoï¼ŒCoilæ˜¯æœ€æ…¢çš„ã€‚ ä»ç¼“å­˜åŠ è½½çš„ç»“æœæ˜¯ä¸åŒçš„ã€‚Glide å’Œ Coil å‡ ä¹ç›¸åŒï¼ŒPicasso æ˜¯æœ€æ…¢çš„ã€‚ ä»è¿™äº›æ•°å­—ä¸­æˆ‘ä»¬å¯ä»¥å¾—å‡ºå‡ ä¸ªç»“è®ºï¼š æœ‰è®¸å¤šåœºæ™¯éœ€è¦æµ‹è¯•ï¼Œä¾‹å¦‚ï¼Œä¸‹è½½å¤§å›¾ç‰‡ï¼Œè°ƒæ•´å›¾ç‰‡å¤§å°ä»¥é€‚åº”å®¹å™¨ç­‰ç­‰ã€‚å› æ­¤ï¼Œæˆ‘ä¸èƒ½è¯´å…¶ä»–æƒ…å†µä¸‹çš„ç»“æœå¯èƒ½ä¼šæœ‰å¾ˆå¤§çš„ä¸åŒã€‚ æ­£å¦‚æ‚¨æ‰€çœ‹åˆ°çš„ï¼Œç»Ÿè®¡æ•°æ®æ˜¯ä¸€é—¨åŒ…å«å¤§é‡æ•°æ®çš„ç§‘å­¦ï¼Œå› æ­¤å¯¹æ¯ä¸ªåœºæ™¯è¿›è¡Œ 10 æ¬¡æµ‹è¯•ä¸è¶³ä»¥å…·ä½“çš„è¯´æ˜é‚£ä¸ªåº“æœ€å¥½ï¼Œä½†æ˜¯æˆ‘ä»¬å¯ä»¥ç²—ç•¥åœ°äº†è§£æ€§èƒ½ã€‚ Glide ä¼¼ä¹åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹æ›´å¿«ï¼Œä½†æ•°é‡ä¸€èˆ¬ä¸æ˜¯å¾ˆå¤§æƒ…å†µã€‚å¦‚æœä½ éœ€è¦å¾ˆå¥½åœ°æ‰§è¡Œï¼Œæˆ–è€…ä½ æ­£åœ¨ä¸‹è½½å¾ˆå¤šå›¾ç‰‡ï¼Œè¿™å¯èƒ½å¯¹ä½ æ¥è¯´æ˜¯éå¸¸æœ‰ç”¨ã€‚æ­¤å¤–ï¼Œå¦‚æœæˆ‘ä»¬ä½¿ç”¨å¤§å›¾ç‰‡ï¼Œè¿™äº›æµ‹è¯•çš„ç»“æœå¯èƒ½ä¼šæ”¹å˜ã€‚ Coil ä½œä¸ºå›¾ç‰‡åŠ è½½åº“çš„æ–°ç§€ï¼Œæœªæ¥å®ƒçš„æ€§èƒ½å¯èƒ½ä¼šæœ‰å¾ˆå¤§æé«˜ï¼Œç°åœ¨åªæ˜¯æˆ‘ä»¬å°†å®ƒä¸æˆç†Ÿçš„å›¾ç‰‡åŠ è½½åº“è¿›è¡Œæ¯”è¾ƒçš„ç»“æœã€‚ è¯‘è€…æ€è€ƒä½œè€…ä»ä»¥ä¸‹åœºæ™¯å¯¹ Coilã€Glideã€Picasso åšäº†å…¨é¢çš„æµ‹è¯•ã€‚ å½“ç¼“å­˜ä¸ºç©ºæ—¶ï¼Œä»ç½‘ç»œä¸­ä¸‹è½½å›¾ç‰‡çš„å¹³å‡æ—¶é—´ã€‚ ä»ç½‘ç»œä¸­ä¸‹è½½å›¾ç‰‡æ‰€ç”¨çš„æ—¶é—´ã€‚ç»“æœï¼šGlide æœ€å¿« Picasso å’Œ Coil å‡ ä¹ç›¸åŒã€‚ åŠ è½½å®Œæ•´çš„å›¾ç‰‡åˆ—è¡¨æ‰€ç”¨çš„æ—¶é—´ï¼Œä»¥åŠå¹³å‡æ—¶é—´ã€‚ç»“æœï¼šGlide æ˜¯æœ€å¿«çš„ï¼Œå…¶æ¬¡æ˜¯Picassoï¼ŒCoilæ˜¯æœ€æ…¢çš„ã€‚ å½“ç¼“å­˜ä¸ä¸ºç©ºæ—¶ï¼Œä»ç¼“å­˜ä¸­åŠ è½½å›¾ç‰‡çš„å¹³å‡æ—¶é—´ã€‚ ä»ç¼“å­˜ä¸­åŠ è½½å›¾ç‰‡æ‰€ç”¨çš„æ—¶é—´ã€‚ç»“æœï¼šGlide æœ€å¿«ï¼ŒCoil å…¶æ¬¡ï¼ŒPicasso æœ€æ…¢ã€‚ åŠ è½½å®Œæ•´çš„å›¾ç‰‡åˆ—è¡¨æ‰€ç”¨çš„æ—¶é—´ï¼Œä»¥åŠå¹³å‡æ—¶é—´ã€‚ç»“æœï¼šGlide å’Œ Coil å‡ ä¹ç›¸åŒï¼ŒPicasso æ˜¯æœ€æ…¢çš„ã€‚ å›¾ç‰‡åŠ è½½åº“çš„é€‰æ‹©æ˜¯æˆ‘ä»¬åº”ç”¨ç¨‹åºä¸­æœ€é‡è¦çš„éƒ¨åˆ†ä¹‹ä¸€ï¼Œæ ¹æ®ä»¥ä¸Šç»“æœï¼Œå¦‚æœä½ çš„åº”ç”¨ç¨‹åºä¸­æ²¡æœ‰å¤§é‡ä½¿ç”¨å›¾ç‰‡çš„æ—¶å€™ï¼Œæˆ‘è®¤ä¸ºä½¿ç”¨ Coil æ›´å¥½ï¼ŒåŸå› æœ‰ä»¥ä¸‹å‡ ç‚¹ï¼š ä¸ Glide å’Œ Fresco ç±»ä¼¼ï¼ŒCoil æ”¯æŒä½å›¾æ± ï¼Œä½å›¾æ± æ˜¯ä¸€ç§é‡æ–°ä½¿ç”¨ä¸å†ä½¿ç”¨çš„ä½å›¾å¯¹è±¡çš„æŠ€æœ¯ï¼Œè¿™å¯ä»¥æ˜¾è‘—æé«˜å†…å­˜æ€§èƒ½(ç‰¹åˆ«æ˜¯åœ¨oreoä¹‹å‰çš„è®¾å¤‡ä¸Š)ï¼Œä½†æ˜¯å®ƒä¼šé€ æˆä¸€äº› API é™åˆ¶ã€‚ Coil æ˜¯åŸºäº Kotlin å¼€å‘çš„ï¼Œä¸º Kotlin ä½¿ç”¨è€Œè®¾è®¡çš„ï¼Œæ‰€ä»¥ä»£ç é€šå¸¸æ›´ç®€æ´æ›´å¹²å‡€ã€‚ Kotlin ä½œä¸º Android é¦–é€‰è¯­è¨€ï¼ŒCoil æ˜¯ä¸º Kotlin è€Œè®¾è®¡çš„ï¼ŒCoil åœ¨æœªæ¥è‚¯å®šä¼šå¤§æ–¹å…‰å½©ã€‚ ä» Glideã€Picasso è¿ç§»åˆ° Coil æ˜¯éå¸¸çš„å®¹æ˜“ï¼ŒAPI éå¸¸çš„ç›¸ä¼¼ã€‚ Coil æ”¯æŒ androidX lifecycle è·Ÿè¸ªç”Ÿå‘½å‘¨æœŸçŠ¶æ€ï¼Œä¹Ÿæ˜¯æ˜¯ç›®å‰å”¯ä¸€æ”¯æŒ androidX lifecycle çš„ç½‘ç»œå›¾ç‰‡åŠ è½½åº“ã€‚ Coil æ”¯æŒåŠ¨æ€å›¾ç‰‡é‡‡æ ·ï¼Œå‡è®¾æœ¬åœ°æœ‰ä¸€ä¸ª 500x500 çš„å›¾ç‰‡ï¼Œå½“ä»ç£ç›˜è¯»å– 500x500 çš„æ˜ åƒæ—¶ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨ 100x100 çš„æ˜ åƒä½œä¸ºå ä½ç¬¦ã€‚ å¦‚æœä½ çš„æ˜¯å›¾ç‰‡ç±»å‹çš„åº”ç”¨ï¼Œåº”ç”¨ç¨‹åºä¸­åŒ…å«äº†å¤§é‡çš„å›¾ç‰‡ï¼Œå›¾ç‰‡åŠ è½½çš„é€Ÿåº¦æ˜¯æ•´ä¸ªåº”ç”¨çš„æ ¸å¿ƒæŒ‡æ ‡ä¹‹ä¸€ï¼Œé‚£ä¹ˆç°åœ¨è¿˜ä¸é€‚åˆä½¿ç”¨ Coilã€‚ Coil æ¶µç›–äº† Glideã€Picasso ç­‰ç­‰å›¾ç‰‡åŠ è½½åº“æ‰€æ”¯æŒçš„åŠŸèƒ½ï¼Œé™¤æ­¤ä¹‹å¤– Coil è¿˜æœ‰ä¸€ä¸ªåŠŸèƒ½ åŠ¨æ€å›¾ç‰‡é‡‡æ ·ã€‚ åŠ¨æ€å›¾ç‰‡é‡‡æ ·æ›´å¤šå…³äºå›¾ç‰‡é‡‡æ ·ä¿¡æ¯å¯ä»¥è®¿é—® Coil ï¼Œè¿™é‡Œç®€å•çš„è¯´æ˜ä¸€ä¸‹ï¼Œå‡è®¾æœ¬åœ°æœ‰ä¸€ä¸ª 500x500 çš„å›¾ç‰‡ï¼Œå½“ä»ç£ç›˜è¯»å– 500x500 çš„å›¾ç‰‡æ—¶ï¼Œå°†ä½¿ç”¨ 100x100 çš„æ˜ åƒä½œä¸ºå ä½ç¬¦ï¼Œç­‰å¾…åŠ è½½å®Œæˆä¹‹åæ‰ä¼šå®Œå…¨æ˜¾ç¤ºï¼Œç”¨å®˜æ–¹çš„ä¸€å¼ åŠ¨å›¾æ˜¾ç¤ºè¿‡ç¨‹å¦‚ä¸‹ã€‚ è¿™ç§æ·¡å…¥åŠ¨ç”»æ•ˆæœï¼Œåœ¨è§†è§‰ä¸Šä½“éªŒéå¸¸èˆ’é€‚ï¼Œå ä½ç¬¦åœ¨ä¸»çº¿ç¨‹ä¸Šè®¾ç½®ï¼Œè¿™æ ·å¯ä»¥é˜²æ­¢åœ¨ ImageView ä¸ºç©ºçš„æƒ…å†µä¸‹å‡ºç°ç™½è‰²é—ªçƒï¼Œæ¥ä¸‹æ¥è®©æˆ‘ä»¬æ¥çœ‹çœ‹å¦‚ä½•ä½¿ç”¨ Coilï¼ŸCoilã€Glide å’Œ Picasso ä½¿ç”¨ä¸Šå¤§æ¯”æ‹¼ï¼Ÿ å¦‚ä½•ä½¿ç”¨ Coilæ·»åŠ  Coil ä¾èµ– implementation &quot;io.coil-kt:coil:0.11.0&quot; åœ¨ App moudule ä¸‹ build.gradle æ–‡ä»¶ä¸­æ·»åŠ å¦‚ä¸‹ä»£ç  kotlinOptions { jvmTarget = &quot;1.8&quot;} åœ¨é¡¹ç›®ä¸­è°ƒç”¨ä½ éœ€è¦çš„ä»£ç ï¼Œè¿™é‡Œæ±‡æ€»äº† Coil æ‰€æœ‰ä½¿ç”¨æ–¹å¼ // å°†å›¾ç‰‡åŠ è½½åˆ° ImageView ä¸­, å¹¶å¼€å¯å›¾ç‰‡é‡‡æ ·// ç”¨åˆ°äº† Kotlin çš„é«˜çº§ç‰¹æ€§æ‰©å±•ï¼Œè°ƒç”¨æ›´åŠ ç®€å•imageView.load(&quot;https://www.example.com/image.jpg&quot;){ crossfade(true)}inline fun ImageView.load( uri: String?, imageLoader: ImageLoader = Coil.imageLoader(applicationContext), builder: LoadRequestBuilder.() -&gt; Unit = {}): RequestDisposable { return imageLoader.load(context, uri) { target(this@load) builder() }}// Coil æ”¯æŒ Uri,File, String,HttpUrl, Bitmap, Drawable, DrawableIdimageView.load(R.drawable.ic_launcher_background)imageView.load(File(&quot;/path/to/image.jpg&quot;))imageView.load(&quot;content://com.android.externalstorage/image.jpg&quot;)// ......// Coil æä¾›äº†å››ç§è½¬æ¢: æ¨¡ç³Šï¼Œåœ†å½¢å‰ªè£ï¼Œç°åº¦å’Œåœ†è§’imageView.load(&quot;https://www.example.com/image.jpg&quot;) { crossfade(true) placeholder(R.drawable.ic_launcher_background) transformations(CircleCropTransformation())}// Coil æ˜¯ä¸€ä¸ª object å•ä¾‹val imageLoader1 = Coil.imageLoader(applicationContext)// å¯ä»¥åˆ›å»º æˆ–è€… è°ƒç”¨ç¬¬ä¸‰æ–¹åº“(Koin) æ³¨å…¥è‡ªå·±çš„å®ä¾‹ã€‚val imageLoader2 = ImageLoader(applicationContext)// åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œéœ€è¦è¿œç¨‹ä¸‹è½½ç„¶åè¿›è¡Œå›è°ƒvar request = LoadRequest.Builder(applicationContext) .data(&quot;https://www.example.com/image.jpg&quot;) .target { drawable -&gt; // Handle the successful result. } .build()imageLoader2.execute(request) Coilã€Glide å’Œ Picasso ä½¿ç”¨ä¸Šå¤§æ¯”æ‹¼Coil åŸºäº Kotlin è€Œè®¾è®¡ï¼Œè‡ªç„¶ä¹Ÿæ‹¥æœ‰äº† Kotlin çš„é«˜çº§å‡½æ•°çš„ç‰¹æ€§ï¼Œä½¿ç”¨æ¯” Glide å’Œ Picasso è¦ç®€å•å¾ˆå¤šã€‚ åŸºæœ¬ä½¿ç”¨ // Coil - ç”¨åˆ°äº† Kotlin çš„é«˜çº§ç‰¹æ€§æ‰©å±•ï¼Œä¸€è¡Œä»£ç åŠ è½½å›¾ç‰‡imageView.load(url)// GlideGlide.with(context) .load(url) .into(imageView)// PicassoPicasso.get() .load(url) .into(imageView) åå°çº¿ç¨‹ // Coilï¼šæ— é˜»å¡å’Œçº¿ç¨‹å®‰å…¨val imageLoader = Coil.imageLoader(context)val request = GetRequest.Builder(context) .data(url) .size(width, height) .build()val drawable = imageLoader.execute(request).drawable// Glideï¼šé˜»å¡å½“å‰çº¿ç¨‹ï¼Œä¸€å®šä¸èƒ½ä»ä¸»çº¿ç¨‹è°ƒç”¨val drawable = Glide.with(context) .load(url) .submit(width, height) .get()// Picassoï¼šé˜»å¡å½“å‰çº¿ç¨‹ï¼Œä¸€å®šä¸èƒ½ä»ä¸»çº¿ç¨‹è°ƒç”¨val drawable = Picasso.get() .load(url) .resize(width, height) .get() è‡ªåŠ¨æ£€æµ‹ scaleType imageView.scaleType = ImageView.ScaleType.FIT_CENTER// Coilï¼šè‡ªåŠ¨æ£€æµ‹ scaleTypeimageView.load(url) { placeholder(placeholder)}// GlideGlide.with(context) .load(url) .placeholder(placeholder) .fitCenter() .into(imageView)// PicassoPicasso.get() .load(url) .placeholder(placeholder) .fit() .into(imageView) Kotlin å°æŠ€å·§å¦‚ä½•å®ç°ä¸€è¡Œä»£ç äº¤æ¢ä¸¤ä¸ªå˜é‡ï¼Ÿæˆ‘ä»¬å…ˆæ¥å›é¡¾ä¸€ä¸‹ JAVA çš„åšæ³• int a = 1;int b = 2;// JAVA - ä¸­é—´å˜é‡int temp = a;a = b;b = temp;System.out.println(&quot;a = &quot;+a +&quot; b = &quot;+b); // a = 2 b = 1// JAVA - åŠ å‡è¿ç®—a = a + b;b = a - b;a = a - b;System.out.println(&quot;a = &quot; + a + &quot; b = &quot; + b); // a = 2 b = 1 // JAVA - ä½è¿ç®—a = a ^ b;b = a ^ b;a = a ^ b;System.out.println(&quot;a = &quot; + a + &quot; b = &quot; + b); // a = 2 b = 1// Kotlina = b.also { b = a }println(&quot;a = ${a} b = ${b}&quot;) // a = 2 b = 1 å‚è€ƒæ–‡çŒ® https://proandroiddev.com/coilâ€¦â€¦ https://tech.instacart.com/introducing-coilâ€¦â€¦ æ¨èæ–‡ç«  [è¯‘][Googleå·¥ç¨‹å¸ˆ] åˆšåˆšå‘å¸ƒäº† Fragment çš„æ–°ç‰¹æ€§ â€œFragment é—´ä¼ é€’æ•°æ®çš„æ–°æ–¹å¼â€ ä»¥åŠæºç åˆ†æ [è¯‘][Googleå·¥ç¨‹å¸ˆ] è¯¦è§£ FragmentFactory å¦‚ä½•ä¼˜é›…ä½¿ç”¨ Koin ä»¥åŠéƒ¨åˆ†æºç åˆ†æ [è¯‘][2.4K Start] æ”¾å¼ƒ Dagger æ‹¥æŠ± Koin [è¯‘][5k+] Kotlin çš„æ€§èƒ½ä¼˜åŒ–é‚£äº›äº‹ [è¯‘] è§£å¯† RxJava çš„å¼‚å¸¸å¤„ç†æœºåˆ¶ [è¯‘][1.4K+ Star] Kotlin æ–°ç§€ Coil VS Glide and Picasso æ›´å¤šâ€¦â€¦","link":"/2020/08/17/translate/06-coil-vs-glide-vs-picasso/"},{"title":"ã€Œè¯‘ã€ä½ ä¸­æ‹›äº†å—ï¼Ÿ Kotlin ä¸€ä¸ªéšè—çš„å‘","text":"å‰è¨€ åŸæ ‡é¢˜: A decompiled story of Kotlin let and run åŸæ–‡åœ°å€: https://dev.to/vlazdra/a-decompiledâ€¦â€¦ åŸæ–‡ä½œè€…ï¼šVladimir Zdravkovic ä¹‹å‰æˆ‘å‘è¡¨è¿‡å‡ ç¯‡å…³äº Kotlin æ€§èƒ½æŸè€—å’Œ Kotlin æŠ€å·§æ–¹é¢çš„æ–‡ç« ï¼Œå¦‚æœæ²¡æœ‰äº†è§£è¿‡ï¼Œå¯ä»¥ç‚¹å‡»ä¸‹æ–¹é“¾æ¥å‰å»æŸ¥çœ‹ï¼Œå¯ä»¥é¿å…åœ¨å®é™…å¼€å‘ä¸­é‡åˆ°é‡å¤çš„é—®é¢˜ã€‚ [è¯‘][2.4K Start] æ”¾å¼ƒ Dagger æ‹¥æŠ± Koin [è¯‘][5k+] Kotlin çš„æ€§èƒ½ä¼˜åŒ–é‚£äº›äº‹ ä¸ºæ•°ä¸å¤šçš„äººçŸ¥é“çš„ Kotlin æŠ€å·§ä»¥åŠ åŸç†è§£æ(ä¸€) ä¸ºæ•°ä¸å¤šçš„äººçŸ¥é“çš„ Kotlin æŠ€å·§ä»¥åŠ åŸç†è§£æ(äºŒ) è¿™ç¯‡æ–‡ç« ä¸»è¦æ¥åˆ†æ Kotlin å¦å¤–ä¸€ä¸ªéšè—çš„é—®é¢˜ï¼Œæ–‡ç« å°†ä¼šåˆ†ä¸º è¯‘æ–‡ å’Œ è¯‘è€…æ€è€ƒ ä¸¤éƒ¨åˆ†ï¼Œæœ¬æ–‡ä¸ä»…ä»…æ˜¯ç¿»è¯‘ï¼Œåœ¨ è¯‘è€…æ€è€ƒ éƒ¨åˆ†ä¼šå¯¹è¯‘æ–‡è¿›è¡Œæ€»ç»“ä»¥åŠæ›´åŠ æ·±å…¥çš„æ€è€ƒå’Œåˆ†æï¼Œä¹Ÿå¯ä»¥è·³è¿‡è¯‘æ–‡ç›´æ¥çœ‹ è¯‘è€…æ€è€ƒ éƒ¨åˆ†ã€‚ é€šè¿‡è¿™ç¯‡æ–‡ç« ä½ å°†å­¦ä¹ åˆ°ä»¥ä¸‹å†…å®¹ï¼Œå°†åœ¨è¯‘è€…æ€è€ƒéƒ¨åˆ†ä¼šç»™å‡ºç›¸åº”çš„ç­”æ¡ˆ ä½¿ç”¨ T.let ä¼šé‡åˆ°ä»€ä¹ˆé—®é¢˜ï¼Ÿ ä¸ºä»€ä¹ˆä¼šé€ æˆè¿™ä¸ªé—®é¢˜ï¼Ÿ å¦‚ä½•è§£å†³è¿™ä¸ªé—®é¢˜ï¼Ÿ ä¸ºä»€ä¹ˆä½¿ç”¨ T.apply å¯ä»¥è§£å†³è¿™ä¸ªé—®é¢˜ï¼Ÿ T.apply å’Œ T.let æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ å¦‚ä½•åŒºåˆ† run, with, let, also, applyï¼Ÿ Kotlin å¦‚ä½•äº¤æ¢ä¸¤ä¸ªå˜é‡ï¼Ÿ è¿™ç¯‡æ–‡ç« æ¶‰åŠå¾ˆå¤šé‡è¦çš„çŸ¥è¯†ç‚¹ï¼Œè¯·è€å¿ƒè¯»ä¸‹å»ï¼Œåº”è¯¥å¯ä»¥ä»ä¸­å­¦åˆ°å¾ˆå¤šæŠ€å·§ã€‚ è¯‘æ–‡å‰æ®µæ—¶é—´ï¼Œæˆ‘èŠ±äº†ä¸å°‘æ—¶é—´ï¼Œä¸ºäº†å¼„æ¸…æ¥šä¸€ä¸ªç®€å•çš„ Kotlin ä»£ç å— let å’Œ runï¼Œä¸ºä»€ä¹ˆä¸æƒ³åšæˆ‘æƒ³è®©å®ƒåšçš„äº‹ï¼Œç»è¿‡æ— æ•°æ¬¡é‡å†™æˆ‘çš„ä»£ç ä¹‹åï¼Œæˆ‘è®¤ä¸ºè¿™ä¸€å®šæ˜¯æˆ‘è‡ªå·±çš„é”™è¯¯ï¼Œæœ€åä¸ºäº†ææ¸…æ¥š Kotlin è¯­æ³•ç³–èƒŒåå‘ç”Ÿäº†ä»€ä¹ˆï¼Œæœ€åæˆ‘å†³å®šèŠ±ç‚¹æ—¶é—´æ·±å…¥ç ”ç©¶ç”Ÿæˆçš„ä»£ç ã€‚ let å’Œ run æ˜¯ Kotlin æ ‡å‡†åº“å½“ä¸­çš„å†…è”å‡½æ•°ï¼Œæˆ‘è®¤ä¸ºå®ƒä»¬çš„å·¥ä½œçš„æ–¹å¼ä¸ç»å…¸çš„ if ... else ... è¯­å¥ç±»ä¼¼ï¼Œæ‰€ä»¥æˆ‘ä¸€ç›´åœ¨é¡¹ç›®ä¸­è¿™ä¹ˆä½¿ç”¨å®ƒä»¬ï¼Œç›´åˆ°æˆ‘åœ¨ä¸€ä¸ªé¡¹ç›®ä¸­ä¸ºäº†å®ç°æŸä¸ªåŠŸèƒ½çš„æ—¶å€™ï¼Œé‡åˆ°äº†ä¸€ä¸ªéšè—çš„é—®é¢˜ï¼Œè®©æˆ‘ä»¬çœ‹çœ‹é—®é¢˜æ˜¯ä»€ä¹ˆã€‚ è¿™æ˜¯ä¸€ä¸ªå¾ˆç®€å•çš„ Kotlin ä»£ç ï¼Œå®ƒæœ‰ä¸¤ä¸ªå¯ç©ºçš„å˜é‡ï¼Œå…¶ä¸­ä¸€ä¸ªå·²ç»æœ‰å€¼ï¼Œå¦‚æœæˆ‘è°ƒç”¨ doSomeAwesomePrinting() æ–¹æ³•ï¼Œä½ è®¤ä¸ºæ§åˆ¶å°ä¼šè¾“å‡ºä»€ä¹ˆï¼Ÿ ä½ å¯èƒ½ä¼šå’Œæˆ‘ä¸€æ ·è®¤ä¸ºä»€ä¹ˆéƒ½ä¸ä¼šè¾“å‡ºï¼Œå¯æ˜¯â€¦ é”™äº†ï¼Œæœ€åä¼šè¾“å‡º â€œawesome output 1â€ã€‚ ä¸ºä»€ä¹ˆä¼šè¿™æ ·ï¼Ÿæˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹åç¼–è¯‘åçš„ä»£ç ï¼Œå‘ç”Ÿäº†ä»€ä¹ˆã€‚ æ­£å¦‚ä½ æ‰€è§ï¼Œå½“ç¬¬äºŒä¸ªå˜é‡ awesomeVar2 ä¸ºç©ºæ—¶ï¼ŒKotlin è‡ªåŠ¨ç”Ÿæˆçš„å˜é‡ var10000 ä¹Ÿä¸ºç©ºï¼Œæ‰€ä»¥ç¨‹åºä¸ä¼šæ‰§è¡Œ return è¯­å¥ï¼Œå‡½æ•°æ‰§è¡Œåˆ°æœ€åä¼šè¾“å‡º â€awesome output 1â€œã€‚ è®©æˆ‘ä»¬æ¥çœ‹çœ‹å¦å¤–ä¸€ä¸ªä¾‹å­ï¼Œåœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬å¯¹ä¸Šé¢ Kotlin ä»£ç åšä¸€äº›æ›´æ”¹ï¼Œåœ¨ç¬¬äºŒä¸ªå˜é‡ä¸Šæ·»åŠ  elvis æ“ä½œç¬¦ï¼Œä»£ç å¦‚ä¸‹æ‰€ç¤ºã€‚ å¦‚æœå†æ¬¡è°ƒç”¨ doSomeAwesomePrinting() æ–¹æ³•åˆ™ä¼šè¾“å‡º â€œawesome output 3â€ï¼Œè¿™æ¬¡çš„ä¿®æ”¹å·²å®Œæˆäº†æƒ³è¦åšçš„äº‹æƒ…ï¼Œä¸ç»å…¸çš„ if ... else ... è¯­å¥ç±»ä¼¼ï¼Œæˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹åç¼–è¯‘åçš„ä»£ç ã€‚ æ­£å¦‚ä½ æ‰€è§ï¼Œåç¼–è¯‘åçš„ä»£ç å…¶å®å°±æ˜¯ if ... else ... è¯­å¥ï¼Œå½“ç¬¬äºŒä¸ªå˜é‡ä¸ºç©ºæ—¶åˆ™è¾“å‡º â€œawesome output 3â€ï¼Œ ç°åœ¨æ¥åˆ†æä¸€ä¸‹å¦‚ä½•è§£å†³æ–‡ç« å¼€å¤´æå‡ºæ¥çš„é—®é¢˜ã€‚ è§£å†³æ–¹æ¡ˆ æ„Ÿè°¢ Danny çš„å»ºè®®ï¼Œå…¶å®å¯ä»¥ç”¨ Kotlin å¦å¤–çš„ä¸€ä¸ªå†…è”å‡½æ•° apply æ¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚ æ¥ä¸‹æ¥æŒ‰ç…§ Danny çš„å»ºè®®ï¼Œä½¿ç”¨ Kotlin å¦å¤–ä¸€ä¸ªå†…è”å‡½æ•° applyï¼Œçœ‹çœ‹ä¼šå‘ç”Ÿä»€ä¹ˆã€‚ å’Œæˆ‘ä»¬æ‰€æœŸæœ›çš„ä¸€æ ·ï¼Œå½“ç¬¬äºŒä¸ªå˜é‡ä¸ºç©ºæ—¶ï¼Œæ§åˆ¶å°ä»€ä¹ˆéƒ½ä¸ä¼šè¾“å‡ºï¼Œä½ å¯ä»¥è¯•ä¸€ä¸‹ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬æ¥åˆ†æä¸€ä¸‹åç¼–è¯‘åçš„ä»£ç ã€‚ æ­£å¦‚ä½ æ‰€çœ‹åˆ°çš„ï¼ŒKotlin è‡ªåŠ¨ç”Ÿæˆçš„å˜é‡ var1 ä¸ä¸ºç©ºï¼Œå½“ç¬¬äºŒä¸ªå˜é‡ awesomeVar2 ä¸ºç©ºæ—¶ï¼Œç›´æ¥ return äº†ã€‚ æœ€åæˆ‘ä»¬å¯¹ä¸Šé¢ Kotlin ä»£ç ï¼Œåœ¨ apply çš„åŸºç¡€ä¸Šï¼Œåšä¸€ç‚¹ä¸€ç‚¹ä¿®æ”¹ï¼Œåœ¨ç¬¬äºŒä¸ªå˜é‡ä¸Šæ·»åŠ  elvis æ“ä½œç¬¦å¦‚ä¸‹æ‰€ç¤ºã€‚ è¿è¡Œä»£ç ä¹‹åï¼Œå½“ç¬¬äºŒä¸ªå˜é‡ä¸ºç©ºæ—¶ï¼Œæ§åˆ¶å°å°†ä¼šè¾“å‡º â€œawesome output 3â€ ï¼Œä¸ºäº†èƒ½å¤Ÿç†è§£è¿™é‡Œå‘ç”Ÿäº†ä»€ä¹ˆï¼Œæˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹åç¼–è¯‘åçš„ä»£ç ã€‚ ç”Ÿæˆçš„ä»£ç æ¯”ä¹‹å‰å¤šäº†å¾ˆå¤šï¼Œä½†æ˜¯ä¸å½±å“æˆ‘ä»¬æ­£å¸¸åˆ†æï¼Œå’Œæˆ‘ä»¬é¢„æœŸçš„ä¸€æ ·ï¼Œæ§åˆ¶å°å°†è¾“å‡º â€œawesome output 3â€ è¯‘è€…æ€è€ƒæ¥ä¸‹æ¥æ˜¯è¯‘è€…æ€è€ƒéƒ¨åˆ†ï¼ŒæŒ‰ç…§ä¹‹å‰çš„é£æ ¼ï¼Œæˆ‘ä»¬å…ˆå¯¹è¯‘æ–‡è¿›è¡Œæ€»ç»“ï¼Œç„¶ååœ¨è¿›è¡Œåˆ†æã€‚ æ€»ç»“å’Œåˆ†æä½¿ç”¨ T.let ä¼šé‡åˆ°äº†ä»€ä¹ˆé—®é¢˜ï¼Ÿ Kotlin æ ‡å‡†åº“å½“ä¸­çš„å†…è”å‡½æ•° T.let å’Œ T.run ç­‰ç­‰ï¼Œå®ƒä»¬çš„å·¥ä½œçš„æ–¹å¼ä¸ if ... else ... è¯­å¥ç±»ä¼¼ï¼Œä»åç¼–è¯‘åçš„ä»£ç å¯çŸ¥å…¶å®å°±æ˜¯ if ... else ... è¯­å¥ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯èƒ½ä¼šè®¤ä¸ºè¿è¡Œä¸‹é¢çš„ä»£ç å’Œ if ... else ... è¯­å¥ä¸€æ ·ä¸ä¼šæœ‰ä»»ä½•è¾“å‡ºã€‚ class ExampleClass { var awesomeVar1: String? = &quot;some awesome string value&quot; var awesomeVar2: String? = null fun doSomeAwesomePrinting() { awesomeVar1?.let { awesomeVar2?.let { println(&quot;awesome output 2&quot;) } } ?: run { println(&quot;awesome output 1&quot;) } }} ä½†æ˜¯ç»“æœå´å‡ºäººæ„æ–™ï¼Œå½“ç¬¬äºŒä¸ªå˜é‡ä¸ºç©ºæ—¶ï¼Œå±…ç„¶è¾“å‡º â€œawesome output 1â€ï¼Œå¤§å®¶å¯ä»¥åç¼–è¯‘ä¸Šé¢çš„ä»£ç çœ‹ä¸€ä¸‹ï¼Œä¼šæ›´åŠ æ¸…æ¥šå…¶å†…éƒ¨é€»è¾‘ã€‚ ä¸ºä»€ä¹ˆä¼šé€ æˆè¿™ä¸ªé—®é¢˜ï¼Ÿ æˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹ Kotlin å†…è”å‡½æ•° T.let çš„æºç å®ç°ã€‚ public inline fun &lt;T, R&gt; T.let(block: (T) -&gt; R): R { contract { callsInPlace(block, InvocationKind.EXACTLY_ONCE) } return block(this)} æ­£å¦‚ä½ æ‰€çœ‹åˆ°çš„ T.let æ¥å—çš„å‚æ•°æ˜¯ it, å®ƒè¿”å›æœ€åä¸€è¡Œï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬å°†æºä»£ç æ‹†è§£ä¸€ä¸‹ï¼Œå¯èƒ½ä¼šæ›´æ¸…æ¥šå‘ç”Ÿäº†ä»€ä¹ˆã€‚ fun doSomeAwesomePrinting() { awesomeVar1?.let { // å°† awesomeVar2?.let{...} çš„ç»“æœä½œä¸º awesomeVar1?.let{...} çš„è¿”å›å€¼ // æ‰€ä»¥å½“ awesomeVar2 ä¸ºç©ºæ—¶ï¼ŒawesomeVar2?.let{...} çš„ç»“æœä¸ºç©º // å‡½æ•°æœ€åä¼šè¾“å‡º &quot;awesome output 1&quot; awesomeVar2?.let { println(&quot;awesome output 2&quot;) } } ?: run { println(&quot;awesome output 1&quot;) }} å°† awesomeVar2?.let{...} çš„ç»“æœä½œä¸º awesomeVar1?.let{...} çš„è¿”å›å€¼ å½“ awesomeVar2 ä¸ºç©ºæ—¶ï¼ŒawesomeVar2?.let{...} çš„ç»“æœä¸ºç©º å‡½æ•°æœ€åä¼šè¾“å‡º â€œawesome output 1â€ å¦‚ä½•è§£å†³è¿™ä¸ªé—®é¢˜ï¼Ÿ è§£å†³æ–¹æ¡ˆä¹Ÿå¾ˆç®€å•ä½¿ç”¨å¦å¤–ä¸€ä¸ª Kotlin å†…è”å‡½æ•° T.applyï¼Œä»£ç å¦‚ä¸‹æ‰€ç¤ºã€‚ class ExampleClass { var awesomeVar1: String? = &quot;some awesome string value&quot; var awesomeVar2: String? = null fun doSomeAwesomePrinting() { awesomeVar1?.apply { awesomeVar2?.apply { println(&quot;awesome output 2&quot;) } } ?: run { println(&quot;awesome output 1&quot;) } }} ä½¿ç”¨ Kotlin å¦å¤–ä¸€ä¸ªå†…è”å‡½æ•° T.apply ä¹‹åï¼Œç»“æœå’Œæˆ‘ä»¬æ‰€é¢„æœŸçš„ä¸€æ ·ï¼Œè¿™é‡Œä»€ä¹ˆéƒ½ä¸ä¼šè¾“å‡ºï¼Œé‚£ä¹ˆä¸ºä»€ä¹ˆä½¿ç”¨ T.apply å¯ä»¥è§£å†³è¿™ä¸ªé—®é¢˜ï¼ŸT.apply å’Œ T.let æœ‰ä»€ä¹ˆåŒºåˆ«å‘¢ï¼Ÿ ä¸ºä»€ä¹ˆä½¿ç”¨ T.apply å¯ä»¥è§£å†³è¿™ä¸ªé—®é¢˜ï¼Ÿ æˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹ Kotlin å†…è”å‡½æ•° T.apply çš„æºç å®ç°ã€‚ public inline fun &lt;T&gt; T.apply(block: T.() -&gt; Unit): T { contract { callsInPlace(block, InvocationKind.EXACTLY_ONCE) } block() return this} T.apply å‡½æ•°æ˜¯ä¸€ä¸ªæ‰©å±•å‡½æ•°ï¼Œè¿”å›å€¼æ˜¯å®ƒæœ¬èº«ï¼Œå¹¶ä¸”æ¥å—çš„å‚æ•°æ˜¯ thisï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬å°†æºä»£ç æ‹†è§£è¿›è¡Œåˆ†æã€‚ fun doSomeAwesomePrinting() { awesomeVar1?.apply { // awesomeVar1?.apply{...} çš„è¿”å›å€¼æ˜¯å®ƒæœ¬èº«ï¼ŒawesomeVar1 ä¸ä¸ºç©º // æ‰€ä»¥å½“ awesomeVar2 ä¸ºç©ºæ—¶ï¼Œä»€ä¹ˆéƒ½ä¸ä¼šè¾“å‡º awesomeVar2?.apply { println(&quot;awesome output 2&quot;) } // awesomeVar2?.apply{...} è¿”å›å€¼æ˜¯ awesomeVar2 } ?: run { println(&quot;awesome output 1&quot;) }} æ ¹æ® T.apply å‡½æ•°ç‰¹æ€§ï¼ŒawesomeVar1?.apply{...} çš„è¿”å›å€¼æ˜¯å®ƒæœ¬èº«ï¼Œå˜é‡ awesomeVar1ä¸ä¸ºç©º å½“ awesomeVar2 ä¸ºç©ºæ—¶ï¼Œå¹¶ä¸ä¼šå½±å“åˆ° awesomeVar1?.apply{...} çš„ç»“æœï¼Œæ‰€è¿™é‡Œä»€ä¹ˆéƒ½ä¸ä¼šè¾“å‡º T.apply å’Œ T.let æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ å‡½æ•° æ˜¯å¦æ˜¯æ‰©å±•å‡½æ•° å‡½æ•°å‚æ•°(thisã€it) è¿”å›å€¼(è°ƒç”¨æœ¬èº«ã€æœ€åä¸€è¡Œ) T.let æ˜¯ it æœ€åä¸€è¡Œ T.apply æ˜¯ this è°ƒç”¨æœ¬èº« é™¤äº† T.apply å’Œ T.let ä¹‹å¤–ï¼ŒKotlin è¿˜æœ‰å¾ˆå¤šå…¶ä»–å†…è”å‡½æ•°ä¾‹å¦‚ T.run ã€T.alsoã€with ç­‰ç­‰ï¼Œè™½ç„¶æ“ä½œç¬¦ä¸å¤šï¼Œä½†æ˜¯æƒ³è¦åˆ†æ¸…æ¥šè¿™äº›æ“ä½œç¬¦ç¡®å®æœ‰äº›å›°éš¾ï¼Œæ‰€ä»¥æˆ‘å°†ä¼šä»‹ç»ä¸€ç§ç®€å•çš„æ–¹æ³•æ¥åŒºåˆ†å®ƒä»¬ä»¥åŠå¦‚ä½•ä½¿ç”¨ã€‚ å¦‚ä½•åŒºåˆ† run, with, let, also, applyæ„Ÿè°¢å¤§ç¥ Elye çš„è¿™ç¯‡æ–‡ç« æä¾›çš„æ€è·¯ Mastering Kotlin standard functionsã€‚ å…³äºå¦‚ä½•åŒºåˆ† run, with, let, also, apply æˆ‘åœ¨ä¹‹å‰çš„æ–‡ç«  ä¸ºæ•°ä¸å¤šçš„äººçŸ¥é“çš„ Kotlin æŠ€å·§ä»¥åŠ åŸç†è§£æ ä¸­æœ‰ä»‹ç»ï¼Œè¿™é‡Œæˆ‘ä»¬åœ¨å›é¡¾ä¸€ä¸‹ã€‚ run, with, let, also, apply æ˜¯ Kotlin çš„å†…è”å‡½æ•°ï¼Œä¹Ÿæ˜¯ä½œç”¨åŸŸå‡½æ•°ï¼Œè¿™äº›ä½œç”¨åŸŸå‡½æ•°å¦‚ä½•ä½¿ç”¨ï¼Œä»¥åŠå¦‚ä½•åŒºåˆ†å‘¢ï¼Œæˆ‘ä»¬å°†ä»ä»¥ä¸‹ä¸‰ä¸ªç»´åº¦æ¥åŒºåˆ†å®ƒä»¬ã€‚ æ˜¯å¦æ˜¯æ‰©å±•å‡½æ•°ã€‚ ä½œç”¨åŸŸå‡½æ•°çš„å‚æ•°ï¼ˆthisã€itï¼‰ã€‚ ä½œç”¨åŸŸå‡½æ•°çš„è¿”å›å€¼ï¼ˆè°ƒç”¨æœ¬èº«ã€å…¶ä»–ç±»å‹å³æœ€åä¸€è¡Œï¼‰ã€‚ æ˜¯å¦æ˜¯æ‰©å±•å‡½æ•°é¦–å…ˆæˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹ with å’Œ T.runï¼Œè¿™ä¸¤ä¸ªå‡½æ•°éå¸¸çš„ç›¸ä¼¼ï¼Œä»–ä»¬çš„åŒºåˆ«åœ¨äº with æ˜¯ä¸ªæ™®é€šå‡½æ•°ï¼ŒT.run æ˜¯ä¸ªæ‰©å±•å‡½æ•°ï¼Œæ¥çœ‹ä¸€ä¸‹ä¸‹é¢çš„ä¾‹å­ã€‚ val name: String? = nullwith(name){ val subName = name!!.substring(1,2)}// ä½¿ç”¨ä¹‹å‰å¯ä»¥æ£€æŸ¥å®ƒçš„å¯ç©ºæ€§name?.run { val subName = name.substring(1,2) }?:throw IllegalArgumentException(&quot;name must not be null&quot;) åœ¨è¿™ä¸ªä¾‹å­å½“ä¸­ï¼Œname?.run ä¼šæ›´å¥½ä¸€äº›ï¼Œå› ä¸ºåœ¨ä½¿ç”¨ä¹‹å‰å¯ä»¥æ£€æŸ¥å®ƒçš„å¯ç©ºæ€§ã€‚ ä½œç”¨åŸŸå‡½æ•°çš„å‚æ•°ï¼ˆthisã€itï¼‰æˆ‘ä»¬åœ¨æ¥çœ‹ä¸€ä¸‹ T.run å’Œ T.letï¼Œå®ƒä»¬éƒ½æ˜¯æ‰©å±•å‡½æ•°ï¼Œä½†æ˜¯ä»–ä»¬çš„å‚æ•°ä¸ä¸€æ ·ï¼ŒT.run çš„å‚æ•°æ˜¯ this, T.let çš„å‚æ•°æ˜¯ itã€‚ val name: String? = &quot;hi-dhl.com&quot;// å‚æ•°æ˜¯ thisï¼Œå¯ä»¥çœç•¥ä¸å†™name?.run { println(&quot;The length is ${this.length} this æ˜¯å¯ä»¥çœç•¥çš„ ${length}&quot;)}// å‚æ•° itname?.let { println(&quot;The length is ${it.length}&quot;)}// è‡ªå®šä¹‰å‚æ•°åå­—name?.let { str -&gt; println(&quot;The length is ${str.length}&quot;)} åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ä¼¼ä¹ T.run ä¼šæ›´å¥½ï¼Œå› ä¸º this å¯ä»¥çœç•¥ï¼Œè°ƒç”¨æ›´åŠ çš„ç®€æ´ï¼Œä½†æ˜¯ T.let å…è®¸æˆ‘ä»¬è‡ªå®šä¹‰å‚æ•°åå­—ï¼Œä½¿å¯è¯»æ€§æ›´å¼ºï¼Œå¦‚æœå€¾å‘å¯è¯»æ€§å¯ä»¥é€‰æ‹© T.letã€‚ ä½œç”¨åŸŸå‡½æ•°çš„è¿”å›å€¼ï¼ˆè°ƒç”¨æœ¬èº«ã€å…¶ä»–ç±»å‹å³æœ€åä¸€è¡Œï¼‰æ¥ä¸‹é‡Œæˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹ T.let å’Œ T.also å®ƒä»¬æ¥å—çš„å‚æ•°éƒ½æ˜¯ it, ä½†æ˜¯å®ƒä»¬çš„è¿”å›å€¼æ˜¯ä¸åŒçš„ï¼ŒT.let è¿”å›çš„æ˜¯æœ€åä¸€è¡Œï¼ŒT.also è¿”å›è°ƒç”¨è€…æœ¬èº«ã€‚ var name = &quot;hi-dhl&quot;// è¿”å›è°ƒç”¨æœ¬èº«name = name.also { val result = 1 * 1 &quot;juejin&quot;}println(&quot;name = ${name}&quot;) // name = hi-dhl// è¿”å›çš„æœ€åä¸€è¡Œname = name.let { val result = 1 * 1 &quot;hi-dhl.com&quot;}println(&quot;name = ${name}&quot;) // name = hi-dhl.com ä»ä¸Šé¢çš„ä¾‹å­æ¥çœ‹ T.also ä¼¼ä¹æ²¡æœ‰ä»€ä¹ˆæ„ä¹‰ï¼Œç»†æƒ³ä¸€ä¸‹å…¶å®æ˜¯éå¸¸æœ‰æ„ä¹‰çš„ï¼Œåœ¨ä½¿ç”¨ä¹‹å‰å¯ä»¥è¿›è¡Œè‡ªæˆ‘æ“ä½œï¼Œç»“åˆå…¶ä»–çš„å‡½æ•°ï¼ŒåŠŸèƒ½ä¼šæ›´å¼ºå¤§ã€‚ fun makeDir(path: String) = path.let{ File(it) }.also{ it.mkdirs() } å½“ç„¶ T.also è¿˜å¯ä»¥åšå…¶ä»–äº‹æƒ…ï¼Œæ¯”å¦‚åˆ©ç”¨ T.also åœ¨ä½¿ç”¨ä¹‹å‰å¯ä»¥è¿›è¡Œè‡ªæˆ‘æ“ä½œç‰¹ç‚¹ï¼Œå¯ä»¥å®ç°ä¸€è¡Œä»£ç äº¤æ¢ä¸¤ä¸ªå˜é‡ï¼Œåœ¨åé¢ä¼šæœ‰è¯¦ç»†ä»‹ç» T.apply å‡½æ•°é€šè¿‡ä¸Šé¢çš„åˆ†æï¼Œå¤§è‡´äº†è§£äº†å‡½æ•°çš„è¡Œä¸ºï¼Œæ¥ä¸‹æ¥çœ‹ä¸€ä¸‹ T.apply å‡½æ•°ï¼ŒT.apply å‡½æ•°æ˜¯ä¸€ä¸ªæ‰©å±•å‡½æ•°ï¼Œè¿”å›å€¼æ˜¯å®ƒæœ¬èº«ï¼Œå¹¶ä¸”æ¥å—çš„å‚æ•°æ˜¯ thisã€‚ // æ™®é€šæ–¹æ³•fun createInstance(args: Bundle) : MyFragment { val fragment = MyFragment() fragment.arguments = args return fragment}// æ”¹è¿›æ–¹æ³•fun createInstance(args: Bundle) = MyFragment().apply { arguments = args } // æ™®é€šæ–¹æ³•fun createIntent(intentData: String, intentAction: String): Intent { val intent = Intent() intent.action = intentAction intent.data=Uri.parse(intentData) return intent}// æ”¹è¿›æ–¹æ³•ï¼Œé“¾å¼è°ƒç”¨fun createIntent(intentData: String, intentAction: String) = Intent().apply { action = intentAction } .apply { data = Uri.parse(intentData) } ä½¿ç”¨ T.also å‡½æ•°äº¤æ¢ä¸¤ä¸ªå˜é‡æ¥ä¸‹æ¥æ¼”ç¤ºçš„æ˜¯ä½¿ç”¨ T.also å‡½æ•°ï¼Œå®ç°ä¸€è¡Œä»£ç äº¤æ¢ä¸¤ä¸ªå˜é‡ï¼Ÿæˆ‘ä»¬å…ˆæ¥å›é¡¾ä¸€ä¸‹ Java çš„åšæ³•ã€‚ int a = 1;int b = 2;// Java - ä¸­é—´å˜é‡int temp = a;a = b;b = temp;System.out.println(&quot;a = &quot;+a +&quot; b = &quot;+b); // a = 2 b = 1// Java - åŠ å‡è¿ç®—a = a + b;b = a - b;a = a - b;System.out.println(&quot;a = &quot; + a + &quot; b = &quot; + b); // a = 2 b = 1 // Java - ä½è¿ç®—a = a ^ b;b = a ^ b;a = a ^ b;System.out.println(&quot;a = &quot; + a + &quot; b = &quot; + b); // a = 2 b = 1// Kotlina = b.also { b = a }println(&quot;a = ${a} b = ${b}&quot;) // a = 2 b = 1 ä¸€èµ·æ¥åˆ†æ T.also æ˜¯å¦‚ä½•åšåˆ°çš„ï¼Œå…¶å®è¿™é‡Œç”¨åˆ°äº† T.also å‡½æ•°çš„ä¸¤ä¸ªç‰¹ç‚¹ã€‚ è°ƒç”¨ T.also å‡½æ•°è¿”å›çš„æ˜¯è°ƒç”¨è€…æœ¬èº«ã€‚ åœ¨ä½¿ç”¨ä¹‹å‰å¯ä»¥è¿›è¡Œè‡ªæˆ‘æ“ä½œã€‚ ä¹Ÿå°±æ˜¯è¯´ b.also { b = a } ä¼šå…ˆå°† a çš„å€¼ (1) èµ‹å€¼ç»™ bï¼Œæ­¤æ—¶ b çš„å€¼ä¸º 1ï¼Œç„¶åå°† b åŸå§‹çš„å€¼ï¼ˆ2ï¼‰èµ‹å€¼ç»™ aï¼Œæ­¤æ—¶ a çš„å€¼ä¸º 2ï¼Œå®ç°äº¤æ¢ä¸¤ä¸ªå˜é‡çš„ç›®çš„ã€‚ æ±‡æ€»ä¸ºäº†æ›´æ–¹ä¾¿çš„ç†è§£å’Œè®°å¿†ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¥è¡¨æ ¼çš„å½¢å¼å°†ä¸Šé¢çš„å†…å®¹è¿›è¡Œæ±‡æ€»ï¼Œå…·ä½“è¿˜éœ€è¦æœ‰ç»“åˆå®é™…é¡¹ç›®å»ä½¿ç”¨ã€‚ å‡½æ•° æ˜¯å¦æ˜¯æ‰©å±•å‡½æ•° å‡½æ•°å‚æ•°(thisã€it) è¿”å›å€¼(è°ƒç”¨æœ¬èº«ã€æœ€åä¸€è¡Œ) with ä¸æ˜¯ this æœ€åä¸€è¡Œ T.run æ˜¯ this æœ€åä¸€è¡Œ T.let æ˜¯ it æœ€åä¸€è¡Œ T.also æ˜¯ it è°ƒç”¨æœ¬èº« T.apply æ˜¯ this è°ƒç”¨æœ¬èº« å…¨æ–‡åˆ°è¿™é‡Œå°±ç»“æŸäº†ï¼Œå¤§å®¶å¯ä»¥åœ¨é¡¹ç›®ä¸­çµæ´»çš„å»è¿ç”¨ï¼Œå¯ä»¥è®©ä»£ç çš„å¯è¯»æ€§æ›´é«˜ï¼Œå¦‚æœä½ åœ¨ Kotlin ä¸­é‡åˆ°äº†é‚£äº›å‘ï¼Œæ¬¢è¿åœ¨è¯„è®ºåŒºåˆ†äº«ï¼Œæ›´å¤šä¼˜ç§€çš„è‹±æ–‡æŠ€æœ¯æ–‡ç« ï¼Œç‚¹å‡»è¿™é‡Œ ç²¾é€‰è¯‘æ–‡ æ›´å¤šå…³äº Kotlin çš„å†…è”å‡½æ•° run, with, let, also, apply åœ¨å®é™…é¡¹ç›®ä¸­çš„ä½¿ç”¨ï¼Œå¯ä»¥çœ‹æˆ‘å¦å¤–ä¸€ä¸ªé¡¹ç›® PokemonGo ï¼ŒåŸºäº Jetpack + MVVM + Repository + Data Mapper + Kotlin Flow + Kotlin æŠ€å·§çš„å®æˆ˜é¡¹ç›®ï¼Œå¯ä»¥ç‚¹å‡»ä¸‹é¢é“¾æ¥å‰å»æŸ¥çœ‹ã€‚ PokemonGo ä»“åº“åœ°å€ï¼šhttps://github.com/hi-dhl/PokemonGo æ¨èæ–‡ç«  [è¯‘][Googleå·¥ç¨‹å¸ˆ] åˆšåˆšå‘å¸ƒäº† Fragment çš„æ–°ç‰¹æ€§ â€œFragment é—´ä¼ é€’æ•°æ®çš„æ–°æ–¹å¼â€ ä»¥åŠæºç åˆ†æ [è¯‘][Googleå·¥ç¨‹å¸ˆ] è¯¦è§£ FragmentFactory å¦‚ä½•ä¼˜é›…ä½¿ç”¨ Koin ä»¥åŠéƒ¨åˆ†æºç åˆ†æ [è¯‘][2.4K Start] æ”¾å¼ƒ Dagger æ‹¥æŠ± Koin [è¯‘][5k+] Kotlin çš„æ€§èƒ½ä¼˜åŒ–é‚£äº›äº‹ [è¯‘] è§£å¯† RxJava çš„å¼‚å¸¸å¤„ç†æœºåˆ¶ [è¯‘][1.4K+ Star] Kotlin æ–°ç§€ Coil VS Glide and Picasso æ›´å¤šâ€¦â€¦","link":"/2020/08/17/translate/07-kotlin-let-run/"},{"title":"ã€Œè¯‘ã€è§£å¯† RxJava çš„å¼‚å¸¸å¤„ç†æœºåˆ¶","text":"å‰è¨€ åŸæ ‡é¢˜: Beyond Basic RxJava Error Handling åŸæ–‡åœ°å€: https://proandroiddev.com/beyond-basicâ€¦â€¦ åŸæ–‡ä½œè€…ï¼šElyeï¼Œä»…åœ¨ medium ä¸Šå°±æœ‰ 5.2k+ ç²‰ä¸ ä»Šå¤©çœ‹åˆ°ä¸€ç¯‡å¤§ç¥ Elye å…³äº RxJava å¼‚å¸¸çš„å¤„ç†çš„æ–‡ç« ï¼Œè®©æˆ‘å¯¹ RxJava å¼‚å¸¸çš„å¤„ç†æœ‰äº†ä¸€ä¸ªæ¸…æ™°çš„äº†è§£ï¼Œç”¨äº† RxJava å¾ˆä¹…äº†å¯¹é‡Œé¢çš„å¼‚å¸¸å¤„ç†æœºåˆ¶ä¸€ç›´å¾ˆæ‡µæ‡‚ã€‚ é€šè¿‡è¿™ç¯‡æ–‡ç« ä½ å°†å­¦ä¹ åˆ°ä»¥ä¸‹å†…å®¹ï¼Œå°†åœ¨è¯‘è€…æ€è€ƒéƒ¨åˆ†ä¼šç»™å‡ºç›¸åº”çš„ç­”æ¡ˆ just å’Œ fromCallable åŒºåˆ«ï¼Ÿ ä»€ä¹ˆæ˜¯ RxJavaPlugins.setErrorHandlerï¼Ÿ Crashes å‘ç”Ÿåœ¨ just() ä¸­çš„å¤„ç†æ–¹æ¡ˆï¼Ÿ Crashes å‘ç”Ÿåœ¨ subscribe success ä¸­çš„å¤„ç†æ–¹æ¡ˆï¼Ÿ Crashes å‘ç”Ÿåœ¨ subscribe error ä¸­çš„å¤„ç†æ–¹æ¡ˆï¼Ÿ Crashes å‘ç”Ÿåœ¨ complete ä¸­çš„å¤„ç†æ–¹æ¡ˆï¼Ÿ Crashes å‘ç”Ÿåœ¨ complete ä¹‹å‰çš„å¤„ç†æ–¹æ¡ˆï¼Ÿ è¿™ç¯‡æ–‡ç« æ¶‰åŠå¾ˆå¤šé‡è¦çš„çŸ¥è¯†ç‚¹ï¼Œè¯·è€å¿ƒè¯»ä¸‹å»ï¼Œåº”è¯¥å¯ä»¥ä»ä¸­å­¦åˆ°å¾ˆå¤šæŠ€å·§ã€‚ è¯‘æ–‡å¤§éƒ¨åˆ†äº†è§£ RxJava çš„äººéƒ½ä¼šå–œæ¬¢å®ƒï¼Œå› ä¸ºå®ƒèƒ½å¤Ÿå°è£… onError å›è°ƒä¸Šçš„é”™è¯¯å¤„ç†ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š Single.just(getSomeData()) .map { item -&gt; handleMap(item) } .subscribe( { result -&gt; handleResult(result) }, { error -&gt; handleError(error) } // Expect all error capture ) ä½ å¯èƒ½ä¼šä»¥ä¸ºæ‰€æœ‰çš„ Crashes éƒ½å°†è°ƒç”¨ handleError æ¥å¤„ç†ï¼Œä½†å…¶å®å¹¶å…¨éƒ½æ˜¯è¿™æ ·çš„ Crashes å‘ç”Ÿåœ¨ just() ä¸­æˆ‘å…ˆæ¥çœ‹ä¸€ä¸ªç®€å•çš„ä¾‹å­ï¼Œå‡è®¾ crashes å‘ç”Ÿåœ¨ getSomeData() æ–¹æ³•å†…éƒ¨ Single.just(getSomeData() /**ğŸ”¥CrashğŸ”¥**/ ) .map { item -&gt; handleMap(item) } .subscribe( { result -&gt; handleResult(result) }, { error -&gt; handleError(error) } // Crash NOT caught â›”ï¸ è¿™ä¸ªé”™è¯¯å°†ä¸ä¼šåœ¨ handleError ä¸­æ•è·ï¼Œå› ä¸º just() ä¸æ˜¯ RxJava è°ƒç”¨é“¾çš„ä¸€éƒ¨åˆ†ï¼Œå¦‚æœä½ æƒ³æ•è·å®ƒï¼Œä½ å¯èƒ½éœ€è¦åœ¨æœ€å¤–å±‚æ·»åŠ  try-catch æ¥å¤„ç†ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š try { Single.just(getSomeData() /**ğŸ”¥CrashğŸ”¥**/ ) .map { item -&gt; handleMap(item) } .subscribe( { result -&gt; handleResult(result) }, { error -&gt; handleError(error) } // Crash NOT caught â›”ï¸ )} catch (exception: Exception) { handleError(exception) // Crash caught âœ…} å¦‚æœä½ ä¸ä½¿ç”¨ just ï¼Œè€Œæ˜¯ä½¿ç”¨ RxJava å†…éƒ¨çš„ä¸€äº›ä¸œè¥¿ï¼Œä¾‹å¦‚ fromCallableï¼Œé”™è¯¯å°†ä¼šè¢«æ•è· Single.fromCallable{ getSomeData() /**ğŸ”¥CrashğŸ”¥**/ } .map { item -&gt; handleMap(item) } .subscribe( { result -&gt; handleResult(result) }, { error -&gt; handleError(error) } // Crash caught âœ… ) Crashes å‘ç”Ÿåœ¨ subscribe success ä¸­è®©æˆ‘ä»¬æ¥å‡è®¾ä¸€ä¸‹ Crashes å‡ºç°åœ¨ subscribe success ä¸­ï¼Œå¦‚ä¸‹æ‰€ç¤º Single.just(getSomeData() ) .map { item -&gt; handleMap(item) } .subscribe( { result -&gt; handleResult(result) /**ğŸ”¥CrashğŸ”¥**/ }, { error -&gt; handleError(error) } // Crash NOT caught â›”ï¸ ) è¿™ä¸ªé”™è¯¯å°†ä¸ä¼šè¢« handleError æ•è·ï¼Œå¥‡æ€ªçš„æ˜¯ï¼Œå¦‚æœæˆ‘ä»¬å°† Single æ¢æˆ Observableï¼Œå¼‚å¸¸å°±ä¼šè¢«æ•è·ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š Observable.just(getSomeData() ) .map { item -&gt; handleMap(item) } .subscribe( { result -&gt; handleResult(result) /**ğŸ”¥CrashğŸ”¥**/ }, { error -&gt; handleError(error) }, // Crash caught âœ… { handleCompletion() } ) åŸå› æ˜¯åœ¨ Single ä¸­æˆåŠŸçš„è®¢é˜…è¢«è®¤ä¸ºæ˜¯ä¸€ä¸ªå®Œæ•´çš„æµã€‚å› æ­¤ï¼Œé”™è¯¯ä¸å†èƒ½è¢«æ•è·ã€‚è€Œåœ¨ Observable ä¸­ï¼Œå®ƒè®¤ä¸º onNext éœ€è¦å¤„ç†ï¼Œå› æ­¤ crash ä»ç„¶å¯ä»¥è¢«æ•è·ï¼Œé‚£ä¹ˆæˆ‘ä»¬åº”è¯¥å¦‚ä½•è§£å†³è¿™ä¸ªé—®é¢˜å‘¢ é”™è¯¯çš„å¤„ç†æ–¹å¼ï¼Œåƒä¹‹å‰ä¸€æ ·ï¼Œåœ¨æœ€å¤–å±‚ä½¿ç”¨ try-catch è¿›è¡Œå¼‚å¸¸æ•è· try { Single.just(getSomeData()) .map { item -&gt; handleMap(item) } .subscribe( { result -&gt; handleResult(result)/**ğŸ”¥CrashğŸ”¥**/ }, { error -&gt; handleError(error) } // Crash NOT caught â›”ï¸ )} catch (exception: Exception) { handleError(exception) // Crash NOT caught â›”ï¸} ä½†æ˜¯è¿™æ ·åšå…¶å®å¼‚å¸¸å¹¶æ²¡æœ‰è¢«æ•è·ï¼Œcrash ä¾ç„¶åœ¨ä¼ é€’ï¼Œå› ä¸º RxJava åœ¨å†…éƒ¨å¤„ç†äº† crashï¼Œå¹¶æ²¡æœ‰ä¼ é€’åˆ°å¤–éƒ¨ ä¸€ç§å¾ˆå¥‡æ€ªçš„æ–¹å¼ï¼Œåœ¨ subscribe successful ä¸­ï¼Œæ‰§è¡Œ try-catch Single.just(getSomeData() ) .map { item -&gt; handleMap(item) } .subscribe( { result -&gt; try { handleResult(result) /**ğŸ”¥CrashğŸ”¥**/ } catch (exception: Exception) { handleError(exception) // Crash caught âœ… } }, { error -&gt; handleError(error) }, // Crash NOT caught â›”ï¸ ) è¿™ç§æ–¹å¼è™½ç„¶æ•è·ä½äº†è¿™ä¸ªå¼‚å¸¸ï¼Œä½†æ˜¯ RxJava å¹¶ä¸çŸ¥é“å¦‚ä½•å¤„ç† ä¸€ç§æ¯”è¾ƒå¥½çš„æ–¹å¼ ä¸Šæ–‡æåˆ°äº†ä½¿ç”¨ Single åœ¨ subscribe successful ä¸­ä¸èƒ½æ•è·å¼‚å¸¸ï¼Œå› ä¸ºè¢«è®¤ä¸ºæ˜¯ä¸€ä¸ªå®Œæ•´çš„æµï¼Œå¤„ç†è¿™ä¸ªæƒ…å†µæ¯”è¾ƒå¥½çš„æ–¹å¼ï¼Œå¯ä»¥ä½¿ç”¨ doOnSuccess æ–¹æ³• Single.just(getSomeData() ) .map { item -&gt; handleMap(item) } .doOnSuccess { result -&gt; handleResult(result) /*ğŸ”¥CrashğŸ”¥*/ }, } .subscribe( { /** REMOVE CODE **/ }, { error -&gt; handleError(error) } // Crash caught âœ… ) å½“æˆ‘ä»¬æŒ‰ç…§ä¸Šé¢æ–¹å¼å¤„ç†çš„æ—¶å€™ï¼Œé”™è¯¯å°†ä¼šè¢« onError æ•è·ï¼Œå¦‚æœæƒ³è®©ä»£ç æ›´å¥½çœ‹ï¼Œå¯ä»¥ä½¿ç”¨ doOnError æ–¹æ³•ï¼Œå¦‚ä¸‹æ‰€ç¤º: Single.just(getSomeData() ) .map { item -&gt; handleMap(item) } .doOnSuccess { result -&gt; handleResult(result) /*ğŸ”¥CrashğŸ”¥*/ }, } .doOnError { error -&gt; handleError(error) } // Crash NOT stop â›”ï¸ .subscribe() ä½†æ˜¯è¿™å¹¶æ²¡æœ‰å®Œå…¨è§£å†³ crash é—®é¢˜ï¼Œè™½ç„¶å·²ç»æ•è·äº†ä½†å¹¶æ²¡æœ‰åœæ­¢ï¼Œå› æ­¤ crash ä»ç„¶å‘ç”Ÿã€‚ æ›´å‡†ç¡®çš„è§£é‡Šï¼Œå®ƒå®é™…ä¸Šç¡®å®æ•è·äº† crashï¼Œä½†æ˜¯ doOnError ä¸æ˜¯å®Œæ•´çŠ¶æ€ï¼Œå› æ­¤é”™è¯¯ä»åº”è¯¥åœ¨ onError ä¸­å¤„ç†ï¼Œå¦åˆ™å®ƒä¼šåœ¨é‡Œé¢ crashï¼Œæ‰€ä»¥æˆ‘ä»¬è‡³å°‘åº”è¯¥æä¾›ä¸€ä¸ªç©ºçš„ onError Single.just(getSomeData() ) .map { item -&gt; handleMap(item) } .doOnSuccess { result -&gt; handleResult(result) /*ğŸ”¥CrashğŸ”¥*/ }, } .doOnError { error -&gt; handleError(error) } // Crash NOT stop â›”ï¸ .subscribe({} {}) // But crash stop here âœ… Crashes å‘ç”Ÿåœ¨ subscribe error ä¸­æˆ‘ä»¬æ¥æ€è€ƒä¸€ä¸‹å¦‚æœ Crashes å‘ç”Ÿåœ¨ subscribe error ä¸­æ€ä¹ˆå¤„ç†ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š Single.just(getSomeData() ) .map { item -&gt; handleMap(item) } .subscribe( { result -&gt; handleResult(result) }, { error -&gt; handleError(error) /**ğŸ”¥CrashğŸ”¥**/ } )``` æˆ‘ä»¬å¯ä»¥æƒ³åˆ°ä½¿ç”¨ä¸Šæ–‡æåˆ°çš„æ–¹æ³•æ¥è§£å†³è¿™ä¸ªé—®é¢˜ Single.just(getSomeData() ) .map { item -&gt; handleMap(item) } .doOnSuccess { result -&gt; handleResult(result) }, } .doOnError { error -&gt; handleError(error) /ğŸ”¥CrashğŸ”¥/ } .subscribe({} {}) // Crash stop here âœ… å°½ç®¡è¿™æ ·å¯ä»¥é¿å… crash ï¼Œä½†æ˜¯ä»ç„¶å¾ˆå¥‡æ€ªï¼Œå› ä¸ºæ²¡æœ‰åœ¨ crash æ—¶åšä»»ä½•äº‹æƒ…ï¼Œæˆ‘ä»¬å¯ä»¥æŒ‰ç…§ä¸‹é¢çš„æ–¹å¼ï¼Œåœ¨ onError ä¸­æ•è·å¼‚å¸¸ï¼Œè¿™æ˜¯ä¸€ç§éå¸¸æœ‰è¶£çš„ç¼–ç¨‹æ–¹å¼ã€‚ Single.just(getSomeData() ) .map { item -&gt; handleMap(item) } .doOnSuccess { result -&gt; handleResult(result) }, } .doOnError { error -&gt; handleError(error) /ğŸ”¥CrashğŸ”¥/ } .subscribe({} { error -&gt; handleError(error) }) // Crash caught âœ… ä¸ç®¡æ€ä¹ˆæ ·è¿™ä¸ªæ–¹æ¡ˆæ˜¯å¯è¡Œçš„ï¼Œåœ¨è¿™é‡Œåªæ˜¯å±•ç¤ºå¦‚ä½•å¤„ç†ï¼Œåé¢è¿˜ä¼šæœ‰å¾ˆå¥½çš„æ–¹å¼### Crashes å‘ç”Ÿåœ¨ complete ä¸­ä¾‹å¦‚ Observable é™¤äº† onError å’Œ onNextï¼ˆè¿˜æœ‰ç±»ä¼¼äº Single çš„ onSuccessï¼‰ä¹‹å¤–ï¼Œè¿˜æœ‰onComplete çŠ¶æ€ã€‚å¦‚æœ crashes å‘ç”Ÿåœ¨å¦‚ä¸‹æ‰€ç¤ºçš„ onComplete ä¸­ï¼Œå®ƒå°†ä¸ä¼šè¢«æ•è·ã€‚ Observable.just(getSomeData() ) .map { item -&gt; handleMap(item) } .subscribe( { result -&gt; handleResult(result) }, { error -&gt; handleError(error) }, // Crash NOT caught â›”ï¸ { handleCompletion()/ğŸ”¥CrashğŸ”¥/ } ) æˆ‘ä»¬å¯ä»¥æŒ‰ç…§ä¹‹å‰çš„æ–¹æ³•åœ¨ doOnComplete æ–¹æ³•ä¸­è¿›è¡Œå¤„ç†ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š Observable.just(getSomeData() ) .map { item -&gt; handleMap(item) } .doOnNext{ result -&gt; handleResult(result) } .doOnError{ error -&gt; handleError(error) } Crash NOT stop â›”ï¸ .doOnComplete { handleCompletion()/ğŸ”¥CrashğŸ”¥/ } .subscribe({ }, { }, { }) // Crash STOP here âœ… æœ€ç»ˆ crash èƒ½å¤Ÿåœ¨ doOnError ä¸­æ•è·ï¼Œå¹¶åœ¨æˆ‘ä»¬æä¾›çš„æœ€åä¸€ä¸ªç©º onError å‡½æ•°å¤„åœæ­¢ï¼Œä½†æ˜¯æˆ‘ä»¬é€šè¿‡è¿™ç§è§£å†³æ–¹æ³•é€ƒé¿äº†é—®é¢˜ã€‚### Crashes å‘ç”Ÿåœ¨ complete ä¹‹å‰è®©æˆ‘ä»¬çœ‹å¦ä¸€ç§æœ‰è¶£çš„æƒ…å†µï¼Œæˆ‘ä»¬æ¨¡æ‹Ÿä¸€ç§æƒ…å†µï¼Œæˆ‘ä»¬è®¢é˜…çš„æ“ä½œéå¸¸æ…¢ï¼Œæ— æ³•è½»æ˜“ç»ˆæ­¢ï¼ˆå¦‚æœç»ˆæ­¢ï¼Œå®ƒå°†crashï¼‰ val disposeMe = Observable.fromCallable { Thread.sleep(1000) } .doOnError{ error -&gt; handleError(error) } // Crash NOT caught â›”ï¸ .subscribe({}, {}, {}) // Crash NOT caught or stop â›”ï¸Handler().postDelayed({ disposeMe.dispose() }, 100) æˆ‘ä»¬åœ¨ fromCallable ä¸­ç­‰å¾… 1000 æ‰èƒ½å®Œæˆï¼Œä½†æ˜¯åœ¨100æ¯«ç§’ï¼Œæˆ‘ä»¬é€šè¿‡è°ƒç”¨ disposeMe.dispose() ç»ˆæ­¢æ“ä½œã€‚è¿™å°†è¿«ä½¿ Thread.sleepï¼ˆ1000ï¼‰åœ¨ç»“æŸä¹‹å‰ç»ˆæ­¢ï¼Œä»è€Œä½¿å…¶å´©æºƒï¼Œæ— æ³•é€šè¿‡ doOnError æˆ–è€…æä¾›çš„ onError å‡½æ•°æ•è·å´©æºƒå³ä½¿æˆ‘ä»¬åœ¨æœ€å¤–é¢ä½¿ç”¨ try-catchï¼Œä¹Ÿæ˜¯æ²¡ç”¨çš„ï¼Œä¹Ÿæ— æ³•åƒå…¶ä»–æ‰€æœ‰ RxJava å†…éƒ¨ crash ä¸€æ ·èµ·ä½œç”¨ã€‚ try { val disposeMe = Observable.fromCallable { Thread.sleep(1000) } .doOnError{} // Crash NOT caught â›”ï¸ .subscribe({}, {}, {}) // Crash NOT caught or stop â›”ï¸ Handler().postDelayed({ disposeMe.dispose() }, 100)} catch (exception: Exception) { handleError(exception) // Crash NOT caught too â›”ï¸} ### RxJava Crash ç»ˆæè§£å†³æ–¹æ¡ˆå¯¹äº RxJava å¦‚æœç¡®å®å‘ç”Ÿäº† crashï¼Œä½† crash ä¸åœ¨æ‚¨çš„æ§åˆ¶èŒƒå›´å†…ï¼Œå¹¶ä¸”æ‚¨å¸Œæœ›é‡‡ç”¨ä¸€ç§å…¨å±€çš„æ–¹å¼æ•è·å®ƒï¼Œå¯ä»¥ç”¨ä¸‹é¢æ˜¯è§£å†³æ–¹æ¡ˆã€‚ RxJavaPlugins.setErrorHandler { e -&gt; handleError(e) } æ³¨å†Œ ErrorHandler å®ƒå°†æ•è·ä¸Šè¿°ä»»ä½•æƒ…å†µä¸‹çš„æ‰€æœ‰ RxJava æœªæ•è·çš„é”™è¯¯ï¼ˆ just() é™¤å¤–ï¼Œå› ä¸ºå®ƒä¸å±äºRxJava è°ƒç”¨é“¾çš„ä¸€éƒ¨åˆ†ï¼‰ä½†æ˜¯è¦æ³¨æ„ç”¨äºè°ƒç”¨é”™è¯¯å¤„ç†çš„çº¿ç¨‹åœ¨ crash å‘ç”Ÿçš„åœ°æ–¹æŒ‚èµ·ï¼Œå¦‚æœä½ æƒ³ç¡®ä¿å®ƒæ€»æ˜¯å‘ç”Ÿåœ¨ä¸»UIçº¿ç¨‹ä¸Šï¼Œç”¨ runOnUiThread{ } åŒ…æ‹¬èµ·æ¥ RxJavaPlugins.setErrorHandler { e -&gt; runOnUiThread { handleError(e))}} å› æ­¤ï¼Œå¯¹äºä¸Šé¢çš„æƒ…å†µï¼Œç”±äºåœ¨å®Œæˆä¹‹å‰ç»ˆæ­¢è€Œå¯¼è‡´ Crashï¼Œä¸‹é¢å°†å¯¹æ­¤è¿›è¡Œå¤„ç†ã€‚ RxJavaPlugins.setErrorHandler { e -&gt; handle(e) } // Crash caught âœ…val disposeMe = Observable.fromCallable { Thread.sleep(1000) } .doOnError{ error -&gt; handleError(error) } // Crash NOT caught â›”ï¸ .subscribe({}, {}, {}) // Crash NOT caught or stop â›”ï¸Handler().postDelayed({ disposeMe.dispose() }, 100) æœ‰äº†è¿™ä¸ªè§£å†³æ–¹æ¡ˆï¼Œå¹¶ä¸æ„å‘³ç€æ³¨å†Œ ErrorHandler å°±æ˜¯æ­£ç¡®çš„æ–¹å¼ RxJavaPlugins.setErrorHandler { e -&gt; handle(e) } é€šè¿‡äº†è§£ä¸Šé¢å‘ç”Ÿ Crash å¤„ç†æ–¹æ¡ˆï¼Œæ‚¨å°±å¯ä»¥é€‰æ‹©æœ€æœ‰æ•ˆçš„è§£å†³æ–¹æ¡ˆï¼Œå¤šä¸ªæ–¹æ¡ˆé…åˆä¸€èµ·ä½¿ç”¨ï¼Œä»¥æ›´å¥å£®åœ°å¤„ç†ç¨‹åºæ‰€å‘ç”Ÿçš„çš„ Crashã€‚## è¯‘è€…æ€è€ƒä½œè€…å¤§æ¦‚æ€»äº† 5 ç§ RxJava å¯èƒ½å‡ºç°çš„å¼‚å¸¸çš„ä½ç½®* Crashes å‘ç”Ÿåœ¨ just() ä¸­* Crashes å‘ç”Ÿåœ¨ subscribe success ä¸­* Crashes å‘ç”Ÿåœ¨ subscribe error ä¸­* Crashes å‘ç”Ÿåœ¨ complete ä¸­* Crashes å‘ç”Ÿåœ¨ complete ä¹‹å‰æ€»çš„æ¥è¯´ RxJava æ— æ³•åˆ¤æ–­è¿™äº›è¶…å‡ºç”Ÿå‘½å‘¨æœŸçš„ã€ä¸å¯äº¤ä»˜çš„å¼‚å¸¸ä¸­å“ªäº›åº”è¯¥æˆ–ä¸åº”è¯¥å¯¼è‡´åº”ç”¨ç¨‹åºå´©æºƒï¼Œæœ€åä½œè€…ç»™å‡ºäº†ï¼ŒRxJava Crash ç»ˆæè§£å†³æ–¹æ¡ˆï¼Œæ³¨å†Œ ErrorHandler RxJavaPlugins.setErrorHandler { e -&gt; handleError(e) } å®ƒå°†æ•è·ä¸Šè¿°ä»»ä½•æƒ…å†µä¸‹çš„æ‰€æœ‰ RxJava æœªæ•è·çš„é”™è¯¯ï¼Œjust() é™¤å¤–ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬æ¥äº†è§£ä¸€ä¸‹ RxJavaPlugins.setErrorHandler### å…³äº RxJavaPlugins.setErrorHandlerè¿™æ˜¯ RxJava2.x çš„ä¸€ä¸ªé‡è¦è®¾è®¡ï¼Œä»¥ä¸‹å‡ ç§ç±»å‹çš„é”™è¯¯ RxJava æ˜¯æ— æ³•æ•è·çš„ï¼š* ç”±äºä¸‹æ¸¸çš„ç”Ÿå‘½å‘¨æœŸå·²ç»è¾¾åˆ°å…¶ç»ˆç«¯çŠ¶æ€å¯¼è‡´çš„å¼‚å¸¸* ä¸‹æ¸¸å–æ¶ˆäº†å°†è¦å‘å‡ºé”™è¯¯çš„åºåˆ—è€Œæ— æ³•å‘å‡ºçš„é”™è¯¯* å‘ç”Ÿäº† crash ï¼Œä½†æ˜¯ crash ä¸åœ¨æ‚¨çš„æ§åˆ¶èŒƒå›´å†…* ä¸€äº›ç¬¬ä¸‰æ–¹åº“çš„ä»£ç åœ¨è¢«å–æ¶ˆ æˆ–è€… è°ƒç”¨ä¸­æ–­æ—¶ä¼šæŠ›å‡ºè¯¥å¼‚å¸¸ï¼Œè¿™é€šå¸¸ä¼šå¯¼è‡´æ— æ³•äº¤ä»˜çš„å¼‚å¸¸ã€‚RxJava æ— æ³•åˆ¤æ–­è¿™äº›è¶…å‡ºç”Ÿå‘½å‘¨æœŸçš„ã€ä¸å¯äº¤ä»˜çš„å¼‚å¸¸ä¸­å“ªäº›åº”è¯¥æˆ–ä¸åº”è¯¥å¯¼è‡´åº”ç”¨ç¨‹åºå´©æºƒã€‚è¿™äº›æ— æ³•æ•è·çš„é”™è¯¯ï¼Œæœ€åä¼šå‘é€åˆ° RxJavaPlugins.onError å¤„ç†ç¨‹åºä¸­ã€‚è¿™ä¸ªå¤„ç†ç¨‹åºå¯ä»¥ç”¨æ–¹æ³•RxJavaPlugins.setErrorHandler() é‡å†™ï¼ŒRxJava é»˜è®¤æƒ…å†µä¸‹ä¼šå°† Throwable çš„ stacktrace æ‰“å°åˆ°æ§åˆ¶å°ï¼Œå¹¶è°ƒç”¨å½“å‰çº¿ç¨‹çš„æœªæ•è·å¼‚å¸¸å¤„ç†ç¨‹åºã€‚æ‰€ä»¥æˆ‘ä»¬å¯ä»¥é‡‡ç”¨ä¸€ç§å…¨å±€çš„å¤„ç†æ–¹å¼ï¼Œæ³¨å†Œä¸€ä¸ª RxJavaPlugins.setErrorHandler() ï¼Œæ·»åŠ ä¸€ä¸ªéç©ºçš„å…¨å±€é”™è¯¯å¤„ç†ï¼Œä¸‹é¢çš„ç¤ºä¾‹æ¼”ç¤ºäº†ä¸Šé¢åˆ—å‡ºæ¥çš„å‡ ç§æ— æ³•äº¤ä»˜çš„å¼‚å¸¸ã€‚ RxJavaPlugins.setErrorHandler(e -&gt; { if (e instanceof UndeliverableException) { e = e.getCause(); } if ((e instanceof IOException) || (e instanceof SocketException)) { // fine, irrelevant network problem or API that throws on cancellation return; } if (e instanceof InterruptedException) { // fine, some blocking code was interrupted by a dispose call return; } if ((e instanceof NullPointerException) || (e instanceof IllegalArgumentException)) { // thatâ€™s likely a bug in the application Thread.currentThread().getUncaughtExceptionHandler() .handleException(Thread.currentThread(), e); return; } if (e instanceof IllegalStateException) { // thatâ€™s a bug in RxJava or in a custom operator Thread.currentThread().getUncaughtExceptionHandler() .handleException(Thread.currentThread(), e); return; } Log.warning(â€œUndeliverable exception received, not sure what to doâ€, e);}); æˆ‘ç›¸ä¿¡åˆ°è¿™é‡Œå…³äº RxJava Crash å¤„ç†æ–¹æ¡ˆï¼Œåº”è¯¥äº†è§£çš„å¾ˆæ¸…æ¥šäº†ï¼Œé€‰æ‹©æœ€æœ‰æ•ˆçš„è§£å†³æ–¹æ¡ˆï¼Œå¤šä¸ªæ–¹æ¡ˆé…åˆä¸€èµ·ä½¿ç”¨ï¼Œå¯ä»¥æ›´å¥å£®åœ°å¤„ç†ç¨‹åºæ‰€å‘ç”Ÿçš„çš„ Crashã€‚æ¥ä¸‹æ¥æˆ‘ä»¬æ¥äº†è§£ä¸€ä¸‹ just å’Œ fromCallable åŒºåˆ« ï¼Œä½œè€…åœ¨å¦å¤–ä¸€ç¯‡æ–‡ç«  [just-vs-fromcallable](https://medium.com/@elye.project/rxjava-2-understanding-hot-vs-cold-with-just-vs-fromcallable-3c463f9f68c9) åšäº†è¯¦ç»†çš„ä»‹ç»### just å’Œ fromCallable åŒºåˆ«#### 1. å€¼è·å–æ¥æºä¸ä¸€æ ·just å€¼ä»å¤–éƒ¨è·å–çš„ï¼Œè€Œ fromCallable å€¼æ¥è‡ªäºå†…éƒ¨ç”Ÿæˆï¼Œä¸ºäº†æ›´æ¸…æ¥šçš„äº†è§£ï¼Œæˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹ä¸‹é¢çš„ä»£ç ï¼š println(â€œFrom Justâ€)val justSingle = Single.just(Random.nextInt())justSingle.subscribe{ it -&gt; println(it) }justSingle.subscribe{ it -&gt; println(it) } println(â€œ\\nFrom Callableâ€)val callableSingle = Single.fromCallable { Random.nextInt() }callableSingle.subscribe{ it -&gt; println(it) }callableSingle.subscribe{ it -&gt; println(it) } å¯¹äº Just å’Œ fromCallable åˆ†åˆ«è°ƒç”¨ 2 æ¬¡ subscribe æ‰§è¡Œç»“æœå¦‚ä¸‹æ‰€ç¤ºï¼š From Just801570614801570614 From Callable12516018492033593269 ä½ ä¼šå‘ç°å¯¹äº just æ— è®º subscribe å¤šå°‘æ¬¡ï¼Œç”Ÿæˆçš„éšæœºå€¼éƒ½ä¿æŒä¸å˜ï¼Œå› ä¸ºè¯¥å€¼æ˜¯ä» Observable å¤–éƒ¨ç”Ÿæˆçš„ï¼Œè€Œ Observable åªæ˜¯å°†å…¶å­˜å‚¨ä¾›ä»¥åä½¿ç”¨ã€‚ä½†æ˜¯å¯¹äº fromCallable å®ƒæ˜¯ä» Observable å†…éƒ¨ç”Ÿæˆçš„ï¼Œæ¯æ¬¡ subscribe éƒ½ä¼šéƒ½ä¼šç”Ÿæˆä¸€ä¸ªæ–°çš„éšæœºæ•°ã€‚#### 2. ç«‹å³æ‰§è¡Œå’Œå»¶è¿Ÿæ‰§è¡Œ* just åœ¨è°ƒç”¨ subscribe æ–¹æ³•ä¹‹å‰å€¼å·²ç»ç”Ÿæˆäº†ï¼Œå±äºç«‹å³æ‰§è¡Œã€‚* è€Œ fromCallable æ˜¯è°ƒç”¨ subscribe æ–¹æ³•ä¹‹åæ‰§è¡Œçš„ï¼Œå±äºå»¶è¿Ÿæ‰§è¡Œã€‚ä¸ºäº†æ›´æ¸…æ¥šçš„äº†è§£ï¼Œæˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹ä¸‹é¢çš„ä»£ç ï¼š fun main() { println(â€œFrom Justâ€) val justSingle = Single.just(getRandomMessage()) println(â€œstart subscribingâ€) justSingle.subscribe{ it -&gt; println(it) } println(&quot;\\nFrom Callable&quot;) val callableSingle = Single.fromCallable { getRandomMessage() } println(&quot;start subscribing&quot;) callableSingle.subscribe{ it -&gt; println(it) }} fun getRandomMessage(): Int { println(â€œ-Generating-â€œ) return Random.nextInt()} ç»“æœå¦‚ä¸‹æ‰€ç¤ºï¼š From Just-Generating-start subscribing1778320787 From Callablestart subscribing-Generating-1729786515 å¯¹äº just åœ¨è°ƒç”¨ subscribe ä¹‹å‰æ‰“å°äº† -Generating-ï¼Œè€Œ fromCallable æ˜¯åœ¨è°ƒç”¨ subscribe ä¹‹åæ‰æ‰“å° -Generating-ã€‚ åˆ°è¿™é‡Œæ–‡ç« å°±ç»“æŸäº†ï¼Œæˆ‘ä»¬æ¥ä¸€èµ·æ¢è®¨ä¸€ä¸ªé—®é¢˜ï¼Œ åœ¨ Java æ—¶ä»£ RxJava ç¡®å®å¸®åŠ©æˆ‘ä»¬è§£å†³äº†å¾ˆå¤šé—®é¢˜ï¼Œä½†æ˜¯ç›¸å¯¹è€Œè¨€ä¸å¥½çš„åœ°æ–¹ RxJava é‡Œé¢å„ç§æ“ä½œç¬¦ï¼Œç†è§£èµ·æ¥ç¡®å®å¾ˆè´¹åŠ²ï¼Œéšç€ Google å°† Kotlin ä½œä¸º Android é¦–é€‰è¯­è¨€ï¼Œé‚£ä¹ˆ RxKotlinï¼Œæœ‰èƒ½ç»™æˆ‘ä»¬å¸¦æ¥å“ªäº›å¥½å¤„äº†ï¼Œåœ¨ Kotlin æ—¶ä»£ï¼Œè¿˜æœ‰å¿…è¦ä½¿ç”¨ RxKotlin å—ï¼Ÿ ## å‚è€ƒæ–‡çŒ® * [Beyond Basic RxJava Error Handling](https://proandroiddev.com/beyond-basic-rxjava-error-handling-b0875d3877e0) * [RxJava 2 : Understanding Hot vs. Cold with just vs. fromCallable](https://medium.com/@elye.project/rxjava-2-understanding-hot-vs-cold-with-just-vs-fromcallable-3c463f9f68c9) * [What&apos;s different in 2.0](https://github.com/ReactiveX/RxJava/wiki/What&apos;s-different-in-2.0) ## æ¨èæ–‡ç«  * [[è¯‘][Googleå·¥ç¨‹å¸ˆ] åˆšåˆšå‘å¸ƒäº† Fragment çš„æ–°ç‰¹æ€§ â€œFragment é—´ä¼ é€’æ•°æ®çš„æ–°æ–¹å¼â€ ä»¥åŠæºç åˆ†æ](https://juejin.im/post/5eb58da05188256d6d6bb248) * [[è¯‘][Googleå·¥ç¨‹å¸ˆ] è¯¦è§£ FragmentFactory å¦‚ä½•ä¼˜é›…ä½¿ç”¨ Koin ä»¥åŠéƒ¨åˆ†æºç åˆ†æ](https://juejin.im/post/5ecb16f1f265da76fb0c3967) * [[è¯‘][2.4K Start] æ”¾å¼ƒ Dagger æ‹¥æŠ± Koin](https://juejin.im/post/5ebc1eb8e51d454dcf45744e?utm_source=gold_browser_extension) * [[è¯‘][5k+] Kotlin çš„æ€§èƒ½ä¼˜åŒ–é‚£äº›äº‹](https://juejin.im/post/5ec0f3afe51d454db11f8a94#heading-7) * [[è¯‘] è§£å¯† RxJava çš„å¼‚å¸¸å¤„ç†æœºåˆ¶](https://juejin.im/post/5ecc10626fb9a047e25d5aac) * [[è¯‘][1.4K+ Star] Kotlin æ–°ç§€ Coil VS Glide and Picasso](https://juejin.im/post/5edd1f5ae51d45789e0d9a22) * [æ›´å¤š......](https://github.com/hi-dhl/Technical-Article-Translation)","link":"/2020/08/17/translate/05-rxJava-error/"},{"title":"ã€Œè¯‘ã€Kotlin çš„æ€§èƒ½ä¼˜åŒ–é‚£äº›äº‹","text":"å‰è¨€ åŸæ ‡é¢˜: Item: Consider aggregating elements to a map åŸæ–‡åœ°å€: https://blog.kotlin-academy.com/itemâ€¦â€¦ åŸæ–‡ä½œè€…ï¼šMarcin Moskala è¿™ç¯‡æ–‡ç« åº”è¯¥å¯ä»¥è¯´æ˜¯ [è¯‘][2.4K Start] æ”¾å¼ƒ Dagger æ‹¥æŠ± Koin æ–‡ç« çš„ç»­é›†ï¼Œåœ¨ â€œæ”¾å¼ƒ Dagger æ‹¥æŠ± Koinâ€ æ–‡ç« ä¸­ä»‹ç»äº†è¿‡æ¸¡ä½¿ç”¨ Inline ä¿®é¥°ç¬¦æ‰€å¸¦æ¥çš„åæœï¼Œä»¥åŠ Koin å›¢é˜Ÿåœ¨ä¸ºä¿®å¤ 1x ç‰ˆæœ¬æ‰€åšçš„æ€§èƒ½ä¼˜åŒ–ï¼Œè¿™è¾¹æ–‡ç« å°†ç»§ç»­å­¦ä¹ å¦‚ä½•æå‡ Kotlin çš„æŸ¥è¯¢é€Ÿåº¦ã€‚ é€šè¿‡è¿™ç¯‡æ–‡ç« ä½ å°†å­¦ä¹ åˆ°ä»¥ä¸‹å†…å®¹ï¼Œå°†åœ¨è¯‘è€…æ€è€ƒéƒ¨åˆ†ä¼šç»™å‡ºç›¸åº”çš„ç­”æ¡ˆ å¦‚ä½•æå‡ Kotlin çš„æŸ¥è¯¢é€Ÿåº¦ï¼Ÿ æ€§èƒ½å’Œä»£ç å¯è¯»æ€§è¯¥åšå¦‚ä½•é€‰æ‹©ï¼Ÿ Kotlin å†…å­˜æ³„éœ²é‚£äº›äº‹, æ¶ˆé™¤è¿‡æœŸçš„å¯¹è±¡å¼•ç”¨ï¼Ÿ å¦‚ä½•æé«˜ Kotlin ä»£ç çš„å¯è¯»æ€§ï¼Ÿ Kotlin ç®—æ³•ï¼šä¸€è¡Œä»£ç å®ç°æ¨è¾‰ä¸‰è§’ï¼Ÿ è¿™ç¯‡æ–‡ç« æ¶‰åŠå¾ˆå¤šé‡è¦çš„çŸ¥è¯†ç‚¹ï¼Œå¸¦ç€è‡ªå·±ç†è§£ï¼Œè¯·è€å¿ƒè¯»ä¸‹å»ï¼Œåº”è¯¥å¯ä»¥ä»ä¸­å­¦åˆ°å¾ˆå¤šæŠ€å·§ è¯‘æ–‡æˆ‘ä»¬éœ€è¦å¤šæ¬¡è®¿é—®å¤§é‡çš„æ•°æ®æƒ…å†µï¼Œè¿™å…¶å®å¹¶ä¸å°‘è§ï¼Œä¾‹å¦‚ï¼š cacheï¼šä»æœåŠ¡ä¸Šä¸‹è½½çš„æ•°æ®ï¼Œç„¶åä¿å­˜åœ¨æœ¬åœ°å†…å­˜ä¸­ä»¥æ›´å¿«åœ°è®¿é—®å®ƒä»¬ repositoryï¼šä»ä¸€äº›æ–‡ä»¶ä¸­åŠ è½½æ•°æ® in-memory repositoryï¼šç”¨äºä¸åŒç±»å‹çš„å†…å­˜æµ‹è¯• è¿™äº›æ•°æ®å¯èƒ½è¡¨ç¤ºä¸€äº›ç”¨æˆ·ã€idã€é…ç½®ç­‰ç­‰ï¼Œå®ƒä»¬é€šå¸¸ä»¥ list å½¢å¼è¿”ç»™æˆ‘ä»¬ï¼Œå®ƒä»¬å¯èƒ½ä»¥ç›¸åŒçš„æ–¹å¼å­˜å‚¨åœ¨å†…å­˜ä¸­ï¼š class NetworkUserRepo(val userService: UserService): UserRepo { private var users: List&lt;User&gt;? = null override fun getUser(id: UserId): User? { if(users == null) { users = userService.getUsers() } return users?.firstOrNull { it.id == id } }}class ConfigurationsRepository( val configurations: List&lt;Configuration&gt;) { fun getByName(name: String) = configurations .firstOrNull { it.name == name }}class InMemoryUserRepo: UserRepo { private val users: MutableList&lt;User&gt; = mutableListOf() override fun getUser(id: UserId): User? = users.firstOrNull { it.id == id } fun addUser(user: User) { user.add(user) }} è¿™å¯èƒ½æ˜¯å­˜å‚¨è¿™äº›å…ƒç´ çš„æœ€å¥½æ–¹å¼ï¼Œæ³¨æ„æˆ‘ä»¬æ˜¯å¦‚ä½•åŠ è½½æ•°æ®å¦‚ä½•ä½¿ç”¨çš„ï¼Œæˆ‘ä»¬é€šè¿‡æŸä¸ªæ ‡è¯†ç¬¦æˆ–è€…åå­—è®¿é—®è¿™äº›å…ƒç´ ï¼ˆå®ƒä»¬ä¸æˆ‘ä»¬è®¾è®¡æ•°æ®åº“æ—¶å”¯ä¸€å€¼æœ‰å…³ï¼‰ï¼Œå½“ n ç­‰äº list çš„å¤§å°æ—¶ï¼Œåœ¨ list ä¸­æŸ¥æ‰¾å…ƒç´ çš„å¤æ‚åº¦ä¸º O(n)ï¼Œæ›´å‡†ç¡®çš„è¯´ï¼Œå¹³å‡éœ€è¦ n / 2 æ¬¡æ¯”è¾ƒæ‰èƒ½æ‰¾åˆ°ä¸€ä¸ªå…ƒç´ ï¼Œå¦‚æœæ˜¯ä¸€ä¸ªæ¯”è¾ƒçš„å¤§çš„ listï¼ŒæŸ¥æ‰¾æ•ˆç‡æå…¶ä½æ•ˆï¼Œè§£å†³è¿™ä¸ªé—®é¢˜çš„ä¸€ä¸ªå¥½åŠæ³•æ˜¯ä½¿ç”¨ Map ä»£æ›¿ list, Kotlin é»˜è®¤ä½¿ç”¨çš„æ˜¯ hash map, æ›´å…·ä½“çš„è¯´æ˜¯ LinkedHashMapï¼Œå½“æˆ‘ä»¬ä½¿ç”¨ hash map æŸ¥æ‰¾å…ƒç´ çš„æ€§èƒ½è¦å¥½å¾—å¤š, å®é™…ä¸Š JVM ä½¿ç”¨çš„ hash map çš„å¤§å°æ ¹æ®æ˜ å°„æœ¬èº«çš„å¤§å°è¿›è¡Œäº†è°ƒæ•´, å¦‚æœå®ç° hashCode æ–¹å¼æ­£ç¡®ï¼ŒæŸ¥æ‰¾ä¸€ä¸ªå…ƒç´ åªéœ€è¦è¿›è¡Œä¸€æ¬¡æ¯”è¾ƒã€‚ è¿™æ˜¯ InMemoryRepo ä¸­ä½¿ç”¨ map ä»£æ›¿ list class InMemoryUserRepo: UserRepo { private val users: MutableMap&lt;UserId, User&gt; = mutableMapOf() override fun getUser(id: UserId): User? = users[id] fun addUser(user: User) { user.put(user.id, user) }} å¤§å¤šæ˜¯å…¶ä»–æ“ä½œï¼Œæ¯”å¦‚ä¿®æ”¹æˆ–è€…è¿­ä»£è¿™äº›æ•°æ®ï¼ˆå¯èƒ½ä½¿ç”¨é›†åˆæ–¹æ³• filter, map, flatMap, sorted, sum ç­‰ç­‰ï¼‰å¯¹äº list å’Œ map æ€§èƒ½å·®ä¸å¤šçš„ã€‚ é‚£ä¹ˆæˆ‘ä»¬å¦‚ä½•ä» list è½¬æ¢åˆ° mapï¼Œæˆ–è€…ä» map è½¬æ¢åˆ° listï¼Œä½¿ç”¨ associate æ–¹æ³•æ¥å®Œæˆ list è½¬æ¢åˆ° mapï¼Œæœ€å¸¸è§çš„æ–¹æ³•æ˜¯ associateByï¼Œå®ƒæ„å»ºä¸€ä¸ªæ˜ å°„ï¼Œå…¶ä¸­çš„å€¼æ˜¯åˆ—è¡¨ä¸­çš„å…ƒç´ ï¼Œé”®æ˜¯é€šè¿‡ä¸€ä¸ª lambda è¡¨è¾¾å¼æä¾›ã€‚ data class User(val id: Int, val name: String)val users = listOf(User(1, &quot;Michal&quot;), User(2, &quot;Marek&quot;))val byId = users.associateBy { it.id }byId == mapOf(1 to User(1, &quot;Michal&quot;), 2 to User(2, &quot;Marek&quot;)) val byName = users.associateBy { it.name }byName == mapOf(&quot;Michal&quot; to User(1, &quot;Michal&quot;), &quot;Marek&quot; to User(2, &quot;Marek&quot;)) æ³¨æ„ï¼Œæ˜ å°„ä¸­çš„é”®å¿…é¡»æ˜¯å”¯ä¸€çš„ï¼Œå¦åˆ™ç›¸åŒé”®å€¼çš„å…ƒç´ ä¼šè¢«åˆ æ‰ï¼Œè¿™å°±æ˜¯ä¸ºä»€ä¹ˆæˆ‘ä»¬åº”è¯¥æ ¹æ®å”¯ä¸€æ ‡è¯†ç¬¦è¿›è¡Œå…³è”ï¼ˆå¯¹äºé”®å€¼ä¸æ˜¯å”¯ä¸€çš„ï¼Œåº”è¯¥ä½¿ç”¨ groupBy æ–¹æ³•ï¼‰ val users = listOf(User(1, &quot;Michal&quot;), User(2, &quot;Michal&quot;))val byName = users.associateBy { it.name }byName == mapOf(&quot;Michal&quot; to User(2, &quot;Michal&quot;)) ä» map è½¬æ¢åˆ° list ä½¿ç”¨ values æ–¹æ³• val users = listOf(User(1, &quot;Michal&quot;), User(2, &quot;Michal&quot;))val byId = users.associateBy { it.id }users == byId.values å¦‚ä½•åœ¨ repositories ä¸­ç”¨ Map æé«˜å…ƒç´ è®¿é—®çš„æ€§èƒ½ class NetworkUserRepo(val userService: UserService): UserRepo { private var users: Map&lt;UserId, User&gt;? = null override fun getUser(id: UserId): User? { if(users == null) { users = userService.getUsers().associateBy { it.id } } return users?.get(id) }}class ConfigurationsRepository( configurations: List&lt;Configuration&gt;) { val configurations: Map&lt;String, Configuration&gt; = configurations.associateBy { it.name } fun getByName(name: String) = configurations[name]} è¿™ä¸ªæŠ€å·§æ˜¯éå¸¸é‡è¦çš„ï¼Œä½†æ˜¯å¹¶ä¸é€‚åˆæ‰€æœ‰çš„ casesï¼Œå½“æˆ‘ä»¬éœ€è¦è®¿é—®æ¯”è¾ƒå¤§çš„ list çš„æ—¶å€™æ˜¯éå¸¸æœ‰ç”¨çš„ï¼Œè¿™åœ¨åå°è®¿é—®æ˜¯éå¸¸é‡è¦çš„ï¼Œè¿™äº› list å¯èƒ½åœ¨åå°æ¯ç§’è¢«è®¿é—®å¾ˆå¤šæ¬¡ï¼Œä½†æ˜¯åœ¨å‰å°å¹¶ä¸é‡è¦ï¼ˆè¿™é‡Œè¯´çš„æ˜¯ Android æˆ–è€… iOSï¼‰ç”¨æˆ·æœ€å¤šåªä¼šè®¿é—®å‡ æ¬¡ repositoryï¼Œéœ€è¦æ³¨æ„çš„æ˜¯ä» list è½¬æ¢åˆ° map æ˜¯éœ€è¦æ—¶é—´çš„ï¼Œå¦‚æœè¿‡æ¸¡ä½¿ç”¨ï¼Œå¯èƒ½ä¼šå¯¹æ€§èƒ½æœ‰ä¸å¥½çš„å½±å“ã€‚ è¯‘è€…æ€è€ƒä½œè€…æ€»å…±ä»ä¸‰ä¸ªæ–¹é¢ Networkã€Configurationsã€InMemory å‘Šè¯‰æˆ‘ä»¬åº”è¯¥å¦‚ä½•ä» list è½¬ map, æˆ–è€…ä» map è½¬ list, ä»¥åŠåº”è¯¥åœ¨åå°éœ€è¦å¤šæ¬¡è®¿é—®å¾ˆå¤§çš„æ•°æ®é›†åˆä¸­ä½¿ç”¨ mapï¼Œè¿‡æ¸¡çš„ä½¿ç”¨åªä¼šå¯¹æ€§èƒ½äº§ç”Ÿè´Ÿé¢çš„å½±å“ã€‚ list è½¬ map è°ƒç”¨ç”¨ associateBy æ–¹æ³•ï¼Œæ¥å—ä¸€ä¸ª lambda è¡¨è¾¾å¼ val users = listOf(User(1, &quot;Michal&quot;), User(2, &quot;Michal&quot;))val byName = users.associateBy { it.name }byName == mapOf(&quot;Michal&quot; to User(2, &quot;Michal&quot;)) ä» map è½¬ list è°ƒç”¨ values æ–¹æ³• val users = listOf(User(1, &quot;Michal&quot;), User(2, &quot;Michal&quot;))val byId = users.associateBy { it.id }users == byId.values è¿™æ˜¯ä¸€ä¸ªéå¸¸é‡è¦çš„ä¼˜åŒ–çš„æ‰‹æ®µï¼ˆä½¿ç”¨ç©ºé—´æ¢å–æ—¶é—´ï¼‰ï¼Œåœ¨ [è¯‘][2.4K Start] æ”¾å¼ƒ Dagger æ‹¥æŠ± Koin æ–‡ç« ä¸­ä»‹ç»äº†å½“æˆ‘ä»¬å¼•å…¥ Koin 1x çš„æ—¶å€™å†·å¯åŠ¨æ—¶é—´å˜é•¿äº†ï¼Œè€Œä¸”åœ¨æœ‰å¤§é‡ä¾èµ–çš„æ—¶å€™ï¼ŒæŸ¥æ‰¾çš„æ—¶é—´ä¼šæœ‰ç‚¹é•¿ï¼Œç”¨è¿‡è¿™ä¸ªç‰ˆæœ¬çš„æœ‹å‹ï¼Œåº”è¯¥éƒ½ä¼šæœ‰è¿™ä¸ªæ„Ÿè§‰ï¼ŒKoin å›¢é˜Ÿçš„è§£å†³æ–¹æ¡ˆä¸­ç”¨åˆ°äº† HashMapï¼Œä½¿ç”¨ç©ºé—´æ¢å–æ—¶é—´ï¼ŒæŸ¥æ‰¾ä¸€ä¸ª Definition æ—¶é—´å¤æ‚åº¦å˜æˆäº† O(1)ï¼Œä»æé«˜çš„è®¿é—®é€Ÿåº¦ã€‚ å…¶å®æˆ‘ä»¬åº”è¯¥åœ¨å¤´è„‘ä¸­ï¼Œä¿æŒå†…å­˜ç®¡ç†çš„æ„è¯†ï¼Œåœ¨æ¯æ¬¡ä¼˜åŒ–ã€ä¿®æ”¹ä»£ç ä¹‹å‰ï¼Œä¸è¦æ€¥äºå†™ä»£ç ï¼Œå…ˆæ•´ç†ä¸€ä¸‹æ€è·¯ï¼Œåœ¨å¤´è„‘ä¸­è¿‡ä¸€éè‡ªå·±çš„æ–¹æ¡ˆï¼Œæˆ‘ä»¬åº”è¯¥ä¸ºé¡¹ç›®æ‰¾åˆ°ä¸€ä¸ªæŠ˜è¡·æ–¹æ¡ˆï¼Œä¸ä»…è¦è€ƒè™‘å†…å­˜å’Œæ€§èƒ½ï¼Œè¿˜è¦è€ƒè™‘ä»£ç çš„å¯è¯»æ€§ã€‚å½“æˆ‘ä»¬åšä¸€ä¸ªåº”ç”¨ç¨‹åºï¼Œåœ¨å¤§å¤šæ•°æƒ…å†µä¸‹å¯è¯»æ€§æ›´é‡è¦ã€‚å½“æˆ‘ä»¬å¼€å‘ä¸€ä¸ªåº“æ—¶ï¼Œé€šå¸¸æ€§èƒ½å’Œå†…å­˜æ›´é‡è¦ã€‚ æ€§èƒ½å’Œä»£ç å¯è¯»æ€§è¯¥åšå¦‚ä½•é€‰æ‹©å¦‚æœç”¨ Java å’Œ Kotlin è¯­è¨€åˆ·è¿‡ LeetCodeï¼Œä½¿ç”¨ç›¸åŒçš„æ€è·¯å®ç°åŒä¸€ä¸ªç®—æ³•ï¼Œåœ¨æ­£å¸¸çš„ Case ä¸­ï¼ŒKotlin å’Œ Java æ‰§è¡Œæ—¶é—´å·®å€¼å¾ˆå°ï¼Œæ•°æ®é‡è¶Šå¤§çš„æƒ…å†µä¸‹ Kotlin å’Œ Java å·®è·ä¼šè¶Šæ¥è¶Šå¤§ï¼ŒKotlin æ‰§è¡Œæ—¶é—´ä¼šè¶Šæ¥è¶Šæ…¢ï¼Œä½†æ˜¯ä¸ºä»€ä¹ˆ Kotlin è¯­è¨€è¿˜ä¼šæˆä¸º Android å¼€å‘çš„é¦–é€‰è¯­è¨€å‘¢ï¼Ÿæ¥çœ‹ä¸€ä¸‹ä½œè€… Marcin Moskala å¦å¤–ä¸€ç¯‡æ–‡ç«  My favorite examples of functional programming in Kotlin å±•ç¤ºçš„å¿«æ’ç®—æ³•ã€‚ åœ¨ä¹‹å‰çš„æ–‡ç« ä¸­åˆ†äº«äº†è¿‡è¿™ä¸ªç®—æ³•ï¼Œç°åœ¨æˆ‘ä»¬æ¥åˆ†æä¸€ä¸‹è¿™ä¸ªç®—æ³•ã€‚ fun &lt;T : Comparable&lt;T&gt;&gt; List&lt;T&gt;.quickSort(): List&lt;T&gt; = if(size &lt; 2) this else { val pivot = first() val (smaller, greater) = drop(1).partition { it &lt;= pivot} smaller.quickSort() + pivot + greater.quickSort() } // ä½¿ç”¨ [2,5,1] -&gt; [1,2,5]listOf(2,5,1).quickSort() // [1,2,5] è¿™æ˜¯ä¸€ä¸ªéå¸¸é…·çš„å‡½æ•°å¼ç¼–ç¨‹çš„ä¾‹å­ï¼Œå½“çœ‹åˆ°è¿™ä¸ªç®—æ³•çš„ç¬¬ä¸€æ„Ÿè§‰ï¼Œå®ƒéå¸¸çš„ç®€æ´ï¼Œå¯è¯»æ€§å¾ˆå¼ºï¼Œå…¶æ¬¡æˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹è¿™ä¸ªç®—æ³•æ‰§è¡Œæ—¶é—´ï¼Œå…¶å®å®ƒæ ¹æœ¬æ²¡æœ‰é’ˆå¯¹æ€§èƒ½è¿›è¡Œä¼˜åŒ–ã€‚ å¦‚æœä½ éœ€è¦ä½¿ç”¨é«˜æ€§èƒ½çš„ç®—æ³•ï¼Œä½ å¯ä»¥ä½¿ç”¨ Java æ ‡å‡†åº“å½“ä¸­çš„å‡½æ•°ï¼ŒKotlin æ‰©å±•å‡½æ•° sorted() å°±æ˜¯ç”¨ Java æ ‡å‡†åº“ä¸­çš„å‡½æ•°ï¼ŒJava æ ‡å‡†åº“ä¸­çš„å‡½æ•°æ•ˆç‡ä¼šæ›´é«˜çš„ï¼Œä½†æ˜¯å®é™…æ‰§è¡Œæ—¶é—´æ€ä¹ˆæ ·å‘¢ï¼Ÿç”Ÿæˆä¸€ä¸ªéšæœºæ•°æ•°ç»„ï¼Œä½¿ç”¨ä½¿ç”¨ quickSort() å’Œ sorted() æ–¹æ³•è¿›è¡Œæ’åºï¼Œæ¯”è¾ƒå®ƒä»¬çš„æ‰§è¡Œæ—¶é—´ï¼Œä»£ç å¦‚ä¸‹æ‰€ç¤ºï¼š val r = Random()listOf(100_000, 1_000_000, 10_000_000) .asSequence() .map { (1..it).map { r.nextInt(1000000000) } } .forEach { list: List&lt;Int&gt; -&gt; println(&quot;Java stdlib sorting of ${list.size} elements took ${measureTimeMillis { list.sorted() }}&quot;) println(&quot;quickSort sorting of ${list.size} elements took ${measureTimeMillis { list.quickSort() }}&quot;) } æ‰§è¡Œç»“æœå¦‚ä¸‹æ‰€ç¤ºï¼š Java stdlib sorting of 100000 elements took 83quickSort sorting of 100000 elements took 163Java stdlib sorting of 1000000 elements took 558quickSort sorting of 1000000 elements took 859Java stdlib sorting of 10000000 elements took 6182quickSort sorting of 10000000 elements took 12133` æ­£å¦‚ä½ æ‰€è§ï¼ŒquickSort() æ¯” sorted() æ’åºç®—æ³•è¦æ…¢ä¸¤å€ï¼Œåœ¨æ­£å¸¸æƒ…å†µä¸‹ï¼Œå·®å€¼é€šå¸¸åœ¨ 0.1ms å’Œ 0.2ms ä¹‹é—´ï¼ŒåŸºæœ¬ä¸Šå¯ä»¥å¿½ç•¥ä¸è®¡ï¼Œä½†æ˜¯å®ƒæ›´ç®€æ´ï¼Œå¯è¯»æ€§æ›´å¼ºã€‚è¿™è§£é‡Šäº†åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å¯ä»¥è€ƒè™‘ä½¿ç”¨ä¸€ä¸ªä¼˜åŒ–ç¨‹åº¦ç¨ä½ï¼Œä½†å¯è¯»æ€§å¼ºä¸”ç®€æ´çš„å‡½æ•°ï¼Œä½ åŒæ„ä½œè€…è¿™ç§è§‚ç‚¹å—ï¼Ÿ Kotlin å†…å­˜æ³„éœ²é‚£äº›äº‹, æ¶ˆé™¤è¿‡æœŸçš„å¯¹è±¡å¼•ç”¨æˆ‘çœ‹è¿‡å¾ˆå¤šæ–‡ç« éƒ½è¯´ Kotlin ç®€æ´å’Œé«˜æ•ˆï¼ŒKotlin ç¡®å®å¾ˆç®€æ´ï¼Œåœ¨ â€œå¦‚ä½•æé«˜ Kotlin ä»£ç çš„å¯è¯»æ€§â€ éƒ¨åˆ†æˆ‘ä¼šåˆ—ä¸¾ä¸€äº›ä¾‹å­ï¼Œä½†æ˜¯é«˜æ•ˆçš„èƒŒåæ˜¯æœ‰ä»£ä»·çš„ï¼Œè¿™å—å¾€å¾€å¾ˆå®¹æ˜“è¢«æˆ‘ä»¬å¿½ç•¥ï¼Œè¿™å°±éœ€è¦æˆ‘ä»¬å»ç ”ç©¶ kotlin è¯­æ³•ç³–èƒŒåçš„é­”æ³•ï¼Œå½“æˆ‘ä»¬åœ¨å¼€å‘çš„æ—¶å€™ï¼Œé€‰æ‹©åˆé€‚çš„è¯­æ³•ç³–ï¼Œå°½é‡é¿å…è¿™äº›é”™è¯¯ï¼Œä¾‹å¦‚å¸¦æœ‰ lnmba è¡¨è¾¾å¼é«˜é˜¶å‡½æ•°ï¼Œä¸ä½¿ç”¨ Inline ä¿®é¥°ç¬¦ï¼Œä¼šè¢«ç¼–è¯‘æˆåŒ¿åå†…éƒ¨ç±»ç­‰ç­‰ï¼Œæ›´è¯¦ç»†çš„å†…å®¹å‚è€ƒ [è¯‘][2.4K Start] æ”¾å¼ƒ Dagger æ‹¥æŠ± Koin Inline ä¿®é¥°ç¬¦å¸¦æ¥çš„æ€§èƒ½æŸå¤±éƒ¨åˆ†ã€‚ å†…å­˜ç®¡ç†æœ€é‡è¦çš„ä¸€æ¡è§„åˆ™æ˜¯ï¼Œä¸ä½¿ç”¨çš„å¯¹è±¡åº”è¯¥è¢«é‡Šæ”¾ è¿™ç¯‡æ–‡ç«  Effective Java in Kotlin, item 7: Eliminate obsolete object references ä½œè€…ä¹Ÿåˆ—ä¸¾äº† Kotlin çš„ä¸€äº›ä¾‹å­ï¼Œä¾‹å¦‚æˆ‘ä»¬éœ€è¦ä½¿ç”¨ mutableLazy å±æ€§å§”æ‰˜ï¼Œåƒ lazy ä¸€æ ·å·¥ä½œï¼Œæˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹å®ç°ä»£ç ï¼š fun &lt;T&gt; mutableLazy(initializer: () -&gt; T): ReadWriteProperty&lt;Any?, T&gt; = MutableLazy(initializer)private class MutableLazy&lt;T&gt;( val initializer: () -&gt; T) : ReadWriteProperty&lt;Any?, T&gt; { private var value: T? = null private var initialized = false override fun getValue( thisRef: Any?, property: KProperty&lt;*&gt; ): T { synchronized(this) { if (!initialized) { value = initializer() initialized = true } return value as T } } override fun setValue( thisRef: Any?, property: KProperty&lt;*&gt;, value: T ) { synchronized(this) { this.value = value initialized = true } }} å¦‚ä½•ä½¿ç”¨ï¼š var game: Game? by mutableLazy { readGameFromSave() }fun setUpActions() { startNewGameButton.setOnClickListener { game = makeNewGame() startGame() } resumeGameButton.setOnClickListener { startGame() }} æ€è€ƒä¸€ä¸‹ mutableLazy å®ç°æ­£ç¡®å—ï¼Ÿ å®ƒæœ‰ä¸€ä¸ªåœ°æ–¹ä¸å¯¹ï¼Œlnmba è¡¨è¾¾å¼ initializer åœ¨ä½¿ç”¨åæ²¡æœ‰è¢«åˆ é™¤ã€‚è¿™æ„å‘³ç€åªè¦å¯¹ MutableLazy å®ä¾‹çš„å¼•ç”¨å­˜åœ¨ï¼Œå®ƒå°±ä¼šè¢«ä¿æŒï¼Œå³ä½¿å®ƒä¸å†æœ‰ç”¨ï¼Œå¦‚ä½•æ”¹è¿› MutableLazy å®ç°çš„æ–¹æ³•ï¼Œä¼˜åŒ–ä»£ç å¦‚ä¸‹æ‰€ç¤ºï¼š fun &lt;T&gt; mutableLazy(initializer: () -&gt; T): ReadWriteProperty&lt;Any?, T&gt; = MutableLazy(initializer)private class MutableLazy&lt;T&gt;( var initializer: (() -&gt; T)?) : ReadWriteProperty&lt;Any?, T&gt; { private var value: T? = null override fun getValue( thisRef: Any?, property: KProperty&lt;*&gt; ): T { synchronized(this) { val initializer = initializer if (initializer != null) { value = initializer() this.initializer = null } return value as T } } override fun setValue( thisRef: Any?, property: KProperty&lt;*&gt;, value: T ) { synchronized(this) { this.value = value this.initializer = null } }} åœ¨ä½¿ç”¨å®Œä¹‹åå°† initializer è®¾ç½®ä¸º nullï¼Œå®ƒå°†ä¼šè¢« GC å›æ”¶ã€‚ç‰¹åˆ«è¦æ³¨æ„å½“ä¸€ä¸ªé«˜é˜¶å‡½æ•°ä¼šè¢«ç¼–è¯‘æˆåŒ¿åç±»æ—¶æˆ–è€…å®ƒæ˜¯ä¸€ä¸ªæœªçŸ¥ç±»ï¼ˆä»»ä½•æˆ–æ³›å‹ç±»å‹ï¼‰æ—¶ï¼Œè¿™ä¸ªä¼˜åŒ–æ˜¾å¾—éå¸¸é‡è¦ï¼Œæˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹ Kotlin stdlib åº“ä¸­çš„ç±» SynchronizedLazyImpl ä»£ç å¦‚ä¸‹æ‰€ç¤ºï¼škotlin-stdlibâ€¦â€¦/kotlin/util/LazyJVM.kt private class SynchronizedLazyImpl&lt;out T&gt;( initializer: () -&gt; T, lock: Any? = null) : Lazy&lt;T&gt;, Serializable { private var initializer: (() -&gt; T)? = initializer private var _value: Any? = UNINITIALIZED_VALUE private val lock = lock ?: this override val value: T get() { val _v1 = _value if (_v1 !== UNINITIALIZED_VALUE) { @Suppress(&quot;UNCHECKED_CAST&quot;) return _v1 as T } return synchronized(lock) { val _v2 = _value if (_v2 !== UNINITIALIZED_VALUE) { @Suppress(&quot;UNCHECKED_CAST&quot;) (_v2 as T) } else { val typedValue = initializer!!() _value = typedValue initializer = null typedValue } } } ......} è¯·æ³¨æ„ï¼Œåœ¨ä½¿ç”¨å®Œä¹‹å initializers è®¾ç½®ä¸º nullï¼Œå°†ä¼šè¢« GC å›æ”¶ å¦‚ä½•æé«˜ Kotlin ä»£ç çš„å¯è¯»æ€§ä¸Šæ–‡æåˆ°äº† Kotlin ç®€æ´å¯è¯»æ€§å¾ˆå¼ºï¼Œä½†æ˜¯å‘¢é€šè¿‡ AndroidStudio æä¾›äº† convert our Java code to Kotlin æ’ä»¶ï¼Œå°† Java ä»£ç è½¬æ¢ä¸º Kotlin ä»£ç ï¼ŒJava-Style Kotlin çš„ä»£ç æ˜æ˜¾å¾ˆéš¾çœ‹ï¼Œé‚£ä¹ˆå¦‚ä½•æå‡ Kotlin ä»£ç çš„å¯è¯»æ€§ï¼Œæˆ‘æƒ³åˆ†äº«å‡ ä¸ªå¾ˆé…·çš„ä¾‹å­ Improve Java to Kotlin code reviewï¼Œç”¨åˆ°äº† Elvis è¡¨è¾¾å¼ã€run, with ç­‰ç­‰å‡½æ•° æ¶ˆé™¤!! myList!!.length change to myList?.length ç©ºæ£€æŸ¥ if (callback != null) { callback!!.response()} change to callback?.response() ä½¿ç”¨ Elvis è¡¨è¾¾å¼ if (toolbar != null) { if (arguments != null) { toolbar!!.title = arguments!!.getString(TITLE) } else { toolbar!!.title = &quot;&quot; }} change to toolbar?.title = arguments?.getString(TITLE) ?: â€œâ€ ä½¿ç”¨ scope å‡½æ•° val intent = intentUtil.createIntent(activity!!.applicationContext) activity!!.startActivity(intent)dismiss() change to activity?.run { val intent = intentUtil.createIntent(this) startActivity(intent) dismiss() } ps: scope å‡½æ•°è¿˜æœ‰ run, with, let, also and applyï¼Œå®ƒä»¬çš„åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Œå¦‚ä½•æ­£ç¡®ä½¿ç”¨å®ƒä»¬ï¼Œåé¢çš„æ–‡ç« ä¼šè¯¦ç»†çš„ä»‹ç»ã€‚ ä½¿ç”¨ takeIf if å‡½æ•° if (something != null &amp;&amp; something == preference) { something.doThing() change to something?.takeIf { it == preference }?.let { something.doThing() } Android TextUtil if (TextUtils.isEmpty(someString)) {...}val joinedString = TextUtils.join(COMMA, separateList) change to if (someString.isEmpty()) {...}val joinedString = separateList.joinToString(separator = COMMA) Java Util val strList = Arrays.asList(&quot;someString&quot;) change to val strList = listOf(&quot;someString&quot;) Empty and null if (myList == null || myList.isEmpty()) {...} change to if (myList.isNullOrEmpty() {...} é¿å…å¯¹å¯¹è±¡è¿›è¡Œé‡å¤æ“ä½œ recyclerView.setLayoutManager(layoutManager)recyclerView.setAdapter(adapter) recyclerView.setItemAnimator(animator) change to with(recyclerView) { setLayoutManager(layoutManager) setAdapter(adapter) setItemAnimator(animator)} é¿å…åˆ—è¡¨å¾ªç¯ for (str in stringList) { println(str)} change to stringList.forEach { println(it) } é¿å…ä½¿ç”¨ mutable é›†åˆ val stringList: List&lt;String&gt; = mutableListOf()for (other in otherList) { stringList.add(dosSomething(other))} change to val stringList = otherList.map { dosSomething(it) } ä½¿ç”¨ when ä»£æ›¿ if if (requestCode == REQUEST_1) { doThis()} else if (requestCode == REQUEST_2) { doThat()} else { doSomething()} change to when (requestCode) { REQUEST_1 -&gt; doThis() REQUEST_1 -&gt; doThat() else -&gt; doSomething()} ä½¿ç”¨ const companion object { val EXTRA_STRING = &quot;EXTRA_EMAIL&quot; val EXTRA_NUMBER = 12345} change to companion object { const val EXTRA_STRING = &quot;EXTRA_EMAIL&quot; const val EXTRA_NUMBER = 12345} å¦‚æœæœ‰æ›´å¥½çš„ä¾‹å­ï¼Œæ¬¢è¿ç•™è¨€ Kotlin ç®—æ³•ï¼šä¸€è¡Œä»£ç å®ç°æ¨è¾‰ä¸‰è§’æˆ‘æƒ³åˆ†äº«ä¸€ä¸ªå¾ˆé…·çš„ç®—æ³•ï¼Œç”¨ä¸€è¡Œä»£ç å®ç°æ¨è¾‰ä¸‰è§’ï¼Œä»£ç æ¥è‡ª Marcin Moskala å¤§ç¥çš„ Twitter fun pascal() = generateSequence(listOf(1)) { prev -&gt; listOf(1) + (1..prev.lastIndex).map { prev[it - 1] + prev[it] } + listOf(1)}fun main() { pascal().take(10).forEach(::println)} å®‰åˆ©ä¸€ä¸ªè¯‘è€…è‡ªå·±æ’¸çš„å¯¼èˆªç½‘ç«™åŸºäº Python + Material Design å¼€å‘çš„ â€œä¸ºäº’è”ç½‘äººè€Œè®¾è®¡ å›½å†…å›½å¤–åç«™å¯¼èˆªâ€œ ï¼Œæ”¶é›†äº†å›½å†…å¤–çƒ­é—¨ç½‘å€ï¼Œæ¶µæ‹¬æ–°é—»ã€ä½“è‚²ã€ç”Ÿæ´»ã€å¨±ä¹ã€è®¾è®¡ã€äº§å“ã€è¿è¥ã€å‰ç«¯å¼€å‘ã€Androidå¼€å‘ç­‰ç­‰å¯¼èˆªç½‘ç«™ åœ°å€ å‚è€ƒæ–‡çŒ® Item: Consider aggregating elements to a map Effective Java in Kotlin, item 7: Eliminate obsolete object references Improve Java to Kotlin code review æ¨èæ–‡ç«  [è¯‘][Googleå·¥ç¨‹å¸ˆ] åˆšåˆšå‘å¸ƒäº† Fragment çš„æ–°ç‰¹æ€§ â€œFragment é—´ä¼ é€’æ•°æ®çš„æ–°æ–¹å¼â€ ä»¥åŠæºç åˆ†æ [è¯‘][Googleå·¥ç¨‹å¸ˆ] è¯¦è§£ FragmentFactory å¦‚ä½•ä¼˜é›…ä½¿ç”¨ Koin ä»¥åŠéƒ¨åˆ†æºç åˆ†æ [è¯‘][2.4K Start] æ”¾å¼ƒ Dagger æ‹¥æŠ± Koin [è¯‘][5k+] Kotlin çš„æ€§èƒ½ä¼˜åŒ–é‚£äº›äº‹ [è¯‘] è§£å¯† RxJava çš„å¼‚å¸¸å¤„ç†æœºåˆ¶ [è¯‘][1.4K+ Star] Kotlin æ–°ç§€ Coil VS Glide and Picasso æ›´å¤šâ€¦â€¦","link":"/2020/08/05/translate/04-kotlin-performance/"},{"title":"ã€Œè¯‘ã€æ”¾å¼ƒ Dagger æ‹¥æŠ± Koin","text":"å‰è¨€ åŸæ ‡é¢˜: Koin vs Dagger, Say hello to Koin åŸæ–‡åœ°å€: https://blog.usejournal.com/android-koinâ€¦ åŸæ–‡ä½œè€…ï¼šFarshid ABZ ä½œè€…è¿™ç¯‡æ–‡ç« åˆ°ç›®å‰ä¸ºæ­¢å·²ç»æ”¶åˆ°äº† 2.4k+ çš„èµï¼Œå†²ä¸Šäº† Medium çƒ­é—¨ï¼Œéå¸¸å¥½çš„ä¸€ç¯‡æ–‡ç« ï¼Œæˆ‘ä¹Ÿä½¿ç”¨ Koin + kotlin + databinding ç»“åˆç€ inlineã€reified å¼ºå¤§çš„ç‰¹æ€§å°è£…äº†åŸºç¡€åº“ï¼ŒåŒ…å«äº† DataBindingActivityã€DataBindingFragmentã€DataBindingDialogã€DataBindingListAdapter ç­‰ç­‰, æ­£åœ¨é™†ç»­æ·»åŠ æ–°çš„ç»„ä»¶ã€‚ æ–‡ç« ï¼šhttps://juejin.im/post/5e9c434a51882573663f6cc6 GitHubï¼šhttps://github.com/hi-dhl/JDataBinding é€šè¿‡è¿™ç¯‡æ–‡ç« ä½ å°†å­¦ä¹ åˆ°ä»¥ä¸‹å†…å®¹ï¼Œå°†åœ¨è¯‘è€…æ€è€ƒéƒ¨åˆ†ä¼šç»™å‡ºç›¸åº”çš„ç­”æ¡ˆ Dagger å’Œ Koin ä¼˜åŠ¿åŠ£åŠ¿å¯¹æ¯”ï¼Ÿåº”è¯¥é€‰æ‹© Dagger è¿˜æ˜¯ Koinï¼Ÿ koin è¯­æ³•ç‰¹æ€§ï¼Ÿ Koin ä¸ºä»€ä¹ˆå¯ä»¥åšåˆ°æ— ä»£ç ç”Ÿæˆã€æ— åå°„ï¼Ÿ Inline ä¿®é¥°ç¬¦åšä»€ä¹ˆç”¨çš„ï¼Ÿå¦‚ä½•æ­£ç¡®ä½¿ç”¨ï¼Ÿå¸¦æ¥çš„æ€§èƒ½æŸå¤±ï¼Ÿ åªæ˜¯ç”¨ Inline ä¿®é¥°ç¬¦ï¼Œä¸ºä»€ä¹ˆç¼–è¯‘å™¨ä¼šç»™æˆ‘ä»¬ä¸€ä¸ªè­¦å‘Šï¼Ÿ ä¸ºä»€ä¹ˆç¼–è¯‘å™¨å»ºè®® inline ä¿®é¥°ç¬¦éœ€è¦å’Œ lambda è¡¨è¾¾å¼ä¸€èµ·ä½¿ç”¨å‘¢ï¼Ÿ ä»€ä¹ˆæ—¶å€™åº”è¯¥ä½¿ç”¨ inline ä¿®é¥°ç¬¦ï¼Ÿ Reified ä¿®é¥°ç¬¦åšä»€ä¹ˆç”¨ï¼Ÿå¦‚ä½•ä½¿ç”¨ï¼Ÿ Koin å¸¦æ¥æ€§èƒ½æŸå¤±çš„é‚£äº›äº‹ï¼Ÿ Kotlin ç”¨ 5 è¡Œä»£ç å®ç°å¿«æ’ç®—æ³•ï¼Ÿ è¿™ç¯‡æ–‡ç« æ¶‰åŠå¾ˆå¤šé‡è¦çš„çŸ¥è¯†ç‚¹ï¼Œè¯·è€å¿ƒè¯»ä¸‹å»ï¼Œæˆ‘ç›¸ä¿¡åº”è¯¥ä¼šç»™å¤§å®¶å¸¦æ¥å¾ˆå¤šä¸ä¸€æ ·çš„ä¸œè¥¿ã€‚ è¯‘æ–‡å½“æˆ‘æ­£åœ¨åå¤å­¦ä¹  Dagger çš„æ—¶å€™ï¼Œæˆ‘é‡è§äº† Koinï¼ŒKoin ä¸ä»…èŠ‚çœäº†æˆ‘çš„æ—¶é—´ï¼Œè¿˜æé«˜äº†æ•ˆç‡ï¼Œå°†æˆ‘ä»å¤æ‚ Dagger ç»™é‡Šæ”¾å‡ºæ¥äº†ã€‚ è¿™ç¯‡æ–‡ç« å°†ä¼šå‘Šè¯‰ä½ ä»€ä¹ˆæ˜¯ Koinï¼Œä¸ Dagger å¯¹æ¯”æœ‰é‚£äº›ä¼˜åŠ¿ï¼Œä»¥åŠå¦‚ä½•ä½¿ç”¨ Koinã€‚ æ˜¯ä»€ä¹ˆ KoinKoin æ˜¯ä¸º Kotlin å¼€å‘è€…æä¾›çš„ä¸€ä¸ªå®ç”¨å‹è½»é‡çº§ä¾èµ–æ³¨å…¥æ¡†æ¶ï¼Œé‡‡ç”¨çº¯ Kotlin è¯­è¨€ç¼–å†™è€Œæˆï¼Œä»…ä½¿ç”¨åŠŸèƒ½è§£æï¼Œæ— ä»£ç†ã€æ— ä»£ç ç”Ÿæˆã€æ— åå°„ã€‚ Dagger vs Koinä¸ºäº†æ­£ç¡®æ¯”è¾ƒè¿™ä¸¤ç§æ–¹å¼ï¼Œæˆ‘ä»¬ç”¨ Dagger å’Œ Koin å»å®ç°äº†ä¸€ä¸ªé¡¹ç›®ï¼Œé¡¹ç›®çš„æ¶æ„éƒ½æ˜¯ MVVMï¼Œå…¶ä¸­ç”¨åˆ°äº† retrofit å’Œ LiveDataï¼ŒåŒ…å«äº† 1 ä¸ªActivityã€4 ä¸ª fragmentsã€5 ä¸ª view modelsã€1 ä¸ª repository å’Œ 1 ä¸ª web service æ¥å£, è¿™åº”è¯¥æ˜¯ä¸€ä¸ªå°å‹é¡¹ç›®çš„åŸºç¡€æ¶æ„äº† å…ˆæ¥çœ‹ä¸€ä¸‹ DI åŒ…ä¸‹çš„ç»“æ„ï¼Œå·¦è¾¹æ˜¯ Daggerï¼Œå³è¾¹æ˜¯ Koin å¦‚ä½ æ‰€è§é…ç½® Dagger éœ€è¦å¾ˆå¤šæ–‡ä»¶ è€Œ Koin åªéœ€è¦ 2 ä¸ªæ–‡ä»¶ï¼Œä¾‹å¦‚ ç”¨ Dagger æ³¨å…¥ 1 ä¸ª view models å°±éœ€è¦ 3 ä¸ªæ–‡ä»¶ï¼ˆçœŸçš„éœ€è¦ç”¨è¿™ä¹ˆå¤šæ–‡ä»¶å—ï¼Ÿï¼‰ æ¯”è¾ƒ Dagger å’Œ Koin ä»£ç è¡Œæ•°æˆ‘ä½¿ç”¨ Statistic å·¥å…·æ¥ç»Ÿè®¡çš„ï¼Œåå¤å¯¹æ¯”äº†é¡¹ç›®ç¼–è¯‘å‰å’Œç¼–è¯‘åï¼ŒDagger å’Œ Koin ç”Ÿæˆçš„ä»£ç è¡Œæ•°ï¼Œç»“æœæ˜¯éå¸¸åƒæƒŠçš„ æ­£å¦‚ä½ çœ‹åˆ°çš„ Dagger ç”Ÿæˆçš„ä»£ç è¡Œæ¯” Koin å¤šä¸¤å€ Dagger å’Œ Koin ç¼–è¯‘æ—¶é—´æ€ä¹ˆæ ·å‘¢æ¯æ¬¡ç¼–è¯‘ä¹‹å‰æˆ‘éƒ½ä¼šå…ˆ clean ç„¶åæ‰ä¼š rebuildï¼Œæˆ‘å¾—åˆ°ä¸‹é¢è¿™ä¸ªç»“æœ Koin:BUILD SUCCESSFUL in 17s88 actionable tasks: 83 executed, 5 up-to-dateDagger:BUILD SUCCESSFUL in 18s88 actionable tasks: 83 executed, 5 up-to-date æˆ‘è®¤ä¸ºè¿™ä¸ªç»“æœè¯æ˜äº†ï¼Œå¦‚æœæ˜¯åœ¨ä¸€ä¸ªæ›´å¤§ã€æ›´çœŸå®çš„é¡¹ç›®ä¸­ï¼Œè¿™ä¸ªä»£ä»·æ˜¯éå¸¸æ˜‚è´µã€‚ Dagger å’Œ Koin ä½¿ç”¨ä¸Šæ€ä¹ˆæ ·å‘¢å¦‚æœä½ æƒ³åœ¨ MVVM å’Œ Android Support lib ä¸­ä½¿ç”¨ Dagger ä½ å¿…é¡»è¿™ä¹ˆåšã€‚ é¦–å…ˆåœ¨ module gradle ä¸­ æ·»åŠ  Dagger ä¾èµ–ã€‚ kapt &quot;com.google.dagger:dagger-compiler:$dagger_version&quot;kapt &quot;com.google.dagger:dagger-android-processor:$dagger_version&quot;implementation &quot;com.google.dagger:dagger:$dagger_version&quot; ç„¶ååˆ›å»ºå®Œ modules å’Œ components æ–‡ä»¶ä¹‹åï¼Œ éœ€è¦åœ¨ Application ä¸­ åˆå§‹åŒ– Daggerï¼ˆæˆ–è€…å…¶ä»–æ–¹å¼åˆå§‹åŒ– Daggerï¼‰ã€‚ Class MyApplication : Application(), HasActivityInjector { @Inject lateinit var dispatchingAndroidInjector: DispatchingAndroidInjector&lt;Activity&gt; override fun activityInjector() = dispatchingAndroidInjector fun initDagger() { DaggerAppComponent .builder() .application(this) .build() .inject(this) }} æ‰€æœ‰çš„ Activity ç»§æ‰¿ BaseActivityï¼Œæˆ‘ä»¬éœ€è¦å®ç° HasSupportFragmentInjector å’Œ inject DispatchingAndroidInjectorã€‚ å¯¹äº view modelsï¼Œæˆ‘ä»¬éœ€è¦åœ¨ BaseFragment ä¸­æ³¨å…¥ ViewModelFactoryï¼Œå¹¶å®ç° Injectableã€‚ ä½†è¿™å¹¶ä¸æ˜¯å…¨éƒ¨ã€‚è¿˜æœ‰æ›´å¤šçš„äº‹æƒ…è¦åšã€‚ å¯¹äºæ¯ä¸€ä¸ª ViewModelã€Fragment å’Œ Activity æˆ‘ä»¬éœ€è¦å‘Šè¯‰ DI å¦‚ä½•æ³¨å…¥å®ƒä»¬ï¼Œæ­£å¦‚ä½ æ‰€è§æˆ‘ä»¬æœ‰ ActivityModuleã€FragmentModuleã€å’Œ ViewModelModuleã€‚ æˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹ä¸‹é¢çš„ä»£ç  @Moduleabstract class ActivityModule { @ContributesAndroidInjector(modules = [FragmentModule::class]) abstract fun contributeMainActivity(): MainActivity //Add your other activities here} Fragments å¦‚ä¸‹æ‰€ç¤ºï¼š @Moduleabstract class FragmentModule { @ContributesAndroidInjector abstract fun contributeLoginFragment(): LoginFragment @ContributesAndroidInjector abstract fun contributeRegisterFragment(): RegisterFragment @ContributesAndroidInjector abstract fun contributeStartPageFragment(): StartPageFragment} ViewModels å¦‚ä¸‹æ‰€ä»¥ï¼š @Moduleabstract class ViewModelModule { @Binds abstract fun bindViewModelFactory(factory: ViewModelFactory): ViewModelProvider.Factory @Binds @IntoMap @ViewModelKey(loginViewModel::class) abstract fun bindLoginFragmentViewModel(loginViewModel: loginViewModel): ViewModel @Binds @IntoMap @ViewModelKey(StartPageViewModel::class) abstract fun bindStartPageViewModel(startPageViewModel: StartPageViewModel): ViewModel ......} æ‰€ä»¥ä½ å¿…é¡»åœ¨ DI modules ä¸­æ·»åŠ è¿™äº› Fragmentsã€Activities å’Œ ViewModelsã€‚ é‚£ä¹ˆåœ¨ Koin ä¸­å¦‚ä½•åš ä½ éœ€è¦åœ¨ module gradle ä¸­æ·»åŠ  Koin ä¾èµ– implementation &quot;org.koin:koin-android-viewmodel:$koin_version&quot; ç„¶åæˆ‘ä»¬éœ€è¦åˆ›å»º module æ–‡ä»¶ï¼Œç¨åæˆ‘å‘Šè¯‰ä½ æ€ä¹ˆåšï¼Œå®é™…ä¸Šæˆ‘ä»¬å¹¶ä¸éœ€è¦åƒ Dagger é‚£ä¹ˆå¤šæ–‡ä»¶ã€‚ Dagger è¿˜æœ‰å…¶ä»–é—®é¢˜ å­¦ä¹  Dagger æˆæœ¬æ˜¯å¾ˆé«˜çš„ï¼Œå¦‚æœæœ‰äººåŠ å…¥ä½ çš„é¡¹ç›®æˆ–è€…å›¢é˜Ÿï¼Œä»–/å¥¹ä¸å¾—ä¸èŠ±å¾ˆå¤šæ—¶é—´å­¦ä¹  Daggerï¼Œæˆ‘ä½¿ç”¨ Dagger ä¸¤å¹´äº†ï¼Œåˆ°ç°åœ¨è¿˜ä¸æ˜¯å¾ˆäº†è§£ï¼Œæ¯æ¬¡æˆ‘å¼€å§‹å­¦ä¹  Andorid æ–°æŠ€æœ¯çš„æ—¶å€™ï¼Œæˆ‘ä¸å¾—ä¸å»æœç´¢å’Œå­¦ä¹ å¦‚ä½•ç”¨ Dagger å®ç°æ–°æŠ€æœ¯ã€‚ æ¥çœ‹ä¸€ä¸‹ Koin ä»£ç  é¦–å…ˆæˆ‘ä»¬éœ€è¦æ·»åŠ  Koin ä¾èµ–ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š implementation &quot;org.koin:koin-android-viewmodel:$koin_version&quot; æˆ‘ä»¬ä½¿ç”¨çš„æ˜¯ koin-android-viewmodel åº“ï¼Œå› ä¸ºæˆ‘ä»¬å¸Œæœ›åœ¨ MVVM ä¸­ä½¿ç”¨å®ƒï¼Œå½“ç„¶è¿˜æœ‰å…¶ä»–çš„ä¾èµ–åº“ã€‚ æ·»åŠ å®Œä¾èµ–ä¹‹åï¼Œæˆ‘ä»¬æ¥å®ç°ç¬¬ä¸€ä¸ª module æ–‡ä»¶ï¼Œåƒ Dagger ä¸€æ ·ï¼Œå¯ä»¥åœ¨ä¸€ä¸ªå•ç‹¬çš„æ–‡ä»¶ä¸­å®ç°æ¯ä¸ªæ¨¡å—ï¼Œä½†æ˜¯ç”±äºä»£ç ç®€å•ï¼Œæˆ‘å†³å®šåœ¨ä¸€ä¸ªæ–‡ä»¶ä¸­å®ç°æ‰€æœ‰æ¨¡å—ï¼Œä½ ä¹Ÿå¯ä»¥æŠŠå®ƒä»¬åˆ†å¼€ã€‚ é¦–å…ˆæˆ‘ä»¬éœ€è¦äº†è§£ä¸€ä¸‹ koin è¯­æ³•ç‰¹æ€§ get()ï¼š è§£æ Koin æ¨¡å—ä¸­çš„å®ä¾‹ï¼Œè°ƒç”¨ get() å‡½æ•°è§£ææ‰€è¯·æ±‚ç»„ä»¶éœ€è¦çš„å®ä¾‹ï¼Œè¿™ä¸ª get() å‡½æ•°é€šå¸¸ç”¨äºæ„é€ å‡½æ•°ä¸­ï¼Œæ³¨å…¥æ„é€ å‡½æ•°å€¼ factoryï¼šå£°æ˜è¿™æ˜¯ä¸€ä¸ªå·¥å‚ç»„ä»¶ï¼Œæ¯æ¬¡è¯·æ±‚éƒ½ä¸ºæ‚¨æä¾›ä¸€ä¸ªæ–°å®ä¾‹ singleï¼šé‡‡ç”¨å•ä¾‹è®¾è®¡æ¨¡å¼ nameï¼šç”¨äºå‘½åå®šä¹‰ï¼Œå½“æ‚¨å¸Œæœ›å…·æœ‰ä¸åŒç±»å‹çš„åŒä¸€ä¸ªç±»çš„å¤šä¸ªå®ä¾‹æ—¶ï¼Œéœ€è¦ä½¿ç”¨å®ƒ æˆ‘ä»¬æ²¡æœ‰åˆ›å»ºå…·æœ‰å¤šä¸ªæ³¨é‡Šå’Œå¤šä¸ªç»„ä»¶çš„è®¸å¤šæ–‡ä»¶ï¼Œè€Œæ˜¯ä¸º DI æ³¨å…¥æ¯ä¸ªç±»çš„æ—¶å€™ï¼Œæä¾›ä¸€ä¸ªç®€å•ã€å¯è¯»çš„æ–‡ä»¶ã€‚ äº†è§£å®Œ koin è¯­æ³•ç‰¹æ€§ä¹‹åï¼Œæˆ‘ä»¬æ¥è§£é‡Šä¸‹é¢ä»£ç ä»€ä¹ˆæ„æ€ private val retrofit: Retrofit = createNetworkClient() createNetworkClient æ–¹æ³•åˆ›å»º Retrofit å®ä¾‹ï¼Œè®¾ç½® baseUrlï¼Œæ·»åŠ  ConverterFactory å’Œ Interceptor private val generalApi: GeneralApi = retrofit.create(GeneralApi::class.java)private val authApi: AuthApi = retrofit.create(AuthApi::class.java) AuthApi å’Œ GeneralApi æ˜¯ retrofit æ¥å£ val viewModelModule = module { viewModel { LoginFragmentViewModel(get()) } viewModel { StartPageViewModel() } } åœ¨ module æ–‡ä»¶ä¸­å£°æ˜ä¸º viewModelï¼Œ Koin å°†ä¼šå‘ ViewModelFactory æä¾› viewModelï¼Œå°†å…¶ç»‘å®šåˆ°å½“å‰ç»„ä»¶ã€‚ æ­£å¦‚ä½ æ‰€è§ï¼Œåœ¨ LoginFragmentViewModel æ„é€ å‡½æ•°ä¸­æœ‰è°ƒç”¨äº† get() æ–¹æ³•ï¼Œget() ä¼šè§£æä¸€ä¸ª LoginFragmentViewModel éœ€è¦çš„å‚æ•°ï¼Œç„¶åä¼ é€’ç»™ LoginFragmentViewModelï¼Œè¿™ä¸ªå‚æ•°å°±æ˜¯ AuthRepoã€‚ æœ€ååœ¨ Application onCreate æ–¹æ³•ä¸­æ·»åŠ å¦‚ä¸‹ä»£ç  startKoin(this, listOf(repositoryModule, networkModule, viewModelModule)) è¿™é‡Œåªæ˜¯è°ƒç”¨ startKoin æ–¹æ³•ï¼Œä¼ å…¥ä¸€ä¸ªä¸Šä¸‹æ–‡å’Œä¸€ä¸ªå¸Œæœ›ç”¨æ¥åˆå§‹åŒ– Koin çš„æ¨¡å—åˆ—è¡¨ã€‚ ç°åœ¨ä½¿ç”¨ ViewModel æ¯”ä½¿ç”¨çº¯ ViewModel æ›´å®¹æ˜“ï¼Œåœ¨ Fragment å’Œ Activity è§†å›¾ä¸­æ·»åŠ ä¸‹é¢çš„ä»£ç  private val startPageViewModel: StartPageViewModel by viewModel() é€šè¿‡è¿™æ®µä»£ç ï¼Œkoin ä¸ºæ‚¨åˆ›å»ºäº†ä¸€ä¸ª StartPageViewModel å¯¹è±¡ï¼Œç°åœ¨ä½ å¯ä»¥åœ¨ Fragment å’Œ Activity ä¸­ä½¿ç”¨ view model è¯‘è€…æ€è€ƒä½œè€…æ€»å…±ä»ä»¥ä¸‹ 4 ä¸ªæ–¹é¢å¯¹æ¯”äº† Dagger å’Œ Kotlinï¼š æ–‡ä»¶æ•°é‡ï¼šåŸºäº mvvm æ¶æ„ï¼Œåˆ†åˆ«ä½¿ç”¨äº† Dagger å’Œ koltin ä½œä¸ºä¾èµ–æ³¨å…¥æ¡†æ¶ï¼Œåˆå§‹åŒ– Dagger æ—¶è‡³å°‘éœ€è¦ 9 ä¸ªæ–‡ä»¶ï¼Œè€Œ koltin åªéœ€è¦ 2 ä¸ªæ–‡ä»¶ï¼ŒDagger æ–‡ä»¶æ•°é‡è¿œè¶…è¿‡ koltin ä»£ç è¡Œæ•°ï¼šä½œè€…ä½¿ç”¨äº† Statistic å·¥å…·ï¼Œåå¤å¯¹æ¯”äº†é¡¹ç›®ç¼–è¯‘å‰å’Œç¼–è¯‘åï¼ŒDagger å’Œ Koin ç”Ÿæˆçš„ä»£ç è¡Œæ•°ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤º åå¤çš„å¯¹æ¯”äº† Dagger å’Œ Koin ç¼–è¯‘æ—¶é—´ï¼Œç»“æœå¦‚ä¸‹æ‰€ç¤º koin æ¯” Dagger å¿« Koin:BUILD SUCCESSFUL in 17s88 actionable tasks: 83 executed, 5 up-to-dateDagger:BUILD SUCCESSFUL in 18s88 actionable tasks: 83 executed, 5 up-to-date å­¦ä¹ æˆæœ¬å·¨å¤§ï¼Œå¦‚æœä½¿ç”¨äº† Dagger æœ‹å‹ï¼Œåº”è¯¥å’Œä½œè€…çš„æ„Ÿè§‰æ˜¯ä¸€æ ·çš„ï¼ŒDagger å­¦ä¹ çš„æˆæœ¬æ˜¯éå¸¸é«˜çš„ï¼Œå¦‚æœé¡¹ç›®ä¸­å¼•å…¥äº† Dagger æ„å‘³ç€å›¢é˜Ÿæ¯ä¸ªäººéƒ½è¦å­¦ä¹  Daggerï¼Œæ— ç–‘è¿™ä¸ªæˆæœ¬æ˜¯å·¨å¤§çš„ï¼Œè€Œä¸”ä½¿ç”¨èµ·æ¥éå¸¸çš„å¤æ‚ æ³¨æ„ï¼šä½œè€…åœ¨ Application ä¸­è°ƒç”¨ startKoin æ–¹æ³•åˆå§‹åŒ– Koin çš„æ¨¡å—åˆ—è¡¨ï¼Œæ˜¯ Koin 1X çš„æ–¹å¼ï¼ŒKoin å›¢é˜Ÿåœ¨ 2x çš„æ—¶å€™åšäº†å¾ˆå¤šæ”¹åŠ¨ï¼ˆä¸‹é¢ä¼šä»‹ç»ï¼‰ï¼Œåˆå§‹åŒ– Koin çš„æ¨¡å—åˆ—æœ‰æ‰€æ”¹åŠ¨ï¼Œä»£ç å¦‚ä¸‹æ‰€ç¤ºï¼š startKoin { // Use Koin Android Logger androidLogger() // declare Android context androidContext(this@MainApplication) // declare modules to use modules(module1, module2 ...)} Koin ä¸ºä»€ä¹ˆå¯ä»¥åšåˆ°æ— ä»£ç ç”Ÿæˆã€æ— åå°„Koin ä½œä¸ºä¸€ä¸ªè½»é‡çº§ä¾èµ–æ³¨å…¥æ¡†æ¶ï¼Œä¸ºä»€ä¹ˆå¯ä»¥åšåˆ°æ— ä»£ç ç”Ÿæˆã€æ— åå°„ï¼Ÿå› ä¸º kotlin å¼ºå¤§çš„è¯­æ³•ç³–ï¼ˆä¾‹å¦‚ Inlineã€Reified ç­‰ç­‰ï¼‰å’Œå‡½æ•°å¼ç¼–ç¨‹ï¼Œæˆ‘ä»¬å…ˆæ¥çœ‹ä¸€æ®µä»£ç ã€‚koin-projects/koin-core/src/main/kotlin/org/koin/dsl/Module.kt æ¡ˆä¾‹ä¸€ // typealias æ˜¯ç”¨æ¥ä¸ºå·²ç»å­˜åœ¨çš„ç±»å‹é‡æ–°å®šä¹‰åå­—çš„typealias ModuleDeclaration = Module.() -&gt; Unitfun module(createdAtStart: Boolean = false, override: Boolean = false, moduleDeclaration: ModuleDeclaration): Module { // åˆ›å»º Module val module = Module(createdAtStart, override) // æ‰§è¡ŒåŒ¿æ‰©å±•å‡½æ•° moduleDeclaration(module) return module}// å¦‚ä½•ä½¿ç”¨val mModule: Module = module { single { ... } factory { ... }} Module æ˜¯ä¸€ä¸ª lambda è¡¨è¾¾å¼ï¼Œæ‰å¯ä»¥åœ¨ â€œ{}â€ é‡Œé¢è‡ªç”±å®šä¹‰ single å’Œ factoryï¼Œä¼šç­‰åˆ°ä½ éœ€è¦çš„æ—¶å€™æ‰ä¼šæ‰§è¡Œã€‚ æ¡ˆä¾‹äºŒ inline fun &lt;reified T : ViewModel&gt; Module.viewModel( qualifier: Qualifier? = null, override: Boolean = false, noinline definition: Definition&lt;T&gt;): BeanDefinition&lt;T&gt; { val beanDefinition = factory(qualifier, override, definition) beanDefinition.setIsViewModel() return beanDefinition} å†…è”å‡½æ•°æ”¯æŒå…·ä½“åŒ–çš„ç±»å‹å‚æ•°ï¼Œä½¿ç”¨ reified ä¿®é¥°ç¬¦æ¥é™å®šç±»å‹å‚æ•°ï¼Œä»¥åœ¨å‡½æ•°å†…éƒ¨è®¿é—®å®ƒäº†ï¼Œç”±äºå‡½æ•°æ˜¯å†…è”çš„ï¼Œä¸éœ€è¦åå°„ï¼Œé€šè¿‡ä¸Šé¢ä¸¤ä¸ªæ¡ˆä¾‹ï¼Œè¯´æ˜äº†ä¸ºä»€ä¹ˆ Koin å¯ä»¥åšåˆ°æ— ä»£ç ç”Ÿæˆã€æ— åå°„ã€‚å»ºè®®å¤§å®¶éƒ½å»çœ‹çœ‹ Koin çš„æºç ï¼Œèƒ½å¤Ÿä»ä¸­å­¦åˆ°å¾ˆå¤šæŠ€å·§ï¼Œåé¢æˆ‘ä¼šèŠ±å¥½å‡ ç¯‡æ–‡ç« åˆ†æ Koin æºç ã€‚ Inline ä¿®é¥°ç¬¦å¸¦æ¥çš„æ€§èƒ½æŸå¤±Inline (å†…è”å‡½æ•°) çš„ä½œç”¨ï¼šæå‡è¿è¡Œæ•ˆç‡ï¼Œè°ƒç”¨è¢« inline ä¿®é¥°ç¬¦çš„å‡½æ•°ï¼Œä¼šæŠŠé‡Œé¢çš„ä»£ç æ”¾åˆ°æˆ‘è°ƒç”¨çš„åœ°æ–¹ã€‚ å¦‚æœé˜…è¯»è¿‡ Koin æºç çš„æœ‹å‹ï¼Œåº”è¯¥ä¼šå‘ç° inline éƒ½æ˜¯å’Œ lambda è¡¨è¾¾å¼å’Œ reified ä¿®é¥°ç¬¦é…å¥—åœ¨ä¸€èµ·ä½¿ç”¨çš„ï¼Œå¦‚æœåªä½¿ç”¨ inline ä¿®é¥°ç¬¦æ ‡è®°å‡½æ•°ä¼šæ€ä¹ˆæ ·ï¼Ÿ åªä½¿ç”¨ inline ä¿®é¥°ç¬¦ä¼šæœ‰æ€§èƒ½é—®é¢˜ï¼Œåœ¨è¿™ç¯‡æ–‡ç«  Consider inline modifier for higher-order functions ä¹Ÿåˆ†æäº†åªä½¿ç”¨ inline ä¿®é¥°ç¬¦ä¸ºä»€ä¹ˆä¼šå¸¦æ¥æ€§èƒ½é—®é¢˜ï¼Œå¹¶ä¸” Android Studio ä¹Ÿä¼šç»™ä¸€ä¸ªå¤§å¤§å¤§çš„è­¦å‘Šã€‚ ç¼–è¯‘å™¨å»ºè®®æˆ‘ä»¬åœ¨å«æœ‰ lambda è¡¨è¾¾å¼ä½œä¸ºå½¢å‚çš„å‡½æ•°ä¸­ä½¿ç”¨å†…è”ï¼Œæ—¢ç„¶ Inline ä¿®é¥°ç¬¦å¯ä»¥æå‡è¿è¡Œæ•ˆç‡ï¼Œä¸ºä»€ä¹ˆç¼–è¯‘å™¨ä¼šç»™æˆ‘ä»¬ä¸€ä¸ªè­¦å‘Šï¼Ÿ ä¸ºä»€ä¹ˆç¼–è¯‘å™¨å»ºè®® inline ä¿®é¥°ç¬¦éœ€è¦å’Œ lambda è¡¨è¾¾å¼ä¸€èµ·ä½¿ç”¨å‘¢ï¼Ÿ 1. æ—¢ç„¶ Inline ä¿®é¥°ç¬¦å¯ä»¥æå‡è¿è¡Œæ•ˆç‡ï¼Œä¸ºä»€ä¹ˆç¼–è¯‘å™¨ä¼šç»™æˆ‘ä»¬ä¸€ä¸ªè­¦å‘Šï¼Ÿ åˆšæ‰æˆ‘ä»¬è¯´è¿‡è°ƒç”¨è¢« inline ä¿®é¥°ç¬¦çš„å‡½æ•°ï¼Œä¼šæŠŠé‡Œé¢çš„ä»£ç æ”¾åˆ°æˆ‘è°ƒç”¨çš„åœ°æ–¹ï¼Œæ¥çœ‹ä¸€ä¸‹ä¸‹é¢è¿™æ®µä»£ç ã€‚ inline fun twoPrintTwo() { print(2) print(2)}inline fun twoTwoPrintTwo() { twoPrintTwo() twoPrintTwo()}inline fun twoTwoTwoPrintTwo() { twoTwoPrintTwo() twoTwoPrintTwo()}fun twoTwoTwoTwoPrintTwo() { twoTwoTwoPrintTwo() twoTwoTwoPrintTwo()} æ‰§è¡Œå®Œæœ€åä¸€ä¸ªæ–¹æ³• twoTwoTwoTwoPrintTwoï¼Œåç¼–è¯‘å‡ºæ¥çš„ç»“æœæ˜¯éå¸¸ä»¤äººåƒæƒŠçš„ï¼Œç»“æœå¦‚ä¸‹æ‰€ç¤ºï¼š public static final void twoTwoTwoTwoPrintTwo() { byte var1 = 2; System.out.print(var1); var1 = 2; System.out.print(var1); var1 = 2; System.out.print(var1); var1 = 2; System.out.print(var1); var1 = 2; System.out.print(var1); var1 = 2; System.out.print(var1); var1 = 2; System.out.print(var1); var1 = 2; System.out.print(var1); var1 = 2; System.out.print(var1); var1 = 2; System.out.print(var1); var1 = 2; System.out.print(var1); var1 = 2; System.out.print(var1); var1 = 2; System.out.print(var1); var1 = 2; System.out.print(var1); var1 = 2; System.out.print(var1); var1 = 2; System.out.print();} è¿™æ˜¾ç¤ºäº†ä½¿ç”¨ Inline ä¿®é¥°ç¬¦çš„ä¸»è¦é—®é¢˜ï¼Œå½“æˆ‘ä»¬è¿‡åº¦ä½¿ç”¨å®ƒä»¬æ—¶ï¼Œä»£ç ä¼šå¿«é€Ÿå¢é•¿ã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆ IntelliJ åœ¨æˆ‘ä»¬ä½¿ç”¨å®ƒçš„æ—¶å€™ä¼šç»™å‡ºè­¦å‘Šã€‚ 2. ä¸ºä»€ä¹ˆç¼–è¯‘å™¨å»ºè®® inline ä¿®é¥°ç¬¦éœ€è¦å’Œ lambda è¡¨è¾¾å¼ä¸€èµ·ä½¿ç”¨å‘¢ï¼Ÿ å› ä¸º JVM æ˜¯ä¸æ”¯æŒ lambda è¡¨è¾¾å¼çš„ï¼Œéå†…è”å‡½æ•°ä¸­çš„ Lambda è¡¨è¾¾å¼ä¼šè¢«ç¼–è¯‘ä¸ºåŒ¿åç±»ï¼Œè¿™å¯¹æ€§èƒ½å¼€é”€æ˜¯éå¸¸å·¨å¤§çš„ï¼Œè€Œä¸”å®ƒä»¬çš„åˆ›å»ºå’Œä½¿ç”¨éƒ½è¾ƒæ…¢ï¼Œå½“æˆ‘ä»¬ä½¿ç”¨ inline ä¿®é¥°ç¬¦æ—¶ï¼Œæˆ‘ä»¬æ ¹æœ¬ä¸éœ€è¦åˆ›å»ºä»»ä½•å…¶ä»–ç±»ï¼Œæ¥çœ‹ä¸€ä¸‹ä¸‹é¢ä»£ç ã€‚ fun main(args: Array&lt;String&gt;) { var a = 0 // å¸¦ inline çš„ Lambda è¡¨è¾¾å¼ repeat(100_000_000) { a += 1 } var b = 0 // ä¸å¸¦ inline çš„ Lambda è¡¨è¾¾å¼ noinlineRepeat(100_000_000) { b += 1 }} ç¼–è¯‘ç»“æœå¦‚ä¸‹ï¼š // Java ä»£ç public static final void main(@NotNull String[] args) { int a = 0; // å¸¦ inline çš„ Lambda è¡¨è¾¾å¼, ä¼šæŠŠé‡Œé¢çš„ä»£ç æ”¾åˆ°æˆ‘è°ƒç”¨çš„åœ°æ–¹ int times$iv = 100000000; int var3 = 0; for(int var4 = times$iv; var3 &lt; var4; ++var3) { ++a; } // ä¸å¸¦ inline çš„ Lambda è¡¨è¾¾å¼ï¼Œä¼šè¢«ç¼–è¯‘ä¸ºåŒ¿åç±» final IntRef b = new IntRef(); b.element = 0; noinlineRepeat(100000000, (Function1)(new Function1() { public Object invoke(Object var1) { ++b.element; return Unit.INSTANCE; } }));} é‚£ä¹ˆæˆ‘ä»¬åº”è¯¥åœ¨ä»€ä¹ˆæ—¶å€™ä½¿ç”¨ inline ä¿®é¥°ç¬¦å‘¢ï¼Ÿ ä½¿ç”¨ inline ä¿®é¥°ç¬¦æ—¶æœ€å¸¸è§çš„åœºæ™¯å°±æ˜¯æŠŠå‡½æ•°ä½œä¸ºå¦ä¸€ä¸ªå‡½æ•°çš„å‚æ•°æ—¶(é«˜é˜¶å‡½æ•°)ï¼Œä¾‹å¦‚ filterã€mapã€joinToString æˆ–è€…ä¸€äº›ç‹¬ç«‹çš„å‡½æ•° repeatã€‚ å¦‚æœæ²¡æœ‰å‡½æ•°ç±»å‹ä½œä¸ºå‚æ•°ï¼Œä¹Ÿæ²¡æœ‰ reified å®åŒ–ç±»å‹å‚æ•°æ—¶ï¼Œä¸åº”è¯¥ä½¿ç”¨ inline ä¿®é¥°ç¬¦äº†ã€‚ ä»åˆ†æ Koin æºç ï¼Œinline åº”è¯¥ lambda è¡¨è¾¾å¼æˆ–è€… reified ä¿®é¥°ç¬¦é…åˆåœ¨ä¸€èµ·ä½¿ç”¨çš„ï¼Œå¦å¤– Android Studio è¶Šæ¥è¶Šæ™ºèƒ½äº†ï¼Œå¦‚æœåœ¨ä¸æ­£ç¡®çš„åœ°æ–¹ä½¿ç”¨ï¼Œä¼šæœ‰ä¸€ä¸ªå¤§å¤§å¤§çš„è­¦å‘Šã€‚ Reified ä¿®é¥°ç¬¦ï¼Œå…·ä½“åŒ–çš„ç±»å‹å‚æ•°reified ï¼ˆå…·ä½“åŒ–çš„ç±»å‹å‚æ•°ï¼‰ï¼šä½¿ç”¨ reified ä¿®é¥°ç¬¦æ¥é™å®šç±»å‹å‚æ•°ï¼Œç»“åˆç€ inline ä¿®é¥°ç¬¦å…·ä½“åŒ–çš„ç±»å‹å‚æ•°ï¼Œå¯ä»¥ç›´æ¥åœ¨å‡½æ•°å†…éƒ¨è®¿é—®å®ƒã€‚ æˆ‘æƒ³åˆ†äº«ä¸¤ä¸ªä½¿ç”¨ Reified ä¿®é¥°ç¬¦å¾ˆå¸¸è§çš„ä¾‹å­ reified-type-parametersï¼Œä½¿ç”¨ Java æ˜¯ä¸å¯èƒ½å®ç°çš„ã€‚ æ¡ˆä¾‹ä¸€ï¼š inline fun &lt;reified T&gt; Gson.fromJson(json: String) = fromJson(json, T::class.java) // ä½¿ç”¨val user: User = Gson().fromJson(json)val user = Gson().fromJson&lt;User&gt;(json) æ¡ˆä¾‹äºŒï¼š inline fun &lt;reified T: Activity&gt; Context.startActivity(vararg params: Pair&lt;String, Any?&gt;) = AnkoInternals.internalStartActivity(this, T::class.java, params) Koin å¸¦æ¥æ€§èƒ½æŸå¤±çš„é‚£äº›äº‹æ€è€ƒäº†å¾ˆä¹…éœ€ä¸éœ€è¦å†™è¿™éƒ¨åˆ†å†…å®¹ï¼Œå› ä¸ºåœ¨ Koin 2x çš„ç‰ˆæœ¬çš„æ—¶å€™å·²ç»ä¿®å¤äº†ï¼Œè¿™æ˜¯å®˜æ–¹çš„é“¾æ¥ News from the trenches â€” Whatâ€™s next for Koin?ï¼Œåæ¥æƒ³æƒ³è¿˜æ˜¯å†™å†™å§ï¼Œä½œä¸ºè‡ªå·±çš„ä¸€ä¸ªå­¦ä¹ ç¬”è®°ã€‚ è¿™ä¸ªæºäºæœ‰ä¸ªäººå¼€äº†ä¸€ä¸ª Issue(Bad performance in some Android devices) ç°åœ¨å·²ç»è¢«å…³é—­äº†ï¼Œä»–æŒ‡å‡ºäº†å½“ Dependency æ•°é‡è¶Šæ¥è¶Šå¤šçš„æ—¶å€™ï¼ŒKoin æ•ˆèƒ½ä¼šè¶Šæ¥è¶Šå·®ï¼Œè€Œä¸”è¿˜åšäº†ä¸€ä¸ªå¯¹æ¯”å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š å¦‚æœä½¿ç”¨è¿‡ Koin 1x çš„æœ‹å‹åº”è¯¥ä¼šæ„Ÿè§‰åˆ°ï¼Œå¼•å…¥ Koin 1x å†·å¯åŠ¨æ—¶é—´è¾¹é•¿äº†ï¼Œè€Œä¸”åœ¨æœ‰å¤§é‡ä¾èµ–çš„æ—¶å€™ï¼ŒæŸ¥æ‰¾çš„æ—¶é—´ä¼šæœ‰ç‚¹é•¿ï¼Œåæ¥ Koin å›¢é˜Ÿä¹Ÿå‘ç°ç¡®å®å­˜åœ¨è¿™ä¸ªé—®é¢˜ï¼Œåˆ°åº•æ˜¯æ€ä¹ˆå›äº‹å‘¢ï¼Ÿ ä»–ä»¬åœ¨ BeanRegistry ç±»ä¸­ç»´æŠ¤äº†ä¸€ä¸ªåˆ—è¡¨ï¼Œç”¨æ¥å­˜å‚¨äº† BeanDefinitionï¼Œç„¶åä½¿ç”¨ Kotlin çš„ filter å‡½æ•°æ‰¾å‡ºå¯¹åº”çš„ BeanDefinitionï¼Œæ‰€ä»¥æ‰¾å‡ºä¸€ä¸ª Definition æ—¶é—´å¤æ‚åº¦æ˜¯ O(n)ï¼Œå¦‚æœå¹³å‡æœ‰ M å±‚ Dependencyï¼Œé‚£ä¹ˆæ—¶é—´å¤æ‚åº¦ä¼šå˜æˆ O(m*n)ã€‚ Koin å›¢é˜Ÿçš„è§£å†³æ–¹æ¡ˆæ˜¯ç”¨äº† HashMapï¼Œä½¿ç”¨ç©ºé—´æ¢å–æ—¶é—´ï¼ŒæŸ¥æ‰¾ä¸€ä¸ª Definition æ—¶é—´å¤æ‚åº¦å˜æˆäº† O(1)ï¼Œä¼˜åŒ–ä¹‹åçš„ç»“æœå¦‚ä¸‹ï¼š Koin 2x ä¸ä»…åœ¨æ€§èƒ½ä¼˜åŒ–ä¸Šæœ‰å¾ˆå¤§çš„æå‡ï¼Œä¹Ÿæ‹“å±•äº†å¾ˆå¤šæ–°çš„ç‰¹æ€§ï¼Œä¾‹å¦‚ FragmentFactory èƒ½å¤Ÿä¾èµ–æ³¨å…¥åˆ° Fragments ä¸­å°±åƒ ViewModels ä¸€æ ·ï¼Œè¿˜æœ‰è‡ªåŠ¨æ‹†ç®±ç­‰ç­‰ï¼Œåœ¨åé¢çš„æ–‡ç« ä¼šè¯¦ç»†çš„åˆ†æä¸€ä¸‹ã€‚ Kotlin ç”¨ 5 è¡Œä»£ç å®ç°å¿«æ’ç®—æ³•æˆ‘æƒ³åˆ†äº«ä¸€ä¸ªå¿«é€Ÿæ’åºç®—æ³•ï¼Œè¿™æ˜¯ä¸€ä¸ªå¾ˆé…·çš„å‡½æ•°ç¼–ç¨‹çš„ä¾‹å­ share cool examplesï¼Œå½“æˆ‘çœ‹åˆ°è¿™æ®µä»£ç çš„æ—¶å€™æƒŠå‘†äº†ï¼Œå±…ç„¶è¿˜å¯ä»¥è¿™ä¹ˆå†™ã€‚ fun &lt;T : Comparable&lt;T&gt;&gt; List&lt;T&gt;.quickSort(): List&lt;T&gt; = if(size &lt; 2) this else { val pivot = first() val (smaller, greater) = drop(1).partition { it &lt;= pivot} smaller.quickSort() + pivot + greater.quickSort() } // ä½¿ç”¨ [2,5,1] -&gt; [1,2,5]listOf(2,5,1).quickSort() // [1,2,5] æœ€ååˆ†äº«ä¸€ä¸ªè¯‘è€…è‡ªå·±æ’¸çš„å¯¼èˆªç½‘ç«™è¯‘è€…åŸºäº Python + Material Design å¼€å‘çš„ â€œä¸ºäº’è”ç½‘äººè€Œè®¾è®¡ å›½å†…å›½å¤–åç«™å¯¼èˆªâ€œ ï¼Œæ”¶é›†äº†å›½å†…å¤–çƒ­é—¨ç½‘å€ï¼Œæ¶µæ‹¬æ–°é—»ã€ä½“è‚²ã€ç”Ÿæ´»ã€å¨±ä¹ã€è®¾è®¡ã€äº§å“ã€è¿è¥ã€å‰ç«¯å¼€å‘ã€Androidå¼€å‘ç­‰ç­‰å¯¼èˆªç½‘ç«™ï¼Œå¦‚æœä½ æœ‰ä»€ä¹ˆå¥½çš„å»ºè®®ï¼Œä¹Ÿå¯ä»¥ç•™è¨€ï¼Œå¯¼èˆªåœ°å€ ï¼š http://site.51git.cn/ ps: ç½‘ç«™ä¸­çš„åœ°å€å¦‚æœæœ‰åŸä½œè€…ä¸å¸Œæœ›å±•ç¤ºçš„ï¼Œå¯ä»¥ç•™è¨€å‘Šè¯‰æˆ‘ï¼Œæˆ‘ä¼šç«‹åˆ»åˆ é™¤ å›½é™…èµ„è®¯ç½‘å€å¤§å…¨ Android ç½‘å€å¤§å…¨ å‚è€ƒæ–‡çŒ® My favorite examples of functional programming in Kotlin koin å®˜ç½‘:https://insert-koin.io/ Effective Kotlin: Consider inline modifier for higher-order functions æ¨èæ–‡ç«  [è¯‘][Googleå·¥ç¨‹å¸ˆ] åˆšåˆšå‘å¸ƒäº† Fragment çš„æ–°ç‰¹æ€§ â€œFragment é—´ä¼ é€’æ•°æ®çš„æ–°æ–¹å¼â€ ä»¥åŠæºç åˆ†æ [è¯‘][Googleå·¥ç¨‹å¸ˆ] è¯¦è§£ FragmentFactory å¦‚ä½•ä¼˜é›…ä½¿ç”¨ Koin ä»¥åŠéƒ¨åˆ†æºç åˆ†æ [è¯‘][2.4K Start] æ”¾å¼ƒ Dagger æ‹¥æŠ± Koin [è¯‘][5k+] Kotlin çš„æ€§èƒ½ä¼˜åŒ–é‚£äº›äº‹ [è¯‘] è§£å¯† RxJava çš„å¼‚å¸¸å¤„ç†æœºåˆ¶ [è¯‘][1.4K+ Star] Kotlin æ–°ç§€ Coil VS Glide and Picasso æ›´å¤šâ€¦â€¦","link":"/2020/08/04/translate/03-dagger-koin/"},{"title":"ã€Œè¯‘ã€Google å·¥ç¨‹å¸ˆè¯¦è§£ FragmentFactory å¦‚ä½•ä¼˜é›…ä½¿ç”¨ Koin ä»¥åŠæºç åˆ†æ","text":"å‰è¨€ åŸæ ‡é¢˜: Android Fragments: FragmentFactory åŸæ–‡åœ°å€: https://proandroiddev.com/fragmentfactoryâ€¦â€¦ åŸæ–‡ä½œè€…ï¼šHusayn Hakeem åœ¨ä¹‹å‰çš„æ–‡ç«  [è¯‘][Googleå·¥ç¨‹å¸ˆ] åˆšåˆšå‘å¸ƒäº† Fragment çš„æ–°ç‰¹æ€§ â€œFragment é—´ä¼ é€’æ•°æ®çš„æ–°æ–¹å¼â€ ä»¥åŠæºç åˆ†æ ä»‹ç»äº† Fragment 1.3.0 ä¸­æ·»åŠ äº†å‡ ä¸ªé‡è¦çš„ APIã€‚ ç»§ç»­ä¸Šä¸€ç¯‡æ–‡ç« ï¼Œä»‹ç»ä¸€ä¸‹ FragmentFactory å’Œ FragmentContainerView ä»¥åŠå¦‚ä½•å’Œ Koin ä¸€èµ·ä½¿ç”¨ï¼Œ è¿™æ˜¯ Google åœ¨ Fragment 1.2.0 ä¸Šåšçš„é‡è¦çš„æ›´æ–°ï¼Œå¼ºçƒˆå»ºè®®å¤§å®¶å»ä½¿ç”¨ é€šè¿‡è¿™ç¯‡æ–‡ç« ä½ å°†å­¦ä¹ åˆ°ä»¥ä¸‹å†…å®¹ï¼Œå°†åœ¨è¯‘è€…æ€è€ƒéƒ¨åˆ†ä¼šç»™å‡ºç›¸åº”çš„ç­”æ¡ˆ FragmentFactory æ˜¯ä»€ä¹ˆï¼Ÿ ä»€ä¹ˆæƒ…å†µä¸‹ä½¿ç”¨ FragmentFactoryï¼Ÿ FragmentContainerView æ˜¯ä»€ä¹ˆï¼Ÿ ä¸ºä»€ä¹ˆ Google å¼ºçƒˆå»ºè®®ä½¿ç”¨ FragmentContainerViewï¼Ÿ Koin å¦‚ä½•å’Œ FragmentFactory ä¸€èµ·ä½¿ç”¨ä»¥åŠæºç åˆ†æï¼Ÿ å¦‚ä½•å¤„ç†åµŒå¥— Fragment? è¿™ç¯‡æ–‡ç« æ¶‰åŠå¾ˆå¤šé‡è¦æ–°çš„çŸ¥è¯†ç‚¹ï¼Œå¸¦ç€è‡ªå·±ç†è§£ï¼Œè¯·è€å¿ƒè¯»ä¸‹å»ï¼Œåº”è¯¥å¯ä»¥ä»ä¸­å­¦åˆ°å¾ˆå¤šæŠ€å·§ã€‚ è¯‘æ–‡ç°åœ¨æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ FragmentFactory æ¥å®Œæˆ Fragment æ„é€ å‡½æ•°çš„æ³¨å…¥ï¼Œä½†æ˜¯è¿™ä¸æ˜¯å¼€å‘äººå‘˜å¿…é¡»ä½¿ç”¨çš„ API, åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œå®ƒå¯ä»¥è¢«è®¤ä¸ºæ˜¯ä¸€ç§å¾ˆå¥½çš„è®¾è®¡æ–¹æ³•ï¼Œå¸®åŠ©æˆ‘ä»¬æµ‹è¯•å¸¦æœ‰å¤–éƒ¨ä¾èµ–é¡¹çš„ Fragmentã€‚ è¿™ç¯‡æ–‡ç« å°†ä¼šè§£é‡Šä»€ä¹ˆæ˜¯ FragmentFactoryï¼Œä»€ä¹ˆæ—¶å€™ä»¥åŠå¦‚ä½•ä½¿ç”¨å®ƒï¼Œå¦‚ä½•å¤„ç†åµŒå¥— Fragmentã€‚ ä»€ä¹ˆæ˜¯ FragmentFactoryï¼Ÿä¹‹å‰ Fragment çš„å®ä¾‹éƒ½æ˜¯é€šè¿‡ä½¿ç”¨é»˜è®¤çš„ç©ºçš„æ„é€ å‡½æ•°è¿›è¡Œå®ä¾‹åŒ–ï¼Œè¿™æ˜¯å› ä¸ºç³»ç»Ÿéœ€è¦åœ¨æŸäº›æƒ…å†µä¸‹é‡æ–°åˆå§‹åŒ–å®ƒï¼Œæ¯”å¦‚é…ç½®æ›´æ”¹æˆ–è€… App çš„è¿›ç¨‹é‡å»ºï¼Œå¦‚æœæ²¡æœ‰é»˜è®¤æ„é€ å‡½æ•°çš„é™åˆ¶ï¼Œç³»ç»Ÿä¸çŸ¥é“å¦‚ä½•é‡æ–°åˆå§‹åŒ– Fragment å®ä¾‹ã€‚ FragmentFactory å‡ºç°å°±æ˜¯ä¸ºäº†è§£å†³è¿™ä¸ªé™åˆ¶ï¼Œé€šè¿‡å‘å…¶æä¾›å®ä¾‹åŒ– Fragment æ‰€éœ€çš„å‚æ•°/ä¾èµ–å…³ç³»ï¼ŒFragmentFactory å¯ä»¥å¸®åŠ©ç³»ç»Ÿåˆ›å»º Fragment å®ä¾‹ã€‚ å¦‚ä½•ä½¿ç”¨ FragmentFactoryï¼Ÿå¦‚æœä½ çš„ Fragment æ²¡æœ‰ç©ºçš„æ„é€ å‡½æ•°ï¼Œæ‚¨éœ€è¦åˆ›å»ºä¸€ä¸ª FragmentFactory æ¥å¤„ç†åˆå§‹åŒ–å®ƒï¼Œé€šè¿‡ç»§æ‰¿ FragmentFactory å¹¶ä¸”è¦†ç›– FragmentFactory#instantiate() æ¥å®Œæˆã€‚ class CustomFragmentFactory(private val dependency: Dependency) : FragmentFactory() { override fun instantiate(classLoader: ClassLoader, className: String): Fragment { if (className == CustomFragment::class.java.name) { return CustomFragment(dependency) } return super.instantiate(classLoader, className) }} Fragment æ˜¯ç”± FragmentManagers æ¥ç®¡ç†çš„ï¼Œæ‰€ä»¥ä¸ºäº†ä½¿ç”¨ FragmentFactory éœ€è¦å…³è” FragmentManagerï¼Œæ›´å…·ä½“çš„è¯´å®ƒå¿…é¡»åˆ†é…ç»™åŒ…å« Fragment ç»„ä»¶çš„ FragmentManagerï¼Œå®ƒå¯ä»¥æ˜¯ Activity æˆ–è€… Fragmentã€‚ ä»€ä¹ˆæ—¶å€™ FragmentFactory å’Œ FragmentManager åšå…³è”FragmentFactory è´Ÿè´£åœ¨ Activity å’Œ parent Fragment åˆå§‹åŒ– Fragmentï¼Œæ‰€ä»¥åº”è¯¥åœ¨åˆ›å»º Fragment ä¹‹å‰è®¾ç½®å®ƒã€‚ åœ¨åˆ›å»º componentâ€™s View ä¹‹å‰ï¼šå¦‚æœåœ¨ XML ä¸­å®šä¹‰ Fragmentï¼Œåº”è¯¥ä½¿ç”¨ Fragment çš„ tag &lt;fragment&gt; æˆ–è€… FragmentContainerViewã€‚ åœ¨åˆ›å»º Fragment ä¹‹å‰ï¼šå¦‚æœ Fragment æ˜¯åŠ¨æ€æ·»åŠ çš„åº”è¯¥ä½¿ç”¨ FragmentTransactionã€‚ åœ¨ç³»ç»Ÿæ¢å¤ Fragment ä¹‹å‰ï¼šå¦‚æœæ˜¯å› ä¸ºé…ç½®æ›´æ”¹æˆ–è€… App çš„è¿›ç¨‹é‡å»ºï¼Œå¯¼è‡´ Fragment é‡å»ºã€‚ æœ‰äº†è¿™äº›é™åˆ¶ï¼Œå¯ä»¥åœ¨ Activity#onCreate() å’Œ Fragment#onCreate() ä¹‹å‰å…³è” FragmentFactory å’Œ FragmentManagerï¼Œåœ¨è¿™ä¸¤ä¸ªè°ƒç”¨å¤„ view åˆ›å»ºä¹‹å‰ä¼šé‡æ–°åˆå§‹åŒ– Fragmentã€‚ è¿™ä¹Ÿå°±æ„å‘³ç€åº”è¯¥åœ¨ super#onCreate() ä¹‹å‰å…³è” FragmentFactory å’Œ FragmentManagerã€‚ åœ¨ Activity å…³è” FragmentFactory å’Œ FragmentManager class HostActivity : AppCompatActivity() { private val customFragmentFactory = CustomFragmentFactory(Dependency()) override fun onCreate(savedInstanceState: Bundle?) { supportFragmentManager.fragmentFactory = customFragmentFactory super.onCreate(savedInstanceState) // ... }} åœ¨ Fragment å…³è” FragmentFactory å’Œ FragmentManager class ParentFragment : Fragment() { private val customFragmentFactory = CustomFragmentFactory(Dependency()) override fun onCreate(savedInstanceState: Bundle?) { childFragmentManager.fragmentFactory = customFragmentFactory super.onCreate(savedInstanceState) // ... }} éœ€è¦ä½¿ç”¨ FragmentFactory å—ï¼Ÿåˆ°ç›®å‰ä¸ºæ­¢ï¼Œæ‚¨å¯èƒ½å·²ç»ä½¿ç”¨å®ƒä»¬çš„é»˜è®¤æ„é€ å‡½æ•°åˆ›å»º Fragmentï¼Œç„¶åä½¿ç”¨ Dagger æˆ– Koin è¿™æ ·çš„åº“æ³¨å…¥å®ƒä»¬éœ€è¦çš„ä¾èµ–é¡¹ï¼Œæˆ–è€…åœ¨å®ƒä»¬è¢«ä½¿ç”¨ä¹‹å‰åœ¨ Fragment ä¸­åˆå§‹åŒ–å®ƒä»¬ã€‚ å¦‚æœä½ çš„ Fragment æœ‰ä¸€ä¸ªé»˜è®¤çš„ç©ºæ„é€ å‡½æ•°ï¼Œé‚£ä¹ˆå°±ä¸éœ€è¦ä½¿ç”¨ FragmentFactoryï¼Œå¦‚æœåœ¨ Fragment æ„é€ å‡½æ•°ä¸­æ¥å—å‚æ•°ï¼Œå¿…é¡»ä½¿ç”¨ FragmentFactoryï¼Œå¦è€…ä¼šæŠ›å‡º Fragment.InstantiationException å¼‚å¸¸ å¦‚ä½•åŒæ—¶ä½¿ç”¨ Fragment å’Œ FragmentFactoryï¼Ÿåªéœ€è¦åœ¨åˆ›å»º Fragment ä¹‹å‰ï¼Œè®¾ç½® FragmentFactoryï¼Œå®ƒå°±ä¼šè¢«ç”¨æ¥å®ä¾‹åŒ–ï¼Œè¿™æ„å‘³ç€åœ¨æ·»åŠ  Fragments ä¹‹å‰ä½¿ç”¨è‡ªå®šä¹‰çš„ FragmentFactoryã€‚ é™æ€æ·»åŠ ï¼š ä½¿ç”¨ Fragment çš„ tag &lt;fragment&gt; å’Œ FragmentContainerViewã€‚ &lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;&lt;androidx.fragment.app.FragmentContainerView xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot; android:id=&quot;@+id/customFragment&quot; android:name=&quot;com.example.CustomFragment&quot; android:layout_width=&quot;match_parent&quot; android:layout_height=&quot;match_parent&quot; android:tag=&quot;custom_fragment&quot; /&gt; è®¾ç½® FragmentFactory ç”¨äºåˆå§‹åŒ–åœ¨Fragment å£°æ˜çš„ FragmentContainerView class HostActivity : AppCompatActivity() { private val customFragmentFactory = CustomFragmentFactory(Dependency()) override fun onCreate(savedInstanceState: Bundle?) { supportFragmentManager.fragmentFactory = customFragmentFactory super.onCreate(savedInstanceState) setContentView(R.layout.activity_with_fragment_container_view) }} åŠ¨æ€æ·»åŠ ï¼š ä½¿ç”¨ FragmentTransaction#add() æ–¹æ³•åŠ¨æ€çš„æ·»åŠ  Fragment class HostActivity : AppCompatActivity() { private val customFragmentFactory = CustomFragmentFactory(Dependency()) override fun onCreate(savedInstanceState: Bundle?) { supportFragmentManager.fragmentFactory = customFragmentFactory super.onCreate(savedInstanceState) setContentView(R.layout.activity_with_empty_frame_layout) if (savedInstanceState == null) { supportFragmentManager.beginTransaction() .add(R.id.content, CustomFragment::class.java, arguments) .commit() } }} FragmentFactory å’ŒåµŒå¥—çš„ Fragmentå¦‚æœ parent Fragment åŒ…å«åµŒå¥—çš„ Fragment æˆ–è€…å¤šå±‚æ¬¡åµŒå¥—çš„ Fragmentï¼Œå®ƒä»¬éƒ½ä¼šä½¿ç”¨ parent Fragment çš„ç›¸åŒ FragmentFactoryï¼ŒåµŒå¥— Fragment éœ€è¦è°ƒç”¨ Fragment#childFragmentManager.fragmentFactory class ParentFragment : Fragment() { override fun onCreate(savedInstanceState: Bundle?) { childFragmentManager.fragmentFactory = parentFragmentFactory super.onCreate(savedInstanceState) if (savedInstanceState == null) { // Add NestedFragment } }}class NestedFragment : Fragment() { override fun onCreate(savedInstanceState: Bundle?) { childFragmentManager.fragmentFactory = childFragmentFactory super.onCreate(savedInstanceState) if (savedInstanceState == null) { // Add NestedNestedFragment } }}class NestedNestedFragment : Fragment() è¯‘è€…æ€è€ƒæˆ‘ä»¬æ¥æ€»ç»“ä¸€ä¸‹ Fragment å‡ ä¸ªé‡è¦çš„æ›´æ–°ï¼Œä»¥åŠåœ¨ä»€ä¹ˆæƒ…å†µä¸‹ä½¿ç”¨ï¼š ä¹‹å‰ Fragment çš„å®ä¾‹éƒ½æ˜¯é€šè¿‡ä½¿ç”¨é»˜è®¤çš„ç©ºçš„æ„é€ å‡½æ•°è¿›è¡Œå®ä¾‹åŒ–çš„ï¼ŒFragmentFactory å‡ºç°å°±æ˜¯ä¸ºäº†è§£å†³è¿™ä¸ªé™åˆ¶ã€‚ FragmentFactory ä¸æ˜¯å¿…é¡»è¦ä½¿ç”¨çš„ï¼Œå¦‚æœåœ¨ Fragment æ„é€ å‡½æ•°ä¸­æ¥å—å‚æ•°ï¼Œå¿…é¡»ä½¿ç”¨ FragmentFactory FragmentFactory éœ€è¦åœ¨ Activity æˆ–è€… Fragment ä¸­ä½¿ç”¨ï¼Œå¹¶ä¸”éœ€è¦åœ¨ Activity#onCreate() å’Œ Fragment#onCreate() ä¹‹å‰å’Œ FragmentManager åšå…³è” åµŒå¥—çš„ Fragment æˆ–è€…å¤šå±‚æ¬¡åµŒå¥—çš„ Fragmentï¼Œä½¿ç”¨çš„æ˜¯ç›¸åŒ FragmentFactory æ­£å› ä¸º FragmentFactory å‡ºç°ï¼Œå¯ä»¥åœ¨ Fragment æ„é€ å‡½æ•°ä¸­ä¼ é€’å‚æ•°ï¼Œæ„å‘³ç€å¯ä»¥ä½¿ç”¨ Koin ç­‰æ¡†æ¶ï¼Œå¯ä»¥å®ç°æ„é€ å‡½æ•°ä¾èµ–æ³¨å…¥ï¼Œåé¢æˆ‘ä¼šæ¼”ç¤ºå¦‚ä½•ä½¿ç”¨ æ¥ä¸‹æ¥ä¸€èµ·äº†è§£ä¸€ä¸‹ä»€ä¹ˆ FragmentContainerViewï¼Œä¸ºä»€ä¹ˆ Google å¼ºçƒˆå»ºè®®ä½¿ç”¨ FragmentContainerView å®¹å™¨æ¥å­˜å‚¨åŠ¨æ€æ·»åŠ çš„ Fragmentã€‚ FragmentContainerView æ˜¯ä»€ä¹ˆï¼Ÿä¸ºä»€ä¹ˆ Google å¼ºçƒˆå»ºè®®ä½¿ç”¨ï¼Ÿæˆ‘ä»¬å…ˆæ¥çœ‹ä¸€ä¸‹ Google çš„æ›´æ–°è¯´æ˜ï¼š FragmentContainerViewï¼š FragmentContainerView æ˜¯ä¸€ä¸ªè‡ªå®šä¹‰ View ç»§æ‰¿ FrameLayoutï¼Œä¸ ViewGroups ä¸åŒï¼Œå®ƒåªæ¥å— Fragment Viewsã€‚ ä¸ºä»€ä¹ˆ Google å¼ºçƒˆå»ºè®®ä½¿ç”¨ï¼Ÿ ä¹‹å‰åœ¨ Google issue æäº†ä¸€ä¸ª fragment z-ordering çš„é—®é¢˜ï¼Œå°±æ˜¯è¯´ Fragment è¿›å…¥å’Œé€€å‡ºåŠ¨ç”»ä¼šå¯¼è‡´ä¸€ä¸ªé—®é¢˜ï¼Œè¿›å…¥çš„ Fragment ä¼šåœ¨é€€å‡ºçš„ Fragmentä¸‹é¢ï¼Œç›´åˆ°å®ƒå®Œå…¨é€€å‡ºå±å¹•ï¼Œè¿™ä¼šå¯¼è‡´åœ¨ Fragment ä¹‹é—´åˆ‡æ¢æ—¶äº§ç”Ÿé”™è¯¯çš„åŠ¨ç”»ã€‚ ä½¿ç”¨ FragmentContainerView å¸¦æ¥çš„å¥½å¤„æ˜¯æ”¹è¿›äº†å¯¹ fragment z-ordering çš„å¤„ç†ã€‚è¿™æ˜¯ Google æ¼”ç¤ºçš„ä¾‹å­ï¼Œä¼˜åŒ–äº†ä¸¤ä¸ª Fragment é€€å‡ºå’Œè¿›å…¥è¿‡æ¸¡ä¸ä¼šäº’ç›¸é‡å ï¼Œä½¿ç”¨ FragmentContainerView å°†å…ˆå¼€å¯é€€å‡ºåŠ¨ç”»ç„¶åæ‰æ˜¯è¿›å…¥åŠ¨ç”»ã€‚ Koin å¦‚ä½•å’Œ FragmentFactory ä¸€èµ·ä½¿ç”¨ä»¥åŠæºç åˆ†æåœ¨ä¹‹å‰çš„æ–‡ç«  [è¯‘][2.4K Start] æ”¾å¼ƒ Dagger æ‹¥æŠ± Koin åˆ†æäº† Koin æ€§èƒ½ï¼Œå¦‚æœæ²¡æœ‰çœ‹è¿‡ï¼Œå»ºè®®å¯ä»¥å»äº†è§£ä¸€ä¸‹ã€‚ Koin å›¢é˜Ÿåœ¨ 2.1.0 ç‰ˆæœ¬å¼€å§‹æ”¯æŒ Fragment çš„ä¾èµ–æ³¨å…¥ï¼Œæˆªå›¾å¦‚ä¸‹æ‰€ç¤ºï¼š 1. æ·»åŠ  Koin Fragment ä¾èµ– implementation &quot;org.koin:koin-androidx-fragment:2.1.5&quot; 2. åˆ›å»º Fragment å¹¶ä¼ é€’ ViewModel class FragmentTest(val mainViewModel: MainViewModel) : Fragment(){ ......} 3. åˆ›å»º Fragment modules val viewModelsModule = module { viewModel { MainViewModel() }}val fragmentModules = module { fragment { FragmentTest(get()) }}val appModules = listOf(fragmentModules, viewModelsModule) 4. åœ¨è°ƒç”¨ startKoin æ–¹æ³•æ—¶è®¾ç½® KoinFragmentFactory startKoin { AndroidLogger(Level.DEBUG) androidContext(this@App) fragmentFactory() loadKoinModules(appModules)} fragmentFactory æ˜¯ KoinApplication çš„æ‰©å±•å‡½æ•°ï¼Œæä¾›äº† KoinFragmentFactory ä»£ç å¦‚ä¸‹æ‰€ç¤ºï¼š koin.loadModules(listOf(module { single&lt;FragmentFactory&gt; { KoinFragmentFactory() } }))} ä¸€èµ·æ¥åˆ†æ KoinFragmentFactory å†…éƒ¨çš„æºç ï¼š class KoinFragmentFactory(val scope: Scope? = null) : FragmentFactory(), KoinComponent { override fun instantiate(classLoader: ClassLoader, className: String): Fragment { val clazz = Class.forName(className).kotlin val instance = if (scope != null) { scope.getOrNull&lt;Fragment&gt;(clazz) }else{ getKoin().getOrNull&lt;Fragment&gt;(clazz) } return instance ?: super.instantiate(classLoader, className) }} ç»§æ‰¿ FragmentFactory å¹¶ä¸”é‡å†™äº† FragmentFactory#instantiate() æ–¹æ³•ï¼Œåœ¨è¿™ä¸ªå‡½æ•°ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨ className ä½œä¸ºå‚æ•°è·å– Fragmentï¼Œå¹¶å°è¯•ä» Koin ä¸­æ£€ç´¢ Fragment å®ä¾‹ 5. åœ¨ onCreate æ–¹æ³•ä¹‹å‰ è°ƒç”¨ setupKoinFragmentFactory ç»‘å®š FragmentFactory override fun onCreate(savedInstanceState: Bundle?) { setupKoinFragmentFactory() super.onCreate(savedInstanceState) setContentView(R.layout.activity_main)} 6. æ·»åŠ  Fragment å¹¶ä¼ é€’ Bundle val arguments = Bundle().apply { putString(FragmentTest.KEY_NAME, &quot;æ¥æºäº MainActivity&quot;)}supportFragmentManager.beginTransaction() .replace(R.id.container, FragmentTest::class.java, arguments) .commit() ç›¸å…³æºç å·²ç»ä¸Šä¼ åˆ° JDataBinding ä¸­, å¯ä»¥æŸ¥çœ‹ Appã€MainActivityã€AppModule å’Œ FragmentTest è¿™å‡ ä¸ªç±» å‚è€ƒæ–‡çŒ® https://github.com/InsertKoinIO/koin/issues/647 Android Fragments: FragmentFactory https://developer.android.com/jetpack/androidx/releases/fragment æ¨èæ–‡ç«  [è¯‘][Googleå·¥ç¨‹å¸ˆ] åˆšåˆšå‘å¸ƒäº† Fragment çš„æ–°ç‰¹æ€§ â€œFragment é—´ä¼ é€’æ•°æ®çš„æ–°æ–¹å¼â€ ä»¥åŠæºç åˆ†æ [è¯‘][Googleå·¥ç¨‹å¸ˆ] è¯¦è§£ FragmentFactory å¦‚ä½•ä¼˜é›…ä½¿ç”¨ Koin ä»¥åŠéƒ¨åˆ†æºç åˆ†æ [è¯‘][2.4K Start] æ”¾å¼ƒ Dagger æ‹¥æŠ± Koin [è¯‘][5k+] Kotlin çš„æ€§èƒ½ä¼˜åŒ–é‚£äº›äº‹ [è¯‘] è§£å¯† RxJava çš„å¼‚å¸¸å¤„ç†æœºåˆ¶ [è¯‘][1.4K+ Star] Kotlin æ–°ç§€ Coil VS Glide and Picasso æ›´å¤šâ€¦â€¦","link":"/2020/07/31/translate/02-fragment-data/"},{"title":"ã€Œè¯‘ã€Google æœ€æ–°å‘å¸ƒäº† Fragment çš„æ–°ç‰¹æ€§ Fragment é—´ä¼ é€’æ•°æ®çš„æ–°æ–¹å¼ ä»¥åŠæºç åˆ†æ","text":"å‰è¨€ åŸæ ‡é¢˜: Android Fragments: Fragment Result åŸæ–‡åœ°å€: https://proandroiddev.com/android-fragments-fragment-resultâ€¦â€¦ åŸæ–‡ä½œè€…: Husayn Hakeem å°±åœ¨ 2020/05/07 å· Now in Android #17 æ›´æ–°äº†ï¼Œå‘å¸ƒ Android çš„æ–°ç‰¹æ€§ï¼Œå…¶ä¸­å°±åŒ…æ‹¬ Fragment é—´é€šä¿¡çš„æ–°æ–¹å¼ï¼Œå¤§å®¶å¯ä»¥ç‚¹å‡»è¿™é‡Œå‰å¾€ï¼Œçœ‹çœ‹éƒ½æœ‰é‚£äº›æ›´æ–° é€šè¿‡è¿™ç¯‡æ–‡ç« ä½ å°†å­¦ä¹ åˆ°ä»¥ä¸‹å†…å®¹ï¼Œå°†åœ¨è¯‘è€…æ€è€ƒéƒ¨åˆ†ä¼šç»™å‡ºç›¸åº”çš„ç­”æ¡ˆ æ–° Fragment é—´é€šä¿¡çš„æ–¹å¼çš„ä½¿ç”¨ï¼Ÿ æ–° Fragment é—´é€šä¿¡çš„æºç åˆ†æï¼Ÿ æ±‡æ€» Fragment ä¹‹é—´çš„é€šä¿¡çš„æ–¹å¼ï¼Ÿ è¯‘æ–‡Frrgament é—´ä¼ é€’æ•°æ®å¯ä»¥é€šè¿‡å¤šç§æ–¹å¼ï¼ŒåŒ…æ‹¬ä½¿ç”¨ target Fragment APIs (Fragment.setTargetFragment() å’Œ Fragment.getTargetFragment())ï¼ŒViewModel æˆ–è€… ä½¿ç”¨ Fragmentsâ€™ çˆ¶å®¹å™¨ Activityï¼Œtarget Fragment APIs å·²ç»è¿‡æ—¶äº†ï¼Œç°åœ¨é¼“åŠ±ä½¿ç”¨æ–°çš„ Fragment result APIs å®Œæˆ Frrgament ä¹‹é—´ä¼ é€’æ•°æ®ï¼Œå…¶ä¸­ä¼ é€’æ•°æ®ç”± FragmentManager å¤„ç†ï¼Œå¹¶ä¸”åœ¨ Fragments è®¾ç½®å‘é€æ•°æ®å’Œæ¥å—æ•°æ® åœ¨ Frrgament ä¹‹é—´ä¼ é€’æ•°æ®ä½¿ç”¨æ–°çš„ Fragment APIs åœ¨ ä¸¤ä¸ª Frrgament ä¹‹é—´çš„ä¼ é€’ï¼Œæ²¡æœ‰ä»»ä½•å¼•ç”¨ï¼Œå¯ä»¥ä½¿ç”¨å®ƒä»¬å…¬å…±çš„ FragmentManagerï¼Œå®ƒå……å½“ Frrgament ä¹‹é—´ä¼ é€’æ•°æ®çš„ä¸­å¿ƒå­˜å‚¨ã€‚ æ¥å—æ•°æ®å¦‚æœæƒ³åœ¨ Fragment ä¸­æ¥å—æ•°æ®ï¼Œå¯ä»¥åœ¨ FragmentManager ä¸­æ³¨å†Œä¸€ä¸ª FragmentResultListenerï¼Œå‚æ•° requestKey å¯ä»¥è¿‡æ»¤æ‰ FragmentManager å‘é€çš„æ•°æ® FragmentManager.setFragmentResultListener( requestKey, lifecycleOwner, FragmentResultListener { requestKey: String, result: Bundle -&gt; // Handle result }) å‚æ•° lifecycleOwner å¯ä»¥è§‚å¯Ÿç”Ÿå‘½å‘¨æœŸï¼Œå½“ Fragment çš„ç”Ÿå‘½å‘¨æœŸå¤„äº STARTED æ—¶æ¥å—æ•°æ®ã€‚å¦‚æœç›‘å¬ Fragment çš„ç”Ÿå‘½å‘¨æœŸï¼Œæ‚¨å¯ä»¥åœ¨æ¥æ”¶åˆ°æ–°æ•°æ®æ—¶å®‰å…¨åœ°æ›´æ–° UIï¼Œå› ä¸º view çš„åˆ›å»º(onViewCreated() æ–¹æ³•åœ¨ onStart() ä¹‹å‰è¢«è°ƒç”¨)ã€‚ å½“ç”Ÿå‘½å‘¨æœŸå¤„äº LifecycleOwner STARTED çš„çŠ¶æ€ä¹‹å‰ï¼Œå¦‚æœæœ‰å¤šä¸ªæ•°æ®ä¼ é€’ï¼Œåªä¼šæ¥æ”¶åˆ°æœ€æ–°çš„å€¼ å½“ç”Ÿå‘½å‘¨æœŸå¤„äº LifecycleOwner DESTROYED æ—¶ï¼Œå®ƒå°†è‡ªåŠ¨ç§»é™¤ listenerï¼Œå¦‚æœæƒ³æ‰‹åŠ¨ç§»é™¤ listenerï¼Œéœ€è¦è°ƒç”¨ FragmentManager.setFragmentResultListener() æ–¹æ³•ï¼Œä¼ é€’ç©ºçš„ FragmentResultListener åœ¨ FragmentManager ä¸­æ³¨å†Œ listenerï¼Œä¾èµ–äº Fragment å‘é€è¿”å›çš„æ•°æ® å¦‚æœåœ¨ FragmentA ä¸­æ¥å— FragmentB å‘é€çš„æ•°æ®ï¼ŒFragmentA å’Œ FragmentB å¤„äºç›¸åŒçš„å±‚çº§ï¼Œé€šè¿‡ parent FragmentManager è¿›è¡Œé€šä¿¡ï¼ŒFragmentA å¿…é¡»ä½¿ç”¨ parent FragmentManager æ³¨å†Œ listener parentFragmentManager.setFragmentResultListener(...) å¦‚æœåœ¨ FragmentA ä¸­æ¥å— FragmentB å‘é€çš„æ•°æ®ï¼ŒFragmentA æ˜¯ FragmentB çš„çˆ¶å®¹å™¨ï¼Œ ä»–ä»¬é€šè¿‡ child FragmentManager è¿›è¡Œé€šä¿¡ childFragmentManager.setFragmentResultListener(...) listener å¿…é¡»è®¾ç½®çš„Fragment ç›¸åŒçš„ FragmentManager å‘é€æ•°æ®å¦‚æœ FragmentB å‘é€æ•°æ®ç»™ FragmentAï¼Œéœ€è¦åœ¨ FragmentA ä¸­æ³¨å†Œ listenerï¼Œé€šè¿‡ parent FragmentManager å‘é€æ•°æ® parentFragmentManager.setFragmentResult( requestKey, // Same request key FragmentA used to register its listener bundleOf(key to value) // The data to be passed to FragmentA) æµ‹è¯• Fragment Resultsæµ‹è¯• Fragment æ˜¯å¦æˆåŠŸæ¥æ”¶æˆ–å‘é€æ•°æ®ï¼Œå¯ä»¥ä½¿ç”¨ FragmentScenario API æ¥å—æ•°æ®å¦‚æœåœ¨ FragmentA ä¸­æ³¨å†Œ FragmentResultListener æ¥å—æ•°æ®ï¼Œä½ å¯ä»¥æ¨¡æ‹Ÿ parent FragmentManager å‘é€æ•°æ®ï¼Œå¦‚æœåœ¨ FragmentA ä¸­æ­£ç¡®æ³¨å†Œäº† listenerï¼Œå¯ä»¥ç”¨æ¥éªŒè¯ FragmentA æ˜¯å¦èƒ½æ”¶åˆ°æ•°æ®ï¼Œä¾‹å¦‚ï¼Œå¦‚æœåœ¨ FragmentA ä¸­æ¥å—æ•°æ®å¹¶æ›´æ–° UI, å¯ä»¥ä½¿ç”¨ Espresso APIs æ¥éªŒè¯æ˜¯å¦æœŸæœ›çš„æ•°æ® @Testfun shouldReceiveData() { val scenario = FragmentScenario.launchInContainer(FragmentA::class.java) // Pass data using the parent fragment manager scenario.onFragment { fragment -&gt; val data = bundleOf(KEY_DATA to &quot;value&quot;) fragment.parentFragmentManager.setFragmentResult(&quot;aKey&quot;, data) } // Verify data is received, for example, by verifying it's been displayed on the UI onView(withId(R.id.textView)).check(matches(withText(&quot;value&quot;))) } å‘é€æ•°æ®å¯ä»¥åœ¨ FragmentB çš„ parent FragmentManager ä¸Šæ³¨å†Œä¸€ä¸ª FragmentResultListener æ¥æµ‹è¯• FragmentB æ˜¯å¦æˆåŠŸå‘é€æ•°æ®ï¼Œå½“å‘é€æ•°æ®ç»“æŸæ—¶ï¼Œå¯ä»¥æ¥éªŒè¯è¿™ä¸ª listener æ˜¯å¦èƒ½æ”¶åˆ°æ•°æ® @Testfun shouldSendData() { val scenario = FragmentScenario.launchInContainer(FragmentB::class.java) // Register result listener var receivedData = &quot;&quot; scenario.onFragment { fragment -&gt; fragment.parentFragmentManager.setFragmentResultListener( KEY, fragment, FragmentResultListener { key, result -&gt; receivedData = result.getString(KEY_DATA) }) } // Send data onView(withId(R.id.send_data)).perform(click()) // Verify data was successfully sent assertThat(receivedData).isEqualTo(&quot;value&quot;)} ç¤ºä¾‹é¡¹ç›®ä¸‹é¢çš„ç¤ºä¾‹é¡¹ç›®ï¼Œå±•ç¤ºäº†å¦‚ä½•ä½¿ç”¨ Fragment æ–°çš„ API android-playground: https://github.com/husaynhakeem/android-playgroundâ€¦ æ€»ç»“è™½ç„¶ä½¿ç”¨äº† Fragment result APIsï¼Œæ›¿æ¢äº†è¿‡æ—¶çš„ Fragment target APIsï¼Œä½†æ˜¯æ–°çš„ APIs åœ¨Bundle ä½œä¸ºæ•°æ®ä¼ ä¼ é€’æ–¹é¢æœ‰ä¸€äº›é™åˆ¶ï¼Œåªèƒ½ä¼ é€’ç®€å•æ•°æ®ç±»å‹ã€Serializable å’Œ Parcelable æ•°æ®ï¼ŒFragment result APIs å…è®¸ç¨‹åºä»å´©æºƒä¸­æ¢å¤æ•°æ®ï¼Œè€Œä¸”ä¸ä¼šæŒæœ‰å¯¹æ–¹çš„å¼•ç”¨ï¼Œé¿å…å½“ Fragment å¤„äºä¸å¯é¢„çŸ¥çŠ¶æ€çš„æ—¶ï¼Œå¯èƒ½å‘ç”ŸæœªçŸ¥çš„é—®é¢˜ è¯‘è€…çš„æ€è€ƒè¿™æ˜¯è¯‘è€…çš„ä¸€äº›æ€è€ƒï¼Œæ€»ç»“ä¸€ä¸‹ Fragment 1.3.0-alpha04 æ–°å¢åŠ çš„ Fragment é—´é€šä¿¡çš„ API æ•°æ®æ¥å— FragmentManager.setFragmentResultListener( requestKey, lifecycleOwner, FragmentResultListener { requestKey: String, result: Bundle -&gt; // Handle result }) æ•°æ®å‘é€ parentFragmentManager.setFragmentResult( requestKey, // Same request key FragmentA used to register its listener bundleOf(key to value) // The data to be passed to FragmentA) é‚£ä¹ˆ Fragment é—´é€šä¿¡çš„æ–° API ç»™æˆ‘ä»¬å¸¦æ¥å“ªäº›å¥½å¤„å‘¢ï¼š åœ¨ Fragment ä¹‹é—´ä¼ é€’æ•°æ®ï¼Œä¸ä¼šæŒæœ‰å¯¹æ–¹çš„å¼•ç”¨ å½“ç”Ÿå‘½å‘¨æœŸå¤„äº ON_START æ—¶å¼€å§‹å¤„ç†æ•°æ®ï¼Œé¿å…å½“ Fragment å¤„äºä¸å¯é¢„çŸ¥çŠ¶æ€çš„æ—¶ï¼Œå¯èƒ½å‘ç”ŸæœªçŸ¥çš„é—®é¢˜ å½“ç”Ÿå‘½å‘¨æœŸå¤„äº ON_DESTROY æ—¶ï¼Œç§»é™¤ç›‘å¬ æˆ‘ä»¬ä¸€èµ·æ¥ä»æºç çš„è§’åº¦åˆ†æä¸€ä¸‹ Google æ˜¯å¦‚ä½•åšçš„ æºç åˆ†ææŒ‰ç…§æƒ¯ä¾‹ä»è°ƒç”¨çš„æ–¹æ³•æ¥åˆ†æï¼Œæ•°æ®æ¥å—æ—¶ï¼Œè°ƒç”¨äº† FragmentManager çš„ setFragmentResultListener æ–¹æ³•androidx.fragment/fragment/1.3.0-alpha04â€¦â€¦androidx/fragment/app/FragmentManager.java private final ConcurrentHashMap&lt;String, LifecycleAwareResultListener&gt; mResultListeners = new ConcurrentHashMap&lt;&gt;();@Overridepublic final void setFragmentResultListener(@NonNull final String requestKey, @NonNull final LifecycleOwner lifecycleOwner, @Nullable final FragmentResultListener listener) { // mResultListeners æ˜¯ ConcurrentHashMap çš„å®ä¾‹ï¼Œç”¨æ¥å‚¨å­˜æ³¨å†Œçš„ listener // å¦‚æœä¼ é€’çš„å‚æ•° listener ä¸ºç©ºæ—¶ï¼Œç§»é™¤ requestKey å¯¹åº”çš„ listener if (listener == null) { mResultListeners.remove(requestKey); return; } // Lifecycleæ˜¯ä¸€ä¸ªç”Ÿå‘½å‘¨æœŸæ„ŸçŸ¥ç»„ä»¶ï¼Œä¸€èˆ¬ç”¨æ¥å“åº”Activityã€Fragmentç­‰ç»„ä»¶çš„ç”Ÿå‘½å‘¨æœŸå˜åŒ– final Lifecycle lifecycle = lifecycleOwner.getLifecycle(); // å½“ç”Ÿå‘½å‘¨æœŸå¤„äº DESTROYED æ—¶ï¼Œç›´æ¥è¿”å› // é¿å…å½“ Fragment å¤„äºä¸å¯é¢„çŸ¥çŠ¶æ€çš„æ—¶ï¼Œå¯èƒ½å‘ç”ŸæœªçŸ¥çš„é—®é¢˜ if (lifecycle.getCurrentState() == Lifecycle.State.DESTROYED) { return; } // å¼€å§‹ç›‘å¬ç”Ÿå‘½å‘¨æœŸ LifecycleEventObserver observer = new LifecycleEventObserver() { @Override public void onStateChanged(@NonNull LifecycleOwner source, @NonNull Lifecycle.Event event) { // å½“ç”Ÿå‘½å‘¨æœŸå¤„äº ON_START æ—¶å¼€å§‹å¤„ç†æ•°æ® if (event == Lifecycle.Event.ON_START) { // å¼€å§‹æ£€æŸ¥å—åˆ°çš„æ•°æ® Bundle storedResult = mResults.get(requestKey); if (storedResult != null) { // å¦‚æœç»“æœä¸ä¸ºç©ºï¼Œè°ƒç”¨å›è°ƒæ–¹æ³• listener.onFragmentResult(requestKey, storedResult); // æ¸…é™¤æ•°æ® setFragmentResult(requestKey, null); } } // å½“ç”Ÿå‘½å‘¨æœŸå¤„äº ON_DESTROY æ—¶ï¼Œç§»é™¤ç›‘å¬ if (event == Lifecycle.Event.ON_DESTROY) { lifecycle.removeObserver(this); mResultListeners.remove(requestKey); } } }; lifecycle.addObserver(observer); mResultListeners.put(requestKey, new FragmentManager.LifecycleAwareResultListener(lifecycle, listener));} Lifecycleæ˜¯ä¸€ä¸ªç”Ÿå‘½å‘¨æœŸæ„ŸçŸ¥ç»„ä»¶ï¼Œä¸€èˆ¬ç”¨æ¥å“åº”Activityã€Fragmentç­‰ç»„ä»¶çš„ç”Ÿå‘½å‘¨æœŸå˜åŒ– è·å– Lifecycle å»ç›‘å¬ Fragment çš„ç”Ÿå‘½å‘¨æœŸçš„å˜åŒ– å½“ç”Ÿå‘½å‘¨æœŸå¤„äº ON_START æ—¶å¼€å§‹å¤„ç†æ•°æ®ï¼Œé¿å…å½“ Fragment å¤„äºä¸å¯é¢„çŸ¥çŠ¶æ€çš„æ—¶ï¼Œå¯èƒ½å‘ç”ŸæœªçŸ¥çš„é—®é¢˜ å½“ç”Ÿå‘½å‘¨æœŸå¤„äº ON_DESTROY æ—¶ï¼Œç§»é™¤ç›‘å¬ æ¥ä¸‹æ¥ä¸€èµ·æ¥çœ‹ä¸€ä¸‹æ•°æ®å‘é€çš„æ–¹æ³•ï¼Œè°ƒç”¨äº† FragmentManager çš„ setFragmentResult æ–¹æ³•androidx.fragment/fragment/1.3.0-alpha04â€¦â€¦androidx/fragment/app/FragmentManager.java private final ConcurrentHashMap&lt;String, Bundle&gt; mResults = new ConcurrentHashMap&lt;&gt;();private final ConcurrentHashMap&lt;String, LifecycleAwareResultListener&gt; mResultListeners = new ConcurrentHashMap&lt;&gt;(); @Overridepublic final void setFragmentResult(@NonNull String requestKey, @Nullable Bundle result) { if (result == null) { // mResults æ˜¯ ConcurrentHashMap çš„å®ä¾‹ï¼Œç”¨æ¥å­˜å‚¨æ•°æ®ä¼ è¾“çš„ Bundle // å¦‚æœä¼ é€’çš„å‚æ•° result ä¸ºç©ºï¼Œç§»é™¤ requestKey å¯¹åº”çš„ Bundle mResults.remove(requestKey); return; } // mResultListeners æ˜¯ ConcurrentHashMap çš„å®ä¾‹ï¼Œç”¨æ¥å‚¨å­˜æ³¨å†Œçš„ listener // è·å– requestKey å¯¹åº”çš„ listener LifecycleAwareResultListener resultListener = mResultListeners.get(requestKey); if (resultListener != null &amp;&amp; resultListener.isAtLeast(Lifecycle.State.STARTED)) { // å¦‚æœ resultListener ä¸ä¸ºç©ºï¼Œå¹¶ä¸”ç”Ÿå‘½å‘¨æœŸå¤„äº STARTED çŠ¶æ€æ—¶ï¼Œè°ƒç”¨å›è°ƒ resultListener.onFragmentResult(requestKey, result); } else { // å¦åˆ™ä¿å­˜å½“å‰ä¼ è¾“çš„æ•°æ® mResults.put(requestKey, result); }} è·å– requestKey æ³¨å†Œçš„ listener å½“ç”Ÿå‘½å‘¨æœŸå¤„äº STARTED çŠ¶æ€æ—¶ï¼Œå¼€å§‹å‘é€æ•°æ® å¦åˆ™ä¿å­˜å½“å‰ä¼ è¾“çš„æ•°æ® æºç åˆ†æåˆ°è¿™é‡Œç»“æŸäº†ï¼Œæˆ‘ä»¬ä¸€èµ·æ¥æ€è€ƒä¸€ä¸‹ï¼Œåœ¨ä¹‹å‰æˆ‘ä»¬çš„éƒ½æœ‰é‚£äº›æ•°æ®ä¼ æ–¹å¼ æ±‡æ€» Fragment ä¹‹é—´çš„é€šä¿¡çš„æ–¹å¼ é€šè¿‡å…±äº« ViewModel æˆ–è€…å…³è” Activityæ¥å®Œæˆï¼ŒFragment ä¹‹é—´ä¸åº”è¯¥ç›´æ¥é€šä¿¡ å‚è€ƒ Google: ViewModel#sharing é€šè¿‡æ¥å£ï¼Œå¯ä»¥åœ¨ Fragment å®šä¹‰æ¥å£ï¼Œå¹¶åœ¨ Activity å®ç°å®ƒ å‚è€ƒ Google: ä¸å…¶ä»– Fragment é€šä¿¡ é€šè¿‡ä½¿ç”¨ findFragmentById æ–¹æ³•ï¼Œè·å– Fragment çš„å®ä¾‹ï¼Œç„¶åè°ƒç”¨ Fragment çš„å…¬å…±æ–¹æ³• å‚è€ƒ Google: ä¸å…¶ä»– Fragment é€šä¿¡ è°ƒç”¨ Fragment.setTargetFragment() å’Œ Fragment.getTargetFragment() æ–¹æ³•ï¼Œä½†æ˜¯æ³¨æ„ target fragment éœ€è¦ç›´æ¥è®¿é—®å¦ä¸€ä¸ª fragment çš„å®ä¾‹ï¼Œè¿™æ˜¯ååˆ†å±é™©çš„ï¼Œå› ä¸ºä½ ä¸çŸ¥é“ç›®æ ‡ fragment å¤„äºä»€ä¹ˆçŠ¶æ€ Fragment æ–°çš„ API, setFragmentResult() å’Œ setFragmentResultListener() ç»¼åˆä»¥ä¸Šé€šä¿¡æ–¹å¼ï¼Œé‚£ä¹ˆä½ è®¤ä¸º Fragment ä¹‹é—´é€šä¿¡æœ€å¥½çš„æ–¹å¼æ˜¯ä»€ä¹ˆï¼Ÿ å‚è€ƒæ–‡çŒ® Now in Android #17: https://medium.com/androiddeveâ€¦â€¦ Pass data between fragments: https://developer.android.com/training/basiâ€¦â€¦ ViewModel#sharing: https://developer.android.com/topic/librariâ€¦â€¦ ä¸å…¶ä»– Fragment é€šä¿¡: https://developer.android.com/training/basicâ€¦â€¦ æ¨èæ–‡ç«  [è¯‘][Googleå·¥ç¨‹å¸ˆ] åˆšåˆšå‘å¸ƒäº† Fragment çš„æ–°ç‰¹æ€§ â€œFragment é—´ä¼ é€’æ•°æ®çš„æ–°æ–¹å¼â€ ä»¥åŠæºç åˆ†æ [è¯‘][Googleå·¥ç¨‹å¸ˆ] è¯¦è§£ FragmentFactory å¦‚ä½•ä¼˜é›…ä½¿ç”¨ Koin ä»¥åŠéƒ¨åˆ†æºç åˆ†æ [è¯‘][2.4K Start] æ”¾å¼ƒ Dagger æ‹¥æŠ± Koin [è¯‘][5k+] Kotlin çš„æ€§èƒ½ä¼˜åŒ–é‚£äº›äº‹ [è¯‘] è§£å¯† RxJava çš„å¼‚å¸¸å¤„ç†æœºåˆ¶ [è¯‘][1.4K+ Star] Kotlin æ–°ç§€ Coil VS Glide and Picasso æ›´å¤šâ€¦â€¦","link":"/2020/06/10/translate/01-fragment/"},{"title":"0xA07 Android 10 æºç åˆ†æï¼šWindow çš„ç±»å‹ ä»¥åŠ ä¸‰ç»´è§†å›¾å±‚çº§åˆ†æ","text":"å¼•è¨€ è¿™æ˜¯ Android 10 æºç åˆ†æç³»åˆ—çš„ç¬¬ 7 ç¯‡ åˆ†æ”¯ï¼šandroid-10.0.0_r14 å…¨æ–‡é˜…è¯»å¤§æ¦‚ 10 åˆ†é’Ÿ åœ¨ä¹‹å‰çš„æ–‡ç«  0xA06 Android 10 æºç åˆ†æï¼šWindowManager è§†å›¾ç»‘å®šä»¥åŠä½“ç³»ç»“æ„ ä»‹ç»äº† Activityã€Windowã€PhoneWindowã€WindowManager ä¹‹é—´çš„å…³ç³»ï¼Œä»¥åŠ Activity å’Œ Dialog çš„è§†å›¾ç»‘å®šè¿‡ç¨‹ï¼Œè€Œè¿™ç¯‡æ–‡ç« ä¸»è¦ä¸¤ä¸ªç›®çš„ï¼š å¯¹ä¸Šä¸€ç¯‡æ–‡ç«  0xA06 Android 10 æºç åˆ†æï¼šWindowManager è§†å›¾ç»‘å®šä»¥åŠä½“ç³»ç»“æ„ åšæ·±å…¥çš„äº†è§£ ä¸ºåé¢çš„ç¯‡æ–‡ç« ã€Œå¦‚ä½•åœ¨ Andorid ç³»ç»Ÿé‡Œæ·»åŠ è‡ªå®šä¹‰ Viewã€ç­‰ç­‰åšå¥½é“ºå« é€šè¿‡è¿™ç¯‡æ–‡ç« ä½ å°†å­¦ä¹ åˆ°ä»¥ä¸‹å†…å®¹ï¼Œå°†åœ¨æ–‡æœ«æ€»ç»“éƒ¨åˆ†ä¼šç»™å‡ºç›¸åº”çš„ç­”æ¡ˆ Window éƒ½æœ‰é‚£äº›å¸¸ç”¨çš„å‚æ•°? Window éƒ½é‚£äº›ç±»å‹ï¼Ÿæ¯ä¸ªç±»å‹çš„æ„æ€ï¼Ÿä»¥åŠä½œç”¨ï¼Ÿ Window é‚£äº›è¿‡æ—¶çš„ API ä»¥åŠå¤„ç†æ–¹æ¡ˆï¼Ÿ Window è§†å›¾å±‚çº§é¡ºåºæ˜¯å¦‚ä½•ç¡®å®šçš„ï¼Ÿ Window éƒ½é‚£äº› flagï¼Ÿæ¯ä¸ª flag çš„æ„æ€ï¼Ÿä»¥åŠä½œç”¨ï¼Ÿ Window çš„è½¯é”®ç›˜æ¨¡å¼ï¼Ÿæ¯ä¸ªæ¨¡å¼çš„æ„æ€ï¼Ÿä»¥åŠå¦‚ä½•ä½¿ç”¨ï¼Ÿ Kotlin å°æŠ€å·§ï¼Ÿ åœ¨å¼€å§‹åˆ†æä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆæ¥çœ‹ä¸€å¼ å›¾ï¼Œç†Ÿæ‚‰ä¸€ä¸‹å‡ ä¸ªåŸºæœ¬æ¦‚å¿µï¼Œè¿™äº›æ¦‚å¿µä¼´å°†éšç€æ•´ç¯‡æ–‡ç«  æˆ‘ä»¬åœ¨æ‰‹æœºä¸Šçœ‹åˆ°çš„ç•Œé¢æ˜¯äºŒç»´çš„ï¼Œä½†æ˜¯å®é™…ä¸Šæ˜¯ä¸€ä¸ªä¸‰ç»´ï¼Œå¦‚ä¸Šå›¾æ‰€ç¤º Windowï¼šæ˜¯ä¸€ä¸ªæŠ½è±¡ç±»ï¼Œå®ƒä½œä¸ºä¸€ä¸ªé¡¶çº§è§†å›¾æ·»åŠ åˆ° WindowManager ä¸­ï¼ŒView æ˜¯ä¾é™„äº Window è€Œå­˜åœ¨çš„ï¼Œå¯¹ View è¿›è¡Œç®¡ç† WindowManagerï¼šå®ƒæ˜¯ä¸€ä¸ªæ¥å£ï¼Œç»§æ‰¿è‡ªæ¥å£ ViewManagerï¼Œå¯¹ Window è¿›è¡Œç®¡ç† PhoneWindowï¼šWindow å”¯ä¸€å®ç°ç±»ï¼Œæ·»åŠ åˆ° WindowManager çš„æ ¹å®¹å™¨ä¸­ WindowManagerServiceï¼šWindowManager æ˜¯ Window çš„å®¹å™¨ï¼Œç®¡ç†ç€ Windowï¼Œå¯¹ Window è¿›è¡Œæ·»åŠ å’Œåˆ é™¤ï¼Œæœ€ç»ˆå…·ä½“çš„å·¥ä½œéƒ½æ˜¯ç”± WindowManagerService æ¥å¤„ç†çš„ï¼ŒWindowManager å’Œ WindowManagerService é€šè¿‡ Binder æ¥è¿›è¡Œè·¨è¿›ç¨‹é€šä¿¡ï¼ŒWindowManagerService æ‰æ˜¯ Window çš„æœ€ç»ˆç®¡ç†è€… è¿™ç¯‡æ–‡ç« é‡è¦çŸ¥è¯†ç‚¹æ˜¯ Window è§†å›¾å±‚çº§é¡ºåºæ˜¯å¦‚ä½•ç¡®å®šçš„ï¼Œå…¶ä»–å†…å®¹éƒ½æ˜¯ä¸€äº›æ¦‚å¿µçš„ä¸œè¥¿ï¼Œå¯ä»¥é€‰æ‹©æ€§çš„é˜…è¯»ï¼Œäº†è§£å®ŒåŸºæœ¬æ¦‚å¿µä¹‹åï¼Œè¿›å…¥è¿™ç¯‡æ–‡ç« çš„æ ¸å¿ƒå†…å®¹ï¼Œæˆ‘ä»¬å…ˆæ¥äº†è§£ä¸€ä¸‹ Window éƒ½æœ‰é‚£äº›å¸¸ç”¨çš„å‚æ•° Window éƒ½æœ‰é‚£äº›å¸¸ç”¨çš„å‚æ•°Window çš„å‚æ•°éƒ½è¢«å®šä¹‰åœ¨ WindowManager çš„é™æ€å†…éƒ¨ç±» LayoutParams ä¸­frameworks/base/core/java/android/view/WindowManager#LayoutParams.java public static class LayoutParams extends ViewGroup.LayoutParams implements Parcelable { // window å·¦ä¸Šè§’çš„ x åæ ‡ public int x; // window å·¦ä¸Šè§’çš„ y åæ ‡ public int y; // Window çš„ç±»å‹ public int type; // Window çš„ flag ç”¨äºæ§åˆ¶ Window çš„æ˜¾ç¤º public int flags; // window è½¯é”®ç›˜è¾“å…¥åŒºåŸŸçš„æ˜¾ç¤ºæ¨¡å¼ public int softInputMode; // window çš„é€æ˜åº¦ï¼Œå–å€¼ä¸º0-1 public float alpha = 1.0f; // window åœ¨å±å¹•ä¸­çš„ä½ç½® public int gravity; // window çš„åƒç´ ç‚¹æ ¼å¼ï¼Œå€¼å®šä¹‰åœ¨ PixelFormat ä¸­ public int format;} æ¥ä¸‹æ¥æˆ‘ä»¬æˆ‘ä»¬ä¸»è¦æ¥ä»‹ç»ä¸€ä¸‹ Window çš„ç±»å‹ã€Window è§†å›¾å±‚çº§é¡ºåºã€Window çš„ flagã€å’Œ window è½¯é”®ç›˜æ¨¡å¼ Window éƒ½é‚£äº›ç±»å‹ä»¥åŠä½œç”¨Window çš„ç±»å‹å¤§æ¦‚å¯ä»¥åˆ†ä¸ºä¸‰ç±»ï¼š åº”ç”¨ç¨‹åº Windowï¼ˆApplication Windowï¼‰ã€å­ Windowï¼ˆSub Windwowï¼‰ã€ç³»ç»Ÿ Windowï¼ˆSystem Windowï¼‰ï¼Œ Window çš„ç±»å‹é€šè¿‡ type å€¼æ¥è¡¨ç¤ºï¼Œæ¯ä¸ªå¤§ç±»å‹åˆåŒ…å«å¤šä¸ªå°ç±»å‹ï¼Œå®ƒä»¬éƒ½å®šä¹‰åœ¨ WindowManager çš„é™æ€å†…éƒ¨ç±» LayoutParamsframeworks/base/core/java/android/view/WindowManager#LayoutParams.java public static class LayoutParams extends ViewGroup.LayoutParams implements Parcelable { public int type; // åº”ç”¨ç¨‹åº Window çš„å¼€å§‹å€¼ public static final int FIRST_APPLICATION_WINDOW = 1; // åº”ç”¨ç¨‹åº Window çš„ç»“æŸå€¼ public static final int LAST_APPLICATION_WINDOW = 99; // å­ Window ç±»å‹çš„å¼€å§‹å€¼ public static final int FIRST_SUB_WINDOW = 1000; // å­ Window ç±»å‹çš„ç»“æŸå€¼ public static final int LAST_SUB_WINDOW = 1999; // ç³»ç»Ÿ Window ç±»å‹çš„å¼€å§‹å€¼ public static final int FIRST_SYSTEM_WINDOW = 2000; // ç³»ç»Ÿ Window ç±»å‹çš„ç»“æŸå€¼ public static final int LAST_SYSTEM_WINDOW = 2999;} ç±»å‹ å€¼ å¤‡æ³¨ FIRST_APPLICATION_WINDOW 1 åº”ç”¨ç¨‹åº Window çš„å¼€å§‹å€¼ LAST_APPLICATION_WINDOW 99 åº”ç”¨ç¨‹åº Window çš„ç»“æŸå€¼ FIRST_SUB_WINDOW 1000 å­ Window çš„å¼€å§‹å€¼ LAST_SUB_WINDOW 1999 å­ Window çš„ç»“æŸå€¼ FIRST_SYSTEM_WINDOW 2000 ç³»ç»Ÿ Window çš„å¼€å§‹å€¼ LAST_SYSTEM_WINDOW 2999 ç³»ç»Ÿ Window çš„ç»“æŸå€¼ å°æŠ€å·§ï¼šå¦‚æœæ˜¯å±‚çº§åœ¨ 2000ï¼ˆFIRST_SYSTEM_WINDOWï¼‰ä»¥ä¸‹çš„æ˜¯ä¸éœ€è¦ç”³è¯·å¼¹çª—æƒé™çš„ åº”ç”¨ç¨‹åº Windowï¼ˆApplication Windowï¼‰ï¼šå®ƒçš„åŒºé—´èŒƒå›´ [1,99]ï¼Œä¾‹å¦‚ Activity frameworks/base/core/java/android/view/WindowManager#LayoutParams.java* // åº”ç”¨ç¨‹åº Window çš„å¼€å§‹å€¼public static final int FIRST_APPLICATION_WINDOW = 1;// åº”ç”¨ç¨‹åº Window çš„åŸºç¡€å€¼public static final int TYPE_BASE_APPLICATION = 1;// æ™®é€šçš„åº”ç”¨ç¨‹åºpublic static final int TYPE_APPLICATION = 2;// ç‰¹æ®Šçš„åº”ç”¨ç¨‹åºçª—å£ï¼Œå½“ç¨‹åºå¯ä»¥æ˜¾ç¤º Window ä¹‹å‰ä½¿ç”¨è¿™ä¸ª Window æ¥æ˜¾ç¤ºä¸€äº›ä¸œè¥¿public static final int TYPE_APPLICATION_STARTING = 3;// TYPE_APPLICATION çš„å˜ä½“ï¼Œåœ¨åº”ç”¨ç¨‹åºæ˜¾ç¤ºä¹‹å‰ï¼ŒWindowManager ä¼šç­‰å¾…è¿™ä¸ª Window ç»˜åˆ¶å®Œæ¯•public static final int TYPE_DRAWN_APPLICATION = 4;// åº”ç”¨ç¨‹åº Window çš„ç»“æŸå€¼public static final int LAST_APPLICATION_WINDOW = 99; ç±»å‹ å¤‡æ³¨ FIRST_APPLICATION_WINDOW åº”ç”¨ç¨‹åº Window çš„å¼€å§‹å€¼ TYPE_BASE_APPLICATION åº”ç”¨ç¨‹åº Window çš„åŸºç¡€å€¼ TYPE_APPLICATION æ™®é€šçš„åº”ç”¨ç¨‹åº TYPE_APPLICATION_STARTING ç‰¹æ®Šçš„åº”ç”¨ç¨‹åºçª—å£ï¼Œå½“ç¨‹åºå¯ä»¥æ˜¾ç¤º Window ä¹‹å‰ä½¿ç”¨è¿™ä¸ª Window æ¥æ˜¾ç¤ºä¸€äº›ä¸œè¥¿ TYPE_DRAWN_APPLICATION TYPE_APPLICATION çš„å˜ä½“ åœ¨åº”ç”¨ç¨‹åºæ˜¾ç¤ºä¹‹å‰ï¼ŒWindowManager ä¼šç­‰å¾…è¿™ä¸ª Window ç»˜åˆ¶å®Œæ¯• LAST_APPLICATION_WINDOW åº”ç”¨ç¨‹åº Window çš„ç»“æŸå€¼ å­ Windowï¼ˆSub Windwowï¼‰ï¼šå®ƒçš„åŒºé—´èŒƒå›´ [1000,1999]ï¼Œè¿™äº› Window æŒ‰ç…§ Z-order é¡ºåºä¾é™„äºçˆ¶ Window ä¸Šï¼ˆå…³äº Z-order åæ–‡æœ‰ä»‹ç»ï¼‰ï¼Œå¹¶ä¸”ä»–ä»¬çš„åæ ‡ç©ºé—´ç›¸å¯¹äºçˆ¶ Window çš„ï¼Œä¾‹å¦‚ï¼šPopupWindow frameworks/base/core/java/android/view/WindowManager#LayoutParams.java* // å­ Window ç±»å‹çš„å¼€å§‹å€¼public static final int FIRST_SUB_WINDOW = 1000;// åº”ç”¨ç¨‹åº Window é¡¶éƒ¨çš„é¢æ¿ã€‚è¿™äº› Window å‡ºç°åœ¨å…¶é™„åŠ  Window çš„é¡¶éƒ¨ã€‚public static final int TYPE_APPLICATION_PANEL = FIRST_SUB_WINDOW;// ç”¨äºæ˜¾ç¤ºåª’ä½“(å¦‚è§†é¢‘)çš„ Windowã€‚è¿™äº› Window å‡ºç°åœ¨å…¶é™„åŠ  Window çš„åé¢ã€‚public static final int TYPE_APPLICATION_MEDIA = FIRST_SUB_WINDOW + 1;// åº”ç”¨ç¨‹åº Window é¡¶éƒ¨çš„å­é¢æ¿ã€‚è¿™äº› Window å‡ºç°åœ¨å…¶é™„åŠ  Window å’Œä»»ä½•Windowçš„é¡¶éƒ¨public static final int TYPE_APPLICATION_SUB_PANEL = FIRST_SUB_WINDOW + 2;// å½“å‰Windowçš„å¸ƒå±€å’Œé¡¶çº§Windowå¸ƒå±€ç›¸åŒæ—¶ï¼Œä¸èƒ½ä½œä¸ºå­ä»£çš„å®¹å™¨public static final int TYPE_APPLICATION_ATTACHED_DIALOG = FIRST_SUB_WINDOW + 3;// ç”¨æ˜¾ç¤ºåª’ä½“ Window è¦†ç›–é¡¶éƒ¨çš„ Windowï¼Œ è¿™æ˜¯ç³»ç»Ÿéšè—çš„ APIpublic static final int TYPE_APPLICATION_MEDIA_OVERLAY = FIRST_SUB_WINDOW + 4;// å­é¢æ¿åœ¨åº”ç”¨ç¨‹åºWindowçš„é¡¶éƒ¨ï¼Œè¿™äº›Windowæ˜¾ç¤ºåœ¨å…¶é™„åŠ Windowçš„é¡¶éƒ¨ï¼Œ è¿™æ˜¯ç³»ç»Ÿéšè—çš„ APIpublic static final int TYPE_APPLICATION_ABOVE_SUB_PANEL = FIRST_SUB_WINDOW + 5;// å­ Window ç±»å‹çš„ç»“æŸå€¼public static final int LAST_SUB_WINDOW = 1999; ç±»å‹ å¤‡æ³¨ FIRST_SUB_WINDOW å­ Window çš„å¼€å§‹å€¼ TYPE_APPLICATION_PANEL åº”ç”¨ç¨‹åº Window é¡¶éƒ¨çš„é¢æ¿ï¼Œè¿™äº› Window å‡ºç°åœ¨å…¶é™„åŠ  Window çš„é¡¶éƒ¨ TYPE_APPLICATION_MEDIA ç”¨äºæ˜¾ç¤ºåª’ä½“(å¦‚è§†é¢‘)çš„ Windowï¼Œè¿™äº› Window å‡ºç°åœ¨å…¶é™„åŠ  Window çš„åé¢ TYPE_APPLICATION_SUB_PANEL åº”ç”¨ç¨‹åº Window é¡¶éƒ¨çš„å­é¢æ¿ï¼Œè¿™äº› Window å‡ºç°åœ¨å…¶é™„åŠ  Window å’Œä»»ä½•Windowçš„é¡¶éƒ¨ TYPE_APPLICATION_ATTACHED_DIALOG å½“å‰Windowçš„å¸ƒå±€å’Œé¡¶çº§Windowå¸ƒå±€ç›¸åŒæ—¶ï¼Œä¸èƒ½ä½œä¸ºå­ä»£çš„å®¹å™¨ TYPE_APPLICATION_MEDIA_OVERLAY ç”¨æ˜¾ç¤ºåª’ä½“ Window è¦†ç›–é¡¶éƒ¨çš„ Windowï¼Œ è¿™æ˜¯ç³»ç»Ÿéšè—çš„ API TYPE_APPLICATION_ABOVE_SUB_PANEL å­é¢æ¿åœ¨åº”ç”¨ç¨‹åºWindowçš„é¡¶éƒ¨ï¼Œè¿™äº›Windowæ˜¾ç¤ºåœ¨å…¶é™„åŠ Windowçš„é¡¶éƒ¨ï¼Œ è¿™æ˜¯ç³»ç»Ÿéšè—çš„ API LAST_SUB_WINDOW å­ Window çš„ç»“æŸå€¼ ç³»ç»Ÿ Windowï¼ˆSystem Windowï¼‰: å®ƒåŒºé—´èŒƒå›´ [2000,2999]ï¼Œä¾‹å¦‚ï¼šToastï¼Œè¾“å…¥æ³•çª—å£ï¼Œç³»ç»ŸéŸ³é‡æ¡çª—å£ï¼Œç³»ç»Ÿé”™è¯¯çª—å£ frameworks/base/core/java/android/view/WindowManager#LayoutParams.java* // ç³»ç»ŸWindowç±»å‹çš„å¼€å§‹å€¼public static final int FIRST_SYSTEM_WINDOW = 2000;// ç³»ç»ŸçŠ¶æ€æ ï¼Œåªèƒ½æœ‰ä¸€ä¸ªçŠ¶æ€æ ï¼Œå®ƒè¢«æ”¾ç½®åœ¨å±å¹•çš„é¡¶éƒ¨ï¼Œæ‰€æœ‰å…¶ä»–çª—å£éƒ½å‘ä¸‹ç§»åŠ¨public static final int TYPE_STATUS_BAR = FIRST_SYSTEM_WINDOW;// ç³»ç»Ÿæœç´¢çª—å£ï¼Œåªèƒ½æœ‰ä¸€ä¸ªæœç´¢æ ï¼Œå®ƒè¢«æ”¾ç½®åœ¨å±å¹•çš„é¡¶éƒ¨public static final int TYPE_SEARCH_BAR = FIRST_SYSTEM_WINDOW+1;@Deprecated// API å·²ç»è¿‡æ—¶ï¼Œç”¨ TYPE_APPLICATION_OVERLAY ä»£æ›¿public static final int TYPE_PHONE = FIRST_SYSTEM_WINDOW+2;@Deprecated// API å·²ç»è¿‡æ—¶ï¼Œç”¨ TYPE_APPLICATION_OVERLAY ä»£æ›¿public static final int TYPE_SYSTEM_ALERT = FIRST_SYSTEM_WINDOW+3;// å·²ç»ä»ç³»ç»Ÿä¸­è¢«ç§»é™¤ï¼Œå¯ä»¥ä½¿ç”¨ TYPE_KEYGUARD_DIALOG ä»£æ›¿public static final int TYPE_KEYGUARD = FIRST_SYSTEM_WINDOW+4;@Deprecated// API å·²ç»è¿‡æ—¶ï¼Œç”¨ TYPE_APPLICATION_OVERLAY ä»£æ›¿public static final int TYPE_TOAST = FIRST_SYSTEM_WINDOW+5;@Deprecated// API å·²ç»è¿‡æ—¶ï¼Œç”¨ TYPE_APPLICATION_OVERLAY ä»£æ›¿public static final int TYPE_SYSTEM_OVERLAY = FIRST_SYSTEM_WINDOW+6;@Deprecated// API å·²ç»è¿‡æ—¶ï¼Œç”¨ TYPE_APPLICATION_OVERLAY ä»£æ›¿public static final int TYPE_PRIORITY_PHONE = FIRST_SYSTEM_WINDOW+7;// ç³»ç»Ÿå¯¹è¯æ¡†çª—å£public static final int TYPE_SYSTEM_DIALOG = FIRST_SYSTEM_WINDOW+8;// é”å±æ—¶æ˜¾ç¤ºçš„å¯¹è¯æ¡†public static final int TYPE_KEYGUARD_DIALOG = FIRST_SYSTEM_WINDOW+9;@Deprecated// API å·²ç»è¿‡æ—¶ï¼Œç”¨ TYPE_APPLICATION_OVERLAY ä»£æ›¿public static final int TYPE_SYSTEM_ERROR = FIRST_SYSTEM_WINDOW+10;// è¾“å…¥æ³•çª—å£ï¼Œä½äºæ™®é€š UI ä¹‹ä¸Šï¼Œåº”ç”¨ç¨‹åºå¯é‡æ–°å¸ƒå±€ä»¥å…è¢«æ­¤çª—å£è¦†ç›–public static final int TYPE_INPUT_METHOD = FIRST_SYSTEM_WINDOW+11;// è¾“å…¥æ³•å¯¹è¯æ¡†ï¼Œæ˜¾ç¤ºäºå½“å‰è¾“å…¥æ³•çª—å£ä¹‹ä¸Špublic static final int TYPE_INPUT_METHOD_DIALOG= FIRST_SYSTEM_WINDOW+12;// å¢™çº¸public static final int TYPE_WALLPAPER = FIRST_SYSTEM_WINDOW+13;// çŠ¶æ€æ çš„æ»‘åŠ¨é¢æ¿public static final int TYPE_STATUS_BAR_PANEL = FIRST_SYSTEM_WINDOW+14;// åº”ç”¨ç¨‹åºå åŠ çª—å£æ˜¾ç¤ºåœ¨æ‰€æœ‰çª—å£ä¹‹ä¸Špublic static final int TYPE_APPLICATION_OVERLAY = FIRST_SYSTEM_WINDOW + 38;// ç³»ç»ŸWindowç±»å‹çš„ç»“æŸå€¼public static final int LAST_SYSTEM_WINDOW = 2999; ç±»å‹ å¤‡æ³¨ FIRST_SYSTEM_WINDOW ç³»ç»Ÿ Window ç±»å‹çš„å¼€å§‹å€¼ TYPE_STATUS_BAR ç³»ç»ŸçŠ¶æ€æ ï¼Œåªèƒ½æœ‰ä¸€ä¸ªçŠ¶æ€æ ï¼Œå®ƒè¢«æ”¾ç½®åœ¨å±å¹•çš„é¡¶éƒ¨ï¼Œæ‰€æœ‰å…¶ä»–çª—å£éƒ½å‘ä¸‹ç§»åŠ¨ TYPE_SEARCH_BAR ç³»ç»Ÿæœç´¢çª—å£ï¼Œåªèƒ½æœ‰ä¸€ä¸ªæœç´¢æ ï¼Œå®ƒè¢«æ”¾ç½®åœ¨å±å¹•çš„é¡¶éƒ¨ TYPE_PHONE API å·²ç»è¿‡æ—¶ï¼Œç”¨ TYPE_APPLICATION_OVERLAY ä»£æ›¿ TYPE_SYSTEM_ALERT API å·²ç»è¿‡æ—¶ï¼Œç”¨ TYPE_APPLICATION_OVERLAY ä»£æ›¿ TYPE_KEYGUARD å·²ç»ä»ç³»ç»Ÿä¸­è¢«ç§»é™¤ï¼Œå¯ä»¥ä½¿ç”¨ TYPE_KEYGUARD_DIALOG ä»£æ›¿ TYPE_TOAST API å·²ç»è¿‡æ—¶ï¼Œç”¨ TYPE_APPLICATION_OVERLAY ä»£æ›¿ TYPE_SYSTEM_OVERLAY API å·²ç»è¿‡æ—¶ï¼Œç”¨ TYPE_APPLICATION_OVERLAY ä»£æ›¿ TYPE_PRIORITY_PHONE API å·²ç»è¿‡æ—¶ï¼Œç”¨ TYPE_APPLICATION_OVERLAY ä»£æ›¿ TYPE_SYSTEM_ERROR API å·²ç»è¿‡æ—¶ï¼Œç”¨ TYPE_APPLICATION_OVERLAY ä»£æ›¿ TYPE_APPLICATION_OVERLAY åº”ç”¨ç¨‹åºå åŠ çª—å£æ˜¾ç¤ºåœ¨æ‰€æœ‰çª—å£ä¹‹ä¸Š TYPE_SYSTEM_DIALOG ç³»ç»Ÿå¯¹è¯æ¡†çª—å£ TYPE_KEYGUARD_DIALOG é”å±æ—¶æ˜¾ç¤ºçš„å¯¹è¯æ¡† TYPE_INPUT_METHOD è¾“å…¥æ³•çª—å£ï¼Œä½äºæ™®é€š UI ä¹‹ä¸Šï¼Œåº”ç”¨ç¨‹åºå¯é‡æ–°å¸ƒå±€ä»¥å…è¢«æ­¤çª—å£è¦†ç›– TYPE_INPUT_METHOD_DIALOG è¾“å…¥æ³•å¯¹è¯æ¡†ï¼Œæ˜¾ç¤ºäºå½“å‰è¾“å…¥æ³•çª—å£ä¹‹ä¸Š TYPE_WALLPAPER å¢™çº¸ TYPE_STATUS_BAR_PANEL çŠ¶æ€æ çš„æ»‘åŠ¨é¢æ¿ LAST_SYSTEM_WINDOW ç³»ç»Ÿ Window ç±»å‹çš„ç»“æŸå€¼ éœ€è¦æ³¨æ„çš„æ˜¯ï¼š TYPE_PHONEã€TYPE_SYSTEM_ALERTã€TYPE_TOASTã€TYPE_SYSTEM_OVERLAYã€TYPE_PRIORITY_PHONEã€TYPE_SYSTEM_ERROR è¿™äº› type åœ¨ API 26 ä¸­å‡å·²ç»è¿‡æ—¶ï¼Œä½¿ç”¨ TYPE_APPLICATION_OVERLAY ä»£æ›¿ï¼Œéœ€è¦ç”³è¯· Manifest.permission.SYSTEM_ALERT_WINDOW æƒé™ TYPE_KEYGUARD å·²ç»è¢«ä»ç³»ç»Ÿä¸­ç§»é™¤ï¼Œå¯ä»¥ä½¿ç”¨ TYPE_KEYGUARD_DIALOG æ¥ä»£æ›¿ Window è§†å›¾å±‚çº§é¡ºåºæˆ‘ä»¬åœ¨æ‰‹æœºä¸Šçœ‹çš„æ˜¯äºŒç»´çš„ï¼Œä½†æ˜¯å®é™…ä¸Šæ˜¯ä¸‰ç»´çš„æ˜¾ç¤ºï¼Œå¦‚ä¸‹å›¾æ‰€ç¤º åœ¨æ–‡ç« å¼€å¤´ä»‹ç»äº†å‚æ•°ç±»å‹åŒ…å«äº† Window çš„ x è½´åæ ‡ã€Window çš„ y è½´åæ ‡ï¼Œ æ—¢ç„¶æ˜¯ä¸€ä¸ªä¸‰ç»´åæ ‡ç³»ï¼Œé‚£ä¹ˆ z è½´åæ ‡åœ¨å“ªé‡Œï¼Ÿ æ¥ä¸‹æ¥å°±æ˜¯æˆ‘ä»¬è¦åˆ†æçš„éå¸¸é‡è¦çš„ä¸€ä¸ªç±» WindowManagerServiceï¼Œå½“æ·»åŠ  Window çš„æ—¶å€™å·²ç»ç¡®å®šå¥½äº† Window çš„å±‚çº§ï¼Œæ˜¾ç¤ºçš„æ—¶å€™æ‰ä¼šæ ¹æ®å½“å‰çš„å±‚çº§ç¡®å®š Window åº”è¯¥åœ¨å“ªä¸€å±‚æ˜¾ç¤º WindowManager æ˜¯ Window çš„å®¹å™¨ï¼Œç®¡ç†ç€ Windowï¼Œå¯¹ Window è¿›è¡Œæ·»åŠ å’Œåˆ é™¤ï¼Œå…·ä½“çš„å·¥ä½œéƒ½æ˜¯ç”± WMS æ¥å¤„ç†çš„ï¼ŒWindowManager å’Œ WMS é€šè¿‡ Binder æ¥è¿›è¡Œè·¨è¿›ç¨‹é€šä¿¡ï¼ŒWMS æ‰æ˜¯ Window çš„æœ€ç»ˆç®¡ç†è€…ï¼Œæˆ‘å…ˆæ¥çœ‹ä¸€ä¸‹ WMS çš„ addWindow æ–¹æ³•frameworks/base/services/core/java/com/android/server/wm/WindowManagerService.java public int addWindow(Session session, IWindow client, int seq, LayoutParams attrs, int viewVisibility, int displayId, Rect outFrame, Rect outContentInsets, Rect outStableInsets, Rect outOutsets, DisplayCutout.ParcelableWrapper outDisplayCutout, InputChannel outInputChannel, InsetsState outInsetsState) { final WindowState win = new WindowState(this, session, client, token, parentWindow, appOp[0], seq, attrs, viewVisibility, session.mUid, session.mCanAddInternalSystemWindow); ...... win.mToken.addWindow(win); ...... win.getParent().assignChildLayers(); ...... } WindowState è®¡ç®—å½“å‰ Window å±‚çº§ win.mToken.addWindow è¿™ä¸ªæ–¹æ³•å°†å½“å‰çš„ win æ”¾å…¥ WindowList ä¸­ï¼ŒWindowList æ˜¯ä¸€ä¸ª ArrayList displayContent.assignWindowLayers æ–¹æ³• è®¡ç®— z-order å€¼, z-order å€¼è¶Šå¤§è¶Šé å‰ï¼Œå°±è¶Šé è¿‘ç”¨æˆ· Window è§†å›¾å±‚çº§é¡ºåº ç”¨ Z-order æ¥è¡¨ç¤ºï¼ŒZ-order å¯¹åº”ç€ WindowManager.LayoutParams çš„ type å€¼ï¼ŒZ-order å¯ä»¥ç†è§£ä¸º Android è§†å›¾çš„å±‚çº§æ¦‚å¿µï¼Œå€¼è¶Šå¤§è¶Šé å‰ï¼Œå°±è¶Šé è¿‘ç”¨æˆ·ã€‚ WindowState å°±æ˜¯ windowManager ä¸­çš„çª—å£ï¼Œä¸€ä¸ª WindowState è¡¨ç¤ºä¸€ä¸ª window é‚£ä¹ˆ Z-order çš„å€¼çš„è®¡ç®—é€»è¾‘åœ¨ WindowState ç±»ä¸­ï¼ŒWindowState æ„é€ çš„æ—¶å€™åˆå§‹åŒ–å½“å‰çš„ mBaseLayer å’Œ mSubLayerï¼Œè¿™ä¸¤ä¸ªå‚æ•°åº”è¯¥æ˜¯å†³å®š z-order çš„ä¸¤ä¸ªå› ç´ frameworks/base/services/core/java/com/android/server/wm/WindowState.java static final int TYPE_LAYER_MULTIPLIER = 10000;static final int TYPE_LAYER_OFFSET = 1000; WindowState(WindowManagerService service, Session s, IWindow c, WindowToken token, WindowState parentWindow, int appOp, int seq, WindowManager.LayoutParams a, int viewVisibility, int ownerId, boolean ownerCanAddInternalSystemWindow, PowerManagerWrapper powerManagerWrapper) { // åˆ¤æ–­è¯¥æ˜¯å¦åœ¨å­ Window çš„ç±»å‹èŒƒå›´å†…[1000,1999] if (mAttrs.type &gt;= FIRST_SUB_WINDOW &amp;&amp; mAttrs.type &lt;= LAST_SUB_WINDOW) { // è°ƒç”¨ getWindowLayerLw æ–¹æ³•è¿”å›å€¼åœ¨[1,33]ä¹‹é—´ï¼Œæ ¹æ®ä¸åŒç±»å‹çš„ Window åœ¨å±å¹•ä¸Šè¿›è¡Œæ’åº mBaseLayer = mPolicy.getWindowLayerLw(parentWindow) * TYPE_LAYER_MULTIPLIER + TYPE_LAYER_OFFSET; // mSubLayer å­çª—å£çš„é¡ºåº // è°ƒç”¨ getSubWindowLayerFromTypeLw æ–¹æ³•è¿”å›å€¼åœ¨[-2.3]ä¹‹é—´ ï¼Œè¿”å›å­ Window ç›¸å¯¹äºçˆ¶ Window çš„ä½ç½® mSubLayer = mPolicy.getSubWindowLayerFromTypeLw(a.type); ...... } else { mBaseLayer = mPolicy.getWindowLayerLw(this) * TYPE_LAYER_MULTIPLIER + TYPE_LAYER_OFFSET; mSubLayer = 0; ...... } } mBaseLayer æ˜¯åŸºç¡€åºï¼Œå¯¹åº”çš„åŒºé—´èŒƒå›´ [1,33] mSubLayer ç›¸åŒåˆ†ç»„ä¸‹çš„å­ Window çš„åºï¼Œå¯¹åº”çš„åŒºé—´èŒƒå›´ [-2.3] åˆ¤æ–­è¯¥æ˜¯å¦åœ¨å­ Window çš„ç±»å‹èŒƒå›´å†…[1000,1999] å¦‚æœæ˜¯å­ Windowï¼Œè°ƒç”¨ getWindowLayerLw æ–¹æ³•ï¼Œè®¡ç®— mBaseLayer çš„å€¼ï¼Œè¿”å›ä¸€ä¸ªç”¨æ¥å¯¹ Window è¿›è¡Œæ’åºçš„ä»»æ„æ•´æ•°ï¼Œè°ƒç”¨ getSubWindowLayerFromTypeLw æ–¹æ³•ï¼Œè®¡ç®— mSubLayer çš„å€¼ï¼Œè¿”å›å­ Window ç›¸å¯¹äºçˆ¶ Window çš„ä½ç½® å¦‚æœä¸æ˜¯å­ Windowï¼Œè°ƒç”¨ getWindowLayerLw æ–¹æ³•ï¼Œè®¡ç®— mBaseLayer çš„å€¼ï¼Œè¿”å›ä¸€ä¸ªç”¨æ¥å¯¹ Window è¿›è¡Œæ’åºçš„ä»»æ„æ•´æ•°ï¼ŒmSubLayer å€¼ä¸º 0 è®¡ç®— mBaseLayer çš„å€¼è°ƒç”¨ WindowManagerPolicy çš„ getWindowLayerLw æ–¹æ³•ï¼Œè®¡ç®— mBaseLayer çš„å€¼frameworks/base/services/core/java/com/android/server/policy/WindowManagerPolicy.java int APPLICATION_LAYER = 2;int APPLICATION_MEDIA_SUBLAYER = -2;int APPLICATION_MEDIA_OVERLAY_SUBLAYER = -1;int APPLICATION_PANEL_SUBLAYER = 1;int APPLICATION_SUB_PANEL_SUBLAYER = 2;int APPLICATION_ABOVE_SUB_PANEL_SUBLAYER = 3; /*** æ ¹æ®ä¸åŒç±»å‹çš„ Window åœ¨å±å¹•ä¸Šè¿›è¡Œæ’åº* è¿”å›ä¸€ä¸ªç”¨æ¥å¯¹çª—å£è¿›è¡Œæ’åºçš„ä»»æ„æ•´æ•°ï¼Œæ•°å­—è¶Šå°ï¼Œè¡¨ç¤ºçš„å€¼è¶Šå°*/ default int getWindowLayerFromTypeLw(int type, boolean canAddInternalSystemWindow) { // åˆ¤æ–­æ˜¯å¦åœ¨åº”ç”¨ç¨‹åº Window ç±»å‹çš„å–å€¼èŒƒå›´å†… [1,99] if (type &gt;= FIRST_APPLICATION_WINDOW &amp;&amp; type &lt;= LAST_APPLICATION_WINDOW) { return APPLICATION_LAYER; } switch (type) { case TYPE_WALLPAPER: // å£çº¸ï¼Œé€šè¿‡ window manager åˆ é™¤å®ƒ return 1; case TYPE_PHONE: // ç”µè¯ return 3; case TYPE_SEARCH_BAR: // æœç´¢æ  return 6; case TYPE_SYSTEM_DIALOG: // ç³»ç»Ÿçš„ dialog return 7; case TYPE_TOAST: // ç³»ç»Ÿ toast return 8; case TYPE_INPUT_METHOD: // è¾“å…¥æ³• return 15; case TYPE_STATUS_BAR: // çŠ¶æ€æ  return 17; case TYPE_KEYGUARD_DIALOG: //é”å± return 20; ...... case TYPE_POINTER: // the (mouse) pointer layer return 33; default: return APPLICATION_LAYER; }} æ ¹æ®ä¸åŒç±»å‹çš„ Window åœ¨å±å¹•ä¸Šè¿›è¡Œæ’åºï¼Œè¿”å›ä¸€ä¸ªç”¨æ¥å¯¹ Window è¿›è¡Œæ’åºçš„ä»»æ„æ•´æ•°ï¼Œæ•°å­—è¶Šå°ï¼Œè¡¨ç¤ºçš„å€¼è¶Šå°ï¼Œé€šè¿‡ä»¥ä¸‹å…¬å¼æ¥è®¡ç®—å®ƒçš„åŸºç¡€åº ï¼ŒåŸºç¡€åºè¶Šå¤§ï¼ŒZ-order å€¼è¶Šå¤§è¶Šé å‰ï¼Œå°±è¶Šé è¿‘ç”¨æˆ·ï¼Œæˆ‘ä»¬ä»¥ Activity ä¸ºä¾‹ï¼š Activity å±äºåº”ç”¨å±‚ Windowï¼Œå®ƒçš„å–å€¼èŒƒå›´åœ¨ [1,99] å†…ï¼Œè°ƒç”¨ getWindowLayerLw æ–¹æ³•è¿”å› APPLICATION_LAYERï¼ŒAPPLICATION_LAYER å€¼ä¸º 2ï¼Œé€šè¿‡ä¸‹é¢æ–¹æ³•è¿›è¡Œè®¡ç®— static final int TYPE_LAYER_MULTIPLIER = 10000;static final int TYPE_LAYER_OFFSET = 1000;mBaseLayer = mPolicy.getWindowLayerLw(parentWindow) * TYPE_LAYER_MULTIPLIER + TYPE_LAYER_OFFSET; é‚£ä¹ˆæœ€ç»ˆ Activity çš„ mBaseLayer å€¼æ˜¯ 21000 è®¡ç®— mSubLayer çš„å€¼è°ƒç”¨ getSubWindowLayerFromTypeLw æ–¹æ³• ï¼Œä¼ å…¥ WindowManager.LayoutParams çš„å®ä¾‹ a çš„ type å€¼ï¼Œè®¡ç®— mSubLayer çš„å€¼frameworks/base/services/core/java/com/android/server/policy/WindowManagerPolicy.java int APPLICATION_LAYER = 2;int APPLICATION_MEDIA_SUBLAYER = -2;int APPLICATION_MEDIA_OVERLAY_SUBLAYER = -1;int APPLICATION_PANEL_SUBLAYER = 1;int APPLICATION_SUB_PANEL_SUBLAYER = 2;int APPLICATION_ABOVE_SUB_PANEL_SUBLAYER = 3;/*** è®¡ç®— Window ç›¸å¯¹äºçˆ¶ Window çš„ä½ç½®* è¿”å› ä¸€ä¸ªæ•´æ•°ï¼Œæ­£å€¼åœ¨å‰é¢ï¼Œè¡¨ç¤ºåœ¨çˆ¶ Window ä¸Šé¢ï¼Œè´Ÿå€¼åœ¨åé¢ï¼Œè¡¨ç¤ºåœ¨çˆ¶ Window çš„ä¸‹é¢*/default int getSubWindowLayerFromTypeLw(int type) { switch (type) { case TYPE_APPLICATION_PANEL: // 1000 case TYPE_APPLICATION_ATTACHED_DIALOG: // 1003 return APPLICATION_PANEL_SUBLAYER; // return 1 case TYPE_APPLICATION_MEDIA:// 1001 return APPLICATION_MEDIA_SUBLAYER;// return -2 case TYPE_APPLICATION_MEDIA_OVERLAY: return APPLICATION_MEDIA_OVERLAY_SUBLAYER; // return -1 case TYPE_APPLICATION_SUB_PANEL:// 1002 return APPLICATION_SUB_PANEL_SUBLAYER;// return 2 case TYPE_APPLICATION_ABOVE_SUB_PANEL: return APPLICATION_ABOVE_SUB_PANEL_SUBLAYER;// return 3 } return 0;} è®¡ç®—å­ Window ç›¸å¯¹äºçˆ¶ Window çš„ä½ç½®ï¼Œè¿”å›ä¸€ä¸ªæ•´æ•°ï¼Œæ­£å€¼è¡¨ç¤ºåœ¨çˆ¶ Window ä¸Šé¢ï¼Œè´Ÿå€¼è¡¨ç¤ºåœ¨çˆ¶ Window çš„ä¸‹é¢ Window çš„ flagWindow çš„ flag ç”¨äºæ§åˆ¶ Window çš„æ˜¾ç¤ºï¼Œå®ƒä»¬çš„å€¼ä¹Ÿæ˜¯å®šä¹‰åœ¨ WindowManager çš„å†…éƒ¨ç±» LayoutParams ä¸­frameworks/base/core/java/android/view/WindowManager#LayoutParams.java // å½“ Window å¯è§æ—¶å…è®¸é”å±public static final int FLAG_ALLOW_LOCK_WHILE_SCREEN_ON = 0x00000001;// Window åé¢çš„å†…å®¹éƒ½å˜æš—public static final int FLAG_DIM_BEHIND = 0x00000002;@Deprecated// API å·²ç»è¿‡æ—¶ï¼ŒWindow åé¢çš„å†…å®¹éƒ½å˜æ¨¡ç³Špublic static final int FLAG_BLUR_BEHIND = 0x00000004;// Window ä¸èƒ½è·å¾—è¾“å…¥ç„¦ç‚¹ï¼Œå³ä¸æ¥å—ä»»ä½•æŒ‰é”®æˆ–æŒ‰é’®äº‹ä»¶ï¼Œä¾‹å¦‚è¯¥ Window ä¸Š æœ‰ EditViewï¼Œç‚¹å‡» EditView æ˜¯ ä¸ä¼šå¼¹å‡ºè½¯é”®ç›˜çš„// Window èŒƒå›´å¤–çš„äº‹ä»¶ä¾æ—§ä¸ºåŸçª—å£å¤„ç†ï¼›ä¾‹å¦‚ç‚¹å‡»è¯¥çª—å£å¤–çš„viewï¼Œä¾ç„¶ä¼šæœ‰å“åº”ã€‚å¦å¤–åªè¦è®¾ç½®äº†æ­¤Flagï¼Œéƒ½å°†ä¼šå¯ç”¨FLAG_NOT_TOUCH_MODALpublic static final int FLAG_NOT_FOCUSABLE = 0x00000008;// è®¾ç½®äº†è¯¥ Flag,å°† Window ä¹‹å¤–çš„æŒ‰é”®äº‹ä»¶å‘é€ç»™åé¢çš„ Window å¤„ç†, è€Œè‡ªå·±åªä¼šå¤„ç† Window åŒºåŸŸå†…çš„è§¦æ‘¸äº‹ä»¶// Window ä¹‹å¤–çš„ view ä¹Ÿæ˜¯å¯ä»¥å“åº” touch äº‹ä»¶ã€‚public static final int FLAG_NOT_TOUCH_MODAL = 0x00000020;// è®¾ç½®äº†è¯¥Flagï¼Œè¡¨ç¤ºè¯¥ Window å°†ä¸ä¼šæ¥å—ä»»ä½• touch äº‹ä»¶ï¼Œä¾‹å¦‚ç‚¹å‡»è¯¥ Window ä¸ä¼šæœ‰å“åº”ï¼Œåªä¼šä¼ ç»™ä¸‹é¢æœ‰èšç„¦çš„çª—å£ã€‚public static final int FLAG_NOT_TOUCHABLE = 0x00000010;// åªè¦ Window å¯è§æ—¶å±å¹•å°±ä¼šä¸€ç›´äº®ç€public static final int FLAG_KEEP_SCREEN_ON = 0x00000080;// å…è®¸ Window å æ»¡æ•´ä¸ªå±å¹•public static final int FLAG_LAYOUT_IN_SCREEN = 0x00000100;// å…è®¸ Window è¶…è¿‡å±å¹•ä¹‹å¤–public static final int FLAG_LAYOUT_NO_LIMITS = 0x00000200;// å…¨å±æ˜¾ç¤ºï¼Œéšè—æ‰€æœ‰çš„ Window è£…é¥°ï¼Œæ¯”å¦‚åœ¨æ¸¸æˆã€æ’­æ”¾å™¨ä¸­çš„å…¨å±æ˜¾ç¤ºpublic static final int FLAG_FULLSCREEN = 0x00000400;// è¡¨ç¤ºæ¯”FLAG_FULLSCREENä½ä¸€çº§ï¼Œä¼šæ˜¾ç¤ºçŠ¶æ€æ public static final int FLAG_FORCE_NOT_FULLSCREEN = 0x00000800;// å½“ç”¨æˆ·çš„è„¸è´´è¿‘å±å¹•æ—¶ï¼ˆæ¯”å¦‚æ‰“ç”µè¯ï¼‰ï¼Œä¸ä¼šå»å“åº”æ­¤äº‹ä»¶public static final int FLAG_IGNORE_CHEEK_PRESSES = 0x00008000;// åˆ™å½“æŒ‰é”®åŠ¨ä½œå‘ç”Ÿåœ¨ Window ä¹‹å¤–æ—¶ï¼Œå°†æ¥æ”¶åˆ°ä¸€ä¸ªMotionEvent.ACTION_OUTSIDEäº‹ä»¶ã€‚public static final int FLAG_WATCH_OUTSIDE_TOUCH = 0x00040000;@Deprecated// çª—å£å¯ä»¥åœ¨é”å±çš„ Window ä¹‹ä¸Šæ˜¾ç¤º, ä½¿ç”¨ Activity#setShowWhenLocked(boolean) æ–¹æ³•ä»£æ›¿public static final int FLAG_SHOW_WHEN_LOCKED = 0x00080000;// è¡¨ç¤ºè´Ÿè´£ç»˜åˆ¶ç³»ç»Ÿæ èƒŒæ™¯ã€‚å¦‚æœè®¾ç½®ï¼Œç³»ç»Ÿæ å°†ä»¥é€æ˜èƒŒæ™¯ç»˜åˆ¶ï¼Œ// æ­¤ Window ä¸­çš„ç›¸åº”åŒºåŸŸå°†å¡«å…… Windowï¼ƒgetStatusBarColorï¼ˆï¼‰å’Œ Windowï¼ƒgetNavigationBarColorï¼ˆï¼‰ä¸­æŒ‡å®šçš„é¢œè‰²ã€‚public static final int FLAG_DRAWS_SYSTEM_BAR_BACKGROUNDS = 0x80000000;// è¡¨ç¤ºè¦æ±‚ç³»ç»Ÿå£çº¸æ˜¾ç¤ºåœ¨è¯¥ Window åé¢ï¼ŒWindow è¡¨é¢å¿…é¡»æ˜¯åŠé€æ˜çš„ï¼Œæ‰èƒ½çœŸæ­£çœ‹åˆ°å®ƒèƒŒåçš„å£çº¸public static final int FLAG_SHOW_WALLPAPER = 0x00100000; flag å¤‡æ³¨ FLAG_ALLOW_LOCK_WHILE_SCREEN_ON å½“ Window å¯è§æ—¶å…è®¸é”å± FLAG_DIM_BEHIND Window åé¢çš„å†…å®¹éƒ½å˜æš— FLAG_BLUR_BEHIND API å·²ç»è¿‡æ—¶ï¼ŒWindow åé¢çš„å†…å®¹éƒ½å˜æ¨¡ç³Š FLAG_NOT_FOCUSABLE Window ä¸èƒ½è·å¾—è¾“å…¥ç„¦ç‚¹ï¼Œå³ä¸æ¥å—ä»»ä½•æŒ‰é”®æˆ–æŒ‰é’®äº‹ä»¶ï¼Œä¾‹å¦‚è¯¥ Window ä¸Š æœ‰ EditViewï¼Œç‚¹å‡» EditView æ˜¯ ä¸ä¼šå¼¹å‡ºè½¯é”®ç›˜çš„ï¼ŒWindow èŒƒå›´å¤–çš„äº‹ä»¶ä¾æ—§ä¸ºåŸçª—å£å¤„ç†ï¼›ä¾‹å¦‚ç‚¹å‡»è¯¥çª—å£å¤–çš„viewï¼Œä¾ç„¶ä¼šæœ‰å“åº”ã€‚å¦å¤–åªè¦è®¾ç½®äº†æ­¤Flagï¼Œéƒ½å°†ä¼šå¯ç”¨FLAG_NOT_TOUCH_MODAL FLAG_NOT_TOUCH_MODAL è®¾ç½®äº†è¯¥ Flag,å°† Window ä¹‹å¤–çš„æŒ‰é”®äº‹ä»¶å‘é€ç»™åé¢çš„ Window å¤„ç†, è€Œè‡ªå·±åªä¼šå¤„ç† Window åŒºåŸŸå†…çš„è§¦æ‘¸äº‹ä»¶ï¼ŒWindow ä¹‹å¤–çš„ view ä¹Ÿæ˜¯å¯ä»¥å“åº” touch äº‹ä»¶ FLAG_NOT_TOUCHABLE è®¾ç½®äº†è¯¥Flagï¼Œè¡¨ç¤ºè¯¥ Window å°†ä¸ä¼šæ¥å—ä»»ä½• touch äº‹ä»¶ï¼Œä¾‹å¦‚ç‚¹å‡»è¯¥ Window ä¸ä¼šæœ‰å“åº”ï¼Œåªä¼šä¼ ç»™ä¸‹é¢æœ‰èšç„¦çš„çª—å£ FLAG_KEEP_SCREEN_ON åªè¦ Window å¯è§æ—¶å±å¹•å°±ä¼šä¸€ç›´äº®ç€ FLAG_LAYOUT_IN_SCREEN å…è®¸ Window å æ»¡æ•´ä¸ªå±å¹• FLAG_LAYOUT_NO_LIMITS å…è®¸ Window è¶…è¿‡å±å¹•ä¹‹å¤– FLAG_FULLSCREEN å…¨å±æ˜¾ç¤ºï¼Œéšè—æ‰€æœ‰çš„ Window è£…é¥°ï¼Œæ¯”å¦‚åœ¨æ¸¸æˆã€æ’­æ”¾å™¨ä¸­çš„å…¨å±æ˜¾ç¤º FLAG_FORCE_NOT_FULLSCREEN è¡¨ç¤ºæ¯”FLAG_FULLSCREENä½ä¸€çº§ï¼Œä¼šæ˜¾ç¤ºçŠ¶æ€æ  FLAG_IGNORE_CHEEK_PRESSES å½“ç”¨æˆ·çš„è„¸è´´è¿‘å±å¹•æ—¶ï¼ˆæ¯”å¦‚æ‰“ç”µè¯ï¼‰ï¼Œä¸ä¼šå»å“åº”æ­¤äº‹ä»¶ FLAG_WATCH_OUTSIDE_TOUCH åˆ™å½“æŒ‰é”®åŠ¨ä½œå‘ç”Ÿåœ¨ Window ä¹‹å¤–æ—¶ï¼Œå°†æ¥æ”¶åˆ°ä¸€ä¸ªMotionEvent.ACTION_OUTSIDEäº‹ä»¶ FLAG_SHOW_WHEN_LOCKED å·²ç»è¿‡æ—¶ï¼Œçª—å£å¯ä»¥åœ¨é”å±çš„ Window ä¹‹ä¸Šæ˜¾ç¤º, ä½¿ç”¨ Activity#setShowWhenLocked(boolean) æ–¹æ³•ä»£æ›¿ FLAG_DRAWS_SYSTEM_BAR_BACKGROUNDS è¡¨ç¤ºè´Ÿè´£ç»˜åˆ¶ç³»ç»Ÿæ èƒŒæ™¯ã€‚å¦‚æœè®¾ç½®ï¼Œç³»ç»Ÿæ å°†ä»¥é€æ˜èƒŒæ™¯ç»˜åˆ¶ï¼Œ æ­¤ Window ä¸­çš„ç›¸åº”åŒºåŸŸå°†å¡«å…… Windowï¼ƒgetStatusBarColorï¼ˆï¼‰å’Œ Windowï¼ƒgetNavigationBarColorï¼ˆï¼‰ä¸­æŒ‡å®šçš„é¢œè‰² FLAG_SHOW_WALLPAPER è¡¨ç¤ºè¦æ±‚ç³»ç»Ÿå£çº¸æ˜¾ç¤ºåœ¨è¯¥ Window åé¢ï¼ŒWindow è¡¨é¢å¿…é¡»æ˜¯åŠé€æ˜çš„ï¼Œæ‰èƒ½çœŸæ­£çœ‹åˆ°å®ƒèƒŒåçš„å£çº¸ window è½¯é”®ç›˜æ¨¡å¼è¡¨ç¤º window è½¯é”®ç›˜è¾“å…¥åŒºåŸŸçš„æ˜¾ç¤ºæ¨¡å¼ï¼Œå¸¸è§çš„æƒ…å†µ Window çš„è½¯é”®ç›˜æ‰“å¼€ä¼šå æ®æ•´ä¸ªå±å¹•ï¼Œé®æŒ¡äº†åé¢çš„è§†å›¾ï¼Œä¾‹å¦‚çœ‹ç›´æ’­çš„æ—¶å€™åº•éƒ¨æœ‰ä¸ªè¾“å…¥æ¡†ç‚¹å‡»çš„æ—¶å€™ï¼Œè¾“å…¥æ¡†éšç€é”®ç›˜ä¸€èµ·ä¸Šæ¥ï¼Œè€Œæœ‰çš„æ—¶å€™ï¼Œå¸Œæœ›é”®ç›˜è¦†ç›–åœ¨æ‰€æœ‰çš„ View ä¹‹ä¸Šï¼Œç•Œé¢ä¿æŒä¸åŠ¨ç­‰ç­‰ è½¯é”®ç›˜æ¨¡å¼(SoftInputMode) å€¼ï¼Œä¸ AndroidManifest ä¸­ Activity çš„å±æ€§ android:windowSoftInputMode æ˜¯å¯¹åº”çš„ï¼Œå› æ­¤å¯ä»¥åœ¨ AndroidManifest æ–‡ä»¶ä¸­ä¸º Activity è®¾ç½®android:windowSoftInputMode &lt;activity android:windowSoftInputMode=&quot;adjustNothing&quot; /&gt; ä¹Ÿå¯ä»¥åœ¨ Java ä»£ç ä¸­ä¸º Window è®¾ç½® SoftInputMode getWindow().setSoftInputMode(WindowManager.LayoutParams.SOFT_INPUT_ADJUST_NOTHING); SoftInputMode å¸¸ç”¨çš„æœ‰ä»¥ä¸‹å‡ ä¸ªå€¼ // ä¸ä¼šæ”¹å˜è½¯é”®ç›˜çš„çŠ¶æ€public static final int SOFT_INPUT_STATE_UNCHANGED = 1;// å½“ç”¨æˆ·è¿›å…¥è¯¥çª—å£æ—¶ï¼Œéšè—è½¯é”®ç›˜public static final int SOFT_INPUT_STATE_HIDDEN = 2;// å½“çª—å£è·å–ç„¦ç‚¹æ—¶ï¼Œéšè—è½¯é”®ç›˜public static final int SOFT_INPUT_STATE_ALWAYS_HIDDEN = 3;// å½“ç”¨æˆ·è¿›å…¥çª—å£æ—¶ï¼Œæ˜¾ç¤ºè½¯é”®ç›˜public static final int SOFT_INPUT_STATE_VISIBLE = 4;// å½“çª—å£è·å–ç„¦ç‚¹æ—¶ï¼Œæ˜¾ç¤ºè½¯é”®ç›˜public static final int SOFT_INPUT_STATE_ALWAYS_VISIBLE = 5;// windowä¼šè°ƒæ•´å¤§å°ä»¥é€‚åº”è½¯é”®ç›˜çª—å£public static final int SOFT_INPUT_MASK_ADJUST = 0xf0;// æ²¡æœ‰æŒ‡å®šçŠ¶æ€,ç³»ç»Ÿä¼šé€‰æ‹©ä¸€ä¸ªåˆé€‚çš„çŠ¶æ€æˆ–ä¾èµ–äºä¸»é¢˜çš„è®¾ç½®public static final int SOFT_INPUT_ADJUST_UNSPECIFIED = 0x00;// å½“è½¯é”®ç›˜å¼¹å‡ºæ—¶ï¼Œçª—å£ä¼šè°ƒæ•´å¤§å°,ä¾‹å¦‚ç‚¹å‡»ä¸€ä¸ªEditViewï¼Œæ•´ä¸ªlayoutéƒ½å°†å¹³ç§»å¯è§ä¸”å¤„äºè½¯ä»¶ç›˜çš„ä¸Šæ–¹// åŒæ ·çš„è¯¥æ¨¡å¼ä¸èƒ½ä¸SOFT_INPUT_ADJUST_PANç»“åˆä½¿ç”¨ï¼›// å¦‚æœçª—å£çš„å¸ƒå±€å‚æ•°æ ‡å¿—åŒ…å«FLAG_FULLSCREENï¼Œåˆ™å°†å¿½ç•¥è¿™ä¸ªå€¼ï¼Œçª—å£ä¸ä¼šè°ƒæ•´å¤§å°ï¼Œä½†ä¼šä¿æŒå…¨å±ã€‚public static final int SOFT_INPUT_ADJUST_RESIZE = 0x10;// å½“è½¯é”®ç›˜å¼¹å‡ºæ—¶ï¼Œçª—å£ä¸éœ€è¦è°ƒæ•´å¤§å°, è¦ç¡®ä¿è¾“å…¥ç„¦ç‚¹æ˜¯å¯è§çš„,// ä¾‹å¦‚æœ‰ä¸¤ä¸ªEditViewçš„è¾“å…¥æ¡†ï¼Œä¸€ä¸ªä¸ºEv1ï¼Œä¸€ä¸ªä¸ºEv2ï¼Œå½“ä½ ç‚¹å‡»Ev1æƒ³è¦è¾“å…¥æ•°æ®æ—¶ï¼Œå½“å‰çš„Ev1çš„è¾“å…¥æ¡†ä¼šç§»åˆ°è½¯é”®ç›˜ä¸Šæ–¹// è¯¥æ¨¡å¼ä¸èƒ½ä¸SOFT_INPUT_ADJUST_RESIZEç»“åˆä½¿ç”¨public static final int SOFT_INPUT_ADJUST_PAN = 0x20;// å°†ä¸ä¼šè°ƒæ•´å¤§å°ï¼Œç›´æ¥è¦†ç›–åœ¨windowä¸Špublic static final int SOFT_INPUT_ADJUST_NOTHING = 0x30; model å¤‡æ³¨ SOFT_INPUT_STATE_UNCHANGED ä¸ä¼šæ”¹å˜è½¯é”®ç›˜çš„çŠ¶æ€ SOFT_INPUT_STATE_VISIBLE å½“ç”¨æˆ·è¿›å…¥çª—å£æ—¶ï¼Œæ˜¾ç¤ºè½¯é”®ç›˜ SOFT_INPUT_STATE_HIDDEN å½“ç”¨æˆ·è¿›å…¥è¯¥çª—å£æ—¶ï¼Œéšè—è½¯é”®ç›˜ SOFT_INPUT_STATE_ALWAYS_HIDDEN å½“çª—å£è·å–ç„¦ç‚¹æ—¶ï¼Œéšè—è½¯é”®ç›˜ SOFT_INPUT_STATE_ALWAYS_VISIBLE å½“çª—å£è·å–ç„¦ç‚¹æ—¶ï¼Œæ˜¾ç¤ºè½¯é”®ç›˜ SOFT_INPUT_MASK_ADJUST window ä¼šè°ƒæ•´å¤§å°ä»¥é€‚åº”è½¯é”®ç›˜çª—å£ SOFT_INPUT_ADJUST_UNSPECIFIED æ²¡æœ‰æŒ‡å®šçŠ¶æ€,ç³»ç»Ÿä¼šé€‰æ‹©ä¸€ä¸ªåˆé€‚çš„çŠ¶æ€æˆ–ä¾èµ–äºä¸»é¢˜çš„è®¾ç½® SOFT_INPUT_ADJUST_RESIZE 1. å½“è½¯é”®ç›˜å¼¹å‡ºæ—¶ï¼Œçª—å£ä¼šè°ƒæ•´å¤§å°,ä¾‹å¦‚ç‚¹å‡»ä¸€ä¸ªEditViewï¼Œæ•´ä¸ªlayoutéƒ½å°†å¹³ç§»å¯è§ä¸”å¤„äºè½¯ä»¶ç›˜çš„ä¸Šæ–¹ 2. åŒæ ·çš„è¯¥æ¨¡å¼ä¸èƒ½ä¸SOFT_INPUT_ADJUST_PANç»“åˆä½¿ç”¨ 3. å¦‚æœçª—å£çš„å¸ƒå±€å‚æ•°æ ‡å¿—åŒ…å«FLAG_FULLSCREENï¼Œåˆ™å°†å¿½ç•¥è¿™ä¸ªå€¼ï¼Œçª—å£ä¸ä¼šè°ƒæ•´å¤§å°ï¼Œä½†ä¼šä¿æŒå…¨å± SOFT_INPUT_ADJUST_PAN 1. å½“è½¯é”®ç›˜å¼¹å‡ºæ—¶ï¼Œçª—å£ä¸éœ€è¦è°ƒæ•´å¤§å°, è¦ç¡®ä¿è¾“å…¥ç„¦ç‚¹æ˜¯å¯è§çš„ 2. ä¾‹å¦‚æœ‰ä¸¤ä¸ªEditViewçš„è¾“å…¥æ¡†ï¼Œä¸€ä¸ªä¸ºEv1ï¼Œä¸€ä¸ªä¸ºEv2ï¼Œå½“ä½ ç‚¹å‡»Ev1æƒ³è¦è¾“å…¥æ•°æ®æ—¶ï¼Œå½“å‰çš„Ev1çš„è¾“å…¥æ¡†ä¼šç§»åˆ°è½¯é”®ç›˜ä¸Šæ–¹ 3. è¯¥æ¨¡å¼ä¸èƒ½ä¸SOFT_INPUT_ADJUST_RESIZEç»“åˆä½¿ç”¨ SOFT_INPUT_ADJUST_NOTHING å°†ä¸ä¼šè°ƒæ•´å¤§å°ï¼Œç›´æ¥è¦†ç›–åœ¨windowä¸Š Kotlin å°æŠ€å·§åˆ©ç”¨ plus (+) å’Œ plus (-) å¯¹ Map é›†åˆåšè¿ç®—ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š fun main() { val numbersMap = mapOf(&quot;one&quot; to 1, &quot;two&quot; to 2, &quot;three&quot; to 3) // plus (+) println(numbersMap + Pair(&quot;four&quot;, 4)) // {one=1, two=2, three=3, four=4} println(numbersMap + Pair(&quot;one&quot;, 10)) // {one=10, two=2, three=3} println(numbersMap + Pair(&quot;five&quot;, 5) + Pair(&quot;one&quot;, 11)) // {one=11, two=2, three=3, five=5} // plus (-) println(numbersMap - &quot;one&quot;) // {two=2, three=3} println(numbersMap - listOf(&quot;two&quot;, &quot;four&quot;)) // {one=1, three=3}} æ€»ç»“åˆ°è¿™é‡Œå°±ç»“æŸäº†ï¼Œè¿™ç¯‡æ–‡ç« ä¸»è¦ä»‹ç»äº† Window çš„ç±»å‹å¤§æ¦‚å¯ä»¥åˆ†ä¸ºä¸‰ç±»ï¼š åº”ç”¨ç¨‹åº Windowï¼ˆApplication Windowï¼‰ã€å­ Windowï¼ˆSub Windwowï¼‰ã€ç³»ç»Ÿ Windowï¼ˆSystem Windowï¼‰ã€‚ åˆ†åˆ«ä»‹ç»äº† Window çš„ç±»å‹ã€Window è§†å›¾å±‚çº§é¡ºåºã€Window çš„ flagã€å’Œ window è½¯é”®ç›˜æ¨¡å¼ä¸ºåé¢çš„å†…å®¹åšé“ºå« Window éƒ½æœ‰é‚£äº›å¸¸ç”¨çš„å‚æ•°? å‚æ•° å¤‡æ³¨ x window å·¦ä¸Šè§’çš„ x åæ ‡ y window å·¦ä¸Šè§’çš„ y åæ ‡ type Window çš„ç±»å‹ flag Window çš„ flag ç”¨äºæ§åˆ¶ Window çš„æ˜¾ç¤º softInputMode window è½¯é”®ç›˜è¾“å…¥åŒºåŸŸçš„æ˜¾ç¤ºæ¨¡å¼ alpha Window çš„é€æ˜åº¦ï¼Œå–å€¼ä¸º0-1 gravity Window åœ¨å±å¹•ä¸­çš„ä½ç½® alpha Window çš„é€æ˜åº¦ï¼Œå–å€¼ä¸º0-1 format Window çš„åƒç´ ç‚¹æ ¼å¼ï¼Œå€¼å®šä¹‰åœ¨ PixelFormat ä¸­ Window éƒ½æœ‰é‚£äº›ç±»å‹ï¼Ÿ åº”ç”¨ç¨‹åº Windowï¼ˆApplication Windowï¼‰ã€å­ Windowï¼ˆSub Windwowï¼‰ã€ç³»ç»Ÿ Windowï¼ˆSystem Windowï¼‰ï¼Œå­ Window ä¾é™„äºçˆ¶ Window ä¸Šï¼Œå¹¶ä¸”ä»–ä»¬çš„åæ ‡ç©ºé—´ç›¸å¯¹äºçˆ¶ Window çš„ï¼Œæ¯ä¸ªå¤§ç±»å‹åˆåŒ…å«å¤šä¸ªå°ç±»å‹ï¼Œæ¯ä¸ªç±»å‹åœ¨ä¸Šæ–‡çš„è¡¨æ ¼ä¸­å·²ç»åˆ—å‡ºæ¥äº†ï¼Œ Window é‚£äº›è¿‡æ—¶çš„ API ä»¥åŠå¤„ç†æ–¹æ¡ˆï¼Ÿ TYPE_PHONEã€TYPE_SYSTEM_ALERTã€TYPE_TOASTã€TYPE_SYSTEM_OVERLAYã€TYPE_PRIORITY_PHONEã€TYPE_SYSTEM_ERROR è¿™äº› type åœ¨ API 26 ä¸­å‡å·²ç»è¿‡æ—¶ï¼Œä½¿ç”¨ TYPE_APPLICATION_OVERLAY ä»£æ›¿ï¼Œéœ€è¦ç”³è¯· Manifest.permission.SYSTEM_ALERT_WINDOW æƒé™ TYPE_KEYGUARD å·²ç»è¢«ä»ç³»ç»Ÿä¸­ç§»é™¤ï¼Œå¯ä»¥ä½¿ç”¨ TYPE_KEYGUARD_DIALOG æ¥ä»£æ›¿ Window è§†å›¾å±‚çº§é¡ºåºæ˜¯å¦‚ä½•ç¡®å®šçš„ï¼Ÿ Window çš„å‚æ•° xã€yï¼Œåˆ†åˆ«è¡¨ç¤º Window å·¦ä¸Šè§’çš„ x åæ ‡ï¼ŒWindow å·¦ä¸Šè§’çš„ y åæ ‡ï¼ŒWindow è§†å›¾å±‚çº§é¡ºåº ç”¨ Z-order æ¥è¡¨ç¤ºï¼ŒZ-order å¯¹åº”ç€ WindowManager.LayoutParams çš„ type å€¼ï¼ŒZ-order å¯ä»¥ç†è§£ä¸º Android è§†å›¾çš„å±‚çº§æ¦‚å¿µï¼Œå€¼è¶Šå¤§è¶Šé å‰ï¼Œå°±è¶Šé è¿‘ç”¨æˆ·ã€‚è€Œ mBaseLayer å’Œ mSubLayer å†³å®š z-order çš„ä¸¤ä¸ªå› ç´  Window éƒ½é‚£äº› flagï¼Ÿ Window çš„ flag ç”¨äºæ§åˆ¶ Window çš„æ˜¾ç¤ºï¼Œflag çš„å‚æ•°å¦‚ä¸‹æ‰€ç¤ºï¼š flag å¤‡æ³¨ FLAG_ALLOW_LOCK_WHILE_SCREEN_ON å½“ Window å¯è§æ—¶å…è®¸é”å± FLAG_DIM_BEHIND Window åé¢çš„å†…å®¹éƒ½å˜æš— FLAG_BLUR_BEHIND API å·²ç»è¿‡æ—¶ï¼ŒWindow åé¢çš„å†…å®¹éƒ½å˜æ¨¡ç³Š FLAG_NOT_FOCUSABLE Window ä¸èƒ½è·å¾—è¾“å…¥ç„¦ç‚¹ï¼Œå³ä¸æ¥å—ä»»ä½•æŒ‰é”®æˆ–æŒ‰é’®äº‹ä»¶ï¼Œä¾‹å¦‚è¯¥ Window ä¸Š æœ‰ EditViewï¼Œç‚¹å‡» EditView æ˜¯ ä¸ä¼šå¼¹å‡ºè½¯é”®ç›˜çš„ï¼ŒWindow èŒƒå›´å¤–çš„äº‹ä»¶ä¾æ—§ä¸ºåŸçª—å£å¤„ç†ï¼›ä¾‹å¦‚ç‚¹å‡»è¯¥çª—å£å¤–çš„viewï¼Œä¾ç„¶ä¼šæœ‰å“åº”ã€‚å¦å¤–åªè¦è®¾ç½®äº†æ­¤Flagï¼Œéƒ½å°†ä¼šå¯ç”¨FLAG_NOT_TOUCH_MODAL FLAG_NOT_TOUCH_MODAL è®¾ç½®äº†è¯¥ Flag,å°† Window ä¹‹å¤–çš„æŒ‰é”®äº‹ä»¶å‘é€ç»™åé¢çš„ Window å¤„ç†, è€Œè‡ªå·±åªä¼šå¤„ç† Window åŒºåŸŸå†…çš„è§¦æ‘¸äº‹ä»¶ï¼ŒWindow ä¹‹å¤–çš„ view ä¹Ÿæ˜¯å¯ä»¥å“åº” touch äº‹ä»¶ FLAG_NOT_TOUCHABLE è®¾ç½®äº†è¯¥Flagï¼Œè¡¨ç¤ºè¯¥ Window å°†ä¸ä¼šæ¥å—ä»»ä½• touch äº‹ä»¶ï¼Œä¾‹å¦‚ç‚¹å‡»è¯¥ Window ä¸ä¼šæœ‰å“åº”ï¼Œåªä¼šä¼ ç»™ä¸‹é¢æœ‰èšç„¦çš„çª—å£ FLAG_KEEP_SCREEN_ON åªè¦ Window å¯è§æ—¶å±å¹•å°±ä¼šä¸€ç›´äº®ç€ FLAG_LAYOUT_IN_SCREEN å…è®¸ Window å æ»¡æ•´ä¸ªå±å¹• FLAG_LAYOUT_NO_LIMITS å…è®¸ Window è¶…è¿‡å±å¹•ä¹‹å¤– FLAG_FULLSCREEN å…¨å±æ˜¾ç¤ºï¼Œéšè—æ‰€æœ‰çš„ Window è£…é¥°ï¼Œæ¯”å¦‚åœ¨æ¸¸æˆã€æ’­æ”¾å™¨ä¸­çš„å…¨å±æ˜¾ç¤º FLAG_FORCE_NOT_FULLSCREEN è¡¨ç¤ºæ¯”FLAG_FULLSCREENä½ä¸€çº§ï¼Œä¼šæ˜¾ç¤ºçŠ¶æ€æ  FLAG_IGNORE_CHEEK_PRESSES å½“ç”¨æˆ·çš„è„¸è´´è¿‘å±å¹•æ—¶ï¼ˆæ¯”å¦‚æ‰“ç”µè¯ï¼‰ï¼Œä¸ä¼šå»å“åº”æ­¤äº‹ä»¶ FLAG_WATCH_OUTSIDE_TOUCH åˆ™å½“æŒ‰é”®åŠ¨ä½œå‘ç”Ÿåœ¨ Window ä¹‹å¤–æ—¶ï¼Œå°†æ¥æ”¶åˆ°ä¸€ä¸ªMotionEvent.ACTION_OUTSIDEäº‹ä»¶ FLAG_SHOW_WHEN_LOCKED å·²ç»è¿‡æ—¶ï¼Œçª—å£å¯ä»¥åœ¨é”å±çš„ Window ä¹‹ä¸Šæ˜¾ç¤º, ä½¿ç”¨ Activity#setShowWhenLocked(boolean) æ–¹æ³•ä»£æ›¿ FLAG_DRAWS_SYSTEM_BAR_BACKGROUNDS è¡¨ç¤ºè´Ÿè´£ç»˜åˆ¶ç³»ç»Ÿæ èƒŒæ™¯ã€‚å¦‚æœè®¾ç½®ï¼Œç³»ç»Ÿæ å°†ä»¥é€æ˜èƒŒæ™¯ç»˜åˆ¶ï¼Œ æ­¤ Window ä¸­çš„ç›¸åº”åŒºåŸŸå°†å¡«å…… Windowï¼ƒgetStatusBarColorï¼ˆï¼‰å’Œ Windowï¼ƒgetNavigationBarColorï¼ˆï¼‰ä¸­æŒ‡å®šçš„é¢œè‰² FLAG_SHOW_WALLPAPER è¡¨ç¤ºè¦æ±‚ç³»ç»Ÿå£çº¸æ˜¾ç¤ºåœ¨è¯¥ Window åé¢ï¼ŒWindow è¡¨é¢å¿…é¡»æ˜¯åŠé€æ˜çš„ï¼Œæ‰èƒ½çœŸæ­£çœ‹åˆ°å®ƒèƒŒåçš„å£çº¸ Window è½¯é”®ç›˜æ¨¡å¼ï¼Ÿ Window çš„è½¯é”®ç›˜æ¨¡å¼è¡¨ç¤º Window è½¯é”®ç›˜è¾“å…¥åŒºåŸŸçš„æ˜¾ç¤ºæ¨¡å¼ model å¤‡æ³¨ SOFT_INPUT_STATE_UNCHANGED ä¸ä¼šæ”¹å˜è½¯é”®ç›˜çš„çŠ¶æ€ SOFT_INPUT_STATE_VISIBLE å½“ç”¨æˆ·è¿›å…¥çª—å£æ—¶ï¼Œæ˜¾ç¤ºè½¯é”®ç›˜ SOFT_INPUT_STATE_HIDDEN å½“ç”¨æˆ·è¿›å…¥è¯¥çª—å£æ—¶ï¼Œéšè—è½¯é”®ç›˜ SOFT_INPUT_STATE_ALWAYS_HIDDEN å½“çª—å£è·å–ç„¦ç‚¹æ—¶ï¼Œéšè—è½¯é”®ç›˜ SOFT_INPUT_STATE_ALWAYS_VISIBLE å½“çª—å£è·å–ç„¦ç‚¹æ—¶ï¼Œæ˜¾ç¤ºè½¯é”®ç›˜ SOFT_INPUT_MASK_ADJUST window ä¼šè°ƒæ•´å¤§å°ä»¥é€‚åº”è½¯é”®ç›˜çª—å£ SOFT_INPUT_ADJUST_UNSPECIFIED æ²¡æœ‰æŒ‡å®šçŠ¶æ€,ç³»ç»Ÿä¼šé€‰æ‹©ä¸€ä¸ªåˆé€‚çš„çŠ¶æ€æˆ–ä¾èµ–äºä¸»é¢˜çš„è®¾ç½® SOFT_INPUT_ADJUST_RESIZE 1. å½“è½¯é”®ç›˜å¼¹å‡ºæ—¶ï¼Œçª—å£ä¼šè°ƒæ•´å¤§å°,ä¾‹å¦‚ç‚¹å‡»ä¸€ä¸ªEditViewï¼Œæ•´ä¸ªlayoutéƒ½å°†å¹³ç§»å¯è§ä¸”å¤„äºè½¯ä»¶ç›˜çš„ä¸Šæ–¹ 2. åŒæ ·çš„è¯¥æ¨¡å¼ä¸èƒ½ä¸SOFT_INPUT_ADJUST_PANç»“åˆä½¿ç”¨ 3. å¦‚æœçª—å£çš„å¸ƒå±€å‚æ•°æ ‡å¿—åŒ…å«FLAG_FULLSCREENï¼Œåˆ™å°†å¿½ç•¥è¿™ä¸ªå€¼ï¼Œçª—å£ä¸ä¼šè°ƒæ•´å¤§å°ï¼Œä½†ä¼šä¿æŒå…¨å± SOFT_INPUT_ADJUST_PAN 1. å½“è½¯é”®ç›˜å¼¹å‡ºæ—¶ï¼Œçª—å£ä¸éœ€è¦è°ƒæ•´å¤§å°, è¦ç¡®ä¿è¾“å…¥ç„¦ç‚¹æ˜¯å¯è§çš„ 2. ä¾‹å¦‚æœ‰ä¸¤ä¸ªEditViewçš„è¾“å…¥æ¡†ï¼Œä¸€ä¸ªä¸ºEv1ï¼Œä¸€ä¸ªä¸ºEv2ï¼Œå½“ä½ ç‚¹å‡»Ev1æƒ³è¦è¾“å…¥æ•°æ®æ—¶ï¼Œå½“å‰çš„Ev1çš„è¾“å…¥æ¡†ä¼šç§»åˆ°è½¯é”®ç›˜ä¸Šæ–¹ 3. è¯¥æ¨¡å¼ä¸èƒ½ä¸SOFT_INPUT_ADJUST_RESIZEç»“åˆä½¿ç”¨ SOFT_INPUT_ADJUST_NOTHING å°†ä¸ä¼šè°ƒæ•´å¤§å°ï¼Œç›´æ¥è¦†ç›–åœ¨windowä¸Š å‚è€ƒæ–‡çŒ® https://developer.android.google.cn/â€¦/WindowManager.LayoutParams https://www.jianshu.com/p/3528255475a2","link":"/2020/06/07/android10/window-manager/07-WindowManagerService/"},{"title":"0xA06 Android 10 æºç åˆ†æï¼šWindowManager è§†å›¾ç»‘å®šä»¥åŠä½“ç³»ç»“æ„","text":"0xA06 Android 10 æºç åˆ†æï¼šWindowManager è§†å›¾ç»‘å®šä»¥åŠä½“ç³»ç»“æ„ å¼•è¨€ è¿™æ˜¯ Android 10 æºç åˆ†æç³»åˆ—çš„ç¬¬ 6 ç¯‡ åˆ†æ”¯ï¼šandroid-10.0.0_r14 å…¨æ–‡é˜…è¯»å¤§æ¦‚ 10 åˆ†é’Ÿ é€šè¿‡è¿™ç¯‡æ–‡ç« ä½ å°†å­¦ä¹ åˆ°ä»¥ä¸‹å†…å®¹ï¼Œå°†åœ¨æ–‡æœ«æ€»ç»“éƒ¨åˆ†ä¼šç»™å‡ºç›¸åº”çš„ç­”æ¡ˆ Acivity å’Œ Dialog è§†å›¾è§£æç»‘å®šè¿‡ç¨‹ï¼Ÿ Activity çš„è§†å›¾å¦‚ä½•ä¸ Window å…³è”çš„ï¼Ÿ Window å¦‚ä½•ä¸ WindowManager å…³è”ï¼Ÿ Dialog çš„è§†å›¾å¦‚ä½•ä¸ Window å…³è”ï¼Ÿ æœ¬æ–‡ä¸»è¦åˆ†æ Activityã€Windowã€PhoneWindowã€WindowManager ä¹‹é—´çš„å…³ç³»ï¼Œä¸ºæˆ‘ä»¬åé¢çš„æ–‡ç«  ã€Œå¦‚ä½•åœ¨ Andorid ç³»ç»Ÿé‡Œæ·»åŠ è‡ªå®šä¹‰Viewã€ ç­‰ç­‰æ–‡ç« å¥ å®šåŸºç¡€ï¼Œå…ˆæ¥äº†è§£ä¸€ä¸‹å®ƒä»¬çš„åŸºæœ¬æ¦‚å¿µ Activityï¼šåº”ç”¨è§†å›¾çš„å®¹å™¨ã€‚ WindowManagerï¼šå®ƒæ˜¯ä¸€ä¸ªæ¥å£ç±»ï¼Œç»§æ‰¿è‡ªæ¥å£ ViewManagerï¼Œå¯¹ Window è¿›è¡Œç®¡ç† Windowï¼šå®ƒæ˜¯ä¸€ä¸ªæŠ½è±¡ç±»ï¼Œå®ƒä½œä¸ºä¸€ä¸ªé¡¶çº§è§†å›¾æ·»åŠ åˆ° WindowManager ä¸­ï¼Œå¯¹ View è¿›è¡Œç®¡ç† PhoneWindowï¼šWindowå”¯ä¸€å®ç°ç±»ï¼ŒWindowæ˜¯ä¸€ä¸ªæŠ½è±¡æ¦‚å¿µï¼Œæ·»åŠ åˆ°WindowManagerçš„æ ¹å®¹å™¨ DecorView: å®ƒæ˜¯ PhoneWindow å†…éƒ¨çš„ä¸€ä¸ªæˆå‘˜å˜é‡ï¼Œç»§æ‰¿è‡ª FrameLayoutï¼ŒFrameLayout ç»§æ‰¿è‡ª ViewGroup åœ¨åˆ†æä»–ä»¬ä¹‹å‰çš„å…³ç³»ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆæ¥å›é¡¾ä¸€ä¸‹ Acivity å’Œ Dialog è§†å›¾è§£æç»‘å®šçš„è¿‡ç¨‹ Acivity å’Œ Dialog è§†å›¾è§£æç»‘å®šçš„è¿‡ç¨‹Acivity å’Œ Dialog ç›¸å…³çš„æ–‡ç« ï¼š 0xA03 Android 10 æºç åˆ†æï¼šAPK åŠ è½½æµç¨‹ä¹‹èµ„æºåŠ è½½ 0xA04 Android 10 æºç åˆ†æï¼šAPK åŠ è½½æµç¨‹ä¹‹èµ„æºåŠ è½½ï¼ˆäºŒï¼‰ 0xA05 Android 10 æºç åˆ†æï¼šDialog åŠ è½½ç»˜åˆ¶æµç¨‹ä»¥åŠåœ¨ Kotlinã€DataBinding ä¸­çš„ä½¿ç”¨ åœ¨ä¹‹å‰çš„æ–‡ç«  åˆ†åˆ«ä»‹ç»äº† Acivity å’Œ è‡ªå®šä¹‰ Dialog è§†å›¾çš„è§£æå’Œç»‘å®šï¼Œæ€»çš„æ¥è¯´åˆ†ä¸ºä¸‰æ­¥ è°ƒç”¨ LayoutInflater çš„ inflate æ–¹æ³•ï¼Œæ·±åº¦ä¼˜å…ˆéå†è§£æ View è°ƒç”¨ ViewGroup çš„ addView æ–¹æ³•å°†å­ View æ·»åŠ åˆ°æ ¹å¸ƒå±€ä¸­ è°ƒç”¨ WindowManager çš„ addView æ–¹æ³•æ·»åŠ æ ¹å¸ƒå±€ LayoutInflater çš„ inflate æ–¹æ³•æœ‰å¤šä¸ªé‡è½½çš„æ–¹æ³•ï¼Œå¸¸ç”¨çš„æ˜¯ä¸‹é¢ä¸‰ä¸ªå‚æ•°çš„æ–¹æ³•frameworks/base/core/java/android/view/LayoutInflater.java public View inflate(@LayoutRes int resource, @Nullable ViewGroup root) { return inflate(resource, root, root != null);} resourceï¼šè¦è§£æçš„ xml å¸ƒå±€æ–‡ä»¶ Id rootï¼šè¡¨ç¤ºæ ¹å¸ƒå±€ attachToRootï¼šæ˜¯å¦è¦æ·»åŠ åˆ°çˆ¶å¸ƒå±€ root ä¸­ resource å…¶å®å¾ˆå¥½ç†è§£å°±æ˜¯èµ„æº Idï¼Œè€Œ root å’Œ attachToRoot åˆ†åˆ«ä»£è¡¨ä»€ä¹ˆæ„æ€ï¼š å½“ attachToRoot == true ä¸” root ï¼= null æ—¶ï¼Œæ–°è§£æå‡ºæ¥çš„ View ä¼šè¢« add åˆ° root ä¸­å»ï¼Œç„¶åå°† root ä½œä¸ºç»“æœè¿”å› å½“ attachToRoot == false ä¸” root ï¼= null æ—¶ï¼Œæ–°è§£æçš„ View ä¼šç›´æ¥ä½œä¸ºç»“æœè¿”å›ï¼Œè€Œä¸” root ä¼šä¸ºæ–°è§£æçš„ View ç”Ÿæˆ LayoutParams å¹¶è®¾ç½®åˆ°è¯¥ View ä¸­å» å½“ attachToRoot == false ä¸” root == null æ—¶ï¼Œæ–°è§£æçš„ View ä¼šç›´æ¥ä½œä¸ºç»“æœè¿”å› å½“ View è§£æå®Œæˆä¹‹åï¼Œæœ€åä¼šè°ƒç”¨ WindowManager çš„ addView æ–¹æ³•ï¼ŒWindowManager æ˜¯ä¸€ä¸ªæ¥å£ç±»ï¼Œç»§æ‰¿è‡ªæ¥å£ ViewManagerï¼Œç”¨æ¥ç®¡ç† Windowï¼Œå®ƒçš„å®ç°ç±»ä¸º WindowManagerImplï¼Œæ‰€ä»¥è°ƒç”¨ WindowManager çš„ addView æ–¹æ³•ï¼Œå®é™…ä¸Šè°ƒç”¨çš„æ˜¯ WindowManagerImpl çš„ addView æ–¹æ³•frameworks/base/core/java/android/view/WindowManagerImpl.java public final class WindowManagerImpl implements WindowManager { @UnsupportedAppUsage // å•ä¾‹çš„è®¾è®¡æ¨¡å¼ private final WindowManagerGlobal mGlobal = WindowManagerGlobal.getInstance(); private final Context mContext; private final Window mParentWindow; ...... public void addView(@NonNull View view, @NonNull ViewGroup.LayoutParams params) { applyDefaultToken(params); // mGlobal æ˜¯ WindowManagerGlobal çš„å®ä¾‹ mGlobal.addView(view, params, mContext.getDisplay(), mParentWindow); } ...... } mGlobal æ˜¯ WindowManagerGlobal çš„å®ä¾‹ï¼Œä½¿ç”¨çš„å•ä¾‹è®¾è®¡æ¨¡å¼ï¼Œå‚æ•° mParentWindow æ˜¯ Window çš„å®ä¾‹ï¼Œå®é™…ä¸Šæ˜¯å§”æ‰˜ç»™ WindowManagerGlobal å»å®ç°çš„ åˆ°è¿™é‡Œæˆ‘ä»¬å…³äº Acivity å’Œ Dialog è§†å›¾çš„è§£æå’Œæ·»åŠ è¿‡ç¨‹å¤§æ¦‚ä»‹ç»å®Œäº†ï¼Œå…³äº Dialog çš„è§†å›¾å¦‚ä½•ä¸ Window ç»‘å®šåœ¨ 0xA05 Android 10 æºç åˆ†æï¼šDialog åŠ è½½ç»˜åˆ¶æµç¨‹ä»¥åŠåœ¨ Kotlinã€DataBinding ä¸­çš„ä½¿ç”¨ æ–‡ç« ä¸­ä»‹ç»äº†ï¼Œæ¥ä¸‹æ¥åˆ†æä¸€ä¸‹ Activityã€Windowã€WindowManager çš„å…³ç³» Activityã€Windowã€WindowManager çš„å…³ç³»åœ¨ Activity å†…éƒ¨ç»´æŠ¤ç€ä¸€ä¸ª Window çš„å®ä¾‹å˜é‡ mWindowframeworks/base/core/java/android/app/Activity.java public class Activity extends ContextThemeWrappe{ private Window mWindow;}``` Window æ˜¯ä¸€ä¸ªæŠ½è±¡ç±»ï¼Œå®ƒçš„å…·ä½“å®ç°ç±»ä¸º PhoneWindowï¼Œåœ¨ Activity çš„ attach æ–¹æ³•ä¸­ç»™ Window çš„å®ä¾‹å˜é‡ mWindow èµ‹å€¼**frameworks/base/core/java/android/app/Activity.java** final void attach(Context context, ActivityThread aThread, Instrumentation instr, IBinder token, int ident, Application application, Intent intent, ActivityInfo info, CharSequence title, Activity parent, String id, NonConfigurationInstances lastNonConfigurationInstances, Configuration config, String referrer, IVoiceInteractor voiceInteractor, Window window, ActivityConfigCallback activityConfigCallback, IBinder assistToken) { â€¦â€¦ mWindow = new PhoneWindow(this, window, activityConfigCallback); ...... mWindow.setWindowManager( (WindowManager)context.getSystemService(Context.WINDOW_SERVICE), mToken, mComponent.flattenToString(), (info.flags &amp; ActivityInfo.FLAG_HARDWARE_ACCELERATED) != 0); ......} * åˆ›å»ºäº† PhoneWindow å¹¶èµ‹å€¼ç»™ mWindow* è°ƒç”¨ PhoneWindow çš„ setWindowManager æ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•çš„å…·ä½“å®ç°å‘ç”Ÿåœ¨ Window ä¸­ï¼Œæœ€ç»ˆè°ƒç”¨çš„æ˜¯ Window çš„ setWindowManager æ–¹æ³•**frameworks/base/core/java/android/view/Window.java** public void setWindowManager(WindowManager wm, IBinder appToken, String appName, boolean hardwareAccelerated) { â€¦â€¦ // mWindowManager æ˜¯ WindowManagerImplçš„å®ä¾‹å˜é‡ mWindowManager = ((WindowManagerImpl)wm).createLocalWindowManager(this);} å°† WindowManager è½¬æ¢ä¸º WindowManagerImplï¼Œä¹‹åè°ƒç”¨ createLocalWindowManager æ–¹æ³•ï¼Œå¹¶ä¼ é€’å½“å‰çš„ Window å¯¹è±¡ï¼Œæ„å»º WindowManagerImpl å¯¹è±¡ï¼Œä¹‹åèµ‹å€¼ç»™ mWindowManager**frameworks/base/core/java/android/view/WindowManagerImpl.java** public WindowManagerImpl createLocalWindowManager(Window parentWindow) { return new WindowManagerImpl(mContext, parentWindow);} å…¶å®åœ¨ createLocalWindowManager æ–¹æ³•ä¸­ï¼Œå°±åšäº†ä¸€ä»¶äº‹ï¼Œå°† Window ä½œä¸ºå‚æ•°æ„å»ºäº†ä¸€ä¸ª WindowManagerImpl å¯¹è±¡è¿”è¿˜ç»™è°ƒç”¨å¤„&lt;br/&gt;æ€»çš„æ¥è¯´ï¼Œå…¶å®å°±æ˜¯åœ¨ Activity çš„ attach æ–¹æ³•ä¸­ï¼Œé€šè¿‡è°ƒç”¨ Window çš„ setWindowManager æ–¹æ³•å°† Window å’Œ WindowManager å…³è”åœ¨äº†ä¸€èµ·&lt;br/&gt;PhoneWindow æ˜¯ Window çš„å®ç°ç±»ï¼Œå®ƒæ˜¯ä¸€ä¸ªçª—å£ï¼Œæœ¬èº«å¹¶ä¸å…·å¤‡ View ç›¸å…³çš„èƒ½åŠ›ï¼Œå®é™…ä¸Šåœ¨ PhoneWindow å†…éƒ¨ç»´æŠ¤è¿™ä¸€ä¸ªå˜é‡ mDecor**frameworks/base/core/java/com/android/internal/policy/PhoneWindow.java** public class PhoneWindow extends Window{ // This is the top-level view of the window, containing the window decor. private DecorView mDecor; private void installDecor() { mForceDecorInstall = false; if (mDecor == null) { // å®ŒæˆDecorViewçš„å®ä¾‹åŒ– mDecor = generateDecor(-1); â€¦â€¦ } if (mContentParent == null) { // è°ƒç”¨ generateLayout æ–¹æ³• è¦è´Ÿè´£äº†DecorViewçš„åˆå§‹è®¾ç½®ï¼Œè¯¸å¦‚ä¸»é¢˜ç›¸å…³çš„featureã€DecorViewçš„èƒŒæ™¯ mContentParent = generateLayout(mDecor); } ...... } // å®ŒæˆDecorViewçš„å®ä¾‹åŒ– protected DecorView generateDecor(int featureId) { ...... return new DecorView(context, featureId, this, getAttributes()); } // è°ƒç”¨ generateLayout æ–¹æ³• è¦è´Ÿè´£äº†DecorViewçš„åˆå§‹è®¾ç½®ï¼Œ // è¯¸å¦‚ä¸»é¢˜ç›¸å…³çš„featureã€DecorViewçš„èƒŒæ™¯ï¼ŒåŒæ—¶ä¹Ÿåˆå§‹åŒ– contentParent protected ViewGroup generateLayout(DecorView decor) { ...... ViewGroup contentParent = (ViewGroup)findViewById(ID_ANDROID_CONTENT); ...... }} * mDecor æ˜¯ window çš„é¡¶çº§è§†å›¾ï¼Œå®ƒç»§æ‰¿è‡ª FrameLayoutï¼Œå®ƒçš„åˆ›å»ºè¿‡ç¨‹ç”± installDecor å®Œæˆï¼Œç„¶ååœ¨ installDecor æ–¹æ³•ä¸­é€šè¿‡ generateDecor æ–¹æ³•æ¥å®ŒæˆDecorViewçš„å®ä¾‹åŒ–* è°ƒç”¨ generateLayout æ–¹æ³• è¦è´Ÿè´£äº†DecorViewçš„åˆå§‹è®¾ç½®ï¼Œè¯¸å¦‚ä¸»é¢˜ç›¸å…³çš„featureã€DecorViewçš„èƒŒæ™¯ï¼ŒåŒæ—¶ä¹Ÿåˆå§‹åŒ– contentParent* mDecor å®ƒå®é™…ä¸Šæ˜¯ä¸€ä¸ª ViewGroupï¼Œå½“åœ¨ Activity ä¸­è°ƒç”¨ setContentView æ–¹æ³•ï¼Œé€šè¿‡è°ƒç”¨ inflater æ–¹æ³•æŠŠå¸ƒå±€èµ„æºè½¬æ¢ä¸ºä¸€ä¸ª Viewï¼Œç„¶åæ·»åŠ åˆ° DecorView çš„ mContenParnent ä¸­å½“ View åˆå§‹åŒ–å®Œæˆä¹‹åï¼Œæœ€åä¼šè¿›å…¥ ActivityThread çš„ handlerResumeActivity æ–¹æ³•ï¼Œæ‰§è¡Œäº†r.activity.makeVisible()æ–¹æ³•**frameworks/base/core/java/android/app/ActivityThread.java** public void handleResumeActivity(IBinder token, boolean finalStateRequest, boolean isForward, String reason) { â€¦â€¦ if (r.activity.mVisibleFromClient) { r.activity.makeVisible(); } ...... }æœ€ç»ˆè°ƒç”¨ Activity çš„ makeVisible æ–¹æ³•ï¼ŒæŠŠ decorView æ·»åŠ åˆ° WindowManage ä¸­**frameworks/base/core/java/android/app/Activity.java** void makeVisible() { if (!mWindowAdded) { ViewManager wm = getWindowManager(); wm.addView(mDecor, getWindow().getAttributes()); mWindowAdded = true; } mDecor.setVisibility(View.VISIBLE);} åˆ°è¿™é‡Œä»–ä»¬ä¹‹é—´çš„å…³ç³»æ˜ç¡®äº†ï¼š* ä¸€ä¸ª Activity æŒæœ‰ä¸€ä¸ª PhoneWindow çš„å¯¹è±¡ï¼Œè€Œä¸€ä¸ª PhoneWindow å¯¹è±¡æŒæœ‰ä¸€ä¸ª DecorView çš„å®ä¾‹* PhoneWindow ç»§æ‰¿è‡ª Windowï¼Œä¸€ä¸ª Window å¯¹è±¡å†…éƒ¨æŒæœ‰ mWindowManager çš„å®ä¾‹ï¼Œé€šè¿‡è°ƒç”¨ setWindowManager æ–¹æ³•ä¸ WindowManager å…³è”åœ¨ä¸€èµ·* WindowManager ç»§æ‰¿è‡ª ViewManagerï¼ŒWindowManagerImpl æ˜¯ WindowManager æ¥å£çš„å®ç°ç±»ï¼Œä½†æ˜¯å…·ä½“çš„åŠŸèƒ½éƒ½ä¼šå§”æ‰˜ç»™ WindowManagerGlobal æ¥å®ç°* è°ƒç”¨ WindowManager çš„ addView æ–¹æ³•ï¼Œå®é™…ä¸Šè°ƒç”¨çš„æ˜¯ WindowManagerImpl çš„ addView æ–¹æ³•## æ€»ç»“#### Acivity å’Œ Dialog è§†å›¾è§£æç»‘å®šè¿‡ç¨‹ï¼Ÿ* 1. è°ƒç”¨ LayoutInflater çš„ inflate æ–¹æ³•ï¼Œæ·±åº¦ä¼˜å…ˆéå†è§£æ View* 2. è°ƒç”¨ ViewGroup çš„ addView æ–¹æ³•å°†å­ View æ·»åŠ åˆ°æ ¹å¸ƒå±€ä¸­* 3. è°ƒç”¨ WindowManager çš„ addView æ–¹æ³•æ·»åŠ æ ¹å¸ƒå±€#### Activity çš„è§†å›¾å¦‚ä½•ä¸ Window å…³è”çš„ï¼Ÿ* åœ¨ Activity å†…éƒ¨ç»´æŠ¤ç€ä¸€ä¸ª Window çš„å®ä¾‹å˜é‡ mWindow**frameworks/base/core/java/android/app/Activity.java** public class Activity extends ContextThemeWrappe{ private Window mWindow;} * æœ€åè°ƒç”¨ Activity çš„ makeVisible æ–¹æ³•ï¼ŒæŠŠ decorView æ·»åŠ åˆ° WindowManage ä¸­**frameworks/base/core/java/android/app/Activity.java** void makeVisible() { if (!mWindowAdded) { ViewManager wm = getWindowManager(); wm.addView(mDecor, getWindow().getAttributes()); mWindowAdded = true; } mDecor.setVisibility(View.VISIBLE);} #### Window å¦‚ä½•ä¸ WindowManager å…³è”ï¼Ÿåœ¨ Activity çš„ attach æ–¹æ³•ä¸­ï¼Œè°ƒç”¨ PhoneWindow çš„ setWindowManager æ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•çš„å…·ä½“å®ç°å‘ç”Ÿåœ¨ Window ä¸­ï¼Œæœ€ç»ˆè°ƒç”¨çš„æ˜¯ Window çš„ setWindowManager æ–¹æ³•ï¼Œå°† Window å’Œ WindowManager å…³è”åœ¨äº†ä¸€èµ·**frameworks/base/core/java/android/view/Window.java** public void setWindowManager(WindowManager wm, IBinder appToken, String appName, boolean hardwareAccelerated) { â€¦â€¦ // mWindowManager æ˜¯ WindowManagerImplçš„å®ä¾‹å˜é‡ mWindowManager = ((WindowManagerImpl)wm).createLocalWindowManager(this);} #### Dialog çš„è§†å›¾å¦‚ä½•ä¸ Window å…³è”ï¼Ÿ* åœ¨ Dialog çš„æ„é€ æ–¹æ³•ä¸­åˆå§‹åŒ–äº† Window å¯¹è±¡ **frameworks/base/core/java/android/app/Dialog.java** Dialog(@NonNull Context context, @StyleRes int themeResId, boolean createContextThemeWrapper) { â€¦ // è·å–WindowManagerå¯¹è±¡ mWindowManager = (WindowManager) context.getSystemService(Context.WINDOW_SERVICE); // æ„å»ºPhoneWindow final Window w = new PhoneWindow(mContext); // mWindow æ˜¯PhoneWindowå®ä¾‹ mWindow = w; â€¦} * è°ƒç”¨ Dialog çš„ show æ–¹æ³•ï¼Œå®Œæˆ view çš„ç»˜åˆ¶å’Œ Dialog çš„æ˜¾ç¤º**frameworks/base/core/java/android/app/Dialog.java** public void show() { // è·å–DecorView mDecor = mWindow.getDecorView(); // è·å–å¸ƒå±€å‚æ•° WindowManager.LayoutParams l = mWindow.getAttributes(); // å°†DecorViewå’Œå¸ƒå±€å‚æ•°æ·»åŠ åˆ°WindowManagerä¸­ mWindowManager.addView(mDecor, l);} ## å‚è€ƒæ–‡çŒ® * [http://liuwangshu.cn/framework/wm/1-windowmanager.html](http://liuwangshu.cn/framework/wm/1-windowmanager.html) * [https://gudong.site/2017/05/08/activity-windown-decorview.html](https://gudong.site/2017/05/08/activity-windown-decorview.html)","link":"/2020/06/07/android10/window-manager/06-Window-WindowManager/"},{"title":"0xA05 Android 10 æºç åˆ†æï¼šDialogåŠ è½½ç»˜åˆ¶æµç¨‹ä»¥åŠåœ¨Kotlinã€DataBindingä¸­çš„ä½¿ç”¨","text":"å¼•è¨€ è¿™æ˜¯ Android 10 æºç åˆ†æç³»åˆ—çš„ç¬¬ 5 ç¯‡ åˆ†æ”¯ï¼šandroid-10.0.0_r14 å…¨æ–‡é˜…è¯»å¤§æ¦‚ 10 åˆ†é’Ÿ é€šè¿‡è¿™ç¯‡æ–‡ç« ä½ å°†å­¦ä¹ åˆ°ä»¥ä¸‹å†…å®¹ï¼Œå°†åœ¨æ–‡æœ«æ€»ç»“éƒ¨åˆ†ä¼šç»™å‡ºç›¸åº”çš„ç­”æ¡ˆ Dialogçš„çš„åˆ›å»ºæµç¨‹ï¼Ÿ Dialogçš„è§†å›¾æ€ä¹ˆä¸Windowåšå…³è”äº†ï¼Ÿ è‡ªå®šä¹‰CustomDialogçš„viewçš„æ˜¯å¦‚ä½•ç»‘å®šçš„? å¦‚ä½•ä½¿ç”¨Kotlinå…·åå¯é€‰å‚æ•°æ„é€ ç±»ï¼Œå®ç°æ„å»ºè€…æ¨¡å¼ï¼Ÿ ç›¸æ¯”äºJavaçš„æ„å»ºè€…æ¨¡å¼ï¼Œé€šè¿‡å…·åå¯é€‰å‚æ•°æ„é€ ç±»å…·æœ‰ä»¥ä¸‹ä¼˜ç‚¹? å¦‚ä½•åœ¨Dialogä¸­ä½¿ç”¨DataBindingï¼Ÿ é˜…è¯»æœ¬æ–‡ä¹‹å‰ï¼Œå¦‚æœä¹‹å‰æ²¡æœ‰çœ‹è¿‡ ApkåŠ è½½æµç¨‹ä¹‹èµ„æºåŠ è½½ä¸€ å’Œ ApkåŠ è½½æµç¨‹ä¹‹èµ„æºåŠ è½½äºŒ ç‚¹å‡»ä¸‹æ–¹é“¾æ¥å‰å»æŸ¥çœ‹ï¼Œè¿™å‡ ç¯‡æ–‡ç« éƒ½æ˜¯äº’ç›¸å…³è”çš„ 0xA03 Android 10 æºç åˆ†æï¼šApkåŠ è½½æµç¨‹ä¹‹èµ„æºåŠ è½½ï¼ˆä¸€ï¼‰ 0xA04 Android 10 æºç åˆ†æï¼šApkåŠ è½½æµç¨‹ä¹‹èµ„æºåŠ è½½ï¼ˆäºŒï¼‰ æœ¬æ–‡ä¸»è¦æ¥ä¸»è¦å›´ç»•ä»¥ä¸‹å‡ ä¸ªæ–¹é¢æ¥åˆ†æ: DialogåŠ è½½ç»˜åˆ¶æµç¨‹ å¦‚ä½•ä½¿ç”¨Kotlinå…·åå¯é€‰å‚æ•°æ„é€ ç±»ï¼Œå®ç°æ„å»ºè€…æ¨¡å¼ å¦‚ä½•åœ¨Dialogä¸­ä½¿ç”¨DataBinding æºç åˆ†æåœ¨å¼€å§‹åˆ†æDialogçš„æºç ä¹‹å‰ï¼Œéœ€è¦äº†è§£ä¸€ä¸‹DialogåŠ è½½ç»˜åˆ¶æµç¨‹ï¼Œæ¶‰åŠåˆ°çš„æ•°æ®ç»“æ„ä¸èŒèƒ½ åœ¨åŒ… android.app ä¸‹ï¼š Dialogï¼šDialogæ˜¯çª—å£çš„çˆ¶ç±»ï¼Œä¸»è¦å®ç°Windowå¯¹è±¡çš„åˆå§‹åŒ–å’Œä¸€äº›å…±æœ‰é€»è¾‘ AlertDialogï¼šç»§æ‰¿è‡ªDialogï¼Œæ˜¯å…·ä½“çš„Dialogçš„æ“ä½œå®ç°ç±» AlertDialog.Builderï¼šæ˜¯AlertDialogçš„å†…éƒ¨ç±»ï¼Œä¸»è¦ç”¨äºæ„é€ AlertDialog AlertControllerï¼šæ˜¯AlertDialogçš„æ§åˆ¶ç±» AlertController.AlertParamsï¼šæ˜¯AlertControllerçš„å†…éƒ¨ç±»ï¼Œè´Ÿè´£AlertDialogçš„åˆå§‹åŒ–å‚æ•° äº†è§£å®Œç›¸å…³çš„æ•°æ®ç»“æ„ä¸èŒèƒ½ï¼Œæ¥ä¸‹æ¥å›é¡¾ä¸€ä¸‹Dialogçš„åˆ›å»ºæµç¨‹ AlertDialog.Builder builder = new AlertDialog.Builder(this);builder.setIcon(R.mipmap.ic_launcher);builder.setMessage(&quot;Messageéƒ¨åˆ†&quot;);builder.setTitle(&quot;Titleéƒ¨åˆ†&quot;);builder.setView(R.layout.activity_main);builder.setPositiveButton(&quot;ç¡®å®š&quot;, new DialogInterface.OnClickListener() { @Override public void onClick(DialogInterface dialog, int which) { alertDialog.dismiss(); }});builder.setNegativeButton(&quot;å–æ¶ˆ&quot;, new DialogInterface.OnClickListener() { @Override public void onClick(DialogInterface dialog, int which) { alertDialog.dismiss(); }});alertDialog = builder.create();alertDialog.show(); ä¸Šé¢ä»£ç éƒ½ä¸ä¼šå¾ˆé™Œç”Ÿï¼Œä¸»è¦ä½¿ç”¨äº†è®¾è®¡æ¨¡å¼å½“ä¸­-æ„å»ºè€…æ¨¡å¼ï¼Œ æ„å»ºAlertDialog.Builderå¯¹è±¡ builder.setXXX ç³»åˆ—æ–¹æ³•å®ŒæˆDialogçš„åˆå§‹åŒ– è°ƒç”¨builder.create()æ–¹æ³•åˆ›å»ºAlertDialog è°ƒç”¨AlertDialogçš„show()å®ŒæˆViewçš„ç»˜åˆ¶å¹¶æ˜¾ç¤ºAlertDialog ä¸»è¦é€šè¿‡ä¸Šé¢å››æ­¥å®ŒæˆDialogçš„åˆ›å»ºå’Œæ˜¾ç¤ºï¼Œæ¥ä¸‹æ¥æ ¹æ®æºç æ¥åˆ†ææ¯ä¸ªæ–¹æ³•çš„å…·ä½“å®ç°ï¼Œä»¥åŠDialogçš„è§†å›¾æ€ä¹ˆä¸Windowåšå…³è” 1 æ„å»ºAlertDialog.Builderå¯¹è±¡AlertDialog.Builder builder = new AlertDialog.Builder(this); AlertDialog.Builderæ˜¯AlertDialogçš„å†…éƒ¨ç±»ï¼Œç”¨äºå°è£…AlertDialogçš„æ„é€ è¿‡ç¨‹ï¼Œçœ‹ä¸€ä¸‹Builderçš„æ„é€ æ–¹æ³•frameworks/base/core/java/android/app/AlertDialog.java // AlertController.AlertParamsç±»å‹çš„æˆå‘˜å˜é‡private final AlertController.AlertParams P;public Builder(Context context) { this(context, resolveDialogTheme(context, Resources.ID_NULL));}public Builder(Context context, int themeResId) { // æ„é€ ContextThemeWrapperï¼ŒContextThemeWrapper æ˜¯ Contextçš„å­ç±»ï¼Œä¸»è¦ç”¨æ¥å¤„ç†å’Œä¸»é¢˜ç›¸å…³çš„ // åˆå§‹åŒ–æˆä¸ºå˜é‡ P P = new AlertController.AlertParams(new ContextThemeWrapper( context, resolveDialogTheme(context, themeResId)));} ContextThemeWrapper ç»§æ‰¿è‡ªContextWrapperï¼ŒApplicationã€Serviceç»§æ‰¿è‡ªContextWrapperï¼ŒActivityç»§æ‰¿è‡ªContextThemeWrapper Pæ˜¯AlertDialog.Builderä¸­çš„AlertController.AlertParamsç±»å‹çš„æˆå‘˜å˜é‡ AlertParamsä¸­åŒ…å«äº†ä¸AlertDialogè§†å›¾ä¸­å¯¹åº”çš„æˆå‘˜å˜é‡ï¼Œè°ƒç”¨builder.setXXXç³»åˆ—æ–¹æ³•ä¹‹åï¼Œæˆ‘ä»¬ä¼ é€’çš„å‚æ•°å°±ä¿å­˜åœ¨Pä¸­äº† 1.1 AlertParamså°è£…äº†åˆå§‹åŒ–å‚æ•°AlertController.AlertParams æ˜¯AlertControllerçš„å†…éƒ¨ç±»ï¼Œè´Ÿè´£AlertDialogçš„åˆå§‹åŒ–å‚æ•°frameworks/base/core/java/com/android/internal/app/AlertController.java public AlertParams(Context context) {mContext = context;// mCancelable ç”¨æ¥æ§åˆ¶ç‚¹å‡»å¤–éƒ¨æ˜¯å¦å¯å–æ¶ˆï¼Œé»˜è®¤å¯ä»¥å–æ¶ˆmCancelable = true;// LayoutInflater ä¸»è¦æ¥è§£ælayout.xmlæ–‡ä»¶mInflater = (LayoutInflater) context.getSystemService(Context.LAYOUT_INFLATER_SERVICE);} ä¸»è¦æ‰§è¡Œäº†AlertController.AlertParamsçš„åˆå§‹åŒ–æ“ä½œï¼Œåˆå§‹åŒ–äº†ä¸€äº›æˆå‘˜å˜é‡ï¼ŒLayoutInflater ä¸»è¦æ¥è§£ælayout.xmlæ–‡ä»¶ï¼Œå…³äºLayoutInflaterå¯ä»¥å‚è€ƒä¹‹å‰çš„æ–‡ç« 0xA04 Android 10 æºç åˆ†æï¼šApkåŠ è½½æµç¨‹ä¹‹èµ„æºåŠ è½½ï¼ˆäºŒï¼‰ åˆå§‹åŒ–å®ŒæˆAlertParamsä¹‹åï¼Œå°±å®Œæˆäº†AlertDialog.Builderçš„æ„å»º 2 è°ƒç”¨AlertDialog.Builderçš„setXXXç³»åˆ—æ–¹æ³•AlertDialog.Builderåˆå§‹åŒ–å®Œæˆä¹‹åï¼Œè°ƒç”¨å®ƒçš„builder.setXXX ç³»åˆ—æ–¹æ³•å®ŒæˆDialogçš„åˆå§‹åŒ–frameworks/base/core/java/android/app/AlertDialog.java // ... çœç•¥äº†å¾ˆå¤šbuilder.setXXXæ–¹æ³•public Builder setTitle(@StringRes int titleId) { P.mTitle = P.mContext.getText(titleId); return this;}public Builder setMessage(@StringRes int messageId) { P.mMessage = P.mContext.getText(messageId); return this;}public Builder setPositiveButton(@StringRes int textId, final OnClickListener listener) { P.mPositiveButtonText = P.mContext.getText(textId); P.mPositiveButtonListener = listener; return this;}public Builder setPositiveButton(CharSequence text, final OnClickListener listener) { P.mPositiveButtonText = text; P.mPositiveButtonListener = listener; return this;}// ... çœç•¥äº†å¾ˆå¤šbuilder.setXXXæ–¹æ³• ä¸Šé¢æ‰€æœ‰setXXXæ–¹æ³•éƒ½æ˜¯ç»™Builderçš„æˆå‘˜å˜é‡Pèµ‹å€¼ï¼Œå¹¶ä¸”ä»–ä»¬çš„è¿”å›å€¼éƒ½æ˜¯Builderç±»å‹ï¼Œå› æ­¤å¯ä»¥é€šè¿‡æ¶ˆæ¯ççš„æ–¹å¼è°ƒç”¨ builder.setTitle().setMessage().setPositiveButton()... PS: åœ¨Kotlinåº”è¯¥å°½é‡é¿å…ä½¿ç”¨æ„å»ºè€…æ¨¡å¼ï¼Œä½¿ç”¨Kotlinä¸­çš„å…·åå¯é€‰å‚æ•°ï¼Œå®ç°æ„å»ºè€…æ¨¡å¼ï¼Œä»£ç æ›´åŠ ç®€æ´ï¼Œä¸ºäº†ä¸å½±å“é˜…è¯»çš„æµç•…æ€§ï¼Œå°†è¿™éƒ¨åˆ†å†…å®¹æ”¾åˆ°äº†æ–‡æœ«æ‰©å±•é˜…è¯»éƒ¨åˆ† 3 builder.createæ–¹æ³•builder.setXXX ç³»åˆ—æ–¹æ³•ä¹‹åè°ƒç”¨builder.createæ–¹æ³•å®ŒæˆAlertDialogæ„å»ºï¼Œæ¥ä¸‹æ¥çœ‹ä¸€ä¸‹createæ–¹æ³•frameworks/base/core/java/android/app/AlertDialog.java public AlertDialog create() { // P.mContext æ˜¯ContextWrappedTheme çš„å®ä¾‹ final AlertDialog dialog = new AlertDialog(P.mContext, 0, false); // Dialogçš„å‚æ•°å…¶å®ä¿å­˜åœ¨Pè¿™ä¸ªç±»é‡Œé¢ // mAleræ˜¯AlertControllerçš„å®ä¾‹ï¼Œé€šè¿‡è¿™ä¸ªæ–¹æ³•æŠŠPä¸­çš„å˜é‡ä¼ ç»™AlertController.AlertParams P.apply(dialog.mAlert); // ç”¨æ¥æ§åˆ¶ç‚¹å‡»å¤–éƒ¨æ˜¯å¦å¯å–æ¶ˆ,mCancelable é»˜è®¤ä¸ºtrue dialog.setCancelable(P.mCancelable); // å¦‚æœå¯ä»¥å–æ¶ˆè®¾ç½®å›è°ƒç›‘å¬ if (P.mCancelable) { dialog.setCanceledOnTouchOutside(true); } // è®¾ç½®ä¸€ç³»åˆ—ç›‘å¬ dialog.setOnCancelListener(P.mOnCancelListener); dialog.setOnDismissListener(P.mOnDismissListener); if (P.mOnKeyListener != null) { dialog.setOnKeyListener(P.mOnKeyListener); } // è¿”å› AlertDialog å¯¹è±¡ return dialog;} æ ¹æ®P.mContex æ„å»ºäº†ä¸€ä¸ªAlertDialog mAleræ˜¯AlertControllerçš„å®ä¾‹ï¼Œè°ƒç”¨applyæ–¹æ³•æŠŠPä¸­çš„å˜é‡ä¼ ç»™AlertController.AlertParams è®¾ç½®æ˜¯å¦å¯ä»¥ç‚¹å‡»å¤–éƒ¨å–æ¶ˆï¼Œé»˜è®¤å¯ä»¥å–æ¶ˆï¼ŒåŒæ—¶è®¾ç½®å›è°ƒç›‘å¬ æœ€åè¿”å›AlertDialogå¯¹è±¡ 3.1 å¦‚ä½•æ„å»ºAlertDialogæˆ‘ä»¬æ¥åˆ†æä¸€ä¸‹AlertDialogæ˜¯å¦‚ä½•æ„å»ºçš„ï¼Œæ¥çœ‹ä¸€ä¸‹å®ƒçš„é€ æ–¹æ³•å…·ä½“å®ç°frameworks/base/core/java/android/app/AlertDialog.java AlertDialog(Context context, @StyleRes int themeResId, boolean createContextThemeWrapper) { super(context, createContextThemeWrapper ? resolveDialogTheme(context, themeResId) : 0, createContextThemeWrapper); mWindow.alwaysReadCloseOnTouchAttr(); // getContext() è¿”å›çš„æ˜¯ContextWrapperTheme // getWindow() è¿”å›çš„æ˜¯ PhoneWindow // mAlert æ˜¯AlertControllerçš„å®ä¾‹ mAlert = AlertController.create(getContext(), this, getWindow());} PhoneWindowsæ˜¯ä»€ä¹ˆæ—¶å€™åˆ›å»ºçš„ï¼ŸAlertDialogç»§æ‰¿è‡ªDialogï¼Œé¦–å…ˆè°ƒç”¨äº†superçš„æ„é€ æ–¹æ³•ï¼Œæ¥çœ‹ä¸€ä¸‹Dialogçš„æ„é€ æ–¹æ³•frameworks/base/core/java/android/app/Dialog.java Dialog(@NonNull Context context, @StyleRes int themeResId, boolean createContextThemeWrapper) { ... // è·å–WindowManagerå¯¹è±¡ mWindowManager = (WindowManager) context.getSystemService(Context.WINDOW_SERVICE); // æ„å»ºPhoneWindow final Window w = new PhoneWindow(mContext); // mWindow æ˜¯PhoneWindowå®ä¾‹ mWindow = w; w.setCallback(this); w.setOnWindowDismissedCallback(this); w.setOnWindowSwipeDismissedCallback(() -&gt; { if (mCancelable) { cancel(); } }); w.setWindowManager(mWindowManager, null, null); w.setGravity(Gravity.CENTER); // ç»§æ‰¿ Handler mListenersHandler = new ListenersHandler(this);} è·å–WindowManagerå¯¹è±¡ï¼Œæ„å»ºäº†PhoneWindowï¼Œåˆ°è¿™é‡Œæˆ‘ä»¬çŸ¥é“äº†PhoneWindowæ˜¯åœ¨Dialogæ„é€ æ–¹æ³•åˆ›å»ºçš„ åˆå§‹åŒ–äº†Dialogçš„æˆå‘˜å˜é‡mWindowï¼ŒmWindow æ˜¯PhoneWindowçš„å®ä¾‹ åˆå§‹åŒ–äº†Dialogçš„æˆå‘˜å˜é‡mListenersHandlerï¼ŒmListenersHandlerç»§æ‰¿Handler æˆ‘ä»¬å›åˆ°AlertDialogæ„é€ æ–¹æ³•ï¼Œåœ¨AlertDialogæ„é€ æ–¹æ³•å†…ï¼Œè°ƒç”¨äº† AlertController.createæ–¹æ³•ï¼Œæ¥çœ‹ä¸€ä¸‹è¿™ä¸ªæ–¹æ³• public static final AlertController create(Context context, DialogInterface di, Window window) { final TypedArray a = context.obtainStyledAttributes( null, R.styleable.AlertDialog, R.attr.alertDialogStyle, R.style.Theme_DeviceDefault_Settings); int controllerType = a.getInt(R.styleable.AlertDialog_controllerType, 0); a.recycle(); // æ ¹æ®controllerType ä½¿ç”¨ä¸åŒçš„AlertController switch (controllerType) { case MICRO: // MicroAlertController æ˜¯matrixé£æ ¼ ç»§æ‰¿è‡ªAlertController return new MicroAlertController(context, di, window); default: return new AlertController(context, di, window); }} æ ¹æ®controllerType è¿”å›ä¸åŒçš„AlertControllerï¼Œåˆ°è¿™é‡Œåˆ†æå®Œäº†AlertDialogæ˜¯å¦‚ä½•æ„å»ºçš„ 4 è°ƒç”¨Dialogçš„showæ–¹æ³•æ˜¾ç¤ºDialogè°ƒç”¨AlertDialog.Builderçš„createæ–¹æ³•ä¹‹åè¿”å›äº†AlertDialogçš„å®ä¾‹ï¼Œæœ€åè°ƒç”¨äº†AlertDialogçš„showæ–¹æ³•æ˜¾ç¤ºdialogï¼Œä½†æ˜¯AlertDialogæ˜¯ç»§æ‰¿è‡ªDialogçš„ï¼Œå®é™…ä¸Šè°ƒç”¨çš„æ˜¯Dialogçš„showæ–¹æ³•frameworks/base/core/java/android/app/Dialog.java public void show() { // mShowingå˜é‡ç”¨äºè¡¨ç¤ºå½“å‰dialogæ˜¯å¦æ­£åœ¨æ˜¾ç¤º if (mShowing) { if (mDecor != null) { if (mWindow.hasFeature(Window.FEATURE_ACTION_BAR)) { mWindow.invalidatePanelMenu(Window.FEATURE_ACTION_BAR); } mDecor.setVisibility(View.VISIBLE); } return; } mCanceled = false; // mCreatedè¿™ä¸ªå˜é‡æ§åˆ¶dispatchOnCreateæ–¹æ³•åªè¢«æ‰§è¡Œä¸€æ¬¡ if (!mCreated) { dispatchOnCreate(null); } else { // Fill the DecorView in on any configuration changes that // may have occured while it was removed from the WindowManager. final Configuration config = mContext.getResources().getConfiguration(); mWindow.getDecorView().dispatchConfigurationChanged(config); } // ç”¨äºè®¾ç½®ActionBar onStart(); // è·å–DecorView mDecor = mWindow.getDecorView(); if (mActionBar == null &amp;&amp; mWindow.hasFeature(Window.FEATURE_ACTION_BAR)) { final ApplicationInfo info = mContext.getApplicationInfo(); mWindow.setDefaultIcon(info.icon); mWindow.setDefaultLogo(info.logo); mActionBar = new WindowDecorActionBar(this); } // è·å–å¸ƒå±€å‚æ•° WindowManager.LayoutParams l = mWindow.getAttributes(); boolean restoreSoftInputMode = false; if ((l.softInputMode &amp; WindowManager.LayoutParams.SOFT_INPUT_IS_FORWARD_NAVIGATION) == 0) { l.softInputMode |= WindowManager.LayoutParams.SOFT_INPUT_IS_FORWARD_NAVIGATION; restoreSoftInputMode = true; } // å°†DecorViewå’Œå¸ƒå±€å‚æ•°æ·»åŠ åˆ°WindowManagerä¸­ï¼Œå®Œæˆviewçš„ç»˜åˆ¶ mWindowManager.addView(mDecor, l); if (restoreSoftInputMode) { l.softInputMode &amp;= ~WindowManager.LayoutParams.SOFT_INPUT_IS_FORWARD_NAVIGATION; } mShowing = true; // å‘Handlerå‘é€ä¸€ä¸ªDialogçš„æ¶ˆæ¯ï¼Œä»è€Œæ˜¾ç¤ºAlertDialog sendShowMessage();} åˆ¤æ–­dialogæ˜¯å¦å·²ç»æ˜¾ç¤ºï¼Œå¦‚æœæ˜¾ç¤ºäº†ç›´æ¥è¿”å› åˆ¤æ–­dispatchOnCreateæ–¹æ³•æ˜¯å¦å·²ç»è°ƒç”¨ï¼Œå¦‚æœæ²¡æœ‰åˆ™è°ƒç”¨dispatchOnCreateæ–¹æ³• è·å–å¸ƒå±€å‚æ•°æ·»åŠ åˆ°WindowManagerï¼Œè°ƒç”¨addViewæ–¹æ³•å®Œæˆviewçš„ç»˜åˆ¶ å‘Handlerå‘é€ä¸€ä¸ªDialogçš„æ¶ˆæ¯ï¼Œä»è€Œæ˜¾ç¤ºAlertDialog 4.1 dispatchOnCreateåœ¨ä¸Šé¢ä»£ç ä¸­ï¼Œæ ¹æ®mCreatedå˜é‡ï¼Œåˆ¤æ–­dispatchOnCreateæ–¹æ³•æ˜¯å¦å·²ç»è°ƒç”¨ï¼Œå¦‚æœæ²¡æœ‰åˆ™è°ƒç”¨dispatchOnCreateæ–¹æ³•frameworks/base/core/java/android/app/Dialog.java void dispatchOnCreate(Bundle savedInstanceState) { if (!mCreated) { // è°ƒç”¨ onCreate æ–¹æ³• onCreate(savedInstanceState); mCreated = true; }} åœ¨dispatchOnCreateæ–¹æ³•ä¸­ä¸»è¦è°ƒç”¨Dialogçš„onCreateæ–¹æ³•, Dialogçš„onCreateæ–¹æ³•æ˜¯ä¸ªç©ºæ–¹æ³•ï¼Œç”±äºæˆ‘ä»¬åˆ›å»ºçš„æ˜¯AlertDialogå¯¹è±¡ï¼ŒAlertDialogç»§æ‰¿äºDialogï¼Œæ‰€ä»¥è°ƒç”¨çš„æ˜¯AlertDialogçš„onCreateæ–¹æ³•frameworks/base/core/java/android/app/AlertDialog.java protected void onCreate(Bundle savedInstanceState) { super.onCreate(savedInstanceState); mAlert.installContent();} åœ¨è¿™æ–¹æ³•é‡Œé¢è°ƒç”¨äº†AlertControllerçš„installContentæ–¹æ³•ï¼Œæ¥çœ‹ä¸€ä¸‹å…·ä½“çš„å®ç°é€»è¾‘frameworks/base/core/java/com/android/internal/app/AlertController.java public void installContent() { // è·å–ç›¸åº”çš„Dialogå¸ƒå±€æ–‡ä»¶ int contentView = selectContentView(); // è°ƒç”¨setContentViewæ–¹æ³•è§£æå¸ƒå±€æ–‡ä»¶ mWindow.setContentView(contentView); // åˆå§‹åŒ–å¸ƒå±€æ–‡ä»¶ä¸­çš„ç»„ä»¶ setupView();} è°ƒç”¨selectContentViewæ–¹æ³•è·å–å¸ƒå±€æ–‡ä»¶ï¼Œæ¥çœ‹ä¸€ä¸‹å…·ä½“çš„å®ç° frameworks/base/core/java/com/android/internal/app/AlertController.java* private int selectContentView() { if (mButtonPanelSideLayout == 0) { return mAlertDialogLayout; } if (mButtonPanelLayoutHint == AlertDialog.LAYOUT_HINT_SIDE) { return mButtonPanelSideLayout; } return mAlertDialogLayout;} è¿”å›çš„å¸ƒå±€æ˜¯mAlertDialogLayoutï¼Œå¸ƒå±€æ–‡ä»¶æ˜¯åœ¨AlertControllerçš„æ„é€ æ–¹æ³•åˆå§‹åŒ–çš„frameworks/base/core/java/com/android/internal/app/AlertController.java mAlertDialogLayout = a.getResourceId( R.styleable.AlertDialog_layout, R.layout.alert_dialog); è°ƒç”¨Window.setContentViewæ–¹æ³•è§£æå¸ƒå±€æ–‡ä»¶ï¼ŒActivityçš„setContentViewæœ€åä¹Ÿæ˜¯è°ƒç”¨äº†Window.setContentViewè¿™ä¸ªæ–¹æ³•ï¼Œå…·ä½“çš„è§£ææµç¨‹ï¼Œå¯ä»¥å‚è€ƒä¹‹å‰çš„æ–‡ç« Activityå¸ƒå±€åŠ è½½æµç¨‹ 0xA03 Android 10 æºç åˆ†æï¼šApkåŠ è½½æµç¨‹ä¹‹èµ„æºåŠ è½½ è°ƒç”¨setupViewæ–¹æ³•åˆå§‹åŒ–å¸ƒå±€æ–‡ä»¶ä¸­çš„ç»„ä»¶, åˆ°è¿™é‡ŒdispatchOnCreateæ–¹æ³•åˆ†æç»“æŸ 4.2 è°ƒç”¨mWindowManager.addViewå®ŒæˆViewçš„ç»˜åˆ¶å›åˆ°æˆ‘ä»¬çš„Dialogçš„showæ–¹æ³•ï¼Œåœ¨æ‰§è¡Œäº†dispatchOnCreateæ–¹æ³•ä¹‹åï¼Œåˆè°ƒç”¨äº†onStartæ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•ä¸»è¦ç”¨äºè®¾ç½®ActionBarï¼Œç„¶ååˆå§‹åŒ–WindowManager.LayoutParamså¯¹è±¡ï¼Œæœ€åè°ƒç”¨mWindowManager.addView()æ–¹æ³•å®Œæˆç•Œé¢çš„ç»˜åˆ¶ï¼Œç»˜åˆ¶å®Œæˆä¹‹åè°ƒç”¨sendShowMessageæ–¹æ³•frameworks/base/core/java/android/app/Dialog.java private void sendShowMessage() { if (mShowMessage != null) { // Obtain a new message so this dialog can be re-used Message.obtain(mShowMessage).sendToTarget(); }} å‘Handlerå‘é€ä¸€ä¸ªDialogçš„æ¶ˆæ¯ï¼Œä»è€Œæ˜¾ç¤ºAlertDialogï¼Œè¯¥æ¶ˆæ¯æœ€ç»ˆä¼šåœ¨ListenersHandlerä¸­çš„handleMessageæ–¹æ³•ä¸­è¢«æ‰§è¡Œï¼ŒListenersHandleræ˜¯Dialogçš„å†…éƒ¨ç±»ï¼Œç»§æ‰¿Handlerframeworks/base/core/java/android/app/Dialog.java public void handleMessage(Message msg) { switch (msg.what) { case DISMISS: ((OnDismissListener) msg.obj).onDismiss(mDialog.get()); break; case CANCEL: ((OnCancelListener) msg.obj).onCancel(mDialog.get()); break; case SHOW: ((OnShowListener) msg.obj).onShow(mDialog.get()); break; }} å¦‚æœmsg.what = SHOWï¼Œä¼šæ‰§è¡ŒOnShowListener.onShowæ–¹æ³•ï¼Œmsg.whatçš„å€¼å’ŒOnShowListenerè°ƒç”¨setOnShowListeneræ–¹æ³•èµ‹å€¼çš„frameworks/base/core/java/android/app/Dialog.java public void setOnShowListener(@Nullable OnShowListener listener) { if (listener != null) { mShowMessage = mListenersHandler.obtainMessage(SHOW, listener); } else { mShowMessage = null; }} mListenersHandleræ„é€ äº†Messageå¯¹è±¡ï¼Œå½“æˆ‘ä»¬åœ¨Dialogä¸­å‘é€showMessageçš„æ—¶å€™ï¼Œè¢«mListenersHandleræ‰€æ¥æ”¶ 4.3 è‡ªå®šä¹‰Dialogçš„viewçš„æ˜¯å¦‚ä½•ç»‘å®šçš„åœ¨ä¸Šæ–‡åˆ†æä¸­æ ¹æ®mCreatedå˜é‡ï¼Œåˆ¤æ–­dispatchOnCreateæ–¹æ³•æ˜¯å¦å·²ç»è°ƒç”¨ï¼Œå¦‚æœæ²¡æœ‰åˆ™è°ƒç”¨dispatchOnCreateæ–¹æ³•ï¼Œåœ¨dispatchOnCreateæ–¹æ³•ä¸­ä¸»è¦è°ƒç”¨Dialogçš„onCreateæ–¹æ³•ï¼Œç”±äºåˆ›å»ºçš„æ˜¯AlertDialogå¯¹è±¡ï¼ŒAlertDialogç»§æ‰¿äºDialogï¼Œæ‰€ä»¥å®é™…è°ƒç”¨çš„æ˜¯AlertDialogçš„onCreateæ–¹æ³•ï¼Œæ¥å®Œæˆå¸ƒå±€æ–‡ä»¶çš„è§£æï¼Œå’Œå¸ƒå±€æ–‡ä»¶ä¸­æ§ä»¶çš„åˆå§‹åŒ– åŒç†æˆ‘ä»¬è‡ªå®šä¹‰CustomDialogç»§æ‰¿è‡ªDialogï¼Œæ‰€ä»¥è°ƒç”¨çš„æ˜¯è‡ªå®šä¹‰CustomDialogçš„onCreateæ–¹æ³•ï¼Œä»£ç å¦‚ä¸‹ public class CustomDialog extends Dialog { Context mContext; // ... çœç•¥æ„é€ æ–¹æ³• @Override protected void onCreate(Bundle savedInstanceState) { super.onCreate(savedInstanceState); LayoutInflater inflater = (LayoutInflater) mContext .getSystemService(Context.LAYOUT_INFLATER_SERVICE); View view = inflater.inflate(R.layout.custom_dialog, null); setContentView(view); }} åœ¨onCreateæ–¹æ³•ä¸­è°ƒç”¨äº† Dialogçš„setContentView æ–¹æ³•, æ¥åˆ†æsetContentViewæ–¹æ³•frameworks/base/core/java/android/app/Dialog.java public void setContentView(@NonNull View view) { mWindow.setContentView(view);} mWindowæ˜¯PhoneWindowçš„å®ä¾‹ï¼Œæœ€åè°ƒç”¨çš„æ˜¯PhoneWindowçš„setContentViewè§£æå¸ƒå±€æ–‡ä»¶ï¼ŒActivityçš„setContentViewæœ€åä¹Ÿæ˜¯è°ƒç”¨äº†PhoneWindowçš„setContentViewæ–¹æ³•ï¼Œå…·ä½“çš„è§£ææµç¨‹ï¼Œå¯ä»¥å‚è€ƒä¹‹å‰çš„æ–‡ç« Activityå¸ƒå±€åŠ è½½æµç¨‹ 0xA03 Android 10 æºç åˆ†æï¼šApkåŠ è½½æµç¨‹ä¹‹èµ„æºåŠ è½½ æ€»ç»“Dialogå’ŒActivityçš„æ˜¾ç¤ºé€»è¾‘æ˜¯ç›¸ä¼¼çš„éƒ½æ˜¯å†…éƒ¨ç®¡ç†è¿™ä¸€ä¸ªWindowå¯¹è±¡ï¼Œç”¨WIndowå¯¹è±¡å®ç°ç•Œé¢çš„åŠ è½½ä¸æ˜¾ç¤ºé€»è¾‘ Dialogçš„çš„åˆ›å»ºæµç¨‹ï¼Ÿ æ„å»ºAlertDialog.Builderå¯¹è±¡ builder.setXXX ç³»åˆ—æ–¹æ³•å®ŒæˆDialogçš„åˆå§‹åŒ– è°ƒç”¨builder.create()æ–¹æ³•åˆ›å»ºAlertDialog è°ƒç”¨AlertDialogçš„show()åˆå§‹åŒ–Dialogçš„å¸ƒå±€æ–‡ä»¶ï¼ŒWindowå¯¹è±¡ç­‰ï¼Œç„¶åæ‰§è¡ŒmWindowManager.addViewæ–¹æ³•ï¼Œå¼€å§‹æ‰§è¡Œç»˜åˆ¶Viewçš„æ“ä½œï¼Œæœ€ç»ˆå°†Dialogæ˜¾ç¤ºå‡ºæ¥ Dialogçš„è§†å›¾æ€ä¹ˆä¸Windowåšå…³è”äº†ï¼Ÿ åœ¨Dialogçš„æ„é€ æ–¹æ³•ä¸­åˆå§‹åŒ–äº†Windowå¯¹è±¡ Dialog(@NonNull Context context, @StyleRes int themeResId, boolean createContextThemeWrapper) { ... // è·å–WindowManagerå¯¹è±¡ mWindowManager = (WindowManager) context.getSystemService(Context.WINDOW_SERVICE); // æ„å»ºPhoneWindow final Window w = new PhoneWindow(mContext); // mWindow æ˜¯PhoneWindowå®ä¾‹ mWindow = w; ...} è°ƒç”¨Dialogçš„showæ–¹æ³•ï¼Œå®Œæˆviewçš„ç»˜åˆ¶å’ŒDialogçš„æ˜¾ç¤º public void show() { // è·å–DecorView mDecor = mWindow.getDecorView(); // è·å–å¸ƒå±€å‚æ•° WindowManager.LayoutParams l = mWindow.getAttributes(); // å°†DecorViewå’Œå¸ƒå±€å‚æ•°æ·»åŠ åˆ°WindowManagerä¸­ mWindowManager.addView(mDecor, l);} æœ€ç»ˆä¼šé€šè¿‡WindowManagerå°†DecorViewæ·»åŠ åˆ°Windowä¹‹ä¸­ï¼Œç”¨WIndowå¯¹è±¡å®ç°ç•Œé¢çš„åŠ è½½ä¸æ˜¾ç¤ºé€»è¾‘ è‡ªå®šä¹‰CustomDialogçš„viewçš„æ˜¯å¦‚ä½•ç»‘å®šçš„? è°ƒç”¨Dialogçš„showæ–¹æ³•ï¼Œåœ¨è¯¥æ–¹æ³•å†…éƒ¨ä¼šæ ¹æ®mCreatedå˜é‡ï¼Œåˆ¤æ–­dispatchOnCreateæ–¹æ³•æ˜¯å¦å·²ç»è°ƒç”¨ï¼Œå¦‚æœæ²¡æœ‰åˆ™è°ƒç”¨dispatchOnCreateæ–¹æ³•ï¼Œåœ¨dispatchOnCreateæ–¹æ³•ä¸­ä¸»è¦è°ƒç”¨Dialogçš„onCreateæ–¹æ³• è‡ªå®šä¹‰CustomDialogç»§æ‰¿è‡ªDialogï¼Œæ‰€ä»¥è°ƒç”¨çš„æ˜¯è‡ªå®šä¹‰CustomDialogçš„onCreateæ–¹æ³•ï¼Œåœ¨CustomDialogçš„onCreateæ–¹æ³•ä¸­è°ƒç”¨setContentViewæ–¹æ³•ï¼Œæœ€åè°ƒç”¨çš„æ˜¯PhoneWindowçš„setContentViewè§£æå¸ƒå±€æ–‡ä»¶ï¼Œè§£ææµç¨‹å‚è€ƒ0xA03 Android 10 æºç åˆ†æï¼šApkåŠ è½½æµç¨‹ä¹‹èµ„æºåŠ è½½ å¦‚ä½•ä½¿ç”¨Kotlinå…·åå¯é€‰å‚æ•°æ„é€ ç±»ï¼Œå®ç°æ„å»ºè€…æ¨¡å¼ï¼Ÿ è¿™éƒ¨åˆ†å†…å®¹å‚è€ƒæ‰©å±•é˜…è¯»éƒ¨åˆ† ç›¸æ¯”äºJavaçš„æ„å»ºè€…æ¨¡å¼ï¼Œé€šè¿‡å…·åå¯é€‰å‚æ•°æ„é€ ç±»å…·æœ‰ä»¥ä¸‹ä¼˜ç‚¹? ä»£ç éå¸¸çš„ç®€æ´ æ¯ä¸ªå‚æ•°åéƒ½å¯ä»¥æ˜¾ç¤ºçš„ï¼Œå£°æ˜å¯¹è±¡æ—¶æ— é¡»æŒ‰ç…§é¡ºåºä¹¦å†™ï¼Œéå¸¸çš„çµæ´» æ„é€ å‡½æ•°ä¸­æ¯ä¸ªå‚æ•°éƒ½æ˜¯valå£°æ˜çš„ï¼Œåœ¨å¤šçº¿ç¨‹å¹¶å‘ä¸šåŠ¡åœºæ™¯ä¸­æ›´åŠ çš„å®‰å…¨ Kotlinçš„requireæ–¹æ³•ï¼Œè®©æˆ‘ä»¬åœ¨å‚æ•°çº¦æŸä¸Šæ›´åŠ çš„å‹å¥½ å¦‚ä½•åœ¨Dialogä¸­ä½¿ç”¨DataBindingï¼Ÿ è¿™éƒ¨åˆ†å†…å®¹å‚è€ƒæ‰©å±•é˜…è¯»éƒ¨åˆ† æ‰©å±•é˜…è¯»1. Kotlinå®ç°æ„å»ºè€…æ¨¡å¼åˆšæ‰åœ¨ä¸Šæ–‡ä¸­æåˆ°äº†ï¼Œåœ¨Kotlinä¸­åº”è¯¥å°½é‡é¿å…ä½¿ç”¨æ„å»ºè€…æ¨¡å¼ï¼Œä½¿ç”¨Kotlinçš„å…·åå¯é€‰å‚æ•°æ„é€ ç±»ï¼Œå®ç°æ„å»ºè€…æ¨¡å¼ï¼Œä»£ç æ›´åŠ ç®€æ´ åœ¨ â€œEffective Javaâ€ ä¹¦ä¸­ä»‹ç»æ„å»ºè€…æ¨¡å¼æ—¶ï¼Œæ˜¯è¿™æ ·å­æè¿°å®ƒçš„ï¼šæœ¬è´¨ä¸Šbuilderæ¨¡å¼æ¨¡æ‹Ÿäº†å…·åçš„å¯ç®—å‚æ•°ï¼Œå°±åƒAdaå’ŒPythonä¸­çš„ä¸€æ · å…³äºJavaç”¨æ„å»ºè€…æ¨¡å¼å®ç°è‡ªå®šä¹‰dialogï¼Œå¯ä»¥å‚è€ƒè¿™è¾¹æ–‡ç«  Builder Pattern in Javaï¼Œä»£ç æ˜¾å¾—å¾ˆé•¿â€¦â€¦..å¹¸è¿çš„æ˜¯ï¼ŒKotlinæ˜¯ä¸€é—¨æ‹¥æœ‰å…·åå¯é€‰å‚æ•°çš„å˜æˆè¯­è¨€ï¼ŒKotlinä¸­çš„å‡½æ•°å’Œæ„é€ å™¨éƒ½æ”¯æŒè¿™ä¸€ç‰¹æ€§ï¼Œæ¥ä¸‹é‡Œæˆ‘ä»¬ä½¿ç”¨å…·åå¯é€‰å‚æ•°æ„é€ ç±»ï¼Œå®ç°æ„å»ºè€…æ¨¡å¼ï¼Œç‚¹å‡»JDataBindingå‰å¾€æŸ¥çœ‹ï¼Œæ ¸å¿ƒä»£ç å¦‚ä¸‹ï¼š class AppDialog( context: Context, val title: String? = null, val message: String? = null, val yes: AppDialog.() -&gt; Unit) : DataBindingDialog(context, R.style.AppDialog) { init { requireNotNull(message) { &quot;message must be not null&quot; } } override fun onCreate(savedInstanceState: Bundle?) { super.onCreate(savedInstanceState) requestWindowFeature(Window.FEATURE_NO_TITLE) setContentView(root) display.text = message btnNo.setOnClickListener { dismiss() } btnYes.setOnClickListener { yes() } }} è°ƒç”¨æ–¹å¼ä¹Ÿæ›´åŠ çš„ç®€å• AppDialog( context = this@MainActivity, message = msg, yes = { // do something }).show() ç›¸æ¯”äºJavaçš„æ„å»ºè€…æ¨¡å¼ï¼Œé€šè¿‡å…·åå¯é€‰å‚æ•°æ„é€ ç±»å…·æœ‰ä»¥ä¸‹ä¼˜ç‚¹: ä»£ç éå¸¸çš„ç®€æ´ æ¯ä¸ªå‚æ•°åéƒ½å¯ä»¥æ˜¾ç¤ºçš„ï¼Œå£°æ˜å¯¹è±¡æ—¶æ— é¡»æŒ‰ç…§é¡ºåºä¹¦å†™ï¼Œéå¸¸çš„çµæ´» æ„é€ å‡½æ•°ä¸­æ¯ä¸ªå‚æ•°éƒ½æ˜¯valå£°æ˜çš„ï¼Œåœ¨å¤šçº¿ç¨‹å¹¶å‘ä¸šåŠ¡åœºæ™¯ä¸­æ›´åŠ çš„å®‰å…¨ Kotlinçš„requireæ–¹æ³•ï¼Œè®©æˆ‘ä»¬åœ¨å‚æ•°çº¦æŸä¸Šæ›´åŠ çš„å‹å¥½ 2. å¦‚ä½•åœ¨Dialogä¸­ä½¿ç”¨DataBindingDataBindingæ˜¯ä»€ä¹ˆï¼ŸæŸ¥çœ‹Googleå®˜ç½‘ï¼Œä¼šæœ‰æ›´è¯¦ç»†çš„ä»‹ç» DataBinding æ˜¯ Google åœ¨ Jetpack ä¸­æ¨å‡ºçš„ä¸€æ¬¾æ•°æ®ç»‘å®šçš„æ”¯æŒåº“ï¼Œåˆ©ç”¨è¯¥åº“å¯ä»¥å®ç°åœ¨é¡µé¢ç»„ä»¶ä¸­ç›´æ¥ç»‘å®šåº”ç”¨ç¨‹åºçš„æ•°æ®æº åœ¨ä½¿ç”¨Kotlinçš„å…·åå¯é€‰å‚æ•°æ„é€ ç±»å®ç°Dailogæ„å»ºè€…æ¨¡å¼çš„åŸºç¡€ä¸Šï¼Œç”¨DataBindingè¿›è¡ŒäºŒæ¬¡å°è£…ï¼ŒåŠ ä¸ŠDataBindingæ•°æ®ç»‘å®šçš„ç‰¹æ€§ï¼Œä½¿Dialogå˜å¾—æ›´åŠ ç®€æ´ã€æ˜“ç”¨ Step1: å®šä¹‰ä¸€ä¸ªåŸºç±»DataBindingDialog abstract class DataBindingDialog(@NonNull context: Context, @StyleRes themeResId: Int) : Dialog(context, themeResId) { protected inline fun &lt;reified T : ViewDataBinding&gt; binding(@LayoutRes resId: Int): Lazy&lt;T&gt; = lazy { requireNotNull( DataBindingUtil.bind&lt;T&gt;(LayoutInflater.from(context).inflate(resId, null)) ) { &quot;cannot find the matched view to layout.&quot; } }} Step2: æ”¹é€ AppDialog class AppDialog( context: Context, val title: String? = null, val message: String? = null, val yes: AppDialog.() -&gt; Unit) : DataBindingDialog(context, R.style.AppDialog) { private val mBinding: DialogAppBinding by binding(R.layout.dialog_app) init { requireNotNull(message) { &quot;message must be not null&quot; } } override fun onCreate(savedInstanceState: Bundle?) { super.onCreate(savedInstanceState) requestWindowFeature(Window.FEATURE_NO_TITLE) mBinding.apply { setContentView(root) display.text = message btnNo.setOnClickListener { dismiss() } btnYes.setOnClickListener { yes() } } }} åŒç†DataBindingåœ¨Activityã€Fragmentã€Adapterä¸­çš„ä½¿ç”¨ä¹Ÿæ˜¯ä¸€æ ·çš„ï¼Œåˆ©ç”¨Kotlinçš„inlineã€reifiedã€DSLç­‰ç­‰è¯­æ³•ï¼Œå¯ä»¥è®¾è®¡å‡ºæ›´åŠ ç®€æ´å¹¶åˆ©äºç»´æŠ¤çš„ä»£ç  å…³äºåŸºäºDataBindingå°è£…çš„DataBindingActivityã€DataBindingFragmentã€DataBindingDialogåŸºç¡€åº“ç›¸å…³ä»£ç ï¼Œåç»­ä¹Ÿä¼šé™†ç»­å®Œå–„åŸºç¡€åº“ï¼Œç‚¹å‡»JDataBindingå‰å¾€æŸ¥çœ‹ï¼Œæ¬¢è¿start","link":"/2020/06/07/android10/window-manager/05-Dialog/"},{"title":"0xA04 Android 10 æºç åˆ†æï¼šApkåŠ è½½æµç¨‹ä¹‹èµ„æºåŠ è½½ï¼ˆäºŒï¼‰","text":"å¼•è¨€ è¿™æ˜¯ Android 10 æºç åˆ†æç³»åˆ—çš„ç¬¬ 4 ç¯‡ åˆ†æ”¯ï¼šandroid-10.0.0_r14 å…¨æ–‡é˜…è¯»å¤§æ¦‚ 10 åˆ†é’Ÿ é€šè¿‡è¿™ç¯‡æ–‡ç« ä½ å°†å­¦ä¹ åˆ°ä»¥ä¸‹å†…å®¹ï¼Œå°†åœ¨æ–‡æœ«ä¼šç»™å‡ºç›¸åº”çš„ç­”æ¡ˆ View ä¸­çš„ INVISIBLEã€VISIBLEã€GONE éƒ½æœ‰ä»€ä¹ˆä½œç”¨ï¼Ÿ ä¸ºä»€ä¹ˆ ViewStub æ˜¯å¤§å°ä¸º0çš„è§†å›¾ ViewStub æœ‰ä»€ä¹ˆä½œç”¨ï¼Ÿ ViewStub æ˜¯å¦‚ä½•åˆ›å»ºçš„ï¼Ÿ ä¸ºä»€ä¹ˆ ViewStub èƒ½åšåˆ°å»¶è¿ŸåŠ è½½ï¼Ÿ ViewStub æŒ‡å®šçš„ Layout å¸ƒå±€æ–‡ä»¶æ˜¯ä»€ä¹ˆæ—¶å€™è¢«åŠ è½½çš„ï¼Ÿ LayoutInflater æ˜¯ä¸€ä¸ªæŠ½è±¡ç±»å®ƒå¦‚ä½•è¢«åˆ›å»ºçš„ï¼Ÿ ç³»ç»ŸæœåŠ¡å­˜å‚¨åœ¨å“ªé‡Œï¼Ÿå¦‚ä½•è·å–å’Œæ·»åŠ ç³»ç»ŸæœåŠ¡ï¼Ÿ åœ¨ä¸Šä¸€ç¯‡æ–‡ç«  0xA02 Android 10 æºç åˆ†æï¼šAPK åŠ è½½æµç¨‹ä¹‹èµ„æºåŠ è½½ ä¸­é€šè¿‡ LayoutInflater.inflate æ–¹æ³•è§£æ XML æ–‡ä»¶ï¼Œäº†è§£åˆ°äº†ç³»ç»Ÿå¦‚ä½•å¯¹ mergeã€include æ ‡ç­¾æ˜¯å¦‚ä½•å¤„ç†çš„ï¼Œæœ¬æ–‡ä¸»è¦å›´ç»•ä»¥ä¸‹ä¸¤æ–¹é¢å†…å®¹ ç³»ç»Ÿå¯¹ ViewStub å¦‚ä½•å¤„ç†ï¼Ÿ LayoutInflater æ˜¯å¦‚ä½•è¢«åˆ›å»ºçš„ï¼Ÿ ç³»ç»Ÿå¯¹ mergeã€include æ˜¯å¦‚ä½•å¤„ç†çš„ ä½¿ç”¨ merge æ ‡ç­¾å¿…é¡»æœ‰çˆ¶å¸ƒå±€ï¼Œä¸”ä¾èµ–äºçˆ¶å¸ƒå±€åŠ è½½ merge å¹¶ä¸æ˜¯ä¸€ä¸ª ViewGroupï¼Œä¹Ÿä¸æ˜¯ä¸€ä¸ª Viewï¼Œå®ƒç›¸å½“äºå£°æ˜äº†ä¸€äº›è§†å›¾ï¼Œç­‰å¾…è¢«æ·»åŠ ï¼Œè§£æè¿‡ç¨‹ä¸­é‡åˆ° merge æ ‡ç­¾ä¼šå°† merge æ ‡ç­¾ä¸‹é¢çš„æ‰€æœ‰å­ view æ·»åŠ åˆ°æ ¹å¸ƒå±€ä¸­ merge æ ‡ç­¾åœ¨ XML ä¸­å¿…é¡»æ˜¯æ ¹å…ƒç´  ç›¸åçš„ include ä¸èƒ½ä½œä¸ºæ ¹å…ƒç´ ï¼Œéœ€è¦æ”¾åœ¨ä¸€ä¸ª ViewGroup ä¸­ ä½¿ç”¨ include æ ‡ç­¾å¿…é¡»æŒ‡å®šæœ‰æ•ˆçš„ layout å±æ€§ ä½¿ç”¨ include æ ‡ç­¾ä¸å†™å®½é«˜æ˜¯æ²¡æœ‰å…³ç³»çš„ï¼Œä¼šå»è§£æè¢« include çš„ layout merge æ ‡ç­¾ä¸ºä»€ä¹ˆå¯ä»¥èµ·åˆ°ä¼˜åŒ–å¸ƒå±€çš„æ•ˆæœï¼Ÿ è§£æè¿‡ç¨‹ä¸­é‡åˆ° merge æ ‡ç­¾ï¼Œä¼šè°ƒç”¨ rInflate æ–¹æ³•ï¼Œéƒ¨åˆ†ä»£ç å¦‚ä¸‹ // æ ¹æ®å…ƒç´ åè§£æï¼Œç”Ÿæˆå¯¹åº”çš„viewfinal View view = createViewFromTag(parent, name, context, attrs);final ViewGroup viewGroup = (ViewGroup) parent;final ViewGroup.LayoutParams params = viewGroup.generateLayoutParams(attrs);// rInflateChildrenæ–¹æ³•å†…éƒ¨è°ƒç”¨çš„rInflateæ–¹æ³•ï¼Œæ·±åº¦ä¼˜å…ˆéå†è§£ææ‰€æœ‰çš„å­viewrInflateChildren(parser, view, attrs, true);// æ·»åŠ è§£æçš„viewviewGroup.addView(view, params); è§£æ merge æ ‡ç­¾ä¸‹é¢çš„æ‰€æœ‰å­ viewï¼Œç„¶åæ·»åŠ åˆ°æ ¹å¸ƒå±€ä¸­æ›´å¤šä¿¡æ¯æŸ¥çœ‹0xA02 Android 10 æºç åˆ†æï¼šAPK åŠ è½½æµç¨‹ä¹‹èµ„æºåŠ è½½ï¼Œæ¥ä¸‹æ¥çœ‹ä¸€ä¸‹ç³»ç»Ÿå¯¹ ViewStub å¦‚ä½•å¤„ç† 1. ViewStubæ˜¯ä»€ä¹ˆå…³äº ViewStub çš„ä»‹ç»ï¼Œå¯ä»¥ç‚¹å‡»ä¸‹æ–¹å®˜ç½‘é“¾æ¥æŸ¥çœ‹å®˜ç½‘é“¾æ¥https://developer.android.google.cn/reference/androidâ€¦ViewStub ViewStub çš„ç»§æ‰¿ç»“æ„ ç®€å•æ¥è¯´ä¸»è¦ä»¥ä¸‹å‡ ç‚¹ï¼š ViewStub æ§ä»¶æ˜¯ä¸€ä¸ªä¸å¯è§ï¼Œ å¤§å°ä¸º 0 çš„è§†å›¾ å½“ ViewStub æ§ä»¶è®¾ç½®å¯è§ï¼Œæˆ–è€…è°ƒç”¨ inflate() æ–¹æ³•ï¼ŒViewStub æ‰€æŒ‡å®šçš„ layout èµ„æºå°±ä¼šè¢«åŠ è½½ ViewStub ä¹Ÿä¼šä»å…¶çˆ¶æ§ä»¶ä¸­ç§»é™¤ï¼ŒViewStub ä¼šè¢«æ–°åŠ è½½çš„ layout æ–‡ä»¶ä»£æ›¿ ä¸ºä»€ä¹ˆ ViewStub æ˜¯å¤§å°ä¸º 0 çš„è§†å›¾frameworks/base/core/java/android/view/ViewStub.java protected void onMeasure(int widthMeasureSpec, int heightMeasureSpec) { // è®¾ç½®è§†å›¾å¤§å°ä¸º0 setMeasuredDimension(0, 0);} ViewStub çš„ä½œç”¨ ä¸»è¦ç”¨æ¥å»¶è¿Ÿå¸ƒå±€çš„åŠ è½½ï¼Œä¾‹å¦‚ï¼šåœ¨ Android ä¸­éå¸¸å¸¸è§çš„å¸ƒå±€ï¼Œç”¨ ListView æ¥å±•ç¤ºåˆ—è¡¨ä¿¡æ¯ï¼Œå½“æ²¡æœ‰æ•°æ®æˆ–è€…ç½‘ç»œåŠ è½½å¤±è´¥æ—¶, åŠ è½½ç©ºçš„ ListView ä¼šå ç”¨ä¸€äº›èµ„æºï¼Œå¦‚æœç”¨ ViewStub åŒ…è£¹ ListViewï¼Œå½“æœ‰æ•°æ®æ—¶ï¼Œæ‰ä¼šè°ƒç”¨ inflate() æ–¹æ³•æ˜¾ç¤º ListViewï¼Œèµ·åˆ°å»¶è¿ŸåŠ è½½äº†å¸ƒå±€æ•ˆæœ 1.1 ViewStub æ˜¯å¦‚ä½•è¢«åˆ›å»ºçš„åœ¨ä¸Šç¯‡æ–‡ç«  0xA02 Android 10 æºç åˆ†æï¼šAPK åŠ è½½æµç¨‹ä¹‹èµ„æºåŠ è½½ ä¸­ï¼Œä»‹ç»äº† View çš„åˆ›å»ºæ˜¯é€šè¿‡è°ƒç”¨äº† LayoutInflater.createView æ–¹æ³•æ ¹æ®å®Œæ•´çš„ç±»çš„è·¯å¾„ååˆ©ç”¨åå°„æœºåˆ¶æ„å»º View å¯¹è±¡ï¼Œå› ä¸º ViewStub æ˜¯ç»§æ‰¿ Viewï¼Œæ‰€ä»¥ ViewStub çš„åˆ›å»ºå’Œ View çš„åˆ›å»ºæ˜¯ç›¸åŒçš„ï¼Œæ¥çœ‹ä¸€ä¸‹ LayoutInflater.createView æ–¹æ³•frameworks/base/core/java/android/view/LayoutInflater.java ...try { // åˆ©ç”¨æ„é€ å‡½æ•°ï¼Œåˆ›å»ºView final View view = constructor.newInstance(args); if (view instanceof ViewStub) { // å¦‚æœæ˜¯ViewStubï¼Œåˆ™è®¾ç½®LayoutInflater final ViewStub viewStub = (ViewStub) view; viewStub.setLayoutInflater(cloneInContext((Context) args[0])); } return view;} finally { mConstructorArgs[0] = lastContext;}... æ ¹æ®å®Œæ•´çš„ç±»çš„è·¯å¾„ååˆ©ç”¨åå°„æœºåˆ¶æ„å»º View å¯¹è±¡ï¼Œå¦‚æœé‡åˆ° ViewStub å°†å½“å‰ LayoutInflater è®¾ç½®ç»™ ViewStubï¼Œå½“ ViewStub æ§ä»¶è®¾ç½®å¯è§ï¼Œæˆ–è€…è°ƒç”¨ inflate()ï¼Œä¼šè°ƒç”¨ LayoutInflater çš„ inflate æ–¹æ³•å®Œæˆå¸ƒå±€åŠ è½½ï¼Œæ¥ä¸‹æ¥åˆ†æ ViewStub çš„æ„é€ æ–¹æ³• 1.2 ViewStub çš„æ„é€ æ–¹æ³•åœ¨ä¸Šé¢æåˆ°äº†æ ¹æ®å®Œæ•´çš„ç±»çš„è·¯å¾„ååˆ©ç”¨åå°„æœºåˆ¶æ„å»º View å¯¹è±¡ï¼Œå½“ View å¯¹è±¡è¢«åˆ›å»ºçš„æ—¶å€™ï¼Œä¼šè°ƒç”¨å®ƒçš„æ„é€ å‡½æ•°ï¼Œæ¥çœ‹ä¸€ä¸‹ ViewStub çš„æ„é€ æ–¹æ³• public ViewStub(Context context, AttributeSet attrs, int defStyleAttr, int defStyleRes) { super(context); final TypedArray a = context.obtainStyledAttributes(attrs, R.styleable.ViewStub, defStyleAttr, defStyleRes); saveAttributeDataForStyleable(context, R.styleable.ViewStub, attrs, a, defStyleAttr, defStyleRes); // è§£æxmlä¸­è®¾ç½®çš„ android:inflatedId çš„å±æ€§ mInflatedId = a.getResourceId(R.styleable.ViewStub_inflatedId, NO_ID); // è§£æxmlä¸­è®¾ç½®çš„ android:layout å±æ€§ mLayoutResource = a.getResourceId(R.styleable.ViewStub_layout, 0); // è§£æxmlä¸­è®¾ç½®çš„ android:id å±æ€§ mID = a.getResourceId(R.styleable.ViewStub_id, NO_ID); a.recycle(); // viewä¸å¯è§ setVisibility(GONE); // ä¸ä¼šè°ƒç”¨ onDraw æ–¹æ³•ç»˜åˆ¶å†…å®¹ setWillNotDraw(true);} è·å– android:inflatedIdã€android:layoutã€android:id çš„å€¼ è°ƒç”¨ setVisibility æ–¹æ³•ï¼Œè®¾ç½® View ä¸å¯è§ è°ƒç”¨ setWillNotDraw æ–¹æ³•ï¼Œä¸ä¼šè°ƒç”¨ onDraw æ–¹æ³•ç»˜åˆ¶å†…å®¹ åœ¨ä¸Šé¢æåˆ°äº†å¦‚æœæƒ³è¦åŠ è½½ ViewStub æ‰€æŒ‡å®šçš„ layout èµ„æºï¼Œéœ€è¦è®¾ç½® ViewStub æ§ä»¶è®¾ç½®å¯è§ï¼Œæˆ–è€…è°ƒç”¨ inflate() æ–¹æ³•ï¼Œæ¥çœ‹ä¸€ä¸‹ ViewStub çš„ setVisibility æ–¹æ³• 1.3 ViewStub çš„ setVisibility æ–¹æ³•setVisibility(int visibility) æ–¹æ³•ï¼Œå‚æ•° visibility å¯¹åº”ä¸‰ä¸ªå€¼åˆ†åˆ«æ˜¯ INVISIBLEã€VISIBLEã€GONE VISIBLEï¼šè§†å›¾å¯è§ INVISIBLEï¼šè§†å›¾ä¸å¯è§çš„ï¼Œå®ƒä»ç„¶å ç”¨å¸ƒå±€çš„ç©ºé—´ GONEï¼šè§†å›¾ä¸å¯è§ï¼Œå®ƒä¸å ç”¨å¸ƒå±€çš„ç©ºé—´ æ¥ä¸‹é‡ŒæŸ¥çœ‹ä¸€ä¸‹ ViewStub çš„ setVisibility æ–¹æ³•frameworks/base/core/java/android/view/ViewStub.java @Overridepublic void setVisibility(int visibility) { if (mInflatedViewRef != null) { // mInflatedViewRef æ˜¯ WeakReferenceçš„å®ä¾‹ï¼Œè°ƒç”¨inflateæ–¹æ³•æ—¶å€™åˆå§‹åŒ– View view = mInflatedViewRef.get(); if (view != null) { // è®¾ç½®Viewå¯è§ view.setVisibility(visibility); } else { throw new IllegalStateException(&quot;setVisibility called on un-referenced view&quot;); } } else { super.setVisibility(visibility); // å½“Viewä¸ºç©ºä¸”è®¾ç½®è§†å›¾å¯è§(VISIBLEã€INVISIBLE)ï¼Œè°ƒç”¨inflateæ–¹æ³• if (visibility == VISIBLE || visibility == INVISIBLE) { inflate(); } }} mInflatedViewRef æ˜¯ WeakReference çš„å®ä¾‹ï¼Œè°ƒç”¨ inflate æ–¹æ³•æ—¶å€™åˆå§‹åŒ– ä» mInflatedViewRef ç¼“å­˜ä¸­è·å– Viewï¼Œå¹¶ä¸”è®¾ç½® View å¯è§ å½“ View ä¸ºç©ºä¸”è®¾ç½®è§†å›¾å¯è§(VISIBLEã€INVISIBLE)ï¼Œä¼šè°ƒç”¨ inflateæ–¹æ³• 1.4 ViewStub.inflate æ–¹æ³•è°ƒç”¨äº† ViewStub çš„ setVisibility æ–¹æ³•ï¼Œæœ€åéƒ½ä¼šè°ƒç”¨ ViewStub.inflate æ–¹æ³•ï¼Œæ¥æŸ¥çœ‹ä¸€ä¸‹frameworks/base/core/java/android/view/ViewStub.java public View inflate() { final ViewParent viewParent = getParent(); if (viewParent != null &amp;&amp; viewParent instanceof ViewGroup) { if (mLayoutResource != 0) { final ViewGroup parent = (ViewGroup) viewParent; // è§£æå¸ƒå±€è§†å›¾ // è¿”å›çš„viewæ˜¯android:layoutæŒ‡å®šçš„å¸ƒå±€æ–‡ä»¶æœ€é¡¶å±‚çš„view final View view = inflateViewNoAdd(parent); // ç§»é™¤ViewStub // æ·»åŠ viewåˆ°è¢«ç§»é™¤çš„ViewStubçš„ä½ç½® replaceSelfWithView(view, parent); // æ·»åŠ viewåˆ° mInflatedViewRef ä¸­ mInflatedViewRef = new WeakReference&lt;&gt;(view); if (mInflateListener != null) { // åŠ è½½å®Œæˆä¹‹åï¼Œå›è°ƒonInflate æ–¹æ³• mInflateListener.onInflate(this, view); } return view; } else { // éœ€è¦åœ¨xmlä¸­è®¾ç½®android:layoutï¼Œä¸æ˜¯layoutï¼Œå¦åˆ™ä¼šæŠ›å‡ºå¼‚å¸¸ throw new IllegalArgumentException(&quot;ViewStub must have a valid layoutResource&quot;); } } else { // ViewStubä¸èƒ½ä½œä¸ºæ ¹å¸ƒå±€ï¼Œå®ƒéœ€è¦æ”¾åœ¨ViewGroupä¸­, å¦åˆ™ä¼šæŠ›å‡ºå¼‚å¸¸ throw new IllegalStateException(&quot;ViewStub must have a non-null ViewGroup viewParent&quot;); }} è°ƒç”¨ inflateViewNoAdd æ–¹æ³•è¿”å› android:layout æŒ‡å®šçš„å¸ƒå±€æ–‡ä»¶æœ€é¡¶å±‚çš„ View è°ƒç”¨ replaceSelfWithView æ–¹æ³•, ç§»é™¤ ViewStub, æ·»åŠ  View åˆ°è¢«ç§»é™¤çš„ ViewStub çš„ä½ç½® æ·»åŠ  View åˆ° mInflatedViewRef ä¸­ åŠ è½½å®Œæˆä¹‹åï¼Œå›è°ƒ onInflate æ–¹æ³• éœ€è¦æ³¨æ„ä»¥ä¸‹ä¸¤ç‚¹ï¼š ä½¿ç”¨ ViewStub éœ€è¦åœ¨ XML ä¸­è®¾ç½® android:layoutï¼Œä¸æ˜¯ layoutï¼Œå¦åˆ™ä¼šæŠ›å‡ºå¼‚å¸¸ ViewStub ä¸èƒ½ä½œä¸ºæ ¹å¸ƒå±€ï¼Œå®ƒéœ€è¦æ”¾åœ¨ ViewGroup ä¸­, å¦åˆ™ä¼šæŠ›å‡ºå¼‚å¸¸ æ¥æŸ¥çœ‹ä¸€ä¸‹ inflateViewNoAdd æ–¹æ³•å’Œ replaceSelfWithView æ–¹æ³• 1.5 ViewStub.inflateViewNoAdd æ–¹æ³•è°ƒç”¨ inflateViewNoAdd æ–¹æ³•è¿”å› android:layout æŒ‡å®šçš„å¸ƒå±€æ–‡ä»¶æœ€é¡¶å±‚çš„ Viewframeworks/base/core/java/android/view/ViewStub.java private View inflateViewNoAdd(ViewGroup parent) { final LayoutInflater factory; // mInflater æ˜¯Viewè¢«åˆ›å»ºçš„æ—¶å€™ï¼Œå¦‚æœæ˜¯ViewStub, å°†LayoutInflaterèµ‹å€¼ç»™mInflater if (mInflater != null) { factory = mInflater; } else { // å¦‚æœmInflaterä¸ºç©ºï¼Œåˆ™åˆ›å»ºLayoutInflater factory = LayoutInflater.from(mContext); } // ä»æŒ‡å®šçš„ mLayoutResource èµ„æºä¸­è§£æå¸ƒå±€è§†å›¾ // mLayoutResource æ˜¯åœ¨xmlè®¾ç½®çš„ Android:layout æŒ‡å®šçš„å¸ƒå±€æ–‡ä»¶ final View view = factory.inflate(mLayoutResource, parent, false); // mInflatedId æ˜¯åœ¨xmlè®¾ç½®çš„ inflateId if (mInflatedId != NO_ID) { // å°†idå¤åˆ¶ç»™view view.setId(mInflatedId); //æ³¨æ„ï¼šå¦‚æœæŒ‡å®šäº†mInflatedId , è¢«inflateçš„layoutViewçš„idå°±æ˜¯mInflatedId } return view;} mInflater æ˜¯ View è¢«åˆ›å»ºçš„æ—¶å€™ï¼Œå¦‚æœæ˜¯ ViewStub, å°† LayoutInflater èµ‹å€¼ç»™ mInflater å¦‚æœ mInflater ä¸ºç©ºåˆ™é€šè¿‡ LayoutInflater.from(mContext) æ„å»º LayoutInflater è°ƒç”¨ LayoutInflater çš„ inflate æ–¹æ³•è§£æå¸ƒå±€è§†å›¾ å°† mInflatedId è®¾ç½® View 1.6 ViewStub.replaceSelfWithView æ–¹æ³•è°ƒç”¨ replaceSelfWithView æ–¹æ³•, ç§»é™¤ ViewStub, æ·»åŠ  View åˆ°è¢«ç§»é™¤çš„ ViewStub çš„ä½ç½®frameworks/base/core/java/android/view/ViewStub.java private void replaceSelfWithView(View view, ViewGroup parent) { // è·å–ViewStubåœ¨è§†å›¾ä¸­çš„ä½ç½® final int index = parent.indexOfChild(this); // ç§»é™¤ViewStub // æ³¨æ„ï¼šè°ƒç”¨removeViewInLayoutæ–¹æ³•ä¹‹åï¼Œè°ƒç”¨findViewById()æ˜¯æ‰¾ä¸åˆ°è¯¥ViewStubå¯¹è±¡ parent.removeViewInLayout(this); final ViewGroup.LayoutParams layoutParams = getLayoutParams(); // å°†xmlä¸­æŒ‡å®šçš„ android:layout å¸ƒå±€æ–‡ä»¶ä¸­æœ€é¡¶å±‚çš„Viewï¼Œæ·»åŠ åˆ°è¢«ç§»é™¤çš„ ViewStubçš„ä½ç½® if (layoutParams != null) { parent.addView(view, index, layoutParams); } else { parent.addView(view, index); }} è·å– ViewStub åœ¨è§†å›¾ä¸­çš„ä½ç½®ï¼Œç„¶åç§»é™¤ ViewStub æ·»åŠ  android:layout å¸ƒå±€æ–‡ä»¶ä¸­æœ€é¡¶å±‚çš„ View åˆ°è¢«ç§»é™¤çš„ ViewStub çš„ä½ç½® 1.7 ViewStub çš„æ³¨æ„äº‹é¡¹ ä½¿ç”¨ ViewStub éœ€è¦åœ¨ XML ä¸­è®¾ç½® android:layoutï¼Œä¸æ˜¯ layoutï¼Œå¦åˆ™ä¼šæŠ›å‡ºå¼‚å¸¸ throw new IllegalArgumentException(&quot;ViewStub must have a valid layoutResource&quot;); ViewStub ä¸èƒ½ä½œä¸ºæ ¹å¸ƒå±€ï¼Œå®ƒéœ€è¦æ”¾åœ¨ ViewGroup ä¸­, å¦åˆ™ä¼šæŠ›å‡ºå¼‚å¸¸ throw new IllegalStateException(&quot;ViewStub must have a non-null ViewGroup viewParent&quot;); ä¸€æ—¦è°ƒç”¨ setVisibility(View.VISIBLE) æˆ–è€… inflate() æ–¹æ³•ä¹‹åï¼Œè¯¥ ViewStub å°†ä¼šä»è¯•å›¾ä¸­è¢«ç§»é™¤ï¼ˆæ­¤æ—¶è°ƒç”¨ findViewById() æ˜¯æ‰¾ä¸åˆ°è¯¥ ViewStub å¯¹è±¡). // è·å–ViewStubåœ¨è§†å›¾ä¸­çš„ä½ç½®final int index = parent.indexOfChild(this);// ç§»é™¤ViewStub// æ³¨æ„ï¼šè°ƒç”¨removeViewInLayoutæ–¹æ³•ä¹‹åï¼Œè°ƒç”¨findViewById()æ˜¯æ‰¾ä¸åˆ°è¯¥ViewStubå¯¹è±¡parent.removeViewInLayout(this); å¦‚æœæŒ‡å®šäº† mInflatedId , è¢« inflate çš„ layoutView çš„ id å°±æ˜¯ mInflatedId // mInflatedId æ˜¯åœ¨xmlè®¾ç½®çš„ inflateIdif (mInflatedId != NO_ID) { // å°†idå¤åˆ¶ç»™view view.setId(mInflatedId); //æ³¨æ„ï¼šå¦‚æœæŒ‡å®šäº†mInflatedId , è¢«inflateçš„layoutViewçš„idå°±æ˜¯mInflatedId} è¢« inflate çš„ layoutView çš„ layoutParams ä¸ ViewStub çš„ layoutParams ç›¸åŒ. final ViewGroup.LayoutParams layoutParams = getLayoutParams();// å°†xmlä¸­æŒ‡å®šçš„ android:layout å¸ƒå±€æ–‡ä»¶ä¸­æœ€é¡¶å±‚çš„View ä¹Ÿå°±æ˜¯æ ¹viewï¼Œ// æ·»åŠ åˆ°è¢«ç§»é™¤çš„ ViewStubçš„ä½ç½®if (layoutParams != null) { parent.addView(view, index, layoutParams);} else { parent.addView(view, index);} åˆ°è¿™é‡Œå…³äº ViewStub çš„æ„å»ºã€å¸ƒå±€çš„åŠ è½½ä»¥åŠæ³¨æ„äº‹é¡¹åˆ†æå®Œäº†ï¼Œæ¥ä¸‹æ¥åˆ†æä¸€ä¸‹ LayoutInflater æ˜¯å¦‚ä½•è¢«åˆ›å»ºçš„ 2 å…³äºLayoutInflateråœ¨ 0xA02 Android 10 æºç åˆ†æï¼šAPK åŠ è½½æµç¨‹ä¹‹èµ„æºåŠ è½½ æ–‡ç« ä¸­ï¼Œä»‹ç»äº† Activity å¯åŠ¨çš„æ—¶å€™é€šè¿‡è°ƒç”¨ LayoutInflater çš„ inflater çš„æ–¹æ³•åŠ è½½ layout æ–‡ä»¶ï¼Œé‚£ä¹ˆ LayoutInflater æ˜¯å¦‚ä½•è¢«åˆ›å»ºçš„å‘¢ï¼Œå…ˆæ¥çœ‹ä¸€æ®µä»£ç ï¼Œç›¸ä¿¡ä¸‹é¢çš„ä»£ç éƒ½ä¸ä¼šå¾ˆé™Œç”Ÿ public RecyclerView.ViewHolder onCreateViewHolder(@NonNull ViewGroup viewGroup, int i) { return new AllVh(LayoutInflater .from(viewGroup.getContext()) .inflate(R.layout.list_item, viewGroup, false));} LayoutInflaterçš„inflateæ–¹æ³•çš„ä¸‰ä¸ªå‚æ•°éƒ½ä»£è¡¨ä»€ä¹ˆæ„æ€ï¼Ÿ resourceï¼šè¦è§£æçš„ XML å¸ƒå±€æ–‡ä»¶ Id rootï¼šè¡¨ç¤ºæ ¹å¸ƒå±€ attachToRootï¼šæ˜¯å¦è¦æ·»åŠ åˆ°çˆ¶å¸ƒå±€ rootä¸­ resource å…¶å®å¾ˆå¥½ç†è§£å°±æ˜¯èµ„æº Idï¼Œè€Œ root å’Œ attachToRoot åˆ†åˆ«ä»£è¡¨ä»€ä¹ˆæ„æ€ï¼š å½“ attachToRoot == true ä¸” root ï¼= null æ—¶ï¼Œæ–°è§£æå‡ºæ¥çš„ View ä¼šè¢« add åˆ° root ä¸­å»ï¼Œç„¶åå°† root ä½œä¸ºç»“æœè¿”å› å½“ attachToRoot == false ä¸” root ï¼= null æ—¶ï¼Œæ–°è§£æçš„ View ä¼šç›´æ¥ä½œä¸ºç»“æœè¿”å›ï¼Œè€Œä¸” root ä¼šä¸ºæ–°è§£æçš„ View ç”Ÿæˆ LayoutParams å¹¶è®¾ç½®åˆ°è¯¥Viewä¸­å» å½“ attachToRoot == false ä¸” root == null æ—¶ï¼Œæ–°è§£æçš„ View ä¼šç›´æ¥ä½œä¸ºç»“æœè¿”å› 2.1 LayoutInflater æ˜¯å¦‚ä½•è¢«åˆ›å»ºçš„LayoutInflater æ˜¯ä¸€ä¸ªæŠ½è±¡ç±»ï¼Œé€šè¿‡è°ƒç”¨äº† from() çš„é™æ€å‡½æ•°ï¼Œç»ç”±ç³»ç»ŸæœåŠ¡ LAYOUT_INFLATER_SERVICEï¼Œæœ€ç»ˆåˆ›å»ºäº†ä¸€ä¸ª LayoutInflater çš„å­ç±»å¯¹è±¡ PhoneLayoutInflaterï¼Œç»§æ‰¿ç»“æ„å¦‚ä¸‹ï¼š LayoutInflater.from(ctx) å°±æ˜¯æ ¹æ®ä¼ é€’è¿‡æ¥çš„ Context å¯¹è±¡ï¼Œè°ƒç”¨ getSystemService() æ¥è·å–å¯¹åº”çš„ç³»ç»ŸæœåŠ¡, æ¥çœ‹ä¸€ä¸‹è¿™ä¸ªæ–¹æ³•frameworks/base/core/java/android/view/LayoutInflater.java public static LayoutInflater from(Context context) { // è·å–ç³»ç»ŸæœåŠ¡ LAYOUT_INFLATER_SERVICE ï¼Œå¹¶èµ‹å€¼ç»™ LayoutInflater // Context æ˜¯ä¸€ä¸ªæŠ½è±¡ç±»ï¼ŒçœŸæ­£çš„å®ç°ç±»æ˜¯ContextImpl LayoutInflater LayoutInflater = (LayoutInflater) context.getSystemService(Context.LAYOUT_INFLATER_SERVICE); if (LayoutInflater == null) { throw new AssertionError(&quot;LayoutInflater not found.&quot;); } return LayoutInflater;} è€Œ Context æœ¬èº«æ˜¯ä¸€ä¸ªæŠ½è±¡ç±»ï¼Œå®ƒçœŸæ­£çš„å®ä¾‹åŒ–å¯¹è±¡æ˜¯ ContextImplframeworks/base/core/java/android/app/ContextImpl.java public Object getSystemService(String name) { // SystemServiceRegistry æ˜¯ç®¡ç†ç³»ç»ŸæœåŠ¡çš„ // è°ƒç”¨getSystemServiceæ–¹æ³•ï¼Œé€šè¿‡æœåŠ¡åå­—æŸ¥æ‰¾å¯¹åº”çš„æœåŠ¡ return SystemServiceRegistry.getSystemService(this, name);} 2.2 SystemServiceRegistrySystemServiceRegistry ç®¡ç†æ‰€æœ‰çš„ç³»ç»ŸæœåŠ¡ï¼Œè°ƒç”¨ getSystemService æ–¹æ³•ï¼Œé€šè¿‡æœåŠ¡åå­—æŸ¥æ‰¾å¯¹åº”çš„æœåŠ¡frameworks/base/core/java/android/app/SystemServiceRegistry.java public static Object getSystemService(ContextImpl ctx, String name) { // SYSTEM_SERVICE_FETCHERS æ˜¯ä¸€ä¸ªmapé›†åˆ // ä» map é›†åˆä¸­å–å‡ºç³»ç»ŸæœåŠ¡ ServiceFetcher&lt;?&gt; fetcher = SYSTEM_SERVICE_FETCHERS.get(name); return fetcher != null ? fetcher.getService(ctx) : null;} ServiceFetcher ä¸º SystemServiceRegistry ç±»çš„é™æ€å†…éƒ¨æ¥å£ï¼Œå®šä¹‰äº† getService æ–¹æ³• ServiceFetcher çš„å®ç°ç±» CachedServiceFetcher å®ç°äº† getServiceæ–¹æ³• æ‰€æœ‰çš„ç³»ç»ŸæœåŠ¡éƒ½å­˜å‚¨åœ¨ä¸€ä¸ª map é›†åˆ SYSTEM_SERVICE_FETCHERSå½“ ä¸­ï¼Œè°ƒç”¨ get æ–¹æ³•æ¥è·å–å¯¹åº”çš„æœåŠ¡ å¦‚æœæœ‰ getSystemService æ–¹æ³•æ¥è·å–æœåŠ¡ï¼Œé‚£ä¹ˆç›¸åº”çš„ä¹Ÿä¼šæœ‰æ·»åŠ æœåŠ¡çš„æ–¹æ³•frameworks/base/core/java/android/app/SystemServiceRegistry.java private static &lt;T&gt; void registerService(String serviceName, Class&lt;T&gt; serviceClass, ServiceFetcher&lt;T&gt; serviceFetcher) { SYSTEM_SERVICE_NAMES.put(serviceClass, serviceName); SYSTEM_SERVICE_FETCHERS.put(serviceName, serviceFetcher);} é€šè¿‡è°ƒç”¨ SYSTEM_SERVICE_NAMES çš„ put æ–¹æ³•ï¼Œå¾€ map é›†åˆä¸­æ·»åŠ æ•°æ®ï¼Œé‚£ä¹ˆ registerService æ˜¯ä»€ä¹ˆæ—¶å€™è°ƒç”¨çš„ï¼Œåœ¨ SystemServiceRegistry ç±»ä¸­æœç´¢ registerService æ–¹æ³•ï¼ŒçŸ¥é“äº†åœ¨ç±»åŠ è½½çš„æ—¶å€™é€šè¿‡é™æ€ä»£ç å—ä¸­æ·»åŠ çš„ï¼Œæ¥çœ‹ä¸€ä¸‹ static { // åˆå§‹åŒ–åŠ è½½æ‰€æœ‰çš„ç³»ç»ŸæœåŠ¡ ... // çœç•¥äº†å¾ˆå¤šç³»ç»ŸæœåŠ¡ registerService(Context.LAYOUT_INFLATER_SERVICE, LayoutInflater.class, new CachedServiceFetcher&lt;LayoutInflater&gt;() { @Override public LayoutInflater createService(ContextImpl ctx) { return new PhoneLayoutInflater(ctx.getOuterContext()); }}); ... // çœç•¥äº†å¾ˆå¤šç³»ç»ŸæœåŠ¡} æœ€ç»ˆæ˜¯åˆ›å»ºäº†ä¸€ä¸ª PhoneLayoutInflater å¹¶è¿”å›çš„ï¼Œåˆ°è¿™é‡Œ LayoutInflater çš„åˆ›å»ºæµç¨‹å°±åˆ†æå®Œäº† æ€»ç»“View ä¸­çš„ INVISIBLEã€VISIBLEã€GONE éƒ½æœ‰ä»€ä¹ˆä½œç”¨ï¼Ÿ å¦‚æœæƒ³éšè—æˆ–è€…æ˜¾ç¤º Viewï¼Œå¯ä»¥é€šè¿‡è°ƒç”¨ setVisibility(int visibility) æ–¹æ³•æ¥å®ç°ï¼Œå‚æ•° visibility å¯¹åº”ä¸‰ä¸ªå€¼åˆ†åˆ«æ˜¯INVISIBLEã€VISIBLEã€GONE VISIBLEï¼šè§†å›¾å¯è§ INVISIBLEï¼šè§†å›¾ä¸å¯è§çš„ï¼Œå®ƒä»ç„¶å ç”¨å¸ƒå±€çš„ç©ºé—´ GONEï¼šè§†å›¾ä¸å¯è§ï¼Œå®ƒä¸å ç”¨å¸ƒå±€çš„ç©ºé—´ ä¸ºä»€ä¹ˆ ViewStub æ˜¯å¤§å°ä¸º0çš„è§†å›¾ï¼Ÿframeworks/base/core/java/android/view/ViewStub.java protected void onMeasure(int widthMeasureSpec, int heightMeasureSpec) { // è®¾ç½®è§†å›¾å¤§å°ä¸º0 setMeasuredDimension(0, 0);} ViewStub æœ‰ä»€ä¹ˆä½œç”¨ï¼Ÿ ViewStub çš„ä½œç”¨ä¸»è¦ç”¨æ¥å»¶è¿Ÿå¸ƒå±€çš„åŠ è½½ ViewStub æ˜¯å¦‚ä½•åˆ›å»ºçš„ï¼Ÿ å› ä¸º ViewStub æ˜¯ç»§æ‰¿ View, æ‰€ä»¥ ViewStub çš„åˆ›å»ºå’Œ View çš„åˆ›å»ºæ˜¯ç›¸åŒçš„ï¼Œé€šè¿‡è°ƒç”¨äº† LayoutInflater.createView æ–¹æ³•æ ¹æ®å®Œæ•´çš„ç±»çš„è·¯å¾„ååˆ©ç”¨åå°„æœºåˆ¶æ„å»º View å¯¹è±¡frameworks/base/core/java/android/view/LayoutInflater.java ...try { // åˆ©ç”¨æ„é€ å‡½æ•°ï¼Œåˆ›å»ºView final View view = constructor.newInstance(args); if (view instanceof ViewStub) { // å¦‚æœæ˜¯ViewStubï¼Œåˆ™è®¾ç½®LayoutInflater final ViewStub viewStub = (ViewStub) view; viewStub.setLayoutInflater(cloneInContext((Context) args[0])); } return view;} finally { mConstructorArgs[0] = lastContext;}... ä¸ºä»€ä¹ˆ ViewStub èƒ½åšåˆ°å»¶è¿ŸåŠ è½½ï¼Ÿ å› ä¸ºåœ¨è§£æ layout æ–‡ä»¶è¿‡ç¨‹ä¸­é‡åˆ° ViewStubï¼Œåªæ˜¯æ„å»º ViewStub çš„å¯¹è±¡å’Œåˆå§‹åŒ– ViewStub çš„å±æ€§ï¼Œæ²¡æœ‰çœŸæ­£å¼€å§‹è§£æ Viewï¼Œæ‰€ä»¥å¯ä»¥åšåˆ°å»¶è¿Ÿåˆå§‹åŒ– ViewStub æŒ‡å®šçš„ Layout å¸ƒå±€æ–‡ä»¶æ˜¯ä»€ä¹ˆæ—¶å€™è¢«åŠ è½½çš„ï¼Ÿ å½“ViewStub æ§ä»¶è®¾ç½®å¯è§ï¼Œæˆ–è€…è°ƒç”¨ inflate() æ–¹æ³•ï¼ŒViewStub æ‰€æŒ‡å®šçš„ layout èµ„æºå°±ä¼šè¢«åŠ è½½ LayoutInflater æ˜¯ä¸€ä¸ªæŠ½è±¡ç±»å®ƒå¦‚ä½•è¢«åˆ›å»ºçš„ï¼Ÿ LayoutInflater æ˜¯ä¸€ä¸ªæŠ½è±¡ç±»ï¼Œé€šè¿‡è°ƒç”¨äº† from() çš„é™æ€å‡½æ•°ï¼Œç»ç”±ç³»ç»ŸæœåŠ¡ LAYOUT_INFLATER_SERVICEï¼Œæœ€ç»ˆåˆ›å»ºäº†ä¸€ä¸ª LayoutInflaterçš„å­ç±»å¯¹è±¡ PhoneLayoutInflaterï¼Œç»§æ‰¿ç»“æ„å¦‚ä¸‹ï¼š LayoutInflater.from(ctx) å°±æ˜¯æ ¹æ®ä¼ é€’è¿‡æ¥çš„ Context å¯¹è±¡ï¼Œè°ƒç”¨ getSystemService() æ¥è·å–å¯¹åº”çš„ç³»ç»ŸæœåŠ¡ ç³»ç»ŸæœåŠ¡å­˜å‚¨åœ¨å“ªé‡Œï¼Ÿå¦‚ä½•è·å–å’Œæ·»åŠ ç³»ç»ŸæœåŠ¡ï¼Ÿ SystemServiceRegistry ç®¡ç†æ‰€æœ‰çš„ç³»ç»ŸæœåŠ¡ï¼Œæ‰€æœ‰çš„ç³»ç»ŸæœåŠ¡éƒ½å­˜å‚¨åœ¨ä¸€ ä¸ªmapé›†åˆSYSTEM_SERVICE_FETCHERS å½“ä¸­ï¼Œè°ƒç”¨ getSystemService æ–¹æ³•è·å–ç³»ç»ŸæœåŠ¡ï¼Œè°ƒç”¨ registerService æ–¹æ³•æ·»åŠ ç³»ç»ŸæœåŠ¡","link":"/2020/06/07/android10/resource-manager/04-APK-resource2/"},{"title":"0xA03 Android 10 æºç åˆ†æï¼šAPK åŠ è½½æµç¨‹ä¹‹èµ„æºåŠ è½½","text":"å¼•è¨€ è¿™æ˜¯ Android 10 æºç åˆ†æç³»åˆ—çš„ç¬¬ 3 ç¯‡ åˆ†æ”¯ï¼šandroid-10.0.0_r14 å…¨æ–‡é˜…è¯»å¤§æ¦‚ 15 åˆ†é’Ÿ é€šè¿‡è¿™ç¯‡æ–‡ç« ä½ å°†å­¦ä¹ åˆ°ä»¥ä¸‹å†…å®¹ï¼Œæ–‡æœ«ä¼šç»™å‡ºç›¸åº”çš„ç­”æ¡ˆ LayoutInflaterçš„inflate æ–¹æ³•çš„ä¸‰ä¸ªå‚æ•°éƒ½ä»£è¡¨ä»€ä¹ˆæ„æ€ï¼Ÿ ç³»ç»Ÿå¯¹ mergeã€include æ˜¯å¦‚ä½•å¤„ç†çš„ merge æ ‡ç­¾ä¸ºä»€ä¹ˆå¯ä»¥èµ·åˆ°ä¼˜åŒ–å¸ƒå±€çš„æ•ˆæœï¼Ÿ XML ä¸­çš„ View æ˜¯å¦‚ä½•è¢«å®ä¾‹åŒ–çš„ï¼Ÿ ä¸ºä»€ä¹ˆå¤æ‚å¸ƒå±€ä¼šäº§ç”Ÿå¡é¡¿ï¼Ÿåœ¨ Android 10 ä¸Šåšäº†é‚£äº›ä¼˜åŒ–ï¼Ÿ BlinkLayout æ˜¯ä»€ä¹ˆï¼Ÿ å‰é¢ä¸¤ç¯‡æ–‡ç«  0xA01 Android 10 æºç åˆ†æï¼šAPK æ˜¯å¦‚ä½•ç”Ÿæˆçš„ å’Œ 0xA02 Android 10 æºç åˆ†æï¼šAPK çš„å®‰è£…æµç¨‹ åˆ†æäº† APK å¤§æ¦‚å¯ä»¥åˆ†ä¸ºä»£ç å’Œèµ„æºä¸¤éƒ¨åˆ†ï¼Œé‚£ä¹ˆ APK çš„åŠ è½½ä¹Ÿæ˜¯åˆ†ä¸ºä»£ç å’Œèµ„æºä¸¤éƒ¨åˆ†ï¼Œä»£ç çš„åŠ è½½æ¶‰åŠäº†è¿›ç¨‹çš„åˆ›å»ºã€å¯åŠ¨ã€è°ƒåº¦ï¼Œæœ¬æ–‡ä¸»è¦æ¥åˆ†æä¸€ä¸‹èµ„æºçš„åŠ è½½ï¼Œå¦‚æœæ²¡æœ‰çœ‹è¿‡ APK æ˜¯å¦‚ä½•ç”Ÿæˆçš„ å’Œ APK çš„å®‰è£…æµç¨‹ å¯ä»¥ç‚¹å‡»ä¸‹æ–¹è¿æ¥å‰å¾€ï¼š 0xA01 Android 10 æºç åˆ†æï¼šAPK æ˜¯å¦‚ä½•ç”Ÿæˆçš„ 0xA02 Android 10 æºç åˆ†æï¼šAPK çš„å®‰è£…æµç¨‹ 1. Android èµ„æºAndroid èµ„æºå¤§æ¦‚åˆ†ä¸ºä¸¤ä¸ªéƒ¨åˆ†ï¼šassets å’Œ res assets èµ„æº assets èµ„æºæ”¾åœ¨ assets ç›®å½•ä¸‹ï¼Œå®ƒé‡Œé¢ä¿å­˜ä¸€äº›åŸå§‹çš„æ–‡ä»¶ï¼Œå¯ä»¥ä»¥ä»»ä½•æ–¹å¼æ¥è¿›è¡Œç»„ç»‡ï¼Œè¿™äº›æ–‡ä»¶æœ€ç»ˆä¼šåŸå°ä¸åŠ¨çš„è¢«æ‰“åŒ…è¿› APK æ–‡ä»¶ä¸­ï¼Œé€šè¿‡AssetManager æ¥è·å– asset èµ„æºï¼Œä»£ç å¦‚ä¸‹ AssetManager assetManager = context.getAssets();InputStream is = assetManager.open(&quot;fileName&quot;); resèµ„æº res èµ„æºæ”¾åœ¨ä¸»å·¥ç¨‹çš„ res ç›®å½•ä¸‹ï¼Œè¿™ç±»èµ„æºä¸€èˆ¬éƒ½ä¼šåœ¨ç¼–è¯‘é˜¶æ®µç”Ÿæˆä¸€ä¸ªèµ„æº ID ä¾›æˆ‘ä»¬ä½¿ç”¨ï¼Œres ç›®å½•åŒ…æ‹¬ animatorã€animã€ colorã€drawableã€layoutã€menuã€rawã€valuesã€XMLç­‰ï¼Œé€šè¿‡ getResource() å»è·å– Resources å¯¹è±¡ Resources res = getContext().getResources(); APK çš„ç”Ÿæˆè¿‡ç¨‹ä¸­ï¼Œä¼šç”Ÿæˆèµ„æºç´¢å¼•è¡¨ resources.arsc æ–‡ä»¶å’Œ R.java æ–‡ä»¶ï¼Œå‰è€…èµ„æºç´¢å¼•è¡¨ resources.arsc è®°å½•äº†æ‰€æœ‰çš„åº”ç”¨ç¨‹åºèµ„æºç›®å½•çš„ä¿¡æ¯ï¼ŒåŒ…æ‹¬æ¯ä¸€ä¸ªèµ„æºåç§°ã€ç±»å‹ã€å€¼ã€IDä»¥åŠæ‰€é…ç½®çš„ç»´åº¦ä¿¡æ¯ï¼Œåè€…å®šä¹‰äº†å„ä¸ªèµ„æº ID å¸¸é‡ï¼Œè¿è¡Œæ—¶é€šè¿‡ Resources å’Œ AssetManger å…±åŒå®Œæˆèµ„æºçš„åŠ è½½ï¼Œå¦‚æœèµ„æºæ˜¯ä¸ªæ–‡ä»¶ï¼ŒResouces å…ˆæ ¹æ®èµ„æº ID æŸ¥æ‰¾å‡ºæ–‡ä»¶åï¼ŒAssetManger å†æ ¹æ®æ–‡ä»¶åæŸ¥æ‰¾å‡ºå…·ä½“çš„èµ„æºï¼Œå…³äº resources.arscï¼Œå¯ä»¥æŸ¥çœ‹ 0xA01 ASOPåº”ç”¨æ¡†æ¶ï¼šAPK æ˜¯å¦‚ä½•ç”Ÿæˆçš„ 2. èµ„æºçš„åŠ è½½å’Œè§£æåˆ° View çš„ç”Ÿæˆä¸‹é¢ä»£ç ä¸€å®šä¸ä¼šå¾ˆé™Œç”Ÿï¼Œåœ¨ Activity å¸¸è§çš„å‡ è¡Œä»£ç  override fun onCreate(savedInstanceState: Bundle?) { super.onCreate(savedInstanceState) setContentView(R.layout.main_activity)} ä¸€èµ·æ¥åˆ†æä¸€ä¸‹è°ƒç”¨ setContentView æ–¹æ³•ä¹‹ååšäº†ä»€ä¹ˆäº‹æƒ…ï¼Œæ¥ä¸‹æ¥æŸ¥çœ‹ä¸€ä¸‹ Activity ä¸­çš„ setContentView æ–¹æ³•frameworks/base/core/java/android/app/Activity.java public void setContentView(@LayoutRes int layoutResID) { // å®é™…ä¸Šè°ƒç”¨çš„æ˜¯PhoneWindow.setContentViewæ–¹æ³• getWindow().setContentView(layoutResID); initWindowDecorActionBar();} è°ƒç”¨ getWindow æ–¹æ³•è¿”å›çš„æ˜¯ mWindowï¼ŒmWindow æ˜¯ Windowd å¯¹è±¡ï¼Œå®é™…ä¸Šæ˜¯è°ƒç”¨å®ƒçš„å”¯ä¸€å®ç°ç±» PhoneWindow.setContentView æ–¹æ³• 2.1 Activity -&gt; PhoneWindowPhoneWindow æ˜¯ Window çš„å”¯ä¸€å®ç°ç±»ï¼Œå®ƒçš„ç»“æ„å¦‚ä¸‹ï¼š å½“è°ƒç”¨ Activity.setContentView æ–¹æ³•å®é™…ä¸Šè°ƒç”¨çš„æ˜¯ PhoneWindow.setContentView æ–¹æ³•frameworks/base/core/java/com/android/internal/policy/PhoneWindow.java public void setContentView(int layoutResID) { // mContentParentæ˜¯IDä¸ºID_ANDROID_CONTENTçš„FrameLayout // è°ƒç”¨setContentViewæ–¹æ³•ï¼Œå°±æ˜¯ç»™IDä¸ºID_ANDROID_CONTENTçš„Viewæ·»åŠ å­View if (mContentParent == null) { installDecor(); } else if (!hasFeature(FEATURE_CONTENT_TRANSITIONS)) { // FEATURE_CONTENT_TRANSITIONSï¼Œåˆ™æ˜¯æ ‡è®°å½“å‰å†…å®¹åŠ è½½æœ‰æ²¡æœ‰ä½¿ç”¨è¿‡åº¦åŠ¨ç”» // å¦‚æœå†…å®¹å·²ç»åŠ è½½è¿‡ï¼Œå¹¶ä¸”ä¸éœ€è¦åŠ¨ç”»ï¼Œåˆ™ä¼šè°ƒç”¨removeAllViews mContentParent.removeAllViews(); } // æ£€æŸ¥æ˜¯å¦è®¾ç½®äº†FEATURE_CONTENT_TRANSITIONS if (hasFeature(FEATURE_CONTENT_TRANSITIONS)) { final Scene newScene = Scene.getSceneForLayout(mContentParent, layoutResID, getContext()); transitionTo(newScene); } else { // è§£ææŒ‡å®šçš„XMLèµ„æºæ–‡ä»¶ mLayoutInflater.inflate(layoutResID, mContentParent); } mContentParent.requestApplyInsets(); final Callback cb = getCallback(); if (cb != null &amp;&amp; !isDestroyed()) { cb.onContentChanged(); } mContentParentExplicitlySet = true;} å…ˆåˆ¤æ–­ mContentParent æ˜¯å¦ä¸ºç©ºï¼Œå¦‚æœä¸ºç©ºåˆ™è°ƒç”¨ installDecor æ–¹æ³•ï¼Œç”Ÿæˆ mDecorï¼Œå¹¶å°†å®ƒèµ‹å€¼ç»™ mContentParent æ ¹æ® FEATURE_CONTENT_TRANSITIONS æ ‡è®°æ¥åˆ¤æ–­æ˜¯å¦åŠ è½½è¿‡è½¬åœºåŠ¨ç”» å¦‚æœè®¾ç½®äº† FEATURE_CONTENT_TRANSITIONS åˆ™æ·»åŠ  Scene æ¥è¿‡åº¦å¯åŠ¨ï¼Œå¦åˆ™è°ƒç”¨ mLayoutInflater.inflate(layoutResID, mContentParent)ï¼Œè§£æèµ„æºæ–‡ä»¶ï¼Œåˆ›å»º View, å¹¶æ·»åŠ åˆ° mContentParent è§†å›¾ä¸­ 2.2 PhoneWindow -&gt; LayoutInflaterå½“è°ƒç”¨ PhoneWindow.setContentView æ–¹æ³•ï¼Œä¹‹åè°ƒç”¨ LayoutInflater.inflate æ–¹æ³•ï¼Œæ¥è§£æ XML èµ„æºæ–‡ä»¶frameworks/base/core/java/android/view/LayoutInflater.java public View inflate(@LayoutRes int resource, @Nullable ViewGroup root) { return inflate(resource, root, root != null);} inflate å®ƒæœ‰å¤šä¸ªé‡è½½æ–¹æ³•ï¼Œæœ€åè°ƒç”¨çš„æ˜¯ inflate(resource, root, root != null) æ–¹æ³•frameworks/base/core/java/android/view/LayoutInflater.java public View inflate(@LayoutRes int resource, @Nullable ViewGroup root, boolean attachToRoot) { final Resources res = getContext().getResources(); // æ ¹æ®XMLé¢„ç¼–è¯‘ç”Ÿæˆcompiled_view.dex, ç„¶åé€šè¿‡åå°„æ¥ç”Ÿæˆå¯¹åº”çš„Viewï¼Œä»è€Œå‡å°‘XmlPullParserè§£æXmlçš„æ—¶é—´ // éœ€è¦æ³¨æ„çš„æ˜¯åœ¨ç›®å‰çš„releaseç‰ˆæœ¬ä¸­ä¸æ”¯æŒä½¿ç”¨ View view = tryInflatePrecompiled(resource, res, root, attachToRoot); if (view != null) { return view; } // è·å–èµ„æºè§£æå™¨ XmlResourceParser XmlResourceParser parser = res.getLayout(resource); try { return inflate(parser, root, attachToRoot); } finally { parser.close(); }} è¿™ä¸ªæ–¹æ³•ä¸»è¦åšäº†ä¸‰ä»¶äº‹ï¼š æ ¹æ® XML é¢„ç¼–è¯‘ç”Ÿæˆ compiled_view.dex, ç„¶åé€šè¿‡åå°„æ¥ç”Ÿæˆå¯¹åº”çš„ View è·å– XmlResourceParser è§£æ View æ³¨æ„ï¼šåœ¨ç›®å‰çš„ release ç‰ˆæœ¬ä¸­ä¸æ”¯æŒä½¿ç”¨ tryInflatePrecompiled æ–¹æ³•æºç å¦‚ä¸‹ï¼š private void initPrecompiledViews() { // Precompiled layouts are not supported in this release. // enabled æ˜¯å¦å¯åŠ¨é¢„ç¼–è¯‘å¸ƒå±€ï¼Œè¿™é‡Œå§‹ç»ˆä¸ºfalse boolean enabled = false; initPrecompiledViews(enabled);}private void initPrecompiledViews(boolean enablePrecompiledViews) { mUseCompiledView = enablePrecompiledViews; if (!mUseCompiledView) { mPrecompiledClassLoader = null; return; } ...}View tryInflatePrecompiled(@LayoutRes int resource, Resources res, @Nullable ViewGroup root, boolean attachToRoot) { // mUseCompiledViewå§‹ç»ˆä¸ºfalse if (!mUseCompiledView) { return null; } // è·å–éœ€è¦è§£æçš„èµ„æºæ–‡ä»¶çš„ pkg å’Œ layout String pkg = res.getResourcePackageName(resource); String layout = res.getResourceEntryName(resource); try { // æ ¹æ®mPrecompiledClassLoaderé€šè¿‡åå°„è·å–é¢„ç¼–è¯‘ç”Ÿæˆçš„viewå¯¹è±¡çš„Classç±» Class clazz = Class.forName(&quot;&quot; + pkg + &quot;.CompiledView&quot;, false, mPrecompiledClassLoader); Method inflater = clazz.getMethod(layout, Context.class, int.class); View view = (View) inflater.invoke(null, mContext, resource); if (view != null &amp;&amp; root != null) { // å°†ç”Ÿæˆçš„view æ·»åŠ æ ¹å¸ƒå±€ä¸­ XmlResourceParser parser = res.getLayout(resource); try { AttributeSet attrs = Xml.asAttributeSet(parser); advanceToRootNode(parser); ViewGroup.LayoutParams params = root.generateLayoutParams(attrs); // å¦‚æœ attachToRoot=trueæ·»åŠ åˆ°æ ¹å¸ƒå±€ä¸­ if (attachToRoot) { root.addView(view, params); } else { // å¦è€…å°†è·å–åˆ°çš„æ ¹å¸ƒå±€çš„LayoutParamsï¼Œè®¾ç½®åˆ°ç”Ÿæˆçš„viewä¸­ view.setLayoutParams(params); } } finally { parser.close(); } } return view; } catch (Throwable e) { } finally { } return null;} tryInflatePrecompiled æ–¹æ³•æ˜¯ Android 10 æ–°å¢çš„æ–¹æ³•ï¼Œè¿™æ˜¯ä¸€ä¸ªåœ¨ç¼–è¯‘å™¨è¿è¡Œçš„ä¸€ä¸ªä¼˜åŒ–ï¼Œå› ä¸ºå¸ƒå±€æ–‡ä»¶è¶Šå¤æ‚ XmlPullParser è§£æ XML è¶Šè€—æ—¶, tryInflatePrecompiled æ–¹æ³•æ ¹æ® XML é¢„ç¼–è¯‘ç”Ÿæˆcompiled_view.dex, ç„¶åé€šè¿‡åå°„æ¥ç”Ÿæˆå¯¹åº”çš„ Viewï¼Œä»è€Œå‡å°‘ XmlPullParser è§£æ XML çš„æ—¶é—´ï¼Œç„¶åæ ¹æ® attachToRoot å‚æ•°æ¥åˆ¤æ–­æ˜¯æ·»åŠ åˆ°æ ¹å¸ƒå±€ä¸­ï¼Œè¿˜æ˜¯è®¾ç½® LayoutParams å‚æ•°è¿”å›ç»™è°ƒç”¨è€… ç”¨ä¸€ä¸ªå…¨å±€å˜é‡ mUseCompiledView æ¥æ§åˆ¶æ˜¯å¦å¯ç”¨ tryInflatePrecompiled æ–¹æ³•ï¼Œæ ¹æ®æºç åˆ†æï¼ŒmUseCompiledView å§‹ç»ˆä¸º false äº†è§£äº† tryInflatePrecompiled æ–¹æ³•ä¹‹åï¼Œåœ¨æ¥æŸ¥çœ‹ä¸€ä¸‹ inflate æ–¹æ³•ä¸­çš„ä¸‰ä¸ªå‚æ•°éƒ½ä»€ä¹ˆæ„æ€ resourceï¼šè¦è§£æçš„ XML å¸ƒå±€æ–‡ä»¶ ID rootï¼šè¡¨ç¤ºæ ¹å¸ƒå±€ attachToRootï¼šæ˜¯å¦è¦æ·»åŠ åˆ°çˆ¶å¸ƒå±€ root ä¸­ resource å…¶å®å¾ˆå¥½ç†è§£å°±æ˜¯èµ„æº IDï¼Œè€Œ root å’Œ attachToRoot åˆ†åˆ«ä»£è¡¨ä»€ä¹ˆæ„æ€ï¼š å½“ attachToRoot == true ä¸” root ï¼= null æ—¶ï¼Œæ–°è§£æå‡ºæ¥çš„ View ä¼šè¢« add åˆ° root ä¸­å»ï¼Œç„¶åå°† root ä½œä¸ºç»“æœè¿”å› å½“ attachToRoot == false ä¸” root ï¼= null æ—¶ï¼Œæ–°è§£æçš„ View ä¼šç›´æ¥ä½œä¸ºç»“æœè¿”å›ï¼Œè€Œä¸” root ä¼šä¸ºæ–°è§£æçš„ View ç”Ÿæˆ LayoutParams å¹¶è®¾ç½®åˆ°è¯¥ View ä¸­å» å½“ attachToRoot == false ä¸” root == null æ—¶ï¼Œæ–°è§£æçš„ View ä¼šç›´æ¥ä½œä¸ºç»“æœè¿”å› æ ¹æ®æºç çŸ¥é“è°ƒç”¨ tryInflatePrecompiled æ–¹æ³•è¿”å›çš„ view ä¸ºç©ºï¼Œç»§ç»­å¾€ä¸‹æ‰§è¡Œè°ƒç”¨ Resources çš„ getLayout æ–¹æ³•è·å–èµ„æºè§£æå™¨ XmlResourceParser 2.3 LayoutInflater -&gt; Resourcesä¸Šé¢è¯´åˆ° XmlResourceParser æ˜¯é€šè¿‡è°ƒç”¨ Resources çš„ getLayout æ–¹æ³•è·å–çš„ï¼ŒgetLayout æ–¹æ³•åˆå»è°ƒç”¨äº† Resources çš„loadXmlResourceParser æ–¹æ³•frameworks/base/core/java/android/content/res/Resources.java public XmlResourceParser getLayout(@LayoutRes int id) throws NotFoundException { return loadXmlResourceParser(id, &quot;layout&quot;);}XmlResourceParser loadXmlResourceParser(@AnyRes int id, @NonNull String type) throws NotFoundException { // TypedValue ä¸»è¦ç”¨æ¥å­˜å‚¨èµ„æº final TypedValue value = obtainTempTypedValue(); try { final ResourcesImpl impl = mResourcesImpl; // è·å–XMLèµ„æºï¼Œä¿å­˜åˆ° TypedValue impl.getValue(id, value, true); if (value.type == TypedValue.TYPE_STRING) { // ä¸ºæŒ‡å®šçš„XMLèµ„æºï¼ŒåŠ è½½è§£æå™¨ return impl.loadXmlResourceParser(value.string.toString(), id, value.assetCookie, type); } throw new NotFoundException(&quot;Resource ID #0x&quot; + Integer.toHexString(id) + &quot; type #0x&quot; + Integer.toHexString(value.type) + &quot; is not valid&quot;); } finally { releaseTempTypedValue(value); }} TypedValue æ˜¯åŠ¨æ€çš„æ•°æ®å®¹å™¨ï¼Œä¸»è¦ç”¨æ¥å­˜å‚¨ Resource çš„èµ„æºï¼Œè·å– XML èµ„æºä¿å­˜åˆ° TypedValueï¼Œä¹‹åè°ƒç”¨ ResourcesImpl çš„ loadXmlResourceParser æ–¹æ³•åŠ è½½å¯¹åº”çš„è§£æå™¨ 2.4 Resources -&gt; ResourcesImplResourcesImpl å®ç°äº† Resource çš„è®¿é—®ï¼Œå®ƒåŒ…å«äº† AssetManager å’Œæ‰€æœ‰çš„ç¼“å­˜ï¼Œé€šè¿‡ Resource çš„ getValue æ–¹æ³•è·å– XML èµ„æºä¿å­˜åˆ° TypedValueï¼Œä¹‹åå°±ä¼šè°ƒç”¨ ResourcesImpl çš„ loadXmlResourceParser æ–¹æ³•å¯¹è¯¥å¸ƒå±€èµ„æºè¿›è¡Œè§£æframeworks/base/core/java/android/content/res/ResourcesImpl.java XmlResourceParser loadXmlResourceParser(@NonNull String file, @AnyRes int id, int assetCookie, @NonNull String type) throws NotFoundException { if (id != 0) { try { synchronized (mCachedXmlBlocks) { final int[] cachedXmlBlockCookies = mCachedXmlBlockCookies; final String[] cachedXmlBlockFiles = mCachedXmlBlockFiles; final XmlBlock[] cachedXmlBlocks = mCachedXmlBlocks; // é¦–å…ˆä»ç¼“å­˜ä¸­æŸ¥æ‰¾XMLèµ„æº final int num = cachedXmlBlockFiles.length; for (int i = 0; i &lt; num; i++) { if (cachedXmlBlockCookies[i] == assetCookie &amp;&amp; cachedXmlBlockFiles[i] != null &amp;&amp; cachedXmlBlockFiles[i].equals(file)) { // è°ƒç”¨newParseræ–¹æ³•å»æ„å»ºä¸€ä¸ªXmlResourceParserå¯¹è±¡ï¼Œè¿”å›ç»™è°ƒç”¨è€… return cachedXmlBlocks[i].newParser(id); } } // å¦‚æœç¼“å­˜ä¸­æ²¡æœ‰ï¼Œåˆ™åˆ›å»ºXmlBlockï¼Œå¹¶å°†å®ƒæ”¾åˆ°ç¼“å­˜ä¸­ // XmlBlockæ˜¯å·²ç¼–è¯‘çš„XMLæ–‡ä»¶çš„ä¸€ä¸ªåŒ…è£…ç±» final XmlBlock block = mAssets.openXmlBlockAsset(assetCookie, file); if (block != null) { final int pos = (mLastCachedXmlBlockIndex + 1) % num; mLastCachedXmlBlockIndex = pos; final XmlBlock oldBlock = cachedXmlBlocks[pos]; if (oldBlock != null) { oldBlock.close(); } cachedXmlBlockCookies[pos] = assetCookie; cachedXmlBlockFiles[pos] = file; cachedXmlBlocks[pos] = block; // è°ƒç”¨newParseræ–¹æ³•å»æ„å»ºä¸€ä¸ªXmlResourceParserå¯¹è±¡ï¼Œè¿”å›ç»™è°ƒç”¨è€… return block.newParser(id); } } } catch (Exception e) { final NotFoundException rnf = new NotFoundException(&quot;File &quot; + file + &quot; from xml type &quot; + type + &quot; resource ID #0x&quot; + Integer.toHexString(id)); rnf.initCause(e); throw rnf; } } throw new NotFoundException(&quot;File &quot; + file + &quot; from xml type &quot; + type + &quot; resource ID #0x&quot; + Integer.toHexString(id));} é¦–å…ˆä»ç¼“å­˜ä¸­æŸ¥æ‰¾ XML èµ„æºä¹‹åè°ƒç”¨ newParser æ–¹æ³•ï¼Œå¦‚æœç¼“å­˜ä¸­æ²¡æœ‰ï¼Œåˆ™è°ƒç”¨ AssetManger çš„ openXmlBlockAsset æ–¹æ³•åˆ›å»ºä¸€ä¸ª XmlBlockï¼Œå¹¶å°†å®ƒæ”¾åˆ°ç¼“å­˜ä¸­ï¼ŒXmlBlock æ˜¯å·²ç¼–è¯‘çš„ XML æ–‡ä»¶çš„ä¸€ä¸ªåŒ…è£…ç±»frameworks/base/core/java/android/content/res/AssetManager.java XmlBlock openXmlBlockAsset(int cookie, @NonNull String fileName) throws IOException { Preconditions.checkNotNull(fileName, &quot;fileName&quot;); synchronized (this) { ensureOpenLocked(); // è°ƒç”¨nativeæ–¹æ³•nativeOpenXmlAsset, åŠ è½½æŒ‡å®šçš„XMLèµ„æºæ–‡ä»¶ï¼Œå¾—åˆ°ResXMLTree // xmlBlockæ˜¯ResXMLTreeå¯¹è±¡çš„åœ°å€ final long xmlBlock = nativeOpenXmlAsset(mObject, cookie, fileName); if (xmlBlock == 0) { throw new FileNotFoundException(&quot;Asset XML file: &quot; + fileName); } // åˆ›å»ºXmlBlockï¼Œå°è£…xmlBlockï¼Œè¿”å›ç»™è°ƒç”¨è€… final XmlBlock block = new XmlBlock(this, xmlBlock); incRefsLocked(block.hashCode()); return block; }} æœ€ç»ˆè°ƒç”¨ native æ–¹æ³• nativeOpenXmlAsset å»æ‰“å¼€æŒ‡å®šçš„ XML æ–‡ä»¶ï¼ŒåŠ è½½å¯¹åº”çš„èµ„æºï¼Œæ¥æŸ¥çœ‹ä¸€ä¸‹ navtive æ–¹æ³• NativeOpenXmlAssetframeworks/base/core/jni/android_util_AssetManager.cpp // javaæ–¹æ³•å¯¹åº”çš„nativeæ–¹æ³•{&quot;nativeOpenXmlAsset&quot;, &quot;(JILjava/lang/String;)J&quot;, (void*)NativeOpenXmlAsset} static jlong NativeOpenXmlAsset(JNIEnv* env, jobject /*clazz*/, jlong ptr, jint jcookie, jstring asset_path) { ApkAssetsCookie cookie = JavaCookieToApkAssetsCookie(jcookie); ... const DynamicRefTable* dynamic_ref_table = assetmanager-&gt;GetDynamicRefTableForCookie(cookie); std::unique_ptr&lt;ResXMLTree&gt; xml_tree = util::make_unique&lt;ResXMLTree&gt;(dynamic_ref_table); status_t err = xml_tree-&gt;setTo(asset-&gt;getBuffer(true), asset-&gt;getLength(), true); asset.reset(); ... return reinterpret_cast&lt;jlong&gt;(xml_tree.release());} C++ å±‚çš„ NativeOpenXmlAsset æ–¹æ³•ä¼šåˆ›å»º ResXMLTree å¯¹è±¡ï¼Œè¿”å›çš„æ˜¯ ResXMLTree åœ¨ C++ å±‚çš„åœ°å€ Java å±‚ nativeOpenXmlAsse tæ–¹æ³•çš„è¿”å›å€¼ xmlBlock æ˜¯ C++ å±‚çš„ ResXMLTree å¯¹è±¡çš„åœ°å€ï¼Œç„¶åå°† xmlBlock å°è£…è¿› XmlBlock ä¸­è¿”å›ç»™è°ƒç”¨è€… å½“ xmlBlock åˆ›å»ºä¹‹åï¼Œä¼šè°ƒç”¨ newParser æ–¹æ³•ï¼Œæ„å»ºä¸€ä¸ª XmlResourceParser å¯¹è±¡ï¼Œè¿”å›ç»™è°ƒç”¨è€… 2.5 ResourcesImpl -&gt; XmlBlockXmlBlock æ˜¯å·²ç¼–è¯‘çš„ XML æ–‡ä»¶çš„ä¸€ä¸ªåŒ…è£…ç±»ï¼ŒXmlResourceParser è´Ÿè´£å¯¹ XML çš„æ ‡ç­¾è¿›è¡Œéå†è§£æçš„ï¼Œå®ƒçš„çœŸæ­£çš„å®ç°æ˜¯ XmlBlock çš„å†…éƒ¨ç±» XmlBlock.Parserï¼Œè€ŒçœŸæ­£å®Œæˆ XML çš„éå†æ“ä½œçš„å‡½æ•°éƒ½æ˜¯ç”± XmlBlock æ¥å®ç°çš„ï¼Œä¸ºäº†æå‡æ•ˆç‡éƒ½æ˜¯é€šè¿‡ JNI è°ƒç”¨ native çš„å‡½æ•°æ¥åšçš„ï¼Œæ¥ä¸‹æ¥æŸ¥çœ‹ä¸€ä¸‹ newParser æ–¹æ³•frameworks/base/core/java/android/content/res/XmlBlock.java public XmlResourceParser newParser(@AnyRes int resId) { synchronized (this) { // mNativeæ˜¯C++å±‚çš„ResXMLTreeå¯¹è±¡çš„åœ°å€ if (mNative != 0) { // nativeCreateParseStateæ–¹æ³•æ ¹æ® mNative æŸ¥æ‰¾åˆ°ResXMLTreeï¼Œ // åœ¨C++å±‚æ„å»ºä¸€ä¸ªResXMLParserå¯¹è±¡ï¼Œ // æ„å»ºParserï¼Œå°è£…ResXMLParserï¼Œè¿”å›ç»™è°ƒç”¨è€… return new Parser(nativeCreateParseState(mNative, resId), this); } return null; }} è¿™ä¸ªæ–¹æ³•åšä¸¤ä»¶äº‹ mNative æ˜¯ C++ å±‚çš„ ResXMLTree å¯¹è±¡çš„åœ°å€ï¼Œè°ƒç”¨ native æ–¹æ³• nativeCreateParseStateï¼Œåœ¨ C++ å±‚æ„å»ºä¸€ä¸ª ResXMLParser å¯¹è±¡ï¼Œè¿”å› ResXMLParser å¯¹è±¡åœ¨ C++ å±‚çš„åœ°å€ Java å±‚æ‹¿åˆ° ResXMLParser åœ¨ C++ å±‚åœ°å€ï¼Œæ„å»º Parserï¼Œå°è£… ResXMLParserï¼Œè¿”å›ç»™è°ƒç”¨è€… æ¥ä¸‹æ¥æŸ¥çœ‹ä¸€ä¸‹ native æ–¹æ³• nativeCreateParseStateframeworks/base/core/jni/android_util_XmlBlock.cpp // javaæ–¹æ³•å¯¹åº”çš„nativeæ–¹æ³•{ &quot;nativeCreateParseState&quot;, &quot;(JI)J&quot;, (void*) android_content_XmlBlock_nativeCreateParseState } static jlong android_content_XmlBlock_nativeCreateParseState(JNIEnv* env, jobject clazz, jlong token, jint res_id){ ResXMLTree* osb = reinterpret_cast&lt;ResXMLTree*&gt;(token); if (osb == NULL) { jniThrowNullPointerException(env, NULL); return 0; } ResXMLParser* st = new ResXMLParser(*osb); if (st == NULL) { jniThrowException(env, &quot;java/lang/OutOfMemoryError&quot;, NULL); return 0; } st-&gt;setSourceResourceId(res_id); st-&gt;restart(); return reinterpret_cast&lt;jlong&gt;(st);} token å¯¹åº” Java å±‚ mNativeï¼Œæ˜¯ C++ å±‚çš„ ResXMLTree å¯¹è±¡çš„åœ°å€ è°ƒç”¨ C++ å±‚ android_content_XmlBlock_nativeCreateParseState æ–¹æ³•ï¼Œæ ¹æ® tokenæ‰¾åˆ° ResXMLTree å¯¹è±¡ åœ¨ C++ å±‚æ„å»ºä¸€ä¸ª ResXMLParser å¯¹è±¡ï¼Œè¿”ç»™ Java å±‚å¯¹åº” ResXMLParser å¯¹è±¡åœ¨ C++ å±‚çš„åœ°å€ Java å±‚æ‹¿åˆ° ResXMLParser åœ¨ C++ å±‚åœ°å€ï¼Œå°è£…åˆ° Parser ä¸­ 2.6 å†æ¬¡å›åˆ° LayoutInflaterç»è¿‡ä¸€ç³»åˆ—çš„è·³è½¬ï¼Œæœ€åè°ƒç”¨ XmlBlock.newParser æ–¹æ³•è·å–èµ„æºè§£æå™¨ XmlResourceParserï¼Œä¹‹åå›åˆ° LayoutInflater è°ƒç”¨å¤„ inflate æ–¹æ³•ï¼Œç„¶åè°ƒç”¨ rInflate æ–¹æ³•è§£æ Viewframeworks/base/core/java/android/view/LayoutInflater.java public View inflate(XmlPullParser parser, @Nullable ViewGroup root, boolean attachToRoot) { synchronized (mConstructorArgs) { // è·å–context final Context inflaterContext = mContext; final AttributeSet attrs = Xml.asAttributeSet(parser); Context lastContext = (Context) mConstructorArgs[0]; mConstructorArgs[0] = inflaterContext; // å­˜å‚¨æ ¹å¸ƒå±€ View result = root; try { // å¤„ç† START_TA Gå’Œ END_TAG advanceToRootNode(parser); final String name = parser.getName(); // è§£æmergeæ ‡ç­¾ï¼ŒrInflateæ–¹æ³•ä¼šå°†mergeæ ‡ç­¾ä¸‹é¢çš„æ‰€æœ‰å­viewæ·»åŠ åˆ°æ ¹å¸ƒå±€ä¸­ // è¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆmergeæ ‡ç­¾å¯ä»¥ç®€åŒ–å¸ƒå±€çš„æ•ˆæœ if (TAG_MERGE.equals(name)) { if (root == null || !attachToRoot) { throw new InflateException(&quot;&lt;merge /&gt; can be used only with a valid &quot; + &quot;ViewGroup root and attachToRoot=true&quot;); } // è§£æmergeæ ‡ç­¾ä¸‹çš„æ‰€æœ‰çš„Viewï¼Œæ·»åŠ åˆ°æ ¹å¸ƒå±€ä¸­ rInflate(parser, root, inflaterContext, attrs, false); } else { // å¦‚æœä¸æ˜¯mergeæ ‡ç­¾ï¼Œè°ƒç”¨createViewFromTagæ–¹æ³•è§£æå¸ƒå±€è§†å›¾ï¼Œè¿™é‡Œçš„tempå…¶å®æ˜¯æˆ‘ä»¬xmlé‡Œçš„top view final View temp = createViewFromTag(root, name, inflaterContext, attrs); ViewGroup.LayoutParams params = null; // å¦‚æœæ ¹å¸ƒå±€ä¸ä¸ºç©ºçš„è¯ï¼Œä¸”attachToRootä¸ºfalseï¼Œä¸ºViewè®¾ç½®å¸ƒå±€å‚æ•° if (root != null) { // è·å–æ ¹å¸ƒå±€çš„LayoutParams params = root.generateLayoutParams(attrs); // attachToRootä¸ºfalseï¼Œä¸ºViewè®¾ç½®LayoutParams if (!attachToRoot) { temp.setLayoutParams(params); } } // è§£æå½“å‰Viewä¸‹é¢çš„æ‰€æœ‰å­View rInflateChildren(parser, temp, attrs, true); // å¦‚æœ root ä¸ä¸ºç©ºä¸” attachToRoot ä¸ºfalseï¼Œå°†è§£æå‡ºæ¥çš„View æ·»åŠ åˆ°æ ¹å¸ƒå±€ if (root != null &amp;&amp; attachToRoot) { root.addView(temp, params); } // å¦‚æœæ ¹å¸ƒå±€ä¸ºç©º æˆ–è€… attachToRoot ä¸ºfalseï¼Œè¿”å›å½“å‰çš„View if (root == null || !attachToRoot) { result = temp; } } } catch (XmlPullParserException e) { final InflateException ie = new InflateException(e.getMessage(), e); ie.setStackTrace(EMPTY_STACK_TRACE); throw ie; } catch (Exception e) { throw ie; } finally { } return result; }} è§£æ merge æ ‡ç­¾ï¼Œä½¿ç”¨ merge æ ‡ç­¾å¿…é¡»æœ‰çˆ¶å¸ƒå±€ï¼Œä¸”ä¾èµ–äºçˆ¶å¸ƒå±€åŠ è½½ rInflate æ–¹æ³•ä¼šå°† merge æ ‡ç­¾ä¸‹é¢çš„æ‰€æœ‰ View æ·»åŠ åˆ°æ ¹å¸ƒå±€ä¸­ å¦‚æœä¸æ˜¯ merge æ ‡ç­¾ï¼Œè°ƒç”¨ createViewFromTag è§£æå¸ƒå±€è§†å›¾ï¼Œè¿”å› temp, è¿™é‡Œçš„ temp å…¶å®æ˜¯æˆ‘ä»¬ XML é‡Œçš„ Top View è°ƒç”¨ rInflateChildren æ–¹æ³•ï¼Œä¼ é€’å‚æ•° tempï¼Œåœ¨ rInflateChildrenæ–¹ æ³•é‡Œå†…éƒ¨ï¼Œä¼šè°ƒç”¨ rInflate æ–¹æ³•, è§£æå½“å‰ View ä¸‹é¢çš„æ‰€æœ‰å­ View é€šè¿‡åˆ†ææºç çŸ¥é“äº†attachToRoot å’Œ rootçš„å‚æ•°ä»£è¡¨ä»€ä¹ˆæ„æ€ï¼Œè¿™é‡Œæ€»ç»“ä¸€ä¸‹ï¼š å½“ attachToRoot == true ä¸” root ï¼= null æ—¶ï¼Œæ–°è§£æå‡ºæ¥çš„ View ä¼šè¢« add åˆ° root ä¸­å»ï¼Œç„¶åå°† root ä½œä¸ºç»“æœè¿”å› å½“ attachToRoot == false ä¸” root ï¼= null æ—¶ï¼Œæ–°è§£æçš„ View ä¼šç›´æ¥ä½œä¸ºç»“æœè¿”å›ï¼Œè€Œä¸” root ä¼šä¸ºæ–°è§£æçš„Viewç”Ÿæˆ LayoutParamså¹¶è®¾ç½®åˆ°è¯¥ View ä¸­å» å½“ attachToRoot == false ä¸” root == null æ—¶ï¼Œæ–°è§£æçš„ View ä¼šç›´æ¥ä½œä¸ºç»“æœè¿”å› æ— è®ºæ˜¯ä¸æ˜¯ merge æ ‡ç­¾ï¼Œæœ€åéƒ½ä¼šè°ƒç”¨ rInflate æ–¹æ³•è¿›è¡Œ View æ ‘çš„è§£æï¼Œä»–ä»¬çš„åŒºåˆ«åœ¨äºï¼Œå¦‚æœæ˜¯ merge æ ‡ç­¾ä¼ é€’çš„å‚æ•° finishInflate æ˜¯ falseï¼Œå¦‚æœä¸æ˜¯ merge æ ‡ç­¾ä¼ é€’çš„å‚æ•° finishInflate æ˜¯ trueframeworks/base/core/java/android/view/LayoutInflater.java void rInflate(XmlPullParser parser, View parent, Context context, AttributeSet attrs, boolean finishInflate) throws XmlPullParserException, IOException { // è·å–æ•°çš„æ·±åº¦ final int depth = parser.getDepth(); int type; boolean pendingRequestFocus = false; // é€ä¸ª View è§£æ while (((type = parser.next()) != XmlPullParser.END_TAG || parser.getDepth() &gt; depth) &amp;&amp; type != XmlPullParser.END_DOCUMENT) { if (type != XmlPullParser.START_TAG) { continue; } final String name = parser.getName(); if (TAG_REQUEST_FOCUS.equals(name)) { // è§£æandroid:focusable=&quot;true&quot;, è·å–Viewçš„ç„¦ç‚¹ pendingRequestFocus = true; consumeChildElements(parser); } else if (TAG_TAG.equals(name)) { // è§£æandroid:tagæ ‡ç­¾ parseViewTag(parser, parent, attrs); } else if (TAG_INCLUDE.equals(name)) { // è§£æincludeæ ‡ç­¾ï¼Œincludeæ ‡ç­¾ä¸èƒ½ä½œä¸ºæ ¹å¸ƒå±€ if (parser.getDepth() == 0) { throw new InflateException(&quot;&lt;include /&gt; cannot be the root element&quot;); } parseInclude(parser, context, parent, attrs); } else if (TAG_MERGE.equals(name)) { // mergeæ ‡ç­¾å¿…é¡»ä½œä¸ºæ ¹å¸ƒå±€ throw new InflateException(&quot;&lt;merge /&gt; must be the root element&quot;); } else { // æ ¹æ®å…ƒç´ åè§£æï¼Œç”ŸæˆView final View view = createViewFromTag(parent, name, context, attrs); final ViewGroup viewGroup = (ViewGroup) parent; final ViewGroup.LayoutParams params = viewGroup.generateLayoutParams(attrs); // rInflateChildrenæ–¹æ³•å†…éƒ¨è°ƒç”¨çš„rInflateæ–¹æ³•ï¼Œæ·±åº¦ä¼˜å…ˆéå†è§£ææ‰€æœ‰çš„å­View rInflateChildren(parser, view, attrs, true); // æ·»åŠ è§£æçš„View viewGroup.addView(view, params); } } if (pendingRequestFocus) { parent.restoreDefaultFocus(); } // å¦‚æœfinishInflateä¸ºtrueï¼Œåˆ™è°ƒç”¨onFinishInflateæ–¹æ³• if (finishInflate) { parent.onFinishInflate(); }} æ•´ä¸ª View æ ‘çš„è§£æè¿‡ç¨‹å¦‚ä¸‹ï¼š è·å– View æ ‘çš„æ·±åº¦ é€ä¸ª View è§£æ è§£æ android:focusable=â€trueâ€, è·å– View çš„ç„¦ç‚¹ è§£æ android:tag æ ‡ç­¾ è§£æ include æ ‡ç­¾ï¼Œå¹¶ä¸” include æ ‡ç­¾ä¸èƒ½ä½œä¸ºæ ¹å¸ƒå±€ è§£æ merge æ ‡ç­¾ï¼Œå¹¶ä¸” merge æ ‡ç­¾å¿…é¡»ä½œä¸ºæ ¹å¸ƒå±€ æ ¹æ®å…ƒç´ åè§£æï¼Œç”Ÿæˆå¯¹åº”çš„ View rInflateChildren æ–¹æ³•å†…éƒ¨è°ƒç”¨çš„ rInflate æ–¹æ³•ï¼Œæ·±åº¦ä¼˜å…ˆéå†è§£ææ‰€æœ‰çš„å­ View æ·»åŠ è§£æçš„ View æ³¨æ„ï¼šé€šè¿‡åˆ†ææºç , ä»¥ä¸‹å‡ ç‚¹éœ€è¦ç‰¹åˆ«æ³¨æ„ include æ ‡ç­¾ä¸èƒ½ä½œä¸ºæ ¹å…ƒç´ ï¼Œéœ€è¦æ”¾åœ¨ ViewGroupä¸­ merge æ ‡ç­¾å¿…é¡»ä¸ºæ ¹å…ƒç´ ï¼Œä½¿ç”¨ merge æ ‡ç­¾å¿…é¡»æœ‰çˆ¶å¸ƒå±€ï¼Œä¸”ä¾èµ–äºçˆ¶å¸ƒå±€åŠ è½½ å½“ XmlResourseParser å¯¹ XML çš„éå†ï¼Œéšç€å¸ƒå±€è¶Šå¤æ‚ï¼Œå±‚çº§åµŒå¥—è¶Šå¤šï¼Œæ‰€èŠ±è´¹çš„æ—¶é—´ä¹Ÿè¶Šé•¿ï¼Œæ‰€ä»¥å¯¹å¸ƒå±€çš„ä¼˜åŒ–ï¼Œå¯ä»¥ä½¿ç”¨ meger æ ‡ç­¾å‡å°‘å±‚çº§çš„åµŒå¥— åœ¨è§£æè¿‡ç¨‹ä¸­è°ƒç”¨ createViewFromTag æ–¹æ³•ï¼Œæ ¹æ®å…ƒç´ åè§£æï¼Œç”Ÿæˆå¯¹åº”çš„ Viewï¼Œæ¥ä¸‹æ¥æŸ¥çœ‹ä¸€ä¸‹ createViewFromTag æ–¹æ³•frameworks/base/core/java/android/view/LayoutInflater.java private View createViewFromTag(View parent, String name, Context context, AttributeSet attrs) { return createViewFromTag(parent, name, context, attrs, false);}View createViewFromTag(View parent, String name, Context context, AttributeSet attrs, boolean ignoreThemeAttr) { if (name.equals(&quot;view&quot;)) { name = attrs.getAttributeValue(null, &quot;class&quot;); } // å¦‚æœè®¾ç½®äº†theme, æ„å»ºä¸€ä¸ªContextThemeWrapper if (!ignoreThemeAttr) { final TypedArray ta = context.obtainStyledAttributes(attrs, ATTRS_THEME); final int themeResId = ta.getResourceId(0, 0); if (themeResId != 0) { context = new ContextThemeWrapper(context, themeResId); } ta.recycle(); } try {\b\b // å¦‚æœnameæ˜¯blinkï¼Œåˆ™åˆ›å»ºBlinkLayout // å¦‚æœè®¾ç½®factoryï¼Œæ ¹æ®factoryè¿›è¡Œè§£æ, è¿™æ˜¯ç³»ç»Ÿç•™ç»™æˆ‘ä»¬çš„Hookå…¥å£ View view = tryCreateView(parent, name, context, attrs); // å¦‚æœ tryCreateViewæ–¹æ³•è¿”å›çš„Viewä¸ºç©ºï¼Œåˆ™åˆ¤æ–­æ˜¯å†…ç½®Viewè¿˜æ˜¯è‡ªå®šä¹‰View // å¦‚æœæ˜¯å†…ç½®çš„Viewåˆ™è°ƒç”¨onCreateViewæ–¹æ³•ï¼Œå¦‚æœæ˜¯è‡ªå®šä¹‰View åˆ™è°ƒç”¨createViewæ–¹æ³• if (view == null) { final Object lastContext = mConstructorArgs[0]; mConstructorArgs[0] = context; try { // å¦‚æœä½¿ç”¨è‡ªå®šä¹‰Viewï¼Œéœ€è¦åœ¨XMLæŒ‡å®šå…¨è·¯å¾„çš„ï¼Œ // ä¾‹å¦‚ï¼šcom.hi.dhl.CustomViewï¼Œé‚£ä¹ˆè¿™é‡Œå°±æœ‰ä¸ª.äº† // å¯ä»¥åˆ©ç”¨è¿™ä¸€ç‚¹åˆ¤å®šæ˜¯å†…ç½®çš„Viewï¼Œè¿˜æ˜¯è‡ªå®šä¹‰View if (-1 == name.indexOf('.')) { // è§£æå†…ç½®View view = onCreateView(context, parent, name, attrs); } else { // è§£æè‡ªå®šä¹‰View view = createView(context, name, null, attrs); } /** * onCreateViewæ–¹æ³•ä¸createViewæ–¹æ³•çš„åŒºåˆ« * onCreateViewæ–¹æ³•ï¼šä¼šç»™å†…ç½®çš„Viewå‰é¢åŠ ä¸€ä¸ªå‰ç¼€ï¼Œä¾‹å¦‚ï¼šandroid.widgetï¼Œæœ€ç»ˆä¼šè°ƒç”¨createViewæ–¹æ³• * createViewæ–¹æ³•: æ®å®Œæ•´çš„ç±»çš„è·¯å¾„ååˆ©ç”¨åå°„æœºåˆ¶æ„å»ºViewå¯¹è±¡ */ } finally { mConstructorArgs[0] = lastContext; } } return view; } catch (InflateException e) { throw e; } catch (ClassNotFoundException e) { throw ie; } catch (Exception e) { throw ie; }} è§£æ View æ ‡ç­¾ï¼Œå¦‚æœè®¾ç½®äº† theme, æ„å»ºä¸€ä¸ª ContextThemeWrapper è°ƒç”¨ tryCreateView æ–¹æ³•ï¼Œå¦‚æœ name æ˜¯ blinkï¼Œåˆ™åˆ›å»º BlinkLayoutï¼Œå¦‚æœè®¾ç½® factoryï¼Œæ ¹æ® factory è¿›è¡Œè§£æï¼Œè¿™æ˜¯ç³»ç»Ÿç•™ç»™æˆ‘ä»¬çš„ Hook å…¥å£ï¼Œæˆ‘ä»¬å¯ä»¥äººä¸ºçš„å¹²æ¶‰ç³»ç»Ÿåˆ›å»º Viewï¼Œæ·»åŠ æ›´å¤šçš„åŠŸèƒ½ å¦‚æœ tryCreateView æ–¹æ³•è¿”å›çš„ View ä¸ºç©ºï¼Œåˆ™åˆ†åˆ«è°ƒç”¨ onCreateView æ–¹æ³•å’Œ createView æ–¹æ³•ï¼ŒonCreateView æ–¹æ³•è§£æå†…ç½® Viewï¼ŒcreateView æ–¹æ³•è§£æè‡ªå®šä¹‰ View åœ¨è§£æè¿‡ç¨‹ä¸­ï¼Œä¼šå…ˆè°ƒç”¨ tryCreateView æ–¹æ³•ï¼Œæ¥çœ‹ä¸€ä¸‹ tryCreateView æ–¹æ³•å†…éƒ¨åšäº†ä»€ä¹ˆframeworks/base/core/java/android/view/LayoutInflater.java public final View tryCreateView(@Nullable View parent, @NonNull String name, @NonNull Context context, @NonNull AttributeSet attrs) { // BlinkLayoutå®ƒæ˜¯FrameLayoutçš„å­ç±»ï¼Œæ˜¯LayoutInflaterä¸­çš„ä¸€ä¸ªå†…éƒ¨ç±», // å¦‚æœå½“å‰æ ‡ç­¾ä¸ºTAG_1995ï¼Œåˆ™åˆ›å»ºä¸€ä¸ªéš”500æ¯«ç§’é—ªçƒä¸€æ¬¡çš„BlinkLayoutæ¥æ‰¿è½½å®ƒçš„å¸ƒå±€å†…å®¹ if (name.equals(TAG_1995)) { // Let's party like it's 1995! // æºç æ³¨é‡Šä¹Ÿå¾ˆæœ‰æ„æ€ï¼Œå†™äº†Let's party like it's 1995!, æ®è¯´æ˜¯ä¸ºäº†åº†ç¥1995å¹´çš„å¤æ´»èŠ‚ return new BlinkLayout(context, attrs); } // å¦‚æœè®¾ç½®factoryï¼Œæ ¹æ®factoryè¿›è¡Œè§£æ, è¿™æ˜¯ç³»ç»Ÿç•™ç»™æˆ‘ä»¬çš„Hookå…¥å£ï¼Œæˆ‘ä»¬å¯ä»¥äººä¸ºçš„å¹²æ¶‰ç³»ç»Ÿåˆ›å»ºViewï¼Œæ·»åŠ æ›´å¤šçš„åŠŸèƒ½ if (mFactory2 != null) { view = mFactory2.onCreateView(parent, name, context, attrs); } else if (mFactory != null) { view = mFactory.onCreateView(name, context, attrs); } else { view = null; } if (view == null &amp;&amp; mPrivateFactory != null) { view = mPrivateFactory.onCreateView(parent, name, context, attrs); } return view;} å¦‚æœ name æ˜¯ blinkï¼Œåˆ™åˆ›å»º BlinkLayoutï¼Œè¿”ç»™è°ƒç”¨è€… å¦‚æœè®¾ç½® factoryï¼Œæ ¹æ® factory è¿›è¡Œè§£æ, è¿™æ˜¯ç³»ç»Ÿç•™ç»™æˆ‘ä»¬çš„ Hook å…¥å£ï¼Œæˆ‘ä»¬å¯ä»¥äººä¸ºçš„å¹²æ¶‰ç³»ç»Ÿåˆ›å»º Viewï¼Œæ·»åŠ æ›´å¤šçš„åŠŸèƒ½ï¼Œä¾‹å¦‚å¤œé—´æ¨¡å¼ï¼Œå°† View è¿”ç»™è°ƒç”¨è€… æ ¹æ®åˆšæ‰çš„åˆ†æï¼Œä¼šå…ˆè°ƒç”¨ tryCreateView æ–¹æ³•ï¼Œå¦‚æœè¿™ä¸ªæ–¹æ³•è¿”å›çš„ View ä¸ºç©ºï¼Œç„¶åä¼šè°ƒç”¨ onCreateView æ–¹æ³•å¯¹å†…ç½® View è¿›è¡Œè§£æï¼ŒcreateView æ–¹æ³•å¯¹è‡ªå®šä¹‰ View è¿›è¡Œè§£æ onCreateView æ–¹æ³•ä¸ createView æ–¹æ³•çš„æœ‰ä»€ä¹ˆåŒºåˆ« onCreateView æ–¹æ³•ï¼šä¼šç»™å†…ç½®çš„ View å‰é¢åŠ ä¸€ä¸ªå‰ç¼€ï¼Œä¾‹å¦‚ï¼š android.widgetï¼Œæœ€ç»ˆä¼šè°ƒç”¨ createView æ–¹æ³• createView æ–¹æ³•: æ ¹æ®å®Œæ•´çš„ç±»çš„è·¯å¾„ååˆ©ç”¨åå°„æœºåˆ¶æ„å»º View å¯¹è±¡ æ¥çœ‹ä¸€ä¸‹è¿™ä¸¤ä¸ªæ–¹æ³•çš„å®ç°ï¼ŒLayoutInflater æ˜¯ä¸€ä¸ªæŠ½è±¡ç±»ï¼Œæˆ‘ä»¬å®é™…ä½¿ç”¨çš„æ˜¯ PhoneLayoutInflaterï¼Œå®ƒçš„ç»“æ„å¦‚ä¸‹ PhoneLayoutInflater é‡å†™äº† LayoutInflater çš„ onCreatView æ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•å°±æ˜¯ç»™å†…ç½®çš„ View å‰é¢åŠ ä¸€ä¸ªå‰ç¼€frameworks/base/core/java/com/android/internal/policy/PhoneLayoutInflater.java private static final String[] sClassPrefixList = { &quot;android.widget.&quot;, &quot;android.webkit.&quot;, &quot;android.app.&quot;}; protected View onCreateView(String name, AttributeSet attrs) throws ClassNotFoundException { for (String prefix : sClassPrefixList) { try { View view = createView(name, prefix, attrs); if (view != null) { return view; } } catch (ClassNotFoundException e) { } } return super.onCreateView(name, attrs);} onCreateView æ–¹æ³•ä¼šç»™å†…ç½®çš„ View å‰é¢åŠ ä¸€ä¸ªå‰ç¼€ï¼Œä¹‹åè°ƒç”¨ createView æ–¹æ³•ï¼ŒçœŸæ­£çš„ View æ„å»ºè¿˜æ˜¯åœ¨ LayoutInflater çš„ createView æ–¹æ³•é‡Œå®Œæˆçš„ï¼ŒcreateView æ–¹æ³•æ ¹æ®å®Œæ•´çš„ç±»çš„è·¯å¾„ååˆ©ç”¨åå°„æœºåˆ¶æ„å»º View å¯¹è±¡frameworks/base/core/java/android/view/LayoutInflater.java public final View createView(@NonNull Context viewContext, @NonNull String name, @Nullable String prefix, @Nullable AttributeSet attrs) throws ClassNotFoundException, InflateException { ... try { if (constructor == null) { // å¦‚æœåœ¨ç¼“å­˜ä¸­æ²¡æœ‰æ‰¾åˆ°æ„é€ å‡½æ•°ï¼Œåˆ™æ ¹æ®å®Œæ•´çš„ç±»çš„è·¯å¾„ååˆ©ç”¨åå°„æœºåˆ¶æ„å»ºViewå¯¹è±¡ clazz = Class.forName(prefix != null ? (prefix + name) : name, false, mContext.getClassLoader()).asSubclass(View.class); if (mFilter != null &amp;&amp; clazz != null) { boolean allowed = mFilter.onLoadClass(clazz); if (!allowed) { failNotAllowed(name, prefix, viewContext, attrs); } } // åˆ©ç”¨åå°„æœºåˆ¶æ„å»ºclazz, å°†å®ƒçš„æ„é€ å‡½æ•°å­˜å…¥sConstructorMapä¸­ï¼Œä¸‹æ¬¡å¯ä»¥ç›´æ¥ä»ç¼“å­˜ä¸­æŸ¥æ‰¾ constructor = clazz.getConstructor(mConstructorSignature); constructor.setAccessible(true); sConstructorMap.put(name, constructor); } else { // å¦‚æœä»ç¼“å­˜ä¸­æ‰¾åˆ°äº†ç¼“å­˜çš„æ„é€ å‡½æ•° if (mFilter != null) { Boolean allowedState = mFilterMap.get(name); if (allowedState == null) { // æ ¹æ®å®Œæ•´çš„ç±»çš„è·¯å¾„ååˆ©ç”¨åå°„æœºåˆ¶æ„å»ºViewå¯¹è±¡ clazz = Class.forName(prefix != null ? (prefix + name) : name, false, mContext.getClassLoader()).asSubclass(View.class); ... } else if (allowedState.equals(Boolean.FALSE)) { failNotAllowed(name, prefix, viewContext, attrs); } } } ... try { // åˆ©ç”¨æ„é€ å‡½æ•°ï¼Œåˆ›å»ºView final View view = constructor.newInstance(args); if (view instanceof ViewStub) { // å¦‚æœæ˜¯ViewStubï¼Œåˆ™è®¾ç½®LayoutInflater final ViewStub viewStub = (ViewStub) view; viewStub.setLayoutInflater(cloneInContext((Context) args[0])); } return view; } finally { mConstructorArgs[0] = lastContext; } } catch (NoSuchMethodException e) { throw ie; } catch (ClassCastException e) { throw ie; } catch (ClassNotFoundException e) { throw e; } catch (Exception e) { throw ie; } finally { }}``` * å…ˆä»ç¼“å­˜ä¸­å¯»æ‰¾æ„é€ å‡½æ•°ï¼Œå¦‚æœå­˜åœ¨ç›´æ¥ä½¿ç”¨* å¦‚æœæ²¡æœ‰æ‰¾åˆ°æ ¹æ®å®Œæ•´çš„ç±»çš„è·¯å¾„ååˆ©ç”¨åå°„æœºåˆ¶æ„å»º View å¯¹è±¡åˆ°äº†è¿™é‡Œå…³äº APK çš„å¸ƒå±€ XML èµ„æºæ–‡ä»¶çš„æŸ¥æ‰¾å’Œè§£æ -&gt; View çš„ç”Ÿæˆæµç¨‹åˆ°è¿™é‡Œå°±ç»“æŸäº†## æ€»ç»“é‚£æˆ‘ä»¬å°±æ¥ä¾æ¬¡æ¥å›ç­”ä¸Šé¢æå‡ºçš„å‡ ä¸ªé—®é¢˜**LayoutInflater çš„ inflate çš„ä¸‰ä¸ªå‚æ•°éƒ½ä»£è¡¨ä»€ä¹ˆæ„æ€ï¼Ÿ*** resourceï¼šè¦è§£æçš„ XML å¸ƒå±€æ–‡ä»¶ ID* rootï¼šè¡¨ç¤ºæ ¹å¸ƒå±€* attachToRootï¼šæ˜¯å¦è¦æ·»åŠ åˆ°çˆ¶å¸ƒå±€ root ä¸­resource å…¶å®å¾ˆå¥½ç†è§£å°±æ˜¯èµ„æº IDï¼Œè€Œ root å’Œ attachToRoot åˆ†åˆ«ä»£è¡¨ä»€ä¹ˆæ„æ€ï¼š* å½“ attachToRoot == true ä¸” root ï¼= null æ—¶ï¼Œæ–°è§£æå‡ºæ¥çš„ View ä¼šè¢« add åˆ° root ä¸­å»ï¼Œç„¶åå°† root ä½œä¸ºç»“æœè¿”å›* å½“ attachToRoot == false ä¸” root ï¼= null æ—¶ï¼Œæ–°è§£æçš„ View ä¼šç›´æ¥ä½œä¸ºç»“æœè¿”å›ï¼Œè€Œä¸” root ä¼šä¸ºæ–°è§£æçš„ View ç”Ÿæˆ LayoutParams å¹¶è®¾ç½®åˆ°è¯¥ View ä¸­å»* å½“ attachToRoot == false ä¸” root == null æ—¶ï¼Œæ–°è§£æçš„ View ä¼šç›´æ¥ä½œä¸ºç»“æœè¿”å›**ç³»ç»Ÿå¯¹ mergeã€include æ˜¯å¦‚ä½•å¤„ç†çš„*** ä½¿ç”¨ merge æ ‡ç­¾å¿…é¡»æœ‰çˆ¶å¸ƒå±€ï¼Œä¸”ä¾èµ–äºçˆ¶å¸ƒå±€åŠ è½½* merge å¹¶ä¸æ˜¯ä¸€ä¸ª ViewGroupï¼Œä¹Ÿä¸æ˜¯ä¸€ä¸ª Viewï¼Œå®ƒç›¸å½“äºå£°æ˜äº†ä¸€äº›è§†å›¾ï¼Œç­‰å¾…è¢«æ·»åŠ ï¼Œè§£æè¿‡ç¨‹ä¸­é‡åˆ° merge æ ‡ç­¾ä¼šå°† merge æ ‡ç­¾ä¸‹é¢çš„æ‰€æœ‰å­ view æ·»åŠ åˆ°æ ¹å¸ƒå±€ä¸­* merge æ ‡ç­¾åœ¨ XML ä¸­å¿…é¡»æ˜¯æ ¹å…ƒç´ * ç›¸åçš„ include ä¸èƒ½ä½œä¸ºæ ¹å…ƒç´ ï¼Œéœ€è¦æ”¾åœ¨ä¸€ä¸ª ViewGroup ä¸­* ä½¿ç”¨ include æ ‡ç­¾å¿…é¡»æŒ‡å®šæœ‰æ•ˆçš„ layout å±æ€§* ä½¿ç”¨ include æ ‡ç­¾ä¸å†™å®½é«˜æ˜¯æ²¡æœ‰å…³ç³»çš„ï¼Œä¼šå»è§£æè¢« include çš„ layout**merge æ ‡ç­¾ä¸ºä»€ä¹ˆå¯ä»¥èµ·åˆ°ä¼˜åŒ–å¸ƒå±€çš„æ•ˆæœï¼Ÿ**è§£æè¿‡ç¨‹ä¸­é‡åˆ° merge æ ‡ç­¾ï¼Œä¼šè°ƒç”¨ rInflate æ–¹æ³•ï¼Œéƒ¨åˆ†ä»£ç å¦‚ä¸‹ // æ ¹æ®å…ƒç´ åè§£æï¼Œç”Ÿæˆå¯¹åº”çš„Viewfinal View view = createViewFromTag(parent, name, context, attrs);final ViewGroup viewGroup = (ViewGroup) parent;final ViewGroup.LayoutParams params = viewGroup.generateLayoutParams(attrs);// rInflateChildrenæ–¹æ³•å†…éƒ¨è°ƒç”¨çš„rInflateæ–¹æ³•ï¼Œæ·±åº¦ä¼˜å…ˆéå†è§£ææ‰€æœ‰çš„å­ViewrInflateChildren(parser, view, attrs, true);// æ·»åŠ è§£æçš„ViewviewGroup.addView(view, params); è§£æ merge æ ‡ç­¾ä¸‹é¢çš„æ‰€æœ‰å­ Viewï¼Œç„¶åæ·»åŠ åˆ°æ ¹å¸ƒå±€ä¸­**View æ˜¯å¦‚ä½•è¢«å®ä¾‹åŒ–çš„ï¼Ÿ**View åˆ†ä¸ºç³»ç»Ÿ View å’Œè‡ªå®šä¹‰ View, é€šè¿‡è°ƒç”¨ onCreateView ä¸createView æ–¹æ³•è¿›è¡Œä¸åŒçš„å¤„ç†* onCreateView æ–¹æ³•ï¼šä¼šç»™å†…ç½®çš„ View å‰é¢åŠ ä¸€ä¸ªå‰ç¼€ï¼Œä¾‹å¦‚ï¼šandroid.widgetï¼Œæœ€ç»ˆä¼šè°ƒç”¨ createView æ–¹æ³•* createView æ–¹æ³•ï¼šæ ¹æ®å®Œæ•´çš„ç±»çš„è·¯å¾„ååˆ©ç”¨åå°„æœºåˆ¶æ„å»º View å¯¹è±¡**ä¸ºä»€ä¹ˆå¤æ‚å¸ƒå±€ä¼šäº§ç”Ÿå¡é¡¿ï¼Ÿåœ¨ Android 10 ä¸Šåšäº†é‚£äº›ä¼˜åŒ–ï¼Ÿ*** XmlResourseParser å¯¹ XML çš„éå†ï¼Œéšç€å¸ƒå±€è¶Šå¤æ‚ï¼Œå±‚çº§åµŒå¥—è¶Šå¤šï¼Œæ‰€èŠ±è´¹çš„æ—¶é—´ä¹Ÿè¶Šé•¿* è°ƒç”¨ onCreateView ä¸ createView æ–¹æ³•æ˜¯é€šè¿‡åå°„åˆ›å»º View å¯¹è±¡å¯¼è‡´çš„è€—æ—¶* åœ¨ Android 10ä¸Šï¼Œæ–°å¢ tryInflatePrecompiled æ–¹æ³•æ˜¯ä¸ºäº†å‡å°‘ XmlPullParser è§£æ XML çš„æ—¶é—´ï¼Œä½†æ˜¯ç”¨ä¸€ä¸ªå…¨å±€å˜é‡ mUseCompiledView æ¥æ§åˆ¶æ˜¯å¦å¯ç”¨ tryInflatePrecompiled æ–¹æ³•ï¼Œæ ¹æ®æºç åˆ†æï¼ŒmUseCompiledView å§‹ç»ˆä¸º falseï¼Œæ‰€ä»¥ tryInflatePrecompiled æ–¹æ³•ç›®å‰åœ¨ release ç‰ˆæœ¬ä¸­ä¸å¯ä½¿ç”¨**BlinkLayout æ˜¯ä»€ä¹ˆï¼Ÿ**BlinkLayout ç»§æ‰¿ FrameLayoutï¼Œæ˜¯ä¸€ç§ä¼šé—ªçƒçš„å¸ƒå±€ï¼Œè¢«åŒ…è£¹çš„å†…å®¹ä¼šä¸€ç›´é—ªçƒï¼Œæ ¹æ®æºç æ³¨é‡Š Let's party like it's 1995!ï¼ŒBlinkLayout æ˜¯ä¸ºäº†åº†ç¥ 1995 å¹´çš„å¤æ´»èŠ‚, æœ‰å…´è¶£å¯ä»¥çœ‹çœ‹ [reddit](https://www.reddit.com/r/androiddev/comments/3sekn8/lets_party_like_its_1995_from_the_layoutinflater/) ä¸Šçš„è®¨è®ºï¼Œæ¥æŸ¥çœ‹ä¸€ä¸‹å®ƒçš„æºç æ˜¯å¦‚ä½•å®ç°çš„&lt;br/&gt; private static class BlinkLayout extends FrameLayout { private static final int MESSAGE_BLINK = 0x42; private static final int BLINK_DELAY = 500; private boolean mBlink; private boolean mBlinkState; private final Handler mHandler; public BlinkLayout(Context context, AttributeSet attrs) { super(context, attrs); mHandler = new Handler(new Handler.Callback() { @Override public boolean handleMessage(Message msg) { if (msg.what == MESSAGE_BLINK) { if (mBlink) { mBlinkState = !mBlinkState; // æ¯éš”500mså¾ªç¯è°ƒç”¨ makeBlink(); } // è§¦å‘dispatchDraw invalidate(); return true; } return false; } }); } private void makeBlink() { // å‘é€å»¶è¿Ÿæ¶ˆæ¯ Message message = mHandler.obtainMessage(MESSAGE_BLINK); mHandler.sendMessageDelayed(message, BLINK_DELAY); } @Override protected void onAttachedToWindow() { super.onAttachedToWindow(); mBlink = true; mBlinkState = true; makeBlink(); } @Override protected void onDetachedFromWindow() { super.onDetachedFromWindow(); mBlink = false; mBlinkState = true; // ç§»é™¤æ¶ˆæ¯ï¼Œé¿å…å†…å­˜æ³„éœ² mHandler.removeMessages(MESSAGE_BLINK); } @Override protected void dispatchDraw(Canvas canvas) { if (mBlinkState) { super.dispatchDraw(canvas); } }} é€šè¿‡æºç åˆ†æå¯ä»¥çœ‹å‡ºï¼ŒBlinkLayout é€šè¿‡ Handler æ¯éš” 500ms å‘é€æ¶ˆæ¯ï¼Œåœ¨ handleMessage ä¸­å¾ªç¯è°ƒç”¨ invalidate æ–¹æ³•ï¼Œé€šè¿‡è°ƒç”¨ invalidate æ–¹æ³•ï¼Œæ¥è§¦å‘ dispatchDraw æ–¹æ³•ï¼Œåšåˆ°ä¸€é—ªä¸€é—ªçš„æ•ˆæœ ## å‚è€ƒ * [https://www.reddit.com/r/androiddev/comments/3sekn8/lets_party_like_its_1995_from_the_layoutinflater/](https://www.reddit.com/r/androiddev/comments/3sekn8/lets_party_like_its_1995_from_the_layoutinflater/) * [https://github.com/RTFSC-Android/RTFSC/blob/master/LayoutInflater.md](https://github.com/RTFSC-Android/RTFSC/blob/master/LayoutInflater.md) * [https://www.yuque.com/beesx/beesandroid/gd7w9o](https://www.yuque.com/beesx/beesandroid/gd7w9o)","link":"/2020/06/07/android10/resource-manager/03-APK-resource/"},{"title":"0xA02 Android 10 æºç åˆ†æï¼šAPK çš„å®‰è£…æµç¨‹","text":"å‰è¨€ è¿™æ˜¯ Android 10 æºç åˆ†æç³»åˆ—çš„ç¬¬ 2 ç¯‡ åˆ†æ”¯ï¼šandroid-10.0.0_r14 å…¨æ–‡é˜…è¯»å¤§æ¦‚ 10 åˆ†é’Ÿ ä¸Šä¸€ç¯‡æ–‡ç« ä»‹ç»äº† 0xA01 Android 10 æºç åˆ†æï¼šAPK æ˜¯å¦‚ä½•ç”Ÿæˆçš„ï¼Œè¿™ç¯‡æ–‡ç« æ¥ç€ä»‹ç»å¦‚ä½•å®‰è£… APKï¼Œéœ€è¦è¯´ä¸€ä¸‹ Android 10 åŠæ›´é«˜ç‰ˆæœ¬ä¸­, å®‰è£…å™¨ PackageInstaller æºç ä½ç½®æœ‰æ‰€å˜åŠ¨ PackageInstaller æºç æ‰€åœ¨ä½ç½®PackageInstaller æ˜¯ç³»ç»Ÿå†…ç½®çš„åº”ç”¨ç¨‹åºï¼Œç”¨äºå®‰è£…å’Œå¸è½½åº”ç”¨ åœ¨ Android 9 åŠæ›´ä½ç‰ˆæœ¬ä¸­ï¼Œè½¯ä»¶åŒ…å®‰è£…å’Œæƒé™æ§åˆ¶åŠŸèƒ½åŒ…å«åœ¨ PackageInstaller è½¯ä»¶åŒ… (//packages/apps/PackageInstaller) ä¸­ã€‚åœ¨ Android 10 åŠæ›´é«˜ç‰ˆæœ¬ä¸­ï¼Œæƒé™æ§åˆ¶åŠŸèƒ½ä½äºå•ç‹¬çš„è½¯ä»¶åŒ… PermissionController (//packages/apps/PermissionController)ï¼Œè¿™ä¸¤ä¸ªè½¯ä»¶åŒ…åœ¨ Android 10 ä¸­çš„ä½ç½®å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œæ›´å¤šä¿¡æ¯ç‚¹å‡»è¿™é‡Œå‰å¾€ Android æƒé™ Android 9 åŠæ›´ä½ç‰ˆæœ¬ä¸­ ï¼š è½¯ä»¶åŒ…å®‰è£…å’Œæƒé™æ§åˆ¶åŠŸèƒ½æºç è·¯å¾„ï¼špackages/apps/PackageInstaller Android 10 åŠæ›´é«˜ç‰ˆæœ¬ï¼š æƒé™æ§åˆ¶åŠŸèƒ½ PermissionController æºç è·¯å¾„ï¼špackages/apps/PermissionController/ å®‰è£…å™¨ PackageInstaller æºç è·¯å¾„ï¼šframeworks/base/packages/PackageInstaller/ åœ¨ Android ç³»ç»Ÿä¸åŒçš„ç›®å½•å­˜æ”¾ä¸åŒç±»å‹çš„åº”ç”¨ /system/framworkï¼šä¿å­˜çš„æ˜¯èµ„æºå‹çš„åº”ç”¨ç¨‹åºï¼Œå®ƒä»¬ç”¨æ¥æ‰“åŒ…èµ„æºæ–‡ä»¶ /system/appï¼šä¿å­˜ç³»ç»Ÿè‡ªå¸¦çš„åº”ç”¨ç¨‹åº /data/appï¼šä¿å­˜ç”¨æˆ·å®‰è£…çš„åº”ç”¨ç¨‹åº /data/dataï¼šåº”ç”¨æ•°æ®ç›®å½• /data/app-privateï¼šä¿å­˜å—DRMä¿æŠ¤çš„ç§æœ‰åº”ç”¨ç¨‹åº /vendor/appï¼šä¿å­˜è®¾å¤‡å‚å•†æä¾›çš„åº”ç”¨ç¨‹åº æŸ¥çœ‹ PackageInstaller æºç æ–¹å¼ AOSP-PackageInstaller: åŒ…å«äº†å®‰è£…å™¨ PackageInstaller(7.1.2ã€8.1.0ã€9.0.0ã€10.0.0) çš„æºç ï¼Œå¯ä»¥åˆ‡æ¢åˆ†ä¹‹æŸ¥çœ‹ï¼Œè·Ÿéš Android ç‰ˆæœ¬æ›´æ–°ï¼Œä½ æ°¸è¿œå¯ä»¥çœ‹åˆ°æœ€æ–°çš„æºä»£ç  aospxrefï¼šè¿™æ˜¯ä¸€ä¸ªåœ¨çº¿æŸ¥çœ‹ Android æºç ç½‘ç«™ï¼ŒæœåŠ¡å™¨åœ¨é˜¿é‡Œäº‘è®¿é—®é€Ÿåº¦å¾ˆå¿«ï¼Œæ–‡æœ«æœ‰å…³è¿™ä¸ªç½‘ç«™çš„ä»‹ç» googlesource-PackageInstallerï¼šè¿™æ˜¯å®‰è£…å™¨ PackageInstaller åœ¨ googlesource ä¸Šçš„åœ°å€ 1. APK çš„å®‰è£…æ–¹å¼å®‰è£… APK ä¸»è¦åˆ†ä¸ºä»¥ä¸‹ä¸‰ç§åœºæ™¯ å®‰è£…ç³»ç»Ÿåº”ç”¨ï¼šç³»ç»Ÿå¯åŠ¨åè°ƒç”¨ PackageManagerService.main() åˆå§‹åŒ–æ³¨å†Œè§£æå®‰è£…å·¥ä½œ public static PackageManagerService main(Context context, Installer installer, boolean factoryTest, boolean onlyCore) { // Self-check for initial settings. PackageManagerServiceCompilerMapping.checkProperties(); PackageManagerService m = new PackageManagerService(context, installer, factoryTest, onlyCore); m.enableSystemUserPackages(); ServiceManager.addService(&quot;package&quot;, m); final PackageManagerNative pmn = m.new PackageManagerNative(); ServiceManager.addService(&quot;package_native&quot;, pmn); return m;} é€šè¿‡ adb å®‰è£…ï¼šé€šè¿‡ pm å‚æ•°ï¼Œè°ƒç”¨ PM çš„ runInstall æ–¹æ³•ï¼Œè¿›å…¥ PackageManagerService å®‰è£…å®‰è£…å·¥ä½œ é€šè¿‡ç³»ç»Ÿå®‰è£…å™¨ PackageInstaller è¿›è¡Œå®‰è£…ï¼šå…ˆè°ƒç”¨ InstallStart è¿›è¡Œæƒé™æ£€æŸ¥ä¹‹åå¯åŠ¨ PackageInstallActivityï¼Œè°ƒç”¨ PackageInstallActivity çš„ startInstall æ–¹æ³•ï¼Œç‚¹å‡» OK æŒ‰é’®åè¿›å…¥ PackageManagerService å®Œæˆæ‹·è´è§£æå®‰è£…å·¥ä½œ æ‰€æœ‰å®‰è£…æ–¹å¼å¤§è‡´ç›¸åŒï¼Œæœ€ç»ˆå°±æ˜¯å›åˆ° PackageManagerService ä¸­ï¼Œå®‰è£…ä¸€ä¸ª APK çš„å¤§è‡´æµç¨‹å¦‚ä¸‹ï¼š æ‹·è´åˆ° APK æ–‡ä»¶åˆ°æŒ‡å®šç›®å½• è§£å‹ç¼© APKï¼Œæ‹·è´æ–‡ä»¶ï¼Œåˆ›å»ºåº”ç”¨çš„æ•°æ®ç›®å½• è§£æ APK çš„ AndroidManifest.xml æ–‡ä»¶ å‘ Launcher åº”ç”¨ç”³è¯·æ·»åŠ åˆ›å»ºå¿«æ·æ–¹å¼ æœ¬æ–‡ä¸»è¦æ¥åˆ†æé€šè¿‡å®‰è£…å™¨ PackageInstaller å®‰è£… APKï¼Œè¿™æ˜¯ç”¨æˆ·æœ€å¸¸ç”¨çš„ä¸€ç§æ–¹å¼ 2. PackageInstaller çš„å…¥å£ä¸‹é¢ä»£ç ä¸€å®šä¸ä¼šå¾ˆé™Œç”Ÿï¼Œè¿™å°±æ˜¯æˆ‘ä»¬å¸¸ç”¨çš„å®‰è£… APK çš„ä»£ç ï¼ˆPS: å…³äºé™é»˜å®‰è£…æˆ‘ä¼šåç»­åˆ†äº«åœ¨é€†å‘å¼€å‘ç›¸å…³çš„æ–‡ç« ï¼‰ Intent intent = new Intent(Intent.ACTION_VIEW);intent.setFlags(Intent.FLAG_ACTIVITY_NEW_TASK);/** è‡ªAndroid Nå¼€å§‹ï¼Œæ˜¯é€šè¿‡FileProviderå…±äº«ç›¸å…³æ–‡ä»¶ï¼Œä½†æ˜¯Android Qå¯¹å…¬* æœ‰ç›®å½• File APIè¿›è¡Œäº†é™åˆ¶ï¼Œåªèƒ½é€šè¿‡Uriæ¥æ“ä½œ*/if(Build.VERSION.SDK_INT &gt;= Build.VERSION_CODES.Q){ // filePathæ˜¯é€šè¿‡ContentResolverå¾—åˆ°çš„ intent.setDataAndType(Uri.parse(filePath) ,&quot;application/vnd.android.package-archive&quot;); intent.addFlags(Intent.FLAG_GRANT_READ_URI_PERMISSION);}else if (Build.VERSION.SDK_INT &gt;= Build.VERSION_CODES.N) { intent.setFlags(Intent.FLAG_GRANT_READ_URI_PERMISSION); Uri contentUri = FileProvider.getUriForFile(mContext, &quot;com.dhl.file.fileProvider&quot;, file); intent.setDataAndType(contentUri, &quot;application/vnd.android.package-archive&quot;);} else { intent.setDataAndType(Uri.fromFile(file), &quot;application/vnd.android.package-archive&quot;);}startActivity(intent);// éœ€è¦åœ¨AndroidManifestæ·»åŠ æƒé™&lt;uses-permission android:name=&quot;android.permission.REQUEST_INSTALL_PACKAGES&quot; /&gt; é€šè¿‡ intent.setDataAndType æ–¹æ³•æŒ‡å®š Intent çš„æ•°æ®ç±»å‹ä¸º application/vnd.android.package-archiveï¼Œéšå¼åŒ¹é…çš„ Activity ä¸º InstallStartï¼šframeworks/base/packages/PackageInstaller/AndroidManifest.xml &lt;activity android:name=&quot;.InstallStart&quot; android:theme=&quot;@android:style/Theme.Translucent.NoTitleBar&quot; android:exported=&quot;true&quot; android:excludeFromRecents=&quot;true&quot;&gt; &lt;intent-filter android:priority=&quot;1&quot;&gt; &lt;action android:name=&quot;android.intent.action.VIEW&quot; /&gt; &lt;action android:name=&quot;android.intent.action.INSTALL_PACKAGE&quot; /&gt; &lt;category android:name=&quot;android.intent.category.DEFAULT&quot; /&gt; &lt;data android:scheme=&quot;content&quot; /&gt; &lt;data android:mimeType=&quot;application/vnd.android.package-archive&quot; /&gt; &lt;/intent-filter&gt; &lt;intent-filter android:priority=&quot;1&quot;&gt; &lt;action android:name=&quot;android.intent.action.INSTALL_PACKAGE&quot; /&gt; &lt;category android:name=&quot;android.intent.category.DEFAULT&quot; /&gt; &lt;data android:scheme=&quot;package&quot; /&gt; &lt;data android:scheme=&quot;content&quot; /&gt; &lt;/intent-filter&gt; &lt;intent-filter android:priority=&quot;1&quot;&gt; &lt;action android:name=&quot;android.content.pm.action.CONFIRM_INSTALL&quot; /&gt; &lt;category android:name=&quot;android.intent.category.DEFAULT&quot; /&gt; &lt;/intent-filter&gt;&lt;/activity&gt; æœ¬æ–‡åˆ†æçš„æ˜¯ 10.0 çš„æºç ï¼Œåœ¨ 8.0ã€9.0ã€10.0 ç­‰ç­‰ç‰ˆæœ¬ä¸­éšå¼åŒ¹é…çš„ Activity æ˜¯ InstallStartï¼Œ7.0 éšå¼åŒ¹é…çš„ Activity æ˜¯ PackageInstallerActivity å®‰è£…å™¨ PackageInstaller çš„å…¥å£ Activity æ˜¯ InstallStartï¼Œå®šä¹‰äº†ä¸¤ä¸ª schemeï¼šcontent å’Œ package 3. APK çš„å®‰è£…æµç¨‹é€šè¿‡ä¸Šé¢æ–¹å¼æ‰¾åˆ°äº†å…¥å£ Activityï¼Œä¸‹é¢æˆ‘ä»¬æ¥æŸ¥çœ‹ä¸€ä¸‹ APK æ˜¯å¦‚ä½•å®‰è£…çš„ 3.1 InstallStartä¸»è¦å·¥ä½œï¼š åˆ¤æ–­æ˜¯å¦å‹¾é€‰â€œæœªçŸ¥æ¥æºâ€é€‰é¡¹ï¼Œè‹¥æœªå‹¾é€‰è·³è½¬åˆ°è®¾ç½®å®‰è£…æœªçŸ¥æ¥æºç•Œé¢ å¯¹äºå¤§äºç­‰äº Android 8.0 ç‰ˆæœ¬ï¼Œä¼šå…ˆæ£€æŸ¥æ˜¯å¦ç”³è¯·å®‰è£…æƒé™ï¼Œè‹¥æ²¡æœ‰åˆ™ä¸­æ–­å®‰è£… åˆ¤æ–­ Uri çš„ Scheme åè®®ï¼Œè‹¥æ˜¯ content åˆ™è°ƒç”¨ InstallStaging, è‹¥æ˜¯ package åˆ™è°ƒç”¨ PackageInstallerActivity å½“æˆ‘ä»¬è°ƒç”¨ä¸Šé¢å®‰è£…ä»£ç æ¥å®‰è£… APK æ—¶ã€‚ä¼šè·³è½¬åˆ° InstallStart, å¹¶è°ƒç”¨å®ƒçš„ onCreate æ–¹æ³•ï¼šframeworks/base/packages/PackageInstaller/src/com/android/packageinstaller/InstallStart.java @Overrideprotected void onCreate(@Nullable Bundle savedInstanceState) { super.onCreate(savedInstanceState); ... final boolean isSessionInstall = PackageInstaller.ACTION_CONFIRM_INSTALL.equals(intent.getAction()); ... final ApplicationInfo sourceInfo = getSourceInfo(callingPackage); final int originatingUid = getOriginatingUid(sourceInfo); boolean isTrustedSource = false; // åˆ¤æ–­æ˜¯å¦å‹¾é€‰â€œæœªçŸ¥æ¥æºâ€é€‰é¡¹ if (sourceInfo != null &amp;&amp; (sourceInfo.privateFlags &amp; ApplicationInfo.PRIVATE_FLAG_PRIVILEGED) != 0) { isTrustedSource = intent.getBooleanExtra(Intent.EXTRA_NOT_UNKNOWN_SOURCE, false); } if (!isTrustedSource &amp;&amp; originatingUid != PackageInstaller.SessionParams.UID_UNKNOWN) { final int targetSdkVersion = getMaxTargetSdkVersionForUid(this, originatingUid); // å¦‚æœtargetSdkVerisonå°äº0ä¸­æ­¢å®‰è£… if (targetSdkVersion &lt; 0) { Log.w(LOG_TAG, &quot;Cannot get target sdk version for uid &quot; + originatingUid); mAbortInstall = true; // å¦‚æœtargetSdkVersionå¤§äºç­‰äº26ï¼ˆ8.0ï¼‰, ä¸”è·å–ä¸åˆ°REQUEST_INSTALL_PACKAGESæƒé™ä¸­æ­¢å®‰è£… } else if (targetSdkVersion &gt;= Build.VERSION_CODES.O &amp;&amp; !declaresAppOpPermission( originatingUid, Manifest.permission.REQUEST_INSTALL_PACKAGES)) { Log.e(LOG_TAG, &quot;Requesting uid &quot; + originatingUid + &quot; needs to declare permission &quot; + Manifest.permission.REQUEST_INSTALL_PACKAGES); mAbortInstall = true; } } ... // å¦‚æœè®¾ç½®äº†ACTION_CONFIRM_PERMISSIONSï¼Œåˆ™è°ƒç”¨PackageInstallerActivityã€‚ if (isSessionInstall) { nextActivity.setClass(this, PackageInstallerActivity.class); } else { Uri packageUri = intent.getData(); // åˆ¤æ–­Uriçš„Schemeåè®®æ˜¯å¦æ˜¯content if (packageUri != null &amp;&amp; packageUri.getScheme().equals( ContentResolver.SCHEME_CONTENT)) { // [IMPORTANT] This path is deprecated, but should still work. // è¿™ä¸ªè·¯å¾„å·²ç»è¢«èµ·ç”¨äº†ï¼Œä½†æ˜¯ä»ç„¶å¯ä»¥å·¥ä½œ // è°ƒç”¨InstallStagingæ¥æ‹·è´file/contentï¼Œé˜²æ­¢è¢«ä¿®æ”¹ nextActivity.setClass(this, InstallStaging.class); } else if (packageUri != null &amp;&amp; packageUri.getScheme().equals( PackageInstallerActivity.SCHEME_PACKAGE)) { // å¦‚æœUriä¸­åŒ…å«packageï¼Œåˆ™è°ƒç”¨PackageInstallerActivity nextActivity.setClass(this, PackageInstallerActivity.class); } else { // Uriä¸åˆæ³• Intent result = new Intent(); result.putExtra(Intent.EXTRA_INSTALL_RESULT, PackageManager.INSTALL_FAILED_INVALID_URI); setResult(RESULT_FIRST_USER, result); nextActivity = null; } } if (nextActivity != null) { startActivity(nextActivity); } finish();} æ ¹æ® Uri çš„ Scheme åè®®ï¼Œè‹¥æ˜¯ content åˆ™è°ƒç”¨ InstallStagingï¼ŒæŸ¥çœ‹ InstallStaging çš„ onResumeæ–¹æ³•ï¼šframeworks/base/packages/PackageInstaller/src/com/android/packageinstaller/InstallStaging.java @Overrideprotected void onResume() { super.onResume(); if (mStagingTask == null) { if (mStagedFile == null) { // åˆ›å»ºä¸´æ—¶æ–‡ä»¶ mStagedFile ç”¨æ¥å­˜å‚¨æ•°æ® try { mStagedFile = TemporaryFileManager.getStagedFile(this); } catch (IOException e) { showError(); return; } } // å¯åŠ¨ StagingAsyncTaskï¼Œå¹¶ä¼ å…¥äº†contentåè®®çš„Uri mStagingTask = new StagingAsyncTask(); mStagingTask.execute(getIntent().getData()); }} åˆ›å»ºä¸´æ—¶æ–‡ä»¶ mStagedFile ç”¨æ¥å­˜å‚¨æ•°æ® å¯åŠ¨ StagingAsyncTaskï¼Œå¹¶ä¼ å…¥äº† content åè®®çš„ Uri private final class StagingAsyncTask extends AsyncTask&lt;Uri, Void, Boolean&gt; { @Override protected Boolean doInBackground(Uri... params) { ... Uri packageUri = params[0]; try (InputStream in = getContentResolver().openInputStream(packageUri)) { ... // å°†packageUriï¼ˆcontentåè®®çš„Uriï¼‰çš„å†…å®¹å†™å…¥åˆ°mStagedFileä¸­ try (OutputStream out = new FileOutputStream(mStagedFile)) { byte[] buffer = new byte[1024 * 1024]; int bytesRead; while ((bytesRead = in.read(buffer)) &gt;= 0) { // Be nice and respond to a cancellation if (isCancelled()) { return false; } out.write(buffer, 0, bytesRead); } } } catch (IOException | SecurityException | IllegalStateException e) { Log.w(LOG_TAG, &quot;Error staging apk from content URI&quot;, e); return false; } return true; } @Override protected void onPostExecute(Boolean success) { if (success) { // å¦‚æœå†™å…¥æˆåŠŸï¼Œè°ƒç”¨DeleteStagedFileOnResult Intent installIntent = new Intent(getIntent()); installIntent.setClass(InstallStaging.this, DeleteStagedFileOnResult.class); installIntent.setData(Uri.fromFile(mStagedFile)); ... startActivity(installIntent); InstallStaging.this.finish(); } else { showError(); } }} doInBackground æ–¹æ³•ä¸­å°† packageUriï¼ˆcontent åè®®çš„ Uriï¼‰çš„å†…å®¹å†™å…¥åˆ° mStagedFile ä¸­ å¦‚æœå†™å…¥æˆåŠŸï¼Œè°ƒç”¨ DeleteStagedFileOnResult çš„ OnCreate æ–¹æ³•ï¼š frameworks/base/packages/PackageInstaller/src/com/android/packageinstaller/DeleteStagedFileOnResult.java protected void onCreate(@Nullable Bundle savedInstanceState) { super.onCreate(savedInstanceState); if (savedInstanceState == null) { // å¯åŠ¨PackageInstallerActivity Intent installIntent = new Intent(getIntent()); installIntent.setClass(this, PackageInstallerActivity.class); installIntent.setFlags(Intent.FLAG_ACTIVITY_NO_ANIMATION); startActivityForResult(installIntent, 0); }} ç»è¿‡åˆ†æ InstallStaging ä¸»è¦èµ·äº†ä¸­è½¬ä½œç”¨ï¼Œå°† content åè®®çš„ Uri è½¬æ¢ä¸º File åè®®ï¼Œæœ€åè·³è½¬åˆ° PackageInstallerActivity 3.2 PackageInstallerActivityä¸»è¦å·¥ä½œï¼š æ˜¾ç¤ºå®‰è£…ç•Œé¢ åˆå§‹åŒ–å®‰è£…éœ€è¦ç”¨çš„å„ç§å¯¹è±¡ï¼Œæ¯”å¦‚ PackageManagerã€IPackageManagerã€AppOpsManagerã€UserManagerã€PackageInstaller ç­‰ç­‰ æ ¹æ®ä¼ é€’è¿‡æ¥çš„ Scheme åè®®åšä¸åŒçš„å¤„ç† æ£€æŸ¥æ˜¯å¦å…è®¸ã€åˆå§‹åŒ–å®‰è£… åœ¨å‡†å¤‡å®‰è£…çš„ä¹‹å‰ï¼Œæ£€æŸ¥åº”ç”¨åˆ—è¡¨åˆ¤æ–­è¯¥åº”ç”¨æ˜¯å¦å·²å®‰è£…ï¼Œè‹¥å·²å®‰è£…åˆ™æç¤ºè¯¥åº”ç”¨å·²å®‰è£…ï¼Œç”±ç”¨æˆ·å†³å®šæ˜¯å¦æ›¿æ¢ åœ¨å®‰è£…ç•Œé¢ï¼Œæå–å‡º APK ä¸­æƒé™ä¿¡æ¯å¹¶å±•ç¤ºå‡ºæ¥ ç‚¹å‡» OK æŒ‰é’®ç¡®è®¤å®‰è£…åï¼Œä¼šè°ƒç”¨ startInstall å¼€å§‹å®‰è£…å·¥ä½œ PackageInstallerActivity æ‰æ˜¯åº”ç”¨å®‰è£…å™¨ PackageInstaller çœŸæ­£çš„å…¥å£ Activityï¼ŒæŸ¥çœ‹å®ƒçš„ onCreate æ–¹æ³•ï¼šframeworks/base/packages/PackageInstaller/src/com/android/packageinstaller/PackageInstallerActivity.java protected void onCreate(Bundle icicle) { getWindow().addSystemFlags(SYSTEM_FLAG_HIDE_NON_SYSTEM_OVERLAY_WINDOWS); super.onCreate(null); // åˆå§‹åŒ–å®‰è£…éœ€è¦ç”¨åˆ°çš„å¯¹è±¡ mPm = getPackageManager(); mIpm = AppGlobals.getPackageManager(); mAppOpsManager = (AppOpsManager) getSystemService(Context.APP_OPS_SERVICE); mInstaller = mPm.getPackageInstaller(); mUserManager = (UserManager) getSystemService(Context.USER_SERVICE); // æ ¹æ®Uriçš„Schemeåšä¸åŒçš„å¤„ç† boolean wasSetUp = processPackageUri(packageUri); if (!wasSetUp) { return; } // æ˜¾ç¤ºå®‰è£…ç•Œé¢ bindUi(); // æ£€æŸ¥æ˜¯å¦å…è®¸å®‰è£…åŒ…ï¼Œå¦‚æœå…è®¸åˆ™å¯åŠ¨å®‰è£…ã€‚å¦‚æœä¸å…è®¸æ˜¾ç¤ºé€‚å½“çš„å¯¹è¯æ¡† checkIfAllowedAndInitiateInstall();} ä¸»è¦åšäº†å¯¹è±¡çš„åˆå§‹åŒ–ï¼Œè§£æ Uri çš„ Schemeï¼Œåˆå§‹åŒ–ç•Œé¢ï¼Œå®‰è£…åŒ…æ£€æŸ¥ç­‰ç­‰å·¥ä½œï¼Œæ¥ç€æŸ¥çœ‹ä¸€ä¸‹ processPackageUri æ–¹æ³• private boolean processPackageUri(final Uri packageUri) { mPackageURI = packageUri; final String scheme = packageUri.getScheme(); // æ ¹æ®è¿™ä¸ªSchemeåè®®åˆ†åˆ«å¯¹packageåè®®å’Œfileåè®®è¿›è¡Œå¤„ç† switch (scheme) { case SCHEME_PACKAGE: { try { // é€šè¿‡PackageManagerå¯¹è±¡è·å–æŒ‡å®šåŒ…åçš„åŒ…ä¿¡æ¯ mPkgInfo = mPm.getPackageInfo(packageUri.getSchemeSpecificPart(), PackageManager.GET_PERMISSIONS | PackageManager.MATCH_UNINSTALLED_PACKAGES); } catch (NameNotFoundException e) { } if (mPkgInfo == null) { Log.w(TAG, &quot;Requested package &quot; + packageUri.getScheme() + &quot; not available. Discontinuing installation&quot;); showDialogInner(DLG_PACKAGE_ERROR); setPmResult(PackageManager.INSTALL_FAILED_INVALID_APK); return false; } mAppSnippet = new PackageUtil.AppSnippet(mPm.getApplicationLabel(mPkgInfo.applicationInfo), mPm.getApplicationIcon(mPkgInfo.applicationInfo)); } break; case ContentResolver.SCHEME_FILE: { // æ ¹æ®packageUriåˆ›å»ºä¸€ä¸ªæ–°çš„File File sourceFile = new File(packageUri.getPath()); // è§£æAPKå¾—åˆ°APKçš„ä¿¡æ¯ï¼ŒPackageParser.Packageå­˜å‚¨äº†APKçš„æ‰€æœ‰ä¿¡æ¯ PackageParser.Package parsed = PackageUtil.getPackageInfo(this, sourceFile); if (parsed == null) { Log.w(TAG, &quot;Parse error when parsing manifest. Discontinuing installation&quot;); showDialogInner(DLG_PACKAGE_ERROR); setPmResult(PackageManager.INSTALL_FAILED_INVALID_APK); return false; } // æ ¹æ®PackageParser.Packageå¾—åˆ°çš„APKä¿¡æ¯ï¼Œç”ŸæˆPackageInfo mPkgInfo = PackageParser.generatePackageInfo(parsed, null, PackageManager.GET_PERMISSIONS, 0, 0, null, new PackageUserState()); mAppSnippet = PackageUtil.getAppSnippet(this, mPkgInfo.applicationInfo, sourceFile); } break; default: { throw new IllegalArgumentException(&quot;Unexpected URI scheme &quot; + packageUri); } } return true;} ä¸»è¦å¯¹ Scheme åè®®åˆ†åˆ«å¯¹ package åè®®å’Œ file åè®®è¿›è¡Œå¤„ç† SCHEME_PACKAGEï¼š åœ¨ package åè®®ä¸­è°ƒç”¨äº† PackageManager.getPackageInfo æ–¹æ³•ç”Ÿæˆ PackageInfoï¼ŒPackageInfo æ˜¯è·¨è¿›ç¨‹ä¼ é€’çš„åŒ…æ•°æ®ï¼ˆactivitiesã€receiversã€servicesã€providersã€permissionsç­‰ç­‰ï¼‰åŒ…å« APK çš„æ‰€æœ‰ä¿¡æ¯ SCHEME_FILEï¼š åœ¨ file åè®®çš„å¤„ç†ä¸­è°ƒç”¨äº† PackageUtil.getPackageInfo æ–¹æ³•ï¼Œæ–¹æ³•å†…éƒ¨è°ƒç”¨äº† PackageParser.parsePackage() æŠŠ APK æ–‡ä»¶çš„ manifest å’Œç­¾åä¿¡æ¯éƒ½è§£æå®Œæˆå¹¶ä¿å­˜åœ¨äº† Packageï¼ŒPackage åŒ…å«äº†è¯¥ APK çš„æ‰€æœ‰ä¿¡æ¯ è°ƒç”¨ PackageParser.generatePackageInfo ç”Ÿæˆ PackageInfo æ¥ç€å¾€ä¸‹èµ°ï¼Œéƒ½è§£æå®Œæˆä¹‹åï¼Œå›åˆ° onCreate æ–¹æ³•ï¼Œç»§ç»­è°ƒç”¨ checkIfAllowedAndInitiateInstall æ–¹æ³• private void checkIfAllowedAndInitiateInstall() { // é¦–å…ˆæ£€æŸ¥å®‰è£…åº”ç”¨ç¨‹åºçš„ç”¨æˆ·é™åˆ¶ï¼Œå¦‚æœæœ‰é™åˆ¶å¹¶å¼¹å‡ºå¼¹å‡ºæç¤ºDialogæˆ–è€…è·³è½¬åˆ°è®¾ç½®ç•Œé¢ final int installAppsRestrictionSource = mUserManager.getUserRestrictionSource( UserManager.DISALLOW_INSTALL_APPS, Process.myUserHandle()); if ((installAppsRestrictionSource &amp; UserManager.RESTRICTION_SOURCE_SYSTEM) != 0) { showDialogInner(DLG_INSTALL_APPS_RESTRICTED_FOR_USER); return; } else if (installAppsRestrictionSource != UserManager.RESTRICTION_NOT_SET) { startActivity(new Intent(Settings.ACTION_SHOW_ADMIN_SUPPORT_DETAILS)); finish(); return; } // åˆ¤æ–­å¦‚æœå…è®¸å®‰è£…æœªçŸ¥æ¥æºæˆ–è€…æ ¹æ®Intentåˆ¤æ–­å¾—å‡ºè¯¥APKä¸æ˜¯æœªçŸ¥æ¥æº if (mAllowUnknownSources || !isInstallRequestFromUnknownSource(getIntent())) { initiateInstall(); } else { // æ£€æŸ¥æœªçŸ¥å®‰è£…æºé™åˆ¶,å¦‚æœæœ‰é™åˆ¶å¼¹å‡ºDialog,æ˜¾ç¤ºç›¸åº”çš„ä¿¡æ¯ final int unknownSourcesRestrictionSource = mUserManager.getUserRestrictionSource( UserManager.DISALLOW_INSTALL_UNKNOWN_SOURCES, Process.myUserHandle()); final int unknownSourcesGlobalRestrictionSource = mUserManager.getUserRestrictionSource( UserManager.DISALLOW_INSTALL_UNKNOWN_SOURCES_GLOBALLY, Process.myUserHandle()); final int systemRestriction = UserManager.RESTRICTION_SOURCE_SYSTEM &amp; (unknownSourcesRestrictionSource | unknownSourcesGlobalRestrictionSource); if (systemRestriction != 0) { showDialogInner(DLG_UNKNOWN_SOURCES_RESTRICTED_FOR_USER); } else if (unknownSourcesRestrictionSource != UserManager.RESTRICTION_NOT_SET) { startAdminSupportDetailsActivity(UserManager.DISALLOW_INSTALL_UNKNOWN_SOURCES); } else if (unknownSourcesGlobalRestrictionSource != UserManager.RESTRICTION_NOT_SET) { startAdminSupportDetailsActivity( UserManager.DISALLOW_INSTALL_UNKNOWN_SOURCES_GLOBALLY); } else { // å¤„ç†æœªçŸ¥æ¥æºçš„APK handleUnknownSources(); } }} ä¸»è¦æ£€æŸ¥å®‰è£…åº”ç”¨ç¨‹åºçš„ç”¨æˆ·é™åˆ¶ï¼Œå½“ APK æ–‡ä»¶ä¸å¯¹æˆ–è€…å®‰è£…æœ‰é™åˆ¶åˆ™è°ƒç”¨ showDialogInner æ–¹æ³•ï¼Œå¼¹å‡º dialog æç¤ºç”¨æˆ·ï¼Œæ˜¾ç¤ºç›¸åº”çš„é”™è¯¯ä¿¡æ¯ï¼Œæ¥çœ‹ä¸€ä¸‹éƒ½æœ‰é‚£äº›é”™è¯¯ä¿¡æ¯ // Dialog identifiers used in showDialogprivate static final int DLG_BASE = 0;// packageä¿¡æ¯é”™è¯¯private static final int DLG_PACKAGE_ERROR = DLG_BASE + 2;// å­˜å‚¨ç©ºé—´ä¸å¤Ÿprivate static final int DLG_OUT_OF_SPACE = DLG_BASE + 3;// å®‰è£…é”™è¯¯private static final int DLG_INSTALL_ERROR = DLG_BASE + 4;// ç”¨æˆ·é™åˆ¶çš„æœªçŸ¥æ¥æºprivate static final int DLG_UNKNOWN_SOURCES_RESTRICTED_FOR_USER = DLG_BASE + 5;private static final int DLG_ANONYMOUS_SOURCE = DLG_BASE + 6;// åœ¨wearä¸Šä¸æ”¯æŒprivate static final int DLG_NOT_SUPPORTED_ON_WEAR = DLG_BASE + 7;private static final int DLG_EXTERNAL_SOURCE_BLOCKED = DLG_BASE + 8;// å®‰è£…é™åˆ¶ç”¨æˆ·ä½¿ç”¨çš„åº”ç”¨ç¨‹åºprivate static final int DLG_INSTALL_APPS_RESTRICTED_FOR_USER = DLG_BASE + 9; å¦‚æœç”¨æˆ·å…è®¸å®‰è£…æœªçŸ¥æ¥æºï¼Œä¼šè°ƒç”¨ initiateInstall æ–¹æ³• private void initiateInstall() { String pkgName = mPkgInfo.packageName; // æ£€æŸ¥è®¾å¤‡ä¸Šæ˜¯å¦å­˜åœ¨ç›¸åŒåŒ…åçš„APK String[] oldName = mPm.canonicalToCurrentPackageNames(new String[] { pkgName }); if (oldName != null &amp;&amp; oldName.length &gt; 0 &amp;&amp; oldName[0] != null) { pkgName = oldName[0]; mPkgInfo.packageName = pkgName; mPkgInfo.applicationInfo.packageName = pkgName; } // æ£€æŸ¥packageæ˜¯å¦å·²å®‰è£…, å¦‚æœå·²ç»å®‰è£…åˆ™æ˜¾ç¤ºå¯¹è¯æ¡†æç¤ºç”¨æˆ·æ˜¯å¦æ›¿æ¢ã€‚ try { mAppInfo = mPm.getApplicationInfo(pkgName, PackageManager.MATCH_UNINSTALLED_PACKAGES); if ((mAppInfo.flags&amp;ApplicationInfo.FLAG_INSTALLED) == 0) { mAppInfo = null; } } catch (NameNotFoundException e) { mAppInfo = null; } // åˆå§‹åŒ–ç¡®è®¤å®‰è£…ç•Œé¢ startInstallConfirm();} æ ¹æ®åŒ…åè·å–åº”ç”¨ç¨‹åºçš„ä¿¡æ¯ï¼Œè°ƒç”¨ startInstallConfirm æ–¹æ³•åˆå§‹åŒ–å®‰è£…ç¡®è®¤ç•Œé¢åï¼Œå½“ç”¨æˆ·ç‚¹å‡»ç¡®è®¤æŒ‰é’®ä¹‹åå‘ç”Ÿäº†ä»€ä¹ˆï¼Œæ¥ç€æŸ¥çœ‹ç¡®è®¤æŒ‰é’®ç‚¹å‡»äº‹ä»¶ private void bindUi() { ... // ç‚¹å‡»ç¡®è®¤æŒ‰é’®ï¼Œå®‰è£…APK mAlert.setButton(DialogInterface.BUTTON_POSITIVE, getString(R.string.install), (ignored, ignored2) -&gt; { if (mOk.isEnabled()) { if (mSessionId != -1) { mInstaller.setPermissionsResult(mSessionId, true); finish(); } else { // å¯åŠ¨Activityæ¥å®Œæˆåº”ç”¨çš„å®‰è£… startInstall(); } } }, null); // ç‚¹å‡»å–æ¶ˆæŒ‰é’®ï¼Œå–æ¶ˆæ­¤æ¬¡å®‰è£… mAlert.setButton(DialogInterface.BUTTON_NEGATIVE, getString(R.string.cancel), (ignored, ignored2) -&gt; { // Cancel and finish setResult(RESULT_CANCELED); if (mSessionId != -1) { mInstaller.setPermissionsResult(mSessionId, false); } finish(); }, null); setupAlert(); mOk = mAlert.getButton(DialogInterface.BUTTON_POSITIVE); mOk.setEnabled(false);} å½“ç”¨æˆ·ç‚¹å‡»ç¡®è®¤æŒ‰é’®è°ƒç”¨äº† startInstall æ–¹æ³•ï¼Œå¯åŠ¨å­ Activity å®Œæˆ APK çš„å®‰è£… private void startInstall() { // å¯åŠ¨å­Activityæ¥å®Œæˆåº”ç”¨çš„å®‰ Intent newIntent = new Intent(); newIntent.putExtra(PackageUtil.INTENT_ATTR_APPLICATION_INFO, mPkgInfo.applicationInfo); newIntent.setData(mPackageURI); newIntent.setClass(this, InstallInstalling.class); ... if(localLOGV) Log.i(TAG, &quot;downloaded app uri=&quot;+mPackageURI); startActivity(newIntent); finish();} startInstall æ–¹æ³•ç”¨æ¥è·³è½¬åˆ° InstallInstallingï¼Œå¹¶å…³é—­æ‰å½“å‰çš„ PackageInstallerActivity 3.3 InstallInstallingä¸»è¦å·¥ä½œï¼š å‘åŒ…ç®¡ç†å™¨å‘é€åŒ…çš„ä¿¡æ¯ï¼Œç„¶åç­‰å¾…åŒ…ç®¡ç†å™¨å¤„ç†ç»“æœ æ³¨å†Œä¸€ä¸ªè§‚å¯Ÿè€… InstallEventReceiverï¼Œå¹¶æ¥å—å®‰è£…æˆåŠŸå’Œå¤±è´¥çš„å›è°ƒ åœ¨æ–¹æ³• onResume ä¸­åˆ›å»ºåŒæ­¥æ ˆï¼Œæ‰“å¼€å®‰è£… sessionï¼Œè®¾ç½®å®‰è£…è¿›åº¦æ¡ InstallInstalling é¦–å…ˆå‘åŒ…ç®¡ç†å™¨å‘é€åŒ…çš„ä¿¡æ¯ï¼Œç„¶åç­‰å¾…åŒ…ç®¡ç†å™¨å¤„ç†ç»“æœï¼Œå¹¶åœ¨æ–¹æ³• InstallSuccess å’Œæ–¹æ³• InstallFailed è¿›è¡ŒæˆåŠŸå’Œå¤±è´¥çš„å¤„ç†ï¼ŒæŸ¥çœ‹ InstallInstalling çš„ onCreate æ–¹æ³•ï¼šframeworks/base/packages/PackageInstaller/src/com/android/packageinstaller/InstallInstalling.java protected void onCreate(@Nullable Bundle savedInstanceState) { super.onCreate(savedInstanceState); ... // åˆ¤æ–­å®‰è£…çš„åº”ç”¨æ˜¯å¦å·²ç»å­˜åœ¨ if (&quot;package&quot;.equals(mPackageURI.getScheme())) { try { getPackageManager().installExistingPackage(appInfo.packageName); launchSuccess(); } catch (PackageManager.NameNotFoundException e) { launchFailure(PackageManager.INSTALL_FAILED_INTERNAL_ERROR, null); } } else { final File sourceFile = new File(mPackageURI.getPath()); PackageUtil.AppSnippet as = PackageUtil.getAppSnippet(this, appInfo, sourceFile); ... if (savedInstanceState != null) { // å¦‚æœsavedInstanceState ä¸ä¸ºç©ºï¼Œè·å–å·²ç»å­˜åœ¨mSessionId å’ŒmInstallId é‡æ–°æ³¨å†Œ mSessionId = savedInstanceState.getInt(SESSION_ID); mInstallId = savedInstanceState.getInt(INSTALL_ID); try { // æ ¹æ®mInstallIdå‘InstallEventReceiveræ³¨å†Œä¸€ä¸ªè§‚å¯Ÿè€…ï¼ŒlaunchFinishBasedOnResultä¼šæ¥æ”¶åˆ°å®‰è£…äº‹ä»¶çš„å›è°ƒ InstallEventReceiver.addObserver(this, mInstallId, this::launchFinishBasedOnResult); } catch (EventResultPersister.OutOfIdsException e) { } } else { // å¦‚æœä¸ºç©ºåˆ›å»ºSessionParamsï¼Œä»£è¡¨å®‰è£…ä¼šè¯çš„å‚æ•° // è§£æAPK, å¹¶å°†è§£æçš„å‚æ•°èµ‹å€¼ç»™SessionParams PackageInstaller.SessionParams params = new PackageInstaller.SessionParams( PackageInstaller.SessionParams.MODE_FULL_INSTALL); ... try { // æ³¨å†ŒInstallEventReceiverï¼Œå¹¶åœ¨launchFinishBasedOnResultä¼šæ¥æ”¶åˆ°å®‰è£…äº‹ä»¶çš„å›è°ƒ mInstallId = InstallEventReceiver .addObserver(this, EventResultPersister.GENERATE_NEW_ID, this::launchFinishBasedOnResult); } catch (EventResultPersister.OutOfIdsException e) { launchFailure(PackageManager.INSTALL_FAILED_INTERNAL_ERROR, null); } try { // createSession å†…éƒ¨é€šè¿‡IPackageInstallerä¸PackageInstallerServiceè¿›è¡Œè¿›ç¨‹é—´é€šä¿¡ï¼Œ // æœ€ç»ˆè°ƒç”¨çš„æ˜¯PackageInstallerServiceçš„createSessionæ–¹æ³•æ¥åˆ›å»ºå¹¶è¿”å›mSessionId mSessionId = getPackageManager().getPackageInstaller().createSession(params); } catch (IOException e) { launchFailure(PackageManager.INSTALL_FAILED_INTERNAL_ERROR, null); } } ... }} æœ€ç»ˆéƒ½ä¼šæ³¨å†Œä¸€ä¸ªè§‚å¯Ÿè€… InstallEventReceiverï¼Œå¹¶åœ¨ launchFinishBasedOnResult ä¼šæ¥æ”¶åˆ°å®‰è£…äº‹ä»¶çš„å›è°ƒï¼Œå…¶ä¸­ InstallEventReceiver ç»§æ‰¿è‡ª BroadcastReceiverï¼Œç”¨äºæ¥æ”¶å®‰è£…äº‹ä»¶å¹¶å›è°ƒç»™ EventResultPersister createSession å†…éƒ¨é€šè¿‡ IPackageInstaller ä¸ PackageInstallerService è¿›è¡Œè¿›ç¨‹é—´é€šä¿¡ï¼Œæœ€ç»ˆè°ƒç”¨çš„æ˜¯ PackageInstallerServiceçš„createSession æ–¹æ³•æ¥åˆ›å»ºå¹¶è¿”å› mSessionId æ¥ä¸‹æ¥åœ¨ onResume æ–¹æ³•åˆ›å»º InstallingAsyncTask ç”¨æ¥æ‰§è¡Œ APK çš„å®‰è£…ï¼Œæ¥ç€æŸ¥çœ‹ onResume æ–¹æ³• protected void onResume() { super.onResume(); if (mInstallingTask == null) { PackageInstaller installer = getPackageManager().getPackageInstaller(); // æ ¹æ®mSessionId è·å–SessionInfo, ä»£è¡¨å®‰è£…ä¼šè¯çš„è¯¦ç»†ä¿¡æ¯ PackageInstaller.SessionInfo sessionInfo = installer.getSessionInfo(mSessionId); if (sessionInfo != null &amp;&amp; !sessionInfo.isActive()) { mInstallingTask = new InstallingAsyncTask(); mInstallingTask.execute(); } else { // å®‰è£…å®Œæˆåä¼šæ”¶åˆ°å¹¿æ’­ mCancelButton.setEnabled(false); setFinishOnTouchOutside(false); } }} å¾—åˆ° SessionInfo åˆ›å»ºå¹¶åˆ›å»º InstallingAsyncTaskï¼ŒInstallingAsyncTask çš„ doInBackground æ–¹æ³•è®¾ç½®å®‰è£…è¿›åº¦æ¡ï¼Œå¹¶å°† APK ä¿¡æ¯å†™å…¥ PackageInstaller.Sessionï¼Œå†™å…¥å®Œæˆä¹‹åï¼Œåœ¨ InstallingAsyncTask çš„ onPostExecute è¿›è¡ŒæˆåŠŸä¸å¤±è´¥çš„å¤„ç†ï¼Œæ¥ç€æŸ¥çœ‹ onPostExecute æ–¹æ³• protected void onPostExecute(PackageInstaller.Session session) { if (session != null) { Intent broadcastIntent = new Intent(BROADCAST_ACTION); broadcastIntent.setFlags(Intent.FLAG_RECEIVER_FOREGROUND); broadcastIntent.setPackage(getPackageName()); broadcastIntent.putExtra(EventResultPersister.EXTRA_ID, mInstallId); PendingIntent pendingIntent = PendingIntent.getBroadcast( InstallInstalling.this, mInstallId, broadcastIntent, PendingIntent.FLAG_UPDATE_CURRENT); session.commit(pendingIntent.getIntentSender()); mCancelButton.setEnabled(false); setFinishOnTouchOutside(false); } else { getPackageManager().getPackageInstaller().abandonSession(mSessionId); if (!isCancelled()) { launchFailure(PackageManager.INSTALL_FAILED_INVALID_APK, null); } }} åˆ›å»ºäº† broadcastIntentï¼Œå¹¶é€šè¿‡ PackageInstaller.Session çš„ commit æ–¹æ³•å‘é€å‡ºå»ï¼Œé€šè¿‡ broadcastIntent æ„é€ æ–¹æ³•æŒ‡å®šçš„ Intent çš„ Action ä¸º BROADCAST_ACTIONï¼Œè€Œ BROADCAST_ACTION æ˜¯ä¸€ä¸ªå¸¸é‡å€¼ private static final String BROADCAST_ACTION = &quot;com.android.packageinstaller.ACTION_INSTALL_COMMIT&quot;; å›åˆ° InstallInstalling.OnCreate æ–¹æ³•ï¼Œåœ¨ OnCreate æ–¹æ³•æ³¨å†Œ InstallEventReceiverï¼Œè€Œ InstallEventReceiver ç»§æ‰¿è‡ª BroadcastReceiverï¼Œè€Œä½¿ç”¨ BroadcastReceiver éœ€è¦åœ¨ AndroidManifest.xmlæ³¨å†Œï¼Œæ¥ç€æŸ¥çœ‹ AndroidManifest.xmlï¼š/frameworks/base/packages/PackageInstaller/AndroidManifest.xml &lt;receiver android:name=&quot;.InstallEventReceiver&quot; android:permission=&quot;android.permission.INSTALL_PACKAGES&quot; android:exported=&quot;true&quot;&gt; &lt;intent-filter android:priority=&quot;1&quot;&gt; &lt;action android:name=&quot;com.android.packageinstaller.ACTION_INSTALL_COMMIT&quot; /&gt; &lt;/intent-filter&gt;&lt;/receiver&gt; å®‰è£…ç»“æŸä¹‹åï¼Œä¼šåœ¨è§‚å¯Ÿè€… InstallEventReceiver æ³¨å†Œçš„å›è°ƒæ–¹æ³• launchFinishBasedOnResult å¤„ç†å®‰è£…äº‹ä»¶çš„ç»“æœï¼Œæ¥ç€æŸ¥çœ‹ launchFinishBasedOnResult private void launchFinishBasedOnResult(int statusCode, int legacyStatus, String statusMessage) { if (statusCode == PackageInstaller.STATUS_SUCCESS) { launchSuccess(); } else { launchFailure(legacyStatus, statusMessage); }}private void launchSuccess() { Intent successIntent = new Intent(getIntent()); successIntent.setClass(this, InstallSuccess.class); successIntent.addFlags(Intent.FLAG_ACTIVITY_FORWARD_RESULT); startActivity(successIntent); finish();} private void launchFailure(int legacyStatus, String statusMessage) { Intent failureIntent = new Intent(getIntent()); failureIntent.setClass(this, InstallFailed.class); failureIntent.addFlags(Intent.FLAG_ACTIVITY_FORWARD_RESULT); failureIntent.putExtra(PackageInstaller.EXTRA_LEGACY_STATUS, legacyStatus); failureIntent.putExtra(PackageInstaller.EXTRA_STATUS_MESSAGE, statusMessage); startActivity(failureIntent); finish();} å®‰è£…æˆåŠŸå’Œå¤±è´¥ï¼Œéƒ½ä¼šå¯åŠ¨ä¸€ä¸ªæ–°çš„ Activityï¼ˆInstallSuccessã€InstallFailedï¼‰å°†ç»“æœå±•ç¤ºç»™ç”¨æˆ·ï¼Œç„¶å finish æ‰ InstallInstalling 4. æ€»ç»“æ€»ç»“ä¸€ä¸‹ PackageInstaller å®‰è£…APKçš„è¿‡ç¨‹ï¼š æ ¹æ®æ ¹æ® Uri çš„ Scheme æ‰¾åˆ°å…¥å£ InstallStart InstallStart æ ¹æ® Uri çš„ Scheme åè®®ä¸åŒåšä¸åŒçš„å¤„ç† éƒ½ä¼šè°ƒç”¨ PackageInstallerActivity, ç„¶ååˆ†åˆ«å¯¹packageåè®®å’Œ file åè®®çš„ Uri è¿›è¡Œå¤„ç† PackageInstallerActivity æ£€æŸ¥æœªçŸ¥å®‰è£…æºé™åˆ¶,å¦‚æœå®‰è£…æºé™åˆ¶å¼¹å‡ºæç¤º Dialog ç‚¹å‡» OK æŒ‰é’®ç¡®è®¤å®‰è£…åï¼Œä¼šè°ƒç”¨ startInstall å¼€å§‹å®‰è£…å·¥ä½œ å¦‚æœç”¨æˆ·å…è®¸å®‰è£…ï¼Œç„¶åè·³è½¬åˆ° InstallInstallingï¼Œè¿›è¡Œ APK çš„å®‰è£…å·¥ä½œ åœ¨ InstallInstalling ä¸­ï¼Œå‘åŒ…ç®¡ç†å™¨å‘é€åŒ…çš„ä¿¡æ¯ï¼Œç„¶åæ³¨å†Œä¸€ä¸ªè§‚å¯Ÿè€… InstallEventReceiverï¼Œå¹¶æ¥å—å®‰è£…æˆåŠŸå’Œå¤±è´¥çš„å›è°ƒ 5. å…³äº packages.xmlåœ¨ Andorid ç³»ç»Ÿç›®å½• â€œ/data/systemâ€ ä¸‹ä¿å­˜å¾ˆå¤šç³»ç»Ÿæ–‡ä»¶ï¼Œä¸»è¦ä»‹ç» packages.xml æ–‡ä»¶ packages.xmlï¼šè®°å½•äº†ç³»ç»Ÿä¸­æ‰€æœ‰å®‰è£…çš„åº”ç”¨ä¿¡æ¯ï¼ŒåŒ…æ‹¬åŸºæœ¬ä¿¡æ¯ã€ç­¾åå’Œæƒé™ã€APK æ–‡ä»¶çš„è·¯å¾„ã€native åº“çš„å­˜å‚¨è·¯å¾„ ç³»ç»Ÿå¯åŠ¨çš„æ—¶å€™ä¼šé€šè¿‡ PackageManagerServcie è¯»å–è¿™ä¸ªæ–‡ä»¶åŠ è½½ç³»ç»Ÿä¸­æ‰€æœ‰å®‰è£…çš„åº”ç”¨ï¼Œè¿™ä¸ªæ–‡ä»¶åœ¨å¼€å‘ä¸­ä¹Ÿæ˜¯éå¸¸æœ‰å¸®åŠ©çš„ï¼Œä¸åŒå‚å•†ä¼šå¯¹ Android æºç æœ‰ä¸åŒçš„ä¿®æ”¹ï¼Œå¦‚æœæˆ‘ä»¬éœ€è¦åˆ†æç³»ç»Ÿ App çš„æºç ï¼Œå°±é€šè¿‡è¿™ä¸ª packages.xml æ‰¾åˆ°ç›®æ ‡ APKï¼Œdump å‡ºæ¥åˆ†ææºç  ä»¥ä¸‹æ˜¯ packages.xml æ–‡ä»¶éƒ¨åˆ†å†…å®¹ &lt;?xml version='1.0' encoding='utf-8' standalone='yes' ?&gt;&lt;packages&gt; &lt;version sdkVersion=&quot;27&quot; databaseVersion=&quot;3&quot; fingerprint=&quot;Meizu/meizu_M1822_CN/M1822:8.1.0/OPM1.171019.026/1539943691:user/release-keys&quot; /&gt; &lt;version volumeUuid=&quot;primary_physical&quot; sdkVersion=&quot;27&quot; databaseVersion=&quot;27&quot; fingerprint=&quot;Meizu/meizu_M1822_CN/M1822:8.1.0/OPM1.171019.026/1539943691:user/release-keys&quot; /&gt; &lt;meizu_version meizu_fingerprint=&quot;8.1.0-1541573178_stable&quot; /&gt; &lt;permission-trees /&gt; &lt;permissions&gt; &lt;item name=&quot;com.meizu.voiceassistant.push.permission.MESSAGE&quot; package=&quot;com.meizu.voiceassistant&quot; protection=&quot;2&quot; /&gt; &lt;item name=&quot;com.meizu.safe.alphame.permission.DATA&quot; package=&quot;com.meizu.safe&quot; protection=&quot;18&quot; /&gt; &lt;item name=&quot;android.permission.REAL_GET_TASKS&quot; package=&quot;android&quot; protection=&quot;18&quot; /&gt; ...... &lt;item name=&quot;android.permission.MODIFY_PHONE_STATE&quot; granted=&quot;true&quot; flags=&quot;0&quot; /&gt; &lt;item name=&quot;com.android.launcher.permission.INSTALL_SHORTCUT&quot; granted=&quot;true&quot; flags=&quot;0&quot; /&gt; &lt;item name=&quot;android.permission.WAKE_LOCK&quot; granted=&quot;true&quot; flags=&quot;0&quot; /&gt; &lt;/perms&gt; &lt;proper-signing-keyset identifier=&quot;1&quot; /&gt; &lt;/package&gt; &lt;package name=&quot;com.android.providers.telephony&quot; codePath=&quot;/system/priv-app/TelephonyProvider&quot; nativeLibraryPath=&quot;/system/priv-app/TelephonyProvider/lib&quot; primaryCpuAbi=&quot;arm64-v8a&quot; publicFlags=&quot;1007402501&quot; privateFlags=&quot;8&quot; ft=&quot;11e8dc5d800&quot; it=&quot;11e8dc5d800&quot; ut=&quot;11e8dc5d800&quot; version=&quot;27&quot; sharedUserId=&quot;1001&quot; isOrphaned=&quot;true&quot; forceFull=&quot;true&quot;&gt; &lt;sigs count=&quot;1&quot;&gt; &lt;cert index=&quot;0&quot; /&gt; &lt;/sigs&gt; &lt;perms&gt; &lt;item name=&quot;android.permission.SEND_RECEIVE_STK_INTENT&quot; granted=&quot;true&quot; flags=&quot;0&quot; /&gt; &lt;item name=&quot;android.permission.BIND_INCALL_SERVICE&quot; granted=&quot;true&quot; flags=&quot;0&quot; /&gt; ...... &lt;item name=&quot;android.permission.UPDATE_APP_OPS_STATS&quot; granted=&quot;true&quot; flags=&quot;0&quot; /&gt; &lt;/perms&gt; &lt;proper-signing-keyset identifier=&quot;1&quot; /&gt; &lt;/package&gt; 5.1. package è¡¨ç¤ºåŒ…ä¿¡æ¯ name è¡¨ç¤ºåº”ç”¨çš„åŒ…å codePath è¡¨ç¤ºçš„æ˜¯ APK æ–‡ä»¶çš„è·¯å¾„ nativeLibraryPath è¡¨ç¤ºåº”ç”¨çš„ native åº“çš„å­˜å‚¨è·¯å¾„ it è¡¨ç¤ºåº”ç”¨å®‰è£…çš„æ—¶é—´ ut è¡¨ç¤ºåº”ç”¨æœ€åä¸€æ¬¡ä¿®æ”¹çš„æ—¶é—´ version è¡¨ç¤ºåº”ç”¨çš„ç‰ˆæœ¬å· userId è¡¨ç¤ºæ‰€å±äºçš„ id 5.2. sign è¡¨ç¤ºåº”ç”¨çš„ç­¾å count è¡¨ç¤ºæ ‡ç­¾ä¸­åŒ…å«æœ‰å¤šå°‘ä¸ªè¯ä¹¦ cert è¡¨ç¤ºå…·ä½“çš„è¯ä¹¦çš„å€¼ 5.3. perms è¡¨ç¤ºåº”ç”¨å£°æ˜ä½¿ç”¨çš„æƒé™ï¼Œæ¯ä¸€ä¸ªå­æ ‡ç­¾ä»£è¡¨ä¸€é¡¹æƒé™6. å®‰åˆ©ä¸€ä¸ªåœ¨çº¿æŸ¥çœ‹ Android æºç ç½‘ç«™aospxref æ˜¯ weishu å¤§ç¥æ­å»ºä¸€ä¸ªåœ¨çº¿æŸ¥çœ‹åœ¨çº¿æŸ¥çœ‹ Androidæºç ç½‘ç«™, è®¿é—®é€Ÿåº¦éå¸¸å¿« åœ¨è¿™ä¹‹å‰æˆ‘å¸¸ç”¨çš„åœ¨çº¿æŸ¥çœ‹ Android æºç çš„ç½‘ç«™ androidxrefï¼Œè®¿é—®é€Ÿåº¦ä¸ä»…æ…¢ï¼Œè€Œä¸”æ›´æ–°ä¹Ÿä¸åŠæ—¶ï¼Œç°åœ¨ Android 10 å‘å¸ƒäº†ï¼Œè¿™ä¸ªç½‘ç«™åˆ°ç°åœ¨æä¾›çš„æœ€æ–°çš„ä»£ç è¿˜æ˜¯ Andorid 9 aospxref æä¾›äº†ä¸ androidxref å®Œå…¨ä¸€æ ·çš„æºç æµè§ˆå’Œäº¤å‰ç´¢å¼•åŠŸèƒ½ï¼›é™¤æ­¤ä¹‹å¤–ï¼Œå®ƒè¿˜æœ‰ä¸€äº›åˆ«çš„ä¼˜ç‚¹ï¼š è·Ÿéš Android ç‰ˆæœ¬æ›´æ–°ï¼Œä½ æ°¸è¿œå¯ä»¥çœ‹åˆ°æœ€æ–°çš„æºä»£ç ã€‚ æœåŠ¡å™¨åœ¨é˜¿é‡Œäº‘ï¼Œå›½å†…è®¿é—®é€Ÿåº¦è´¼å¿«ã€‚ opengrok ç‰ˆæœ¬è¾ƒé«˜ï¼ŒæŸ¥é˜…ä»£ç æ—¶ä¼šæœ‰è‡ªåŠ¨æç¤ºã€‚ å¯¹é¡µé¢åšè¿‡éƒ¨åˆ†ä¼˜åŒ–ï¼Œä½¿ç”¨æ›´ä¾¿æ·ï¼›æ¯”å¦‚å¯ä»¥åœ¨ä»»æ„ç•Œé¢è·³è½¬åˆ°é¦–é¡µã€‚ å‚è€ƒ AndroidåŒ…ç®¡ç†æ€»ç»“ å®‰åˆ©ä¸€ä¸ªçœ‹ Android æºä»£ç çš„ç½‘ç«™ Android æƒé™ AndroidåŒ…ç®¡ç†æœºåˆ¶ï¼ˆä¸€ï¼‰PackageInstallerçš„åˆå§‹åŒ–","link":"/2020/06/07/android10/package-manager/02-APK-install/"},{"title":"0xA01 Android 10 æºç åˆ†æï¼šAPK æ˜¯å¦‚ä½•ç”Ÿæˆçš„","text":"å‰è¨€ è¿™æ˜¯ Android 10 æºç åˆ†æç³»åˆ—çš„ç¬¬ 1 ç¯‡ åˆ†æ”¯ï¼šandroid-10.0.0_r14 å…¨æ–‡é˜…è¯»å¤§æ¦‚ 5 åˆ†é’Ÿ åœ¨ Android Studio ä¸­ç›´æ¥ç‚¹å‡» Run â€˜appâ€™ å°±å¯ä»¥åœ¨ build/outputs/apk ç”Ÿæˆå¯ä»¥åœ¨ android è®¾å¤‡ä¸­å®‰è£…çš„ APK æ–‡ä»¶ï¼Œé‚£ä¹ˆ APK ç”Ÿæˆçš„è¿‡ç¨‹æ˜¯æ€ä¹ˆæ ·çš„å‘¢ï¼Ÿ APK æ–‡ä»¶å¤§æ¦‚å¯ä»¥åˆ†ä¸ºä¸¤ä¸ªéƒ¨åˆ†ï¼šä»£ç å’Œèµ„æºï¼Œæ‰€ä»¥æ‰“åŒ…çš„ä¹Ÿåˆ†ä¸ºä»£ç å’Œèµ„æºä¸¤ä¸ªéƒ¨åˆ†ï¼Œæˆ‘ä»¬å¯ä»¥æ ¹æ® Googleæä¾›çš„æµç¨‹å›¾ æ¥å…·ä½“äº†è§£ä¸€ä¸ª APK çš„æ„å»ºè¿‡ç¨‹ æ–°ç‰ˆæ„å»ºæµç¨‹å›¾ APK æ‰“åŒ…çš„å†…å®¹ä¸»è¦æœ‰ï¼šåº”ç”¨æ¨¡å—ä¹Ÿå°±æ˜¯è‡ªå·±å¼€å‘çš„ç”¨åˆ°çš„æºä»£ç ã€èµ„æºæ–‡ä»¶ã€aidl æ¥å£æ–‡ä»¶ï¼Œè¿˜æœ‰å°±æ˜¯ä¾èµ–æ¨¡å—å³æºä»£ç ç”¨åˆ°çš„ç¬¬ä¸‰æ–¹ä¾èµ–åº“å¦‚ï¼šaarã€jarã€so æ–‡ä»¶ ä¸ºäº†èƒ½å¤Ÿæ¸…æ¥šçš„äº†è§£ APK æ˜¯å¦‚ä½•ç”Ÿæˆçš„, æ¥çœ‹ä¸€ä¸‹è€ç‰ˆæ„å»ºæµç¨‹å›¾ è€ç‰ˆæ„å»ºæµç¨‹å›¾ åœ¨äº†è§£ APK ç”Ÿæˆçš„è¿‡ç¨‹ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦äº†è§£ä¸€ä¸‹å›¾ä¸­å„ä¸ªå·¥å…·çš„ä½œç”¨ å·¥å…· åå­— åŠŸèƒ½ AAPT/APT2 Android èµ„æºæ‰“åŒ…å·¥å…· AIDL å°†æ‰€æœ‰çš„ AIDL æ¥å£è½¬åŒ–ä¸º Java æ¥å£ Javac(Java Compiler) å°†æ‰€æœ‰çš„ Java ä»£ç ç¼–è¯‘æˆ Classæ–‡ä»¶ Dex å°† Class æ–‡ä»¶ç¼–è¯‘æˆ Dex æ–‡ä»¶ Apkbuilder å°†å¤„ç†åçš„èµ„æºå’Œä»£ç æ‰“åŒ…ç”Ÿæˆ APK æ–‡ä»¶ Jarsigner/Apksigner å¯¹æœªç­¾åçš„ APK æ–‡ä»¶è¿›è¡Œç­¾å Zipalign ä¼˜åŒ–ç­¾ååçš„ APKï¼Œå‡å°‘è¿è¡Œæ—¶æ‰€å ç”¨çš„å†…å­˜ æ„å»ºè¿‡ç¨‹1. ä½¿ç”¨ AAPT å·¥å…·ç”Ÿæˆ R.java æ–‡ä»¶AAPTï¼ˆAndroid Asset Packaging Toolï¼‰android èµ„æºæ‰“åŒ…å·¥å…·ï¼Œå°†èµ„æºæ–‡ä»¶ï¼ˆåŒ…æ‹¬AndroidManifest.xmlã€å¸ƒå±€æ–‡ä»¶ã€å„ç§ xml èµ„æºç­‰ï¼‰æ‰“åŒ…ç”Ÿæˆ R.java æ–‡ä»¶ï¼Œå°† AndroidManifest.xml ç”ŸæˆäºŒè¿›åˆ¶çš„ AndroidManifest.java æ–‡ä»¶ aapt p -M AndroidManifest.xml -S output/res/ -I android.jar -J ./ -F input/out.apkpï¼šæ‰“åŒ…-Mï¼šAndroidManifest.xml æ–‡ä»¶è·¯å¾„-Sï¼šres ç›®å½•è·¯å¾„-Aï¼šassets ç›®å½•è·¯å¾„-Iï¼šandroid.jar è·¯å¾„ï¼Œä¼šç”¨åˆ°çš„ä¸€äº›ç³»ç»Ÿåº“-J æŒ‡å®šç”Ÿæˆçš„ R.java çš„è¾“å‡ºç›®å½•-F å…·ä½“æŒ‡å®š APK æ–‡ä»¶çš„è¾“å‡º ä½†æ˜¯ä» Android Studio 3.0 å¼€å§‹ï¼Œgoogle é»˜è®¤å¼€å¯äº† AAPT2 ä½œä¸ºèµ„æºç¼–è¯‘çš„ç¼–è¯‘å™¨ï¼ŒAAPT2 çš„å‡ºç°ä¸ºèµ„æºçš„å¢é‡ç¼–è¯‘æä¾›äº†æ”¯æŒï¼Œaapt2 ä¸»è¦åˆ†ä¸¤æ­¥ï¼Œcompile å’Œ link compile aapt2 compile -o res.apk --dir output/res/-oï¼šæŒ‡å®šå·²ç¼–è¯‘èµ„æºçš„è¾“å‡ºè·¯å¾„--dirï¼šæŒ‡å®šåŒ…å«å¤šä¸ªèµ„æºæ–‡ä»¶çš„èµ„æºç›®å½• link aapt2 link -o input/out.apk -I tools/android.jar --manifest output/AndroidManifest.xml -A res.apk --java ./-oï¼šæŒ‡å®šé“¾æ¥çš„èµ„æº APK çš„è¾“å‡ºè·¯å¾„-Iï¼šæŒ‡å®š android.jar è·¯å¾„--manifestï¼šæŒ‡å®š AndroidManifest.xml è·¯å¾„--java ï¼šæŒ‡å®šè¦åœ¨å…¶ä¸­ç”Ÿæˆ R.java çš„ç›®å½• 2. æ‰€æœ‰çš„ AIDL æ¥å£è½¬åŒ–ä¸º Java æ¥å£ä½¿ç”¨ AIDLï¼ˆAndroid Interface Denifition Languageï¼‰ï¼Œä½äº sdk\\build-tools ç›®å½•ä¸‹çš„ aidl å·¥å…·ï¼Œå°†æºç æ–‡ä»¶ã€aidl æ–‡ä»¶ã€framework.aidl ç­‰æ‰€æœ‰çš„ AIDL æ–‡ä»¶ï¼Œç”Ÿæˆç›¸åº”çš„ Java æ–‡ä»¶ï¼Œå‘½ä»¤å¦‚ä¸‹ï¼š aidl -Iaidl -pAndroid/Sdk/platforms/android-29/framework.aidl -obuild aidl/com/android/vending/billing/IInAppBillingService.aidl-I æŒ‡å®š import è¯­å¥çš„æœç´¢è·¯å¾„ï¼Œæ³¨æ„ -I ä¸ç›®å½•ä¹‹é—´ä¸€å®šä¸è¦æœ‰ç©ºæ ¼-p æŒ‡å®šç³»ç»Ÿç±»çš„ import è¯­å¥è·¯å¾„ï¼Œå¦‚æœæ˜¯è¦ç”¨åˆ° android.os.Bundle ç³»ç»Ÿçš„ç±»ï¼Œä¸€å®šè¦è®¾ç½® sdk çš„ framework.aidl è·¯å¾„-o ç”Ÿæˆ java æ–‡ä»¶çš„ç›®å½•ï¼Œæ³¨æ„ -o ä¸ç›®å½•ä¹‹é—´ä¸€å®šä¸è¦æœ‰ç©ºæ ¼ï¼Œè€Œä¸”è¿™è®¾ç½®é¡¹ä¸€å®šè¦åœ¨ aidl æ–‡ä»¶è·¯å¾„ä¹‹å‰è®¾ç½® 3. å°† Java ä»£ç ç¼–è¯‘æˆ Class æ–‡ä»¶ä½¿ç”¨ Javacï¼ˆJava Compilerï¼‰æŠŠé¡¹ç›®ä¸­æ‰€æœ‰çš„ Java ä»£ç ç¼–è¯‘æˆ class æ–‡ä»¶, åŒ…æ‹¬ Java æºæ–‡ä»¶ã€AAPT ç”Ÿæˆçš„ R.java æ–‡ä»¶ ä»¥åŠ aidl ç”Ÿæˆçš„ Java æ¥å£æ–‡ä»¶ï¼Œå‘½ä»¤å¦‚ä¸‹ï¼š javac -target 1.8 -bootclasspath platforms/android-28/android.jar -d ./java/com/testjni/*.java 4. å°† Class æ–‡ä»¶ç¼–è¯‘æˆ Dex æ–‡ä»¶ä½¿ç”¨ DX å·¥å…·å°†æ‰€æœ‰çš„ Class æ–‡ä»¶ï¼ˆåŒ…æ‹¬ç¬¬ä¸‰æ–¹åº“ä¸­çš„ class æ–‡ä»¶ï¼‰è½¬æ¢æˆ Dex æ–‡ä»¶ï¼ˆDalvik å¯æ‰§è¡Œæ–‡ä»¶ï¼Œå…¶ä¸­åŒ…æ‹¬åœ¨ Android è®¾å¤‡ä¸Šè¿è¡Œçš„å­—èŠ‚ç ï¼‰ï¼Œè¯¥è¿‡ç¨‹ä¸»è¦å®Œæˆ Java å­—èŠ‚ç è½¬æ¢æˆ Dalvik å­—èŠ‚ç , å‘½ä»¤å¦‚ä¸‹ï¼š java -jar dx.jar --dex --ouput=classes.dex ./java/com/testjni/*.class--dexï¼šå°† class æ–‡ä»¶è½¬æˆdexæ–‡ä»¶--outputï¼šæŒ‡å®šç”Ÿæˆ dex æ–‡ä»¶åˆ°å…·ä½“ä½ç½® 5. æ‰“åŒ…ç”Ÿæˆ APK æ–‡ä»¶ä½¿ç”¨ Apkbuilderï¼ˆä¸»è¦ç”¨åˆ°çš„æ˜¯ sdk/tools/lib/sdklib.jar æ–‡ä»¶ä¸­çš„ ApkBuilderMain ç±»ï¼‰å°†æ‰€æœ‰çš„ Dex æ–‡ä»¶ã€Resource.arscã€Res æ–‡ä»¶å¤¹ã€Assets æ–‡ä»¶å¤¹ã€AndroidManifest.xml æ‰“åŒ…ç”Ÿæˆ APK æ–‡ä»¶ï¼ˆæœªç­¾åï¼‰ 6. å¯¹ APK æ–‡ä»¶ç­¾åä½¿ç”¨ Apksignerï¼ˆAndroidå®˜æ–¹é’ˆå¯¹ APK ç­¾ååŠéªŒè¯å·¥å…·ï¼‰æˆ– Jarsignerï¼ˆJDKæä¾›é’ˆå¯¹ jar åŒ…ç­¾åå·¥å…·ï¼‰å¯¹æœªç­¾åçš„ APK æ–‡ä»¶è¿›è¡Œç­¾å psï¼šå¦‚æœä½¿ç”¨ Apksigner ç­¾åéœ€è¦ï¼ˆ7. ä¼˜åŒ– APK æ–‡ä»¶ï¼‰æ”¾åˆ°ï¼ˆ6. å¯¹ APK æ–‡ä»¶ç­¾åï¼‰ç­¾åå‰é¢ï¼Œä¸ºä»€ä¹ˆï¼Ÿè¯·æŸ¥çœ‹å…³äº Apksigner å’Œ Jarsigner çš„åŒºåˆ«ï¼Œè¯·ç§»æ­¥åˆ°æ–‡æœ« 7. ä¼˜åŒ– APK æ–‡ä»¶ä½¿ç”¨ zipalign å¯¹ç­¾ååçš„ APK æ–‡ä»¶è¿›è¡Œå¯¹é½å¤„ç†ï¼Œå¯¹é½çš„ä¸»è¦è¿‡ç¨‹æ˜¯å°† APK åŒ…ä¸­æ‰€æœ‰çš„èµ„æºæ–‡ä»¶è·ç¦»æ–‡ä»¶èµ·å§‹åç§»ä¸º 4 å­—èŠ‚æ•´æ•°å€ï¼Œè¿™æ ·é€šè¿‡å†…å­˜æ˜ å°„è®¿é—® APK æ–‡ä»¶æ—¶çš„é€Ÿåº¦ä¼šæ›´å¿«ï¼Œå‡å°‘å…¶åœ¨è®¾å¤‡ä¸Šè¿è¡Œæ—¶æ‰€å ç”¨çš„å†…å­˜ æ€»ç»“ä¸Šè¿°æ‰“åŒ…è¿‡ç¨‹éƒ½æ˜¯ AndroidStudio ç¼–è¯‘æ—¶ï¼Œè°ƒç”¨å„ç§ç¼–è¯‘å‘½ä»¤è‡ªåŠ¨å®Œæˆçš„, æ€»ç»“ä¸€ä¸‹ä¸Šè¿°æ‰“åŒ…è¿‡ç¨‹ï¼š é™¤äº† assets å’Œ res/raw èµ„æºè¢«åŸè£…ä¸åŠ¨åœ°æ‰“åŒ…è¿› APK ä¹‹å¤–ï¼Œå…¶å®ƒçš„èµ„æºéƒ½ä¼šè¢«ç¼–è¯‘æˆ–è€…å¤„ç† é™¤äº† assets èµ„æºä¹‹å¤–ï¼Œå…¶å®ƒçš„èµ„æºéƒ½ä¼šè¢«èµ‹äºˆä¸€ä¸ªèµ„æº ID æ‰“åŒ…å·¥å…·è´Ÿè´£ç¼–è¯‘å’Œæ‰“åŒ…èµ„æºï¼Œç¼–è¯‘å®Œæˆä¹‹åï¼Œä¼šç”Ÿæˆä¸€ä¸ª resources.arsc æ–‡ä»¶å’Œä¸€ä¸ª R.javaï¼Œå‰è€…ä¿å­˜çš„æ˜¯ä¸€ä¸ªèµ„æºç´¢å¼•è¡¨ï¼Œåè€…å®šä¹‰äº†å„ä¸ªèµ„æº ID å¸¸é‡ åº”ç”¨ç¨‹åºé…ç½®æ–‡ä»¶ AndroidManifest.xml åŒæ ·ä¼šè¢«ç¼–è¯‘æˆäºŒè¿›åˆ¶çš„ xml æ–‡ä»¶ï¼Œç„¶åå†æ‰“åŒ…åˆ° APK é‡Œé¢å» åº”ç”¨ç¨‹åºåœ¨è¿è¡Œæ—¶é€šè¿‡ AssetManager æ¥è®¿é—®èµ„æºï¼Œæˆ–é€šè¿‡èµ„æº ID æ¥è®¿é—®ï¼Œæˆ–é€šè¿‡æ–‡ä»¶åæ¥è®¿é—® APK æ–‡ä»¶å¤§æ¦‚å¯ä»¥åˆ†ä¸ºä¸¤ä¸ªéƒ¨åˆ†ï¼šä»£ç å’Œèµ„æº, ä»£ç éƒ¨åˆ†é€šè¿‡ Javac å°† Java ä»£ç ç¼–è¯‘æˆ Class æ–‡ä»¶, ç„¶åé€šè¿‡ DX å·¥å…·å°† Class æ–‡ä»¶ç¼–è¯‘æˆ Dex æ–‡ä»¶ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬ä¸»è¦æ¥åˆ†æä¸€ä¸‹èµ„æºçš„ç¼–è¯‘å’Œæ‰“åŒ… èµ„æºçš„ç¼–è¯‘å’Œæ‰“åŒ…åœ¨åˆ†æèµ„æºçš„ç¼–è¯‘å’Œæ‰“åŒ…ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦äº†è§£ä¸€ä¸‹ Android éƒ½æœ‰å“ªäº›èµ„æºï¼Œå…¶å® Android èµ„æºå¤§æ¦‚åˆ†ä¸ºä¸¤ä¸ªéƒ¨åˆ†ï¼šassets å’Œ res 1. assets èµ„æºassets èµ„æºæ”¾åœ¨ assets ç›®å½•ä¸‹ï¼Œå®ƒé‡Œé¢ä¿å­˜ä¸€äº›åŸå§‹çš„æ–‡ä»¶ï¼Œå¯ä»¥ä»¥ä»»ä½•æ–¹å¼æ¥è¿›è¡Œç»„ç»‡ï¼Œè¿™äº›æ–‡ä»¶æœ€ç»ˆä¼šåŸå°ä¸åŠ¨çš„è¢«æ‰“åŒ…è¿› APK æ–‡ä»¶ä¸­ï¼Œé€šè¿‡ AssetManager æ¥è·å– asset èµ„æºï¼Œä»£ç å¦‚ä¸‹ AssetManager assetManager = context.getAssets();InputStream is = assetManager.open(&quot;fileName&quot;); 2. res èµ„æºres èµ„æºæ”¾åœ¨ä¸»å·¥ç¨‹çš„ res ç›®å½•ä¸‹ï¼Œè¿™ç±»èµ„æºä¸€èˆ¬éƒ½ä¼šåœ¨ç¼–è¯‘é˜¶æ®µç”Ÿæˆä¸€ä¸ªèµ„æºIDä¾›æˆ‘ä»¬ä½¿ç”¨ï¼Œres ç›®å½•åŒ…æ‹¬ animatorã€animã€ colorã€drawableã€layoutã€menuã€rawã€valuesã€xml ç­‰ ä¸Šè¿°èµ„æºæ–‡ä»¶é™¤äº† raw ç±»å‹èµ„æºï¼Œä»¥åŠ drawable æ–‡ä»¶å¤¹ä¸‹çš„ Bitmap èµ„æºä¹‹å¤–ï¼Œå…¶å®ƒçš„èµ„æºæ–‡ä»¶å‡ä¼šè¢«ç¼–è¯‘æˆäºŒè¿›åˆ¶æ ¼å¼çš„ XML æ–‡ä»¶ï¼Œç”Ÿæˆçš„äºŒè¿›åˆ¶æ ¼å¼çš„ XML æ–‡ä»¶åˆ†åˆ«æœ‰ä¸€ä¸ªå­—ç¬¦ä¸²èµ„æºæ± ï¼Œç”¨æ¥ä¿å­˜æ–‡ä»¶ä¸­å¼•ç”¨åˆ°çš„æ¯ä¸€ä¸ªå­—ç¬¦ä¸² è¿™æ ·åŸæ¥åœ¨æ–‡æœ¬æ ¼å¼çš„ XML æ–‡ä»¶ä¸­çš„æ¯ä¸€ä¸ªæ”¾ç½®å­—ç¬¦ä¸²çš„åœ°æ–¹åœ¨äºŒè¿›åˆ¶æ ¼å¼çš„XMLæ–‡ä»¶ä¸­éƒ½è¢«æ›¿æ¢æˆä¸€ä¸ªç´¢å¼•åˆ°å­—ç¬¦ä¸²èµ„æºæ± çš„æ•´æ•°å€¼ï¼Œå°†æ•´æ•°å€¼ä¿å­˜åœ¨ R.java ç±»ä¸­ï¼ŒR.java ä¼šå’Œå…¶ä»–æºæ–‡ä»¶ä¸€èµ·ç¼–è¯‘åˆ° APK ä¸­å» å°†èµ„æºç¼–è¯‘æˆäºŒè¿›åˆ¶æ–‡ä»¶ï¼Œéƒ½æ˜¯ç”± AAPT å·¥å…·æ¥å®Œæˆçš„ï¼Œèµ„æºæ‰“åŒ…ä¸»è¦æœ‰ä»¥ä¸‹å‡ ä¸ªæµç¨‹ï¼š è§£æ AndroidManifest.xmlï¼Œè·å¾—åº”ç”¨ç¨‹åºçš„åŒ…åç§°ï¼Œåˆ›å»ºèµ„æºè¡¨ æ·»åŠ è¢«å¼•ç”¨èµ„æºåŒ…ï¼Œè¢«æ·»åŠ çš„èµ„æºä¼šä»¥ä¸€ç§èµ„æº ID çš„æ–¹å¼å®šä¹‰åœ¨ R.java ä¸­ èµ„æºæ‰“åŒ…å·¥å…·åˆ›å»ºä¸€ä¸ª AaptAssets å¯¹è±¡ï¼Œæ”¶é›†å½“å‰éœ€è¦ç¼–è¯‘çš„èµ„æºæ–‡ä»¶ï¼Œæ”¶é›†åˆ°çš„èµ„æºä¿å­˜åœ¨ AaptAssets å¯¹è±¡å¯¹è±¡ä¸­ å°†ä¸Šä¸€æ­¥ AaptAssets å¯¹è±¡ä¿å­˜çš„èµ„æºï¼Œæ·»åŠ åˆ°èµ„æºè¡¨ ResourceTable ä¸­å»ï¼Œç”¨äºæœ€ç»ˆç”Ÿæˆèµ„æºæè¿°æ–‡ä»¶ resources.arsc ç¼–è¯‘ values ç±»èµ„æºï¼Œè¿™ç±»èµ„æºåŒ…æ‹¬æ•°ç»„ã€é¢œè‰²ã€å°ºå¯¸ã€å­—ç¬¦ä¸²ç­‰å€¼ ç»™ styleã€array è¿™ç±»èµ„æºåˆ†é…èµ„æº ID ç¼–è¯‘ XML èµ„æºæ–‡ä»¶ï¼Œç¼–è¯‘çš„æµç¨‹åˆ†ä¸ºï¼šâ‘  è§£æ XML æ–‡ä»¶ â‘¡ èµ‹äºˆå±æ€§åç§°èµ„æº ID â‘¢ è§£æå±æ€§å€¼ â‘£ å°† XML æ–‡ä»¶ä»æ–‡æœ¬æ ¼å¼è½¬æ¢ä¸ºäºŒè¿›åˆ¶æ ¼å¼ ç”Ÿæˆèµ„æºç´¢å¼•è¡¨ resources.arsc 2.1 èµ„æº IDAAP å·¥å…·ä¼šæ‰€æœ‰çš„èµ„æºéƒ½ä¼šç”Ÿæˆä¸€ä¸ª R.java æ–‡ä»¶ï¼Œå¹¶ä¸”æ¯ä¸ªèµ„æºéƒ½å¯¹åº” R.java ä¸­çš„åå…­è¿›åˆ¶æ•´æ•°å˜é‡ï¼Œå…¶å®è¿™äº›åå…­è¿›åˆ¶çš„æ•´æ•°æ˜¯ç”±ä¸‰éƒ¨åˆ†ç»„æˆï¼šPackageId + TypeId + ItemValueï¼Œä»£ç æ‰€ç¤ºï¼š public final class R { public static final class anim { public static final int abc_fade_in=0x7f010000; public static final int abc_fade_in=0x7f010001; //*** } public static final class string { public static final int a11y_no_data=0x7f100000; public static final int a11y_no_permission=0x7f100001; //*** }} æœ€é«˜å­—èŠ‚æ˜¯ Package ID è¡¨ç¤ºå‘½åç©ºé—´ï¼Œæ ‡æ˜èµ„æºçš„æ¥æºï¼ŒAndroid ç³»ç»Ÿè‡ªå·±å®šä¹‰äº†ä¸¤ä¸ª Package IDï¼Œç³»ç»Ÿèµ„æºå‘½åç©ºé—´ï¼š0x01 å’Œ åº”ç”¨èµ„æºå‘½åç©ºé—´ï¼š0x7f æ­£å› ä¸ºåº”ç”¨èµ„æºå‘½åç©ºé—´ï¼š0x7fï¼Œæˆ‘ä»¬åœ¨åšæ’ä»¶åŒ–çš„æ—¶å€™å°±ä¼šå‡ºç°ä¸€ä¸ªé—®é¢˜ï¼Œå®¿ä¸»å’Œæ’ä»¶åŒ…ï¼Œåˆå¹¶èµ„æºåèµ„æº ID å†²çªã€‚é€šè¿‡ä¸Šé¢åˆ†æè¦è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œå°±è¦ä¸ºä¸åŒçš„æ’ä»¶è®¾ç½®ä¸åŒçš„ PackageIdï¼Œè€Œå®¿ä¸»å¯ä»¥ä¿ç•™åŸæ¥ 0x7f ä¸å˜ï¼Œè¿™æ ·å°±æ°¸è¿œä¸ä¼šæœ‰å†²çªå‘ç”Ÿäº† å¦‚ä½•è§£å†³èµ„æºå†²çª åˆ¶å®šä¸€ä¸ªä¸ç”¨å†²çªçš„å‘½åè§„èŒƒ library Module çš„ build.gradle ä¸­è®¾ç½®èµ„æºå‰ç¼€(æ¨è) android { resourcePrefix &quot;&lt;å‰ç¼€&gt;&quot; }2.2 èµ„æºç´¢å¼•(resources.arsc)æœ€ç»ˆç”Ÿæˆçš„æ˜¯èµ„æºç´¢å¼•è¡¨ resources.arsc ï¼Œresources.arsc æ˜¯ä¸€ä¸ªç¼–è¯‘åçš„äºŒè¿›åˆ¶æ–‡ä»¶, åœ¨ AndroidStudio æ‰“å¼€ resources.arsc æ–‡ä»¶ï¼Œå¦‚ä¸‹æ‰€ç¤º Android æ­£æ˜¯åˆ©ç”¨è¿™ä¸ªç´¢å¼•è¡¨æ ¹æ®èµ„æº ID è¿›è¡Œèµ„æºçš„æŸ¥æ‰¾ï¼Œä¸ºä¸åŒè¯­è¨€ã€ä¸åŒåœ°åŒºã€ä¸åŒè®¾å¤‡æä¾›ç›¸å¯¹åº”çš„æœ€ä½³èµ„æºã€‚æŸ¥æ‰¾å’Œé€šè¿‡ Resources å’Œ AssetManger æ¥å®Œæˆçš„ åœ¨æ–‡ä¸­æåˆ°äº†ä¸¤ä¸ªå·¥å…· Apksigner å’Œ Jarsignerï¼Œä¸‹é¢ä¸€èµ·æ¥äº†è§£ä¸€ä¸‹ Apksigner å’Œ Jarsigner çš„åŒºåˆ« Apksigner å’Œ Jarsigner çš„åŒºåˆ«åœ¨ Android Studio ä¸­ç‚¹å‡»èœå• Build-&gt;Generate signed apkâ€¦ æ‰“åŒ…ç­¾åè¿‡ç¨‹ä¸­,å¯ä»¥çœ‹åˆ°ä¸¤ç§ç­¾åé€‰é¡¹ V1(Jar Signature) å’Œ V2(Full APK Signature) Jarsigner æ˜¯ JDK æä¾›çš„é’ˆå¯¹ JAR åŒ…ç­¾åçš„é€šç”¨å·¥å…· Apksigner æ˜¯ Google å®˜æ–¹æä¾›çš„é’ˆå¯¹ Android APK ç­¾ååŠéªŒè¯çš„ä¸“ç”¨å·¥å…· ä»Android 7.0 å¼€å§‹, è°·æ­Œå¢åŠ æ–°ç­¾åæ–¹æ¡ˆ V2 Scheme (APK Signature)ï¼Œä½†Android 7.0 ä»¥ä¸‹ç‰ˆæœ¬, åªèƒ½ç”¨æ—§ç­¾åæ–¹æ¡ˆ V1 scheme (JAR signing) V1(Jar Signature)ç­¾å: æ¥è‡ª JDK(Jarsigner)ï¼Œå¯¹ ZIP å‹ç¼©åŒ…çš„æ¯ä¸ªæ–‡ä»¶è¿›è¡ŒéªŒè¯, ç­¾ååè¿˜èƒ½å¯¹å‹ç¼©åŒ…ä¿®æ”¹(ç§»åŠ¨/é‡æ–°å‹ç¼©æ–‡ä»¶)ï¼Œå¯¹ V1 ç­¾åçš„ APK/JAR è§£å‹,åœ¨ META-INF å­˜æ”¾ç­¾åæ–‡ä»¶(MANIFEST.MF, CERT.SF, CERT.RSA), å…¶ä¸­ MANIFEST.MF æ–‡ä»¶ä¿å­˜æ‰€æœ‰æ–‡ä»¶çš„ SHA1 æŒ‡çº¹(é™¤äº† META-INF æ–‡ä»¶), ç”±æ­¤å¯çŸ¥: V1 ç­¾åæ˜¯å¯¹å‹ç¼©åŒ…ä¸­å•ä¸ªæ–‡ä»¶ç­¾åéªŒè¯ V2(Full APK Signature)ç­¾å: æ¥è‡ª Google(apksigner), å¯¹ ZIP å‹ç¼©åŒ…çš„æ•´ä¸ªæ–‡ä»¶éªŒè¯, ç­¾ååä¸èƒ½ä¿®æ”¹å‹ç¼©åŒ…(åŒ…æ‹¬ zipalign), å¯¹ V2 ç­¾åçš„ APK è§£å‹, æ²¡æœ‰å‘ç°ç­¾åæ–‡ä»¶, é‡æ–°å‹ç¼©å V2 ç­¾åå°±å¤±æ•ˆ, ç”±æ­¤å¯çŸ¥: V2 ç­¾åæ˜¯å¯¹æ•´ä¸ª APK ç­¾åéªŒè¯ åˆ›å»ºå‘å¸ƒå¯†é’¥åº“ï¼Œè¯·å‚é˜…åœ¨ Android Studio ä¸­ä¸ºåº”ç”¨ç­¾å æ€»ç»“ V1 ç­¾åæ˜¯å¯¹å‹ç¼©åŒ…ä¸­å•ä¸ªæ–‡ä»¶ç­¾åéªŒè¯ V2 ç­¾åæ˜¯å¯¹æ•´ä¸ª APK ç­¾åéªŒè¯ zipalign å¯ä»¥åœ¨ V1 ç­¾ååæ‰§è¡Œ zipalign ä¸èƒ½åœ¨ V2 ç­¾ååæ‰§è¡Œ,åªèƒ½åœ¨ V2 ç­¾åä¹‹å‰æ‰§è¡Œ V2 ç­¾åæ›´å®‰å…¨(ä¸èƒ½ä¿®æ”¹å‹ç¼©åŒ…) V2 ç­¾åéªŒè¯æ—¶é—´æ›´çŸ­(ä¸éœ€è¦è§£å‹éªŒè¯), å› è€Œå®‰è£…é€Ÿåº¦åŠ å¿« æ³¨æ„: apksigner å·¥å…·é»˜è®¤åŒæ—¶ä½¿ç”¨ V1 å’Œ V2 ç­¾å,ä»¥å…¼å®¹ Android 7.0 ä»¥ä¸‹ç‰ˆæœ¬ å‚è€ƒæ–‡çŒ® Googleçš„ Apk æ„å»ºæµç¨‹ Android Studio ä¸­ä¸ºåº”ç”¨ç­¾å AAPT2","link":"/2020/06/07/android10/package-manager/01-APK-generate/"},{"title":"LeetCode é“¾è¡¨ï¼šè®¾è®¡é“¾è¡¨","text":"é¢˜ç›®æ¥æºäº LeetCode ä¸Š ç¬¬ 707 å·é—®é¢˜ï¼šè®¾è®¡é“¾è¡¨ã€‚é¢˜ç›®éš¾åº¦ä¸º Mediumã€‚ è‹±æ–‡åœ°å€ï¼šhttps://leetcode.com/problems/design-linked-list ä¸­æ–‡åœ°å€ï¼šhttps://leetcode-cn.com/problems/design-linked-list é¢˜ç›®æè¿°è®¾è®¡é“¾è¡¨çš„å®ç°ã€‚æ‚¨å¯ä»¥é€‰æ‹©ä½¿ç”¨å•é“¾è¡¨æˆ–åŒé“¾è¡¨ã€‚å•é“¾è¡¨ä¸­çš„èŠ‚ç‚¹åº”è¯¥å…·æœ‰ä¸¤ä¸ªå±æ€§ï¼š val å’Œ nextã€‚ val æ˜¯å½“å‰èŠ‚ç‚¹çš„å€¼ï¼Œ next æ˜¯æŒ‡å‘ä¸‹ä¸€ä¸ªèŠ‚ç‚¹çš„æŒ‡é’ˆ/å¼•ç”¨ã€‚å¦‚æœè¦ä½¿ç”¨åŒå‘é“¾è¡¨ï¼Œåˆ™è¿˜éœ€è¦ä¸€ä¸ªå±æ€§ prev ä»¥æŒ‡ç¤ºé“¾è¡¨ä¸­çš„ä¸Šä¸€ä¸ªèŠ‚ç‚¹ã€‚å‡è®¾é“¾è¡¨ä¸­çš„æ‰€æœ‰èŠ‚ç‚¹éƒ½æ˜¯ 0-index çš„ åœ¨é“¾è¡¨ç±»ä¸­å®ç°è¿™äº›åŠŸèƒ½ï¼š get(index)ï¼šè·å–é“¾è¡¨ä¸­ç¬¬ index ä¸ªèŠ‚ç‚¹çš„å€¼ã€‚å¦‚æœç´¢å¼•æ— æ•ˆï¼Œåˆ™è¿”å› -1ã€‚ addAtHead(val)ï¼šåœ¨é“¾è¡¨çš„ç¬¬ä¸€ä¸ªå…ƒç´ ä¹‹å‰æ·»åŠ ä¸€ä¸ªå€¼ä¸º val çš„èŠ‚ç‚¹ã€‚æ’å…¥åï¼Œæ–°èŠ‚ç‚¹å°†æˆä¸ºé“¾è¡¨çš„ç¬¬ä¸€ä¸ªèŠ‚ç‚¹ã€‚ addAtTail(val)ï¼šå°†å€¼ä¸º val çš„èŠ‚ç‚¹è¿½åŠ åˆ°é“¾è¡¨çš„æœ€åä¸€ä¸ªå…ƒç´ ã€‚ addAtIndex(index,val)ï¼šåœ¨é“¾è¡¨ä¸­çš„ç¬¬ index ä¸ªèŠ‚ç‚¹ä¹‹å‰æ·»åŠ å€¼ä¸º val çš„èŠ‚ç‚¹ã€‚å¦‚æœ index ç­‰äºé“¾è¡¨çš„é•¿åº¦ï¼Œåˆ™è¯¥èŠ‚ç‚¹å°†é™„åŠ åˆ°é“¾è¡¨çš„æœ«å°¾ã€‚å¦‚æœ index å¤§äºé“¾è¡¨é•¿åº¦ï¼Œåˆ™ä¸ä¼šæ’å…¥èŠ‚ç‚¹ã€‚å¦‚æœ index å°äº 0ï¼Œåˆ™åœ¨å¤´éƒ¨æ’å…¥èŠ‚ç‚¹ã€‚ deleteAtIndex(index)ï¼šå¦‚æœç´¢å¼• index æœ‰æ•ˆï¼Œåˆ™åˆ é™¤é“¾è¡¨ä¸­çš„ç¬¬ index ä¸ªèŠ‚ç‚¹ã€‚ ç¤ºä¾‹ï¼š MyLinkedList linkedList = new MyLinkedList();linkedList.addAtHead(1);linkedList.addAtTail(3);linkedList.addAtIndex(1,2); //é“¾è¡¨å˜ä¸º1-&gt; 2-&gt; 3linkedList.get(1); //è¿”å›2linkedList.deleteAtIndex(1); //ç°åœ¨é“¾è¡¨æ˜¯1-&gt; 3linkedList.get(1); //è¿”å›3 æç¤ºï¼š æ‰€æœ‰ val å€¼éƒ½åœ¨ [1, 1000] ä¹‹å†…ã€‚ æ“ä½œæ¬¡æ•°å°†åœ¨ [1, 1000] ä¹‹å†…ã€‚ è¯·ä¸è¦ä½¿ç”¨å†…ç½®çš„ LinkedList åº“ã€‚ é“¾è¡¨æ˜¯ä¸€ä¸ªåŒ…å«é›¶ä¸ªæˆ–å¤šä¸ªå…ƒç´ çš„æ•°æ®ç»“æ„ã€‚æ¯ä¸ªå…ƒç´ éƒ½åŒ…å«ä¸€ä¸ªå€¼å’Œåˆ°å¦ä¸€ä¸ªå…ƒç´ çš„é“¾æ¥ã€‚æ ¹æ®é“¾æ¥æ•°çš„ä¸åŒï¼Œå¯ä»¥åˆ†ä¸ºå•é“¾è¡¨ï¼ŒåŒé“¾è¡¨å’Œå¤šé‡é“¾è¡¨ã€‚ æ€è·¯ä¸€ï¼šå•é“¾è¡¨ å‚æ•°çš„å«ä¹‰ï¼š head ï¼šè¡¨ç¤ºçš„é˜Ÿåˆ—çš„å¤´æŒ‡é’ˆ size ï¼šè¡¨ç¤ºé“¾è¡¨çš„é•¿åº¦ï¼Œæ¯æ’å…¥ä¸€ä¸ªå…ƒç´  +1ï¼Œåˆ é™¤ä¸€ä¸ªå…ƒç´  -1 å“¨å…µèŠ‚ç‚¹ å“¨å…µèŠ‚ç‚¹åœ¨æ ‘å’Œé“¾è¡¨ä¸­è¢«å¹¿æ³›ç”¨ä½œ ä¼ªå¤´ã€ä¼ªå°¾ ç­‰ï¼Œé€šå¸¸ä¸ä¿å­˜ä»»ä½•æ•°æ®ã€‚ å•é“¾è¡¨ä¸­å¯ä»¥ä½¿ç”¨ ä¼ªå¤´ ç®€åŒ–æ’å…¥å’Œåˆ é™¤ï¼Œå¯ä»¥é¿å…ç©ºæŒ‡é’ˆçš„å¤„ç† åœ¨æŒ‡å®šä½ç½®æ’å…¥å…ƒç´  æŸ¥æ‰¾æŒ‡å®šä½ç½®çš„å‰é©±èŠ‚ç‚¹ ListNode pre = head;// å› ä¸ºæœ‰ä¼ªå¤´ç»“ç‚¹å­˜åœ¨ï¼Œæ‰€ä»¥ i &lt; index æ‰¾åˆ°çš„èŠ‚ç‚¹ï¼Œä¸€å®šæ˜¯æ’å…¥ä½ç½®çš„å‰é©±èŠ‚ç‚¹for (int i = 0; i &lt; index; i++) pre = pre.next; æ’å…¥å…ƒç´ åˆ°å‰é©±èŠ‚ç‚¹å°¾éƒ¨ï¼ˆä¼ªå¤´ä¸å­˜æ”¾ä»»ä½•æ•°æ®ï¼Œä¼ªå¤´ä¹Ÿæ˜¯å‰é©±èŠ‚ç‚¹ï¼‰ã€‚ ListNode newNode = new ListNode(val);// æ’å…¥å…ƒç´ åˆ°å‰é©±èŠ‚ç‚¹å°¾éƒ¨newNode.next = pre.next;pre.next = newNode; ç¤ºæ„å›¾å¦‚ä¸‹ï¼Œæ¥è‡ª LeetCode å®˜ç½‘ åˆ é™¤æŒ‡å®šä½ç½®çš„èŠ‚ç‚¹ æŸ¥æ‰¾æŒ‡å®šä½ç½®çš„å‰é©±èŠ‚ç‚¹ ListNode pre = head;// å› ä¸ºæœ‰ä¼ªå¤´ç»“ç‚¹å­˜åœ¨ï¼Œæ‰€ä»¥ i &lt; index æ‰¾åˆ°çš„èŠ‚ç‚¹ï¼Œä¸€å®šæ˜¯æ’å…¥ä½ç½®çš„å‰é©±èŠ‚ç‚¹for (int i = 0; i &lt; index; i++) pre = pre.next; åˆ é™¤å½“å‰èŠ‚ç‚¹ pre.next = pre.next.next; ç¤ºæ„å›¾å¦‚ä¸‹ï¼Œæ¥è‡ª LeetCode å®˜ç½‘ å¤æ‚åº¦åˆ†æï¼š æ—¶é—´å¤æ‚åº¦ï¼š addAtHeadï¼š O(1) addAtInderï¼Œgetï¼ŒdeleteAtIndex: (k)ï¼Œå…¶ä¸­ k æŒ‡çš„æ˜¯å…ƒç´ çš„ç´¢å¼•ã€‚ addAtTailï¼šO(N)ï¼Œå…¶ä¸­ N æŒ‡çš„æ˜¯é“¾è¡¨çš„å…ƒç´ ä¸ªæ•°ã€‚ ç©ºé—´å¤æ‚åº¦ O(1)ï¼šæ‰€æœ‰çš„æ“ä½œéƒ½æ˜¯ O(1) Java å®ç°public class ListNode { public int val; public ListNode next; public ListNode(int x) { val = x; }}public class MyLinkedList1 { ListNode head; int size; /** * åˆå§‹åŒ– */ public MyLinkedList1() { size = 0; head = new ListNode(0); } /** * è·å–æŒ‡å®šä½ç½®çš„å…ƒç´ ï¼Œæ‰¾ä¸åˆ°è¿”å› -1 */ public int get(int index) { if (index &lt; 0 || index &gt;= size) return -1; ListNode cur = head; // å› ä¸ºå°†ä¼ªå¤´ä½œä¸ºå¤´ç»“ç‚¹ï¼Œæ‰€ä»¥éœ€è¦ +1 æ‰æ˜¯å½“å‰æŸ¥æ‰¾å…ƒç´ æ‰€åœ¨çš„ç»“ç‚¹ for (int i = 0; i &lt; index + 1; i++) cur = cur.next; return cur.val; } /** * åœ¨å¤´éƒ¨æ·»åŠ å…ƒç´  */ public void addAtHead(int val) { addAtIndex(0, val); } /** * åœ¨å°¾éƒ¨æ·»åŠ å…ƒç´  */ public void addAtTail(int val) { addAtIndex(size, val); } /** * åœ¨æŒ‡å®šä½ç½®æ’å…¥å…ƒç´  */ public void addAtIndex(int index, int val) { if (index &gt; size) return; if (index &lt; 0) index = 0; ListNode pre = head; // å› ä¸ºæœ‰ä¼ªå¤´ç»“ç‚¹å­˜åœ¨ï¼Œæ‰€ä»¥ i &lt; index æ‰¾åˆ°çš„èŠ‚ç‚¹ï¼Œä¸€å®šæ˜¯æ’å…¥ä½ç½®çš„å‰é©±èŠ‚ç‚¹ for (int i = 0; i &lt; index; i++) pre = pre.next; ListNode newNode = new ListNode(val); // æ’å…¥å…ƒç´ åˆ°å‰é©±èŠ‚ç‚¹å°¾éƒ¨ newNode.next = pre.next; pre.next = newNode; size++; } /** * åˆ é™¤æŒ‡å®šä½ç½®çš„å…ƒç´  */ public void deleteAtIndex(int index) { if (index &lt; 0 || index &gt;= size) return; ListNode pre = head; // å› ä¸ºæœ‰ä¼ªå¤´ç»“ç‚¹å­˜åœ¨ï¼Œæ‰€ä»¥ i &lt; index æ‰¾åˆ°çš„èŠ‚ç‚¹ï¼Œä¸€å®šæ˜¯æ’å…¥ä½ç½®çš„å‰é©±èŠ‚ç‚¹ for (int i = 0; i &lt; index; i++) pre = pre.next; pre.next = pre.next.next; size--; }} Kotlin å®ç°public class ListNode { public int val; public ListNode next; public ListNode(int x) { val = x; }}class MyLinkedList1() { /** * åˆå§‹åŒ– */ var head: ListNode = ListNode(0) var size: Int = 0 /** * è·å–æŒ‡å®šä½ç½®çš„å…ƒç´ ï¼Œæ‰¾ä¸åˆ°è¿”å› -1 */ fun get(index: Int): Int { val k = index if (k &lt; 0 || k &gt;= size) return -1 // å› ä¸ºå°†ä¼ªå¤´ä½œä¸ºå¤´ç»“ç‚¹ï¼Œæ‰€ä»¥éœ€è¦ +1 æ‰æ˜¯å½“å‰æŸ¥æ‰¾å…ƒç´ æ‰€åœ¨çš„ç»“ç‚¹ var cur: ListNode? = head for (i in 0 until (k + 1)) cur = cur?.next return cur?.`val` ?: -1 } /** * åœ¨å¤´éƒ¨æ·»åŠ å…ƒç´  */ fun addAtHead(`val`: Int) { addAtIndex(0, `val`) } /** * åœ¨å°¾éƒ¨æ·»åŠ å…ƒç´  */ fun addAtTail(`val`: Int) { addAtIndex(size, `val`) } /** * åœ¨æŒ‡å®šä½ç½®æ’å…¥å…ƒç´  */ fun addAtIndex(index: Int, `val`: Int) { var k = index if (k &gt; size) return if (k &lt; 0) k = 0 // å› ä¸ºæœ‰ä¼ªå¤´ç»“ç‚¹å­˜åœ¨ï¼Œæ‰€ä»¥ i &lt; index æ‰¾åˆ°çš„èŠ‚ç‚¹ï¼Œä¸€å®šæ˜¯æ’å…¥ä½ç½®çš„å‰é©±èŠ‚ç‚¹ var pre: ListNode? = head for (i in 0 until k) pre = pre?.next val node = ListNode(`val`) node.next = pre?.next pre?.next = node size++ } /** * åˆ é™¤æŒ‡å®šä½ç½®çš„å…ƒç´  */ fun deleteAtIndex(index: Int) { var k = index if (k &lt; 0 || k &gt;= size) return // å› ä¸ºæœ‰ä¼ªå¤´ç»“ç‚¹å­˜åœ¨ï¼Œæ‰€ä»¥ i &lt; index æ‰¾åˆ°çš„èŠ‚ç‚¹ï¼Œä¸€å®šæ˜¯æ’å…¥ä½ç½®çš„å‰é©±èŠ‚ç‚¹ var pre: ListNode? = head for (i in 0 until k) pre = pre?.next pre?.next = pre?.next?.next size-- }} æ€è·¯äºŒï¼šåŒå‘é“¾è¡¨åŒé“¾è¡¨æ¯”å•é“¾è¡¨å¿«å¾—å¤šï¼Œæµ‹è¯•ç”¨ä¾‹èŠ±è´¹çš„æ—¶é—´æ¯”å•é“¾è¡¨å¿«äº†ä¸¤å€ã€‚ä½†æ˜¯å®ƒæ›´åŠ å¤æ‚ï¼Œå®ƒåŒ…å«äº† sizeï¼Œè®°å½•é“¾è¡¨å…ƒç´ ä¸ªæ•°ï¼Œå’Œä¼ªå¤´ä¼ªå°¾ å‚æ•°çš„å«ä¹‰ï¼š head ï¼šè¡¨ç¤ºçš„é˜Ÿåˆ—çš„å¤´æŒ‡é’ˆ last ï¼šè¡¨ç¤ºçš„é˜Ÿåˆ—çš„å°¾æŒ‡é’ˆ size ï¼šè¡¨ç¤ºé“¾è¡¨çš„é•¿åº¦ï¼Œæ¯æ’å…¥ä¸€ä¸ªå…ƒç´  +1ï¼Œåˆ é™¤ä¸€ä¸ªå…ƒç´  -1 å“¨å…µèŠ‚ç‚¹ å“¨å…µèŠ‚ç‚¹åœ¨æ ‘å’Œé“¾è¡¨ä¸­è¢«å¹¿æ³›ç”¨ä½œ ä¼ªå¤´ã€ä¼ªå°¾ ç­‰ï¼Œé€šå¸¸ä¸ä¿å­˜ä»»ä½•æ•°æ®ã€‚ åŒå‘é“¾è¡¨ä¸­å¯ä»¥ä½¿ç”¨ ä¼ªå¤´ã€ä¼ªå°¾ ç®€åŒ–æ’å…¥å’Œåˆ é™¤ï¼Œå¯ä»¥é¿å…ç©ºæŒ‡é’ˆçš„å¤„ç† åœ¨æŒ‡å®šä½ç½®æ’å…¥å…ƒç´  æ‰¾åˆ°è¦æ’å…¥èŠ‚ç‚¹çš„å‰é©±èŠ‚ç‚¹å’Œåç»§èŠ‚ç‚¹ LinkedNode pre;LinkedNode succ;// å› ä¸ºæœ‰ä¼ªå¤´ã€ä¼ªå°¾ç»“ç‚¹å­˜åœ¨ï¼Œæ‰€ä»¥ i &lt; index æ‰¾åˆ°çš„èŠ‚ç‚¹ï¼Œä¸€å®šæ˜¯æ’å…¥ä½ç½®çš„å‰é©±èŠ‚ç‚¹if (index &lt; size - index) { pre = head; for (int i = 0; i &lt; index; i++) pre = pre.next; succ = pre.next;} else { succ = last; for (int i = 0; i &lt; size - index; i++) succ = succ.pre; pre = succ.pre;} é€šè¿‡æ”¹å˜å‰é©±ç»“ç‚¹å’Œåç»§èŠ‚ç‚¹çš„é“¾æ¥å…³ç³»æ’å…¥å…ƒç´  LinkedNode newNode = new LinkedNode(val);newNode.next = succ;newNode.pre = pre;succ.pre = newNode;pre.next = newNode; ä»¥ä¸‹ç¤ºæ„å›¾ï¼Œæ¥è‡ª LeetCode å®˜ç½‘ åœ¨æŒ‡å®šä½ç½®åˆ é™¤å…ƒç´  æ‰¾åˆ°è¦æ’å…¥èŠ‚ç‚¹çš„å‰é©±èŠ‚ç‚¹å’Œåç»§èŠ‚ç‚¹ LinkedNode pre;LinkedNode succ;// å› ä¸ºæœ‰ä¼ªå¤´ã€ä¼ªå°¾ç»“ç‚¹å­˜åœ¨ï¼Œæ‰€ä»¥ i &lt; index æ‰¾åˆ°çš„èŠ‚ç‚¹ï¼Œä¸€å®šæ˜¯æ’å…¥ä½ç½®çš„å‰é©±èŠ‚ç‚¹if (index &lt; size - index) { pre = head; for (int i = 0; i &lt; index; i++) pre = pre.next; succ = pre.next.next;} else { succ = last; // ä»å°¾éƒ¨æŸ¥æ‰¾å…ƒç´ ï¼Œéœ€è¦ -1 for (int i = 0; i &lt; size - index - 1; i++) succ = succ.pre; pre = succ.pre.pre;} åˆ é™¤å…ƒç´  pre.next = succ;succ.pre = pre; å¤æ‚åº¦åˆ†æï¼š æ—¶é—´å¤æ‚åº¦ï¼š addAtHeadï¼ŒaddAtTailï¼š O(1) getï¼ŒaddAtIndexï¼Œdeleteï¼šO(min(k,Nâˆ’k))ï¼Œå…¶ä¸­ k æŒ‡çš„æ˜¯å…ƒç´ çš„ç´¢å¼• ç©ºé—´å¤æ‚åº¦ O(1)ï¼šæ‰€æœ‰çš„æ“ä½œéƒ½æ˜¯ O(1) Java å®ç°public class LinkedNode { public int val; public LinkedNode pre; public LinkedNode next; public LinkedNode(int x) { this.val = x; }}class MyLinkedList2 { LinkedNode head; LinkedNode last; int size = 0; /** * åˆå§‹åŒ– */ public MyLinkedList2() { size = 0; head = new LinkedNode(0); last = new LinkedNode(0); head.next = last; last.pre = head; } /** * è·å–æŒ‡å®šä½ç½®çš„å…ƒç´ ï¼Œæ‰¾ä¸åˆ°è¿”å› -1 */ public int get(int index) { if (index &lt; 0 || index &gt;= size) return -1; LinkedNode cur; if (index + 1 &lt; size - index) { cur = head; // å› ä¸ºå°†ä¼ªå¤´ä½œä¸ºå¤´ç»“ç‚¹ï¼Œæ‰€ä»¥éœ€è¦ +1 æ‰æ˜¯å½“å‰æŸ¥æ‰¾å…ƒç´ æ‰€åœ¨çš„ç»“ç‚¹ for (int i = 0; i &lt; index + 1; i++) cur = cur.next; } else { cur = last; for (int i = 0; i &lt; size - index; i++) cur = cur.pre; } return cur.val; } /** * åœ¨å¤´éƒ¨æ·»åŠ å…ƒç´  */ public void addAtHead(int val) { LinkedNode pre = head; LinkedNode succ = head.next; LinkedNode node = new LinkedNode(val); node.next = succ; node.pre = pre; pre.next = node; succ.pre = node; size++; } /** * åœ¨å°¾éƒ¨æ·»åŠ å…ƒç´  */ public void addAtTail(int val) { LinkedNode succ = last; LinkedNode pre = last.pre; LinkedNode node = new LinkedNode(val); node.pre = pre; node.next = succ; succ.pre = node; pre.next = node; size++; } /** * åœ¨æŒ‡å®šä½ç½®æ’å…¥å…ƒç´  */ public void addAtIndex(int index, int val) { if (index &gt; size) return; if (index &lt; 0) index = 0; LinkedNode pre; LinkedNode succ; // å› ä¸ºæœ‰ä¼ªå¤´ã€ä¼ªå°¾ç»“ç‚¹å­˜åœ¨ï¼Œæ‰€ä»¥ i &lt; index æ‰¾åˆ°çš„èŠ‚ç‚¹ï¼Œä¸€å®šæ˜¯æ’å…¥ä½ç½®çš„å‰é©±èŠ‚ç‚¹ if (index &lt; size - index) { pre = head; for (int i = 0; i &lt; index; i++) pre = pre.next; succ = pre.next; } else { succ = last; for (int i = 0; i &lt; size - index; i++) succ = succ.pre; pre = succ.pre; } LinkedNode newNode = new LinkedNode(val); newNode.next = succ; newNode.pre = pre; succ.pre = newNode; pre.next = newNode; size++; } /** * åˆ é™¤æŒ‡å®šä½ç½®çš„å…ƒç´  */ public void deleteAtIndex(int index) { if (index &lt; 0 || index &gt;= size) return; LinkedNode pre; LinkedNode succ; // å› ä¸ºæœ‰ä¼ªå¤´ã€ä¼ªå°¾ç»“ç‚¹å­˜åœ¨ï¼Œæ‰€ä»¥ i &lt; index æ‰¾åˆ°çš„èŠ‚ç‚¹ï¼Œä¸€å®šæ˜¯æ’å…¥ä½ç½®çš„å‰é©±èŠ‚ç‚¹ if (index &lt; size - index) { pre = head; for (int i = 0; i &lt; index; i++) pre = pre.next; succ = pre.next.next; } else { succ = last; // ä»å°¾éƒ¨æŸ¥æ‰¾å…ƒç´ ï¼Œéœ€è¦ -1 for (int i = 0; i &lt; size - index - 1; i++) succ = succ.pre; pre = succ.pre.pre; } pre.next = succ; succ.pre = pre; size--; }} Kotlin å®ç°class MyLinkedList2() { var head: LinkedNode = LinkedNode(0) var last: LinkedNode = LinkedNode(0) var size: Int = 0 init { head.next = last last.pre = head } /** * è·å–æŒ‡å®šä½ç½®çš„å…ƒç´ ï¼Œæ‰¾ä¸åˆ°è¿”å› -1 */ fun get(index: Int): Int { val k = index if (k &lt; 0 || k &gt;= size) return -1 var cur: LinkedNode? = head if ((k + 1) &lt; (size - k)) { // å› ä¸ºå°†ä¼ªå¤´ä½œä¸ºå¤´ç»“ç‚¹ï¼Œæ‰€ä»¥éœ€è¦ +1 æ‰æ˜¯å½“å‰æŸ¥æ‰¾å…ƒç´ æ‰€åœ¨çš„ç»“ç‚¹ for (i in 0 until k + 1) cur = cur?.next } else { cur = last for (i in 0 until size - k) cur = cur?.pre } return cur?.`val` ?: -1 } /** * åœ¨å¤´éƒ¨æ·»åŠ å…ƒç´  */ fun addAtHead(`val`: Int) { val pre: LinkedNode? = head val succ: LinkedNode? = head.next val node: LinkedNode = LinkedNode(`val`) node.next = succ node.pre = pre succ?.pre = node pre?.next = node size++ } /** * åœ¨å°¾éƒ¨æ·»åŠ å…ƒç´  */ fun addAtTail(`val`: Int) { val pre = last.pre val succ = last val node = LinkedNode(`val`) node.next = succ node.pre = pre pre?.next = node succ?.pre = node size++ } /** * åœ¨æŒ‡å®šä½ç½®æ’å…¥å…ƒç´  */ fun addAtIndex(index: Int, `val`: Int) { var k = index if (k &gt; size) return if (k &lt; 0) k = 0 var pre: LinkedNode? = head var succ: LinkedNode? = last // å› ä¸ºæœ‰ä¼ªå¤´ã€ä¼ªå°¾ç»“ç‚¹å­˜åœ¨ï¼Œæ‰€ä»¥ i &lt; index æ‰¾åˆ°çš„èŠ‚ç‚¹ï¼Œä¸€å®šæ˜¯æ’å…¥ä½ç½®çš„å‰é©±èŠ‚ç‚¹ if (k &lt; size - k) { for (i in 0 until k) pre = pre?.next succ = pre?.next } else { succ = last; for (i in 0 until size - k) succ = succ?.pre pre = succ?.pre } val node = LinkedNode(`val`) node.next = succ node.pre = pre pre?.next = node succ?.pre = node size++ } /** * åˆ é™¤æŒ‡å®šä½ç½®çš„å…ƒç´  */ fun deleteAtIndex(index: Int) { val k = index if (k &lt; 0 || k &gt;= size) return var pre: LinkedNode? = head var succ: LinkedNode? = last // å› ä¸ºæœ‰ä¼ªå¤´ã€ä¼ªå°¾ç»“ç‚¹å­˜åœ¨ï¼Œæ‰€ä»¥ i &lt; index æ‰¾åˆ°çš„èŠ‚ç‚¹ï¼Œä¸€å®šæ˜¯æ’å…¥ä½ç½®çš„å‰é©±èŠ‚ç‚¹ if (k &lt; size - k) { for (i in 0 until k) pre = pre?.next succ = pre?.next?.next } else { succ = last; // ä»å°¾éƒ¨æŸ¥æ‰¾å…ƒç´ ï¼Œéœ€è¦ -1 for (i in 0 until size - k - 1) succ = succ?.pre pre = succ?.pre?.pre } pre?.next = succ succ?.pre = pre size-- }}","link":"/2020/08/15/LeetCode/linked-list/01-design-linked-list/"},{"title":"LeetCode æ ˆï¼šæœ‰æ•ˆçš„æ‹¬å·","text":"é¢˜ç›®æ¥æºäº LeetCode ä¸Šç¬¬ 20 å·é—®é¢˜ï¼šæœ‰æ•ˆçš„æ‹¬å·ã€‚é¢˜ç›®éš¾åº¦ä¸º Easyã€‚ è‹±æ–‡åœ°å€ï¼šhttps://leetcode.com/problems/valid-parentheses ä¸­æ–‡åœ°å€ï¼šhttps://leetcode-cn.com/problems/valid-parentheses é¢˜ç›®æè¿°ç»™å®šä¸€ä¸ªå­—ç¬¦ä¸², åªåŒ…æ‹¬ â€˜(â€˜ï¼Œâ€™)â€™ï¼Œâ€™{â€˜ï¼Œâ€™}â€™ï¼Œâ€™[â€˜ï¼Œâ€™]â€™ï¼Œåˆ¤æ–­å­—ç¬¦ä¸²æ˜¯å¦æœ‰æ•ˆ æœ‰æ•ˆå­—ç¬¦ä¸²éœ€è¦æ»¡è¶³ä»¥ä¸‹æ¡ä»¶ï¼š å·¦æ‹¬å·å¿…é¡»ç”¨ç›¸åŒç±»å‹çš„å³æ‹¬å·é—­åˆ å·¦æ‹¬å·å¿…é¡»ä»¥æ­£ç¡®çš„é¡ºåºé—­åˆ æ³¨æ„ç©ºå­—ç¬¦ä¸²å¯è¢«è®¤ä¸ºæ˜¯æœ‰æ•ˆå­—ç¬¦ä¸²ã€‚ Example 1: Input: &quot;()&quot; Output: trueExample 2: Input: &quot;()[]{}&quot; Output: trueExample 3: Input: &quot;(]&quot; Output: falseExample 4: Input: &quot;([)]&quot; Output: falseExample 5: Input: &quot;{[]}&quot; Output: true é¢˜ç›®è§£æ éå†å­—ç¬¦ä¸² é‡åˆ°å·¦æ‹¬å·ï¼Œåˆ™å°†å…¶å¯¹åº”çš„å³æ‹¬å·å‹å…¥æ ˆä¸­ å¦‚æœé‡åˆ°å³æ‹¬å·ï¼š å½“å‰æ ˆä¸ºç©ºï¼Œç›´æ¥è¿”å›false; å½“å‰å³æ‹¬å·å¯¹åº”çš„å·¦æ‹¬å·ï¼Œä¸æ ˆé¡¶å…ƒç´ ä¸ç›¸ç­‰ï¼Œç›´æ¥è¿”å›false é‡å¤æ‰§è¡Œ æ­¥éª¤ 2 å’Œæ­¥éª¤ 3 å¾ªç¯ç»“æŸä¹‹åï¼Œåˆ¤æ–­æ ˆæ˜¯å¦ä¸ºç©ºï¼Œä¸ä¸ºç©ºè¿”å›false Kotlin å®ç°class Solution { fun isValid(s: String): Boolean { val stack = ArrayDeque&lt;Char&gt;() // éå†å­—ç¬¦ä¸² for (c in s) { when (c) { // é‡åˆ°å·¦æ‹¬å·ï¼Œåˆ™å°†å…¶å¯¹åº”çš„å³æ‹¬å·å‹å…¥æ ˆä¸­ '(' -&gt; stack.push(')') '[' -&gt; stack.push(']') '{' -&gt; stack.push('}') else -&gt; { // å½“å‰å³æ‹¬å·ï¼Œä¸æ ˆé¡¶å…ƒç´ ä¸ç›¸ç­‰ï¼Œä¸ç›¸ç­‰ç›´æ¥è¿”å› false val tmp = stack.poll() if (c != tmp) { return false; } } } } return stack.isEmpty(); }} Java å®ç°class Solution { public boolean isValid(String s) { ArrayDeque&lt;Character&gt; stack = new ArrayDeque&lt;Character&gt;(); // éå†å­—ç¬¦ä¸² for (int i = 0; i &lt; s.length(); i++) { char c = s.charAt(i); // é‡åˆ°å·¦æ‹¬å·ï¼Œåˆ™å°†å…¶å¯¹åº”çš„å³æ‹¬å·å‹å…¥æ ˆä¸­ if (c == '(') { stack.push(')'); } else if (c == '[') { stack.push(']'); } else if (c == '{') { stack.push('}'); } else { // å½“å‰æ ˆä¸ºç©ºï¼Œç›´æ¥è¿”å› false if (stack.isEmpty()) { return false; } // å½“å‰å³æ‹¬å·ï¼Œä¸æ ˆé¡¶å…ƒç´ ä¸ç›¸ç­‰ï¼Œä¸ç›¸ç­‰ç›´æ¥è¿”å› false char tmp = stack.poll(); if (c != tmp) { return false; } } } return stack.isEmpty(); }}","link":"/2020/08/13/LeetCode/stack/02-valid-parentheses/"},{"title":"LeetCode æ ˆï¼šæœ€å°æ ˆ","text":"é¢˜ç›®æ¥æºäº LeetCode ä¸Š ç¬¬ 155 å·é—®é¢˜ï¼šæœ€å°æ ˆã€‚é¢˜ç›®éš¾åº¦ä¸º Easyã€‚ è‹±æ–‡åœ°å€ï¼šhttps://leetcode.com/problems/min-stack ä¸­æ–‡åœ°å€ï¼šhttps://leetcode-cn.com/problems/min-stack é¢˜ç›®æè¿°è®¾è®¡ä¸€ä¸ªæ”¯æŒ push ï¼Œpop ï¼Œtop æ“ä½œï¼Œå¹¶èƒ½åœ¨å¸¸æ•°æ—¶é—´å†…æ£€ç´¢åˆ°æœ€å°å…ƒç´ çš„æ ˆã€‚ push(x) â€”â€” å°†å…ƒç´  x æ¨å…¥æ ˆä¸­ã€‚ pop() â€”â€” åˆ é™¤æ ˆé¡¶çš„å…ƒç´ ã€‚ top() â€”â€” è·å–æ ˆé¡¶å…ƒç´ ã€‚ getMin() â€”â€” æ£€ç´¢æ ˆä¸­çš„æœ€å°å…ƒç´ ã€‚ ç¤ºä¾‹ï¼š è¾“å…¥ï¼š[&quot;MinStack&quot;,&quot;push&quot;,&quot;push&quot;,&quot;push&quot;,&quot;getMin&quot;,&quot;pop&quot;,&quot;top&quot;,&quot;getMin&quot;][[],[-2],[0],[-3],[],[],[],[]]è¾“å‡ºï¼š[null,null,null,null,-3,null,0,-2]è§£é‡Šï¼šMinStack minStack = new MinStack();minStack.push(-2);minStack.push(0);minStack.push(-3);minStack.getMin(); --&gt; è¿”å› -3.minStack.pop();minStack.top(); --&gt; è¿”å› 0.minStack.getMin(); --&gt; è¿”å› -2. æç¤ºï¼š popã€top å’Œ getMin æ“ä½œæ€»æ˜¯åœ¨ éç©ºæ ˆ ä¸Šè°ƒç”¨ æ€è·¯ï¼šç®—æ³•æµç¨‹å¦‚ä¸‹ï¼š ç”¨ä¸€ä¸ªè¾…åŠ©æ ˆ minStackï¼Œæ¯æ¬¡ push çš„æ—¶å€™ï¼Œæ¯”è¾ƒå½“å‰å…ƒç´ å’Œæ ˆé¡¶å…ƒç´ ï¼Œå°†æœ€å°å€¼å­˜å…¥ minStackã€‚ å¤æ‚åº¦åˆ†æï¼š æ—¶é—´å¤æ‚åº¦ï¼šO(1) ï¼Œå› ä¸ºæ ˆçš„æ’å…¥ã€åˆ é™¤ä¸è¯»å–æ“ä½œéƒ½æ˜¯ O(1) ç©ºé—´å¤æ‚åº¦ï¼šO(N)ï¼ŒN ä¸ºæ€»æ“ä½œæ¬¡æ•° Kotlin å®ç°class MinStack() { /** initialize your data structure here. */ val stack = ArrayDeque&lt;Int&gt;() val minStack = ArrayDeque&lt;Int&gt;() fun push(x: Int) { stack.push(x) if (minStack.peek() == null) { minStack.push(x) } else { minStack.push(Math.min(x, minStack.peek())) } } fun pop() { stack.poll() minStack.poll() } fun top(): Int { return stack.peek() } fun getMin(): Int { return minStack.peek() }} Java å®ç°class MinStack { ArrayDeque&lt;Integer&gt; stack; ArrayDeque&lt;Integer&gt; minStack; /** * initialize your data structure here. */ public MinStack() { stack = new ArrayDeque&lt;Integer&gt;(); minStack = new ArrayDeque&lt;Integer&gt;(); } public void push(int x) { stack.push(x); if (minStack.peek() == null) { minStack.push(x); } else { minStack.push(Math.min(x, minStack.peek())); } } public void pop() { stack.poll(); minStack.poll(); } public int top() { return stack.peek(); } public int getMin() { return minStack.peek(); }} ç»“è¯­è‡´åŠ›äºåˆ†äº«ä¸€ç³»åˆ— Android ç³»ç»Ÿæºç ã€é€†å‘åˆ†æã€ç®—æ³•ã€ç¿»è¯‘ã€Jetpack æºç ç›¸å…³çš„æ–‡ç« ï¼Œæ­£åœ¨åŠªåŠ›å†™å‡ºæ›´å¥½çš„æ–‡ç« ï¼Œå¦‚æœè¿™ç¯‡æ–‡ç« å¯¹ä½ æœ‰å¸®åŠ©ç»™ä¸ª starï¼Œæ–‡ç« ä¸­æœ‰ä»€ä¹ˆæ²¡æœ‰å†™æ˜ç™½çš„åœ°æ–¹ï¼Œæˆ–è€…æœ‰ä»€ä¹ˆæ›´å¥½çš„å»ºè®®æ¬¢è¿ç•™è¨€ï¼Œæ¬¢è¿ä¸€èµ·æ¥å­¦ä¹ ï¼Œåœ¨æŠ€æœ¯çš„é“è·¯ä¸Šä¸€èµ·å‰è¿›ã€‚ Android10 æºç åˆ†ææ­£åœ¨å†™ä¸€ç³»åˆ—çš„ Android 10 æºç åˆ†æçš„æ–‡ç« ï¼Œäº†è§£ç³»ç»Ÿæºç ï¼Œä¸ä»…æœ‰åŠ©äºåˆ†æé—®é¢˜ï¼Œåœ¨é¢è¯•è¿‡ç¨‹ä¸­ï¼Œå¯¹æˆ‘ä»¬ä¹Ÿæ˜¯éå¸¸æœ‰å¸®åŠ©çš„ï¼Œå¦‚æœä½ åŒæˆ‘ä¸€æ ·å–œæ¬¢ç ”ç©¶ Android æºç ï¼Œå¯ä»¥å…³æ³¨æˆ‘ GitHub ä¸Šçš„ Android10-Source-Analysisã€‚ ç®—æ³•é¢˜åº“çš„å½’çº³å’Œæ€»ç»“ç”±äº LeetCode çš„é¢˜åº“åºå¤§ï¼Œæ¯ä¸ªåˆ†ç±»éƒ½èƒ½ç­›é€‰å‡ºæ•°ç™¾é“é¢˜ï¼Œç”±äºæ¯ä¸ªäººçš„ç²¾åŠ›æœ‰é™ï¼Œä¸å¯èƒ½åˆ·å®Œæ‰€æœ‰é¢˜ç›®ï¼Œå› æ­¤æˆ‘æŒ‰ç…§ç»å…¸ç±»å‹é¢˜ç›®å»åˆ†ç±»ã€å’Œé¢˜ç›®çš„éš¾æ˜“ç¨‹åº¦å»æ’åºã€‚ æ•°æ®ç»“æ„ï¼š æ•°ç»„ã€æ ˆã€é˜Ÿåˆ—ã€å­—ç¬¦ä¸²ã€é“¾è¡¨ã€æ ‘â€¦â€¦ ç®—æ³•ï¼š æŸ¥æ‰¾ç®—æ³•ã€æœç´¢ç®—æ³•ã€ä½è¿ç®—ã€æ’åºã€æ•°å­¦ã€â€¦â€¦ æ¯é“é¢˜ç›®éƒ½ä¼šç”¨ Java å’Œ kotlin å»å®ç°ï¼Œå¹¶ä¸”æ¯é“é¢˜ç›®éƒ½æœ‰è§£é¢˜æ€è·¯ï¼Œå¦‚æœä½ åŒæˆ‘ä¸€æ ·å–œæ¬¢ç®—æ³•ã€LeetCodeï¼Œå¯ä»¥å…³æ³¨æˆ‘ GitHub ä¸Šçš„ LeetCode é¢˜è§£ï¼šLeetcode-Solutions-with-Java-And-Kotlinã€‚ ç²¾é€‰å›½å¤–çš„æŠ€æœ¯æ–‡ç« ç›®å‰æ­£åœ¨æ•´ç†å’Œç¿»è¯‘ä¸€ç³»åˆ—ç²¾é€‰å›½å¤–çš„æŠ€æœ¯æ–‡ç« ï¼Œä¸ä»…ä»…æ˜¯ç¿»è¯‘ï¼Œå¾ˆå¤šä¼˜ç§€çš„è‹±æ–‡æŠ€æœ¯æ–‡ç« æä¾›äº†å¾ˆå¥½æ€è·¯å’Œæ–¹æ³•ï¼Œæ¯ç¯‡æ–‡ç« éƒ½ä¼šæœ‰è¯‘è€…æ€è€ƒéƒ¨åˆ†ï¼Œå¯¹åŸæ–‡çš„æ›´åŠ æ·±å…¥çš„è§£è¯»ï¼Œå¯ä»¥å…³æ³¨æˆ‘ GitHub ä¸Šçš„ Technical-Article-Translationã€‚","link":"/2020/08/09/LeetCode/stack/01-min-stack/"},{"title":"LeetCode é˜Ÿåˆ—ï¼šè®¾è®¡å¾ªç¯é˜Ÿåˆ—","text":"é¢˜ç›®æ¥æºäº LeetCode ä¸Š ç¬¬ 622 å·é—®é¢˜ï¼šå²›å±¿æ•°é‡ã€‚é¢˜ç›®éš¾åº¦ä¸º Mediumã€‚ è‹±æ–‡åœ°å€ï¼šhttps://leetcode.com/problems/design-circular-queue/ ä¸­æ–‡åœ°å€ï¼šhttps://leetcode-cn.com/problems/design-circular-queue/ é¢˜ç›®æè¿°è®¾è®¡ä½ çš„å¾ªç¯é˜Ÿåˆ—å®ç°ã€‚ å¾ªç¯é˜Ÿåˆ—æ˜¯ä¸€ç§çº¿æ€§æ•°æ®ç»“æ„ï¼Œå…¶æ“ä½œè¡¨ç°åŸºäº FIFOï¼ˆå…ˆè¿›å…ˆå‡ºï¼‰åŸåˆ™å¹¶ä¸”é˜Ÿå°¾è¢«è¿æ¥åœ¨é˜Ÿé¦–ä¹‹åä»¥å½¢æˆä¸€ä¸ªå¾ªç¯ã€‚å®ƒä¹Ÿè¢«ç§°ä¸ºâ€œç¯å½¢ç¼“å†²å™¨â€ã€‚ å¾ªç¯é˜Ÿåˆ—çš„ä¸€ä¸ªå¥½å¤„æ˜¯æˆ‘ä»¬å¯ä»¥åˆ©ç”¨è¿™ä¸ªé˜Ÿåˆ—ä¹‹å‰ç”¨è¿‡çš„ç©ºé—´ã€‚åœ¨ä¸€ä¸ªæ™®é€šé˜Ÿåˆ—é‡Œï¼Œä¸€æ—¦ä¸€ä¸ªé˜Ÿåˆ—æ»¡äº†ï¼Œæˆ‘ä»¬å°±ä¸èƒ½æ’å…¥ä¸‹ä¸€ä¸ªå…ƒç´ ï¼Œå³ä½¿åœ¨é˜Ÿåˆ—å‰é¢ä»æœ‰ç©ºé—´ã€‚ä½†æ˜¯ä½¿ç”¨å¾ªç¯é˜Ÿåˆ—ï¼Œæˆ‘ä»¬èƒ½ä½¿ç”¨è¿™äº›ç©ºé—´å»å­˜å‚¨æ–°çš„å€¼ã€‚ ä½ çš„å®ç°åº”è¯¥æ”¯æŒå¦‚ä¸‹æ“ä½œï¼š MyCircularQueue(k): æ„é€ å™¨ï¼Œè®¾ç½®é˜Ÿåˆ—é•¿åº¦ä¸º k ã€‚ Front: ä»é˜Ÿé¦–è·å–å…ƒç´ ã€‚å¦‚æœé˜Ÿåˆ—ä¸ºç©ºï¼Œè¿”å› -1 ã€‚ Rear: è·å–é˜Ÿå°¾å…ƒç´ ã€‚å¦‚æœé˜Ÿåˆ—ä¸ºç©ºï¼Œè¿”å› -1 ã€‚ enQueue(value): å‘å¾ªç¯é˜Ÿåˆ—æ’å…¥ä¸€ä¸ªå…ƒç´ ã€‚å¦‚æœæˆåŠŸæ’å…¥åˆ™è¿”å›çœŸã€‚ deQueue(): ä»å¾ªç¯é˜Ÿåˆ—ä¸­åˆ é™¤ä¸€ä¸ªå…ƒç´ ã€‚å¦‚æœæˆåŠŸåˆ é™¤åˆ™è¿”å›çœŸã€‚ isEmpty(): æ£€æŸ¥å¾ªç¯é˜Ÿåˆ—æ˜¯å¦ä¸ºç©ºã€‚ isFull(): æ£€æŸ¥å¾ªç¯é˜Ÿåˆ—æ˜¯å¦å·²æ»¡ã€‚ ç¤ºä¾‹ï¼š MyCircularQueue circularQueue = new MyCircularQueue(3); // è®¾ç½®é•¿åº¦ä¸º 3circularQueue.enQueue(1); // è¿”å› truecircularQueue.enQueue(2); // è¿”å› truecircularQueue.enQueue(3); // è¿”å› truecircularQueue.enQueue(4); // è¿”å› falseï¼Œé˜Ÿåˆ—å·²æ»¡circularQueue.Rear(); // è¿”å› 3circularQueue.isFull(); // è¿”å› truecircularQueue.deQueue(); // è¿”å› truecircularQueue.enQueue(4); // è¿”å› truecircularQueue.Rear(); // è¿”å› 4 æç¤ºï¼š æ‰€æœ‰çš„å€¼éƒ½åœ¨ 0 è‡³ 1000 çš„èŒƒå›´å†… æ“ä½œæ•°å°†åœ¨ 1 è‡³ 1000 çš„èŒƒå›´å†… è¯·ä¸è¦ä½¿ç”¨å†…ç½®çš„é˜Ÿåˆ—åº“ æ€è·¯ï¼šå‚æ•°çš„å«ä¹‰ï¼š data ï¼šè¡¨ç¤ºå›ºå®šçš„æ•°ç»„ï¼Œç”¨ä½œå¾ªç¯é˜Ÿåˆ— head ï¼šè¡¨ç¤ºçš„é˜Ÿåˆ—çš„å¤´æŒ‡é’ˆ tail ï¼š è¡¨ç¤ºé˜Ÿåˆ—çš„å°¾æŒ‡é’ˆ åˆ¤æ–­é˜Ÿåˆ—æ˜¯å¦å·²æ»¡ (tail + 1) % size == head åˆ¤æ–­é˜Ÿåˆ—æ˜¯å¦ä¸ºç©º head == -1 æˆ–è€… head == tail å…·ä½“å®ç°å¯ä»¥çœ‹ Java å’Œ Kotlinï¼Œå®ƒä»¬çš„å®ç°æ–¹å¼å„ä¸ç›¸åŒ å¤æ‚åº¦åˆ†æï¼š æ—¶é—´å¤æ‚åº¦ï¼šO(1) ï¼Œæ•°ç»„å­˜å‚¨éƒ½æ˜¯æŒ‰é¡ºåºå­˜æ”¾çš„ï¼Œå…·æœ‰éšæœºè®¿é—®çš„ç‰¹ç‚¹ ç©ºé—´å¤æ‚åº¦ï¼šO(N)ï¼ŒN ä¸ºæ•°ç»„çš„é•¿åº¦ Kotlin å®ç°class MyCircularQueue(k: Int) { var head = -1; var tail = -1; var data = IntArray(k); val size = k; fun enQueue(value: Int): Boolean { if (isFull()) return false if (isEmpty()) head = 0 tail = (tail + 1) % size data[tail] = value return true } fun deQueue(): Boolean { if (isEmpty()) return false if (head == tail) { head = -1 tail = -1 return true } head = (head + 1) % size return true } fun Front(): Int { if (isEmpty()) return -1 return data[head] } fun Rear(): Int { if (isEmpty()) return -1 return data[tail] } fun isEmpty(): Boolean { return head == -1 } fun isFull(): Boolean { return (tail + 1) % size == head }} Java å®ç°æ€è·¯å’Œ Kotlin çš„å®ç°ä¸åŒï¼Œä¸ºäº†é¿å…å†²çªå¾ªç¯æ•°ç»„ä¸­ä»»ä½•æ—¶åˆ»ä¸€å®šè‡³å°‘æœ‰ä¸€ä¸ªä½ç½®ä¸å­˜æ”¾æœ‰æ•ˆå…ƒç´ ï¼Œä¸è¿‡è¿™ç§æ–¹æ³•å®ç°ï¼Œæ›´æ–¹ä¾¿è¿›è¡Œæ‰©å®¹ï¼Œå‚è€ƒ ArrayDeque æºç å®ç° class MyCircularQueue { int[] data; int head; int tail; int size; public MyCircularQueue(int k) { // k + 1 æœ‰ä¸¤ä¸ªåŸå›  // 1. ä¸ºäº†é¿å…å†²çªå¾ªç¯æ•°ç»„ä¸­ä»»ä½•æ—¶åˆ»ä¸€å®šè‡³å°‘æœ‰ä¸€ä¸ªä½ç½®ä¸å­˜æ”¾æœ‰æ•ˆå…ƒç´  // 2. å½“ k = 4 ï¼Œä¸‹æ ‡ä» 0 å¼€å§‹çš„ï¼Œå‡è®¾ä¸ç§»åŠ¨ headï¼Œ k ä¹Ÿä¸ +1 ï¼Œç¬¬å››ä¸ªå…ƒç´ å§‹ç»ˆæ”¾ä¸è¿›å» size = k + 1; data = new int[size]; head = 0; tail = 0; } public boolean enQueue(int value) { if (isFull()) return false; data[tail] = value; tail = (tail + 1) % size; return true; } public boolean deQueue() { if (isEmpty()) return false; head = (head + 1) % size; return true; } public int Front() { if (isEmpty()) return -1; return data[head]; } public int Rear() { if (isEmpty()) return -1; // å› ä¸ºæ•°ç»„ä¸­ä»»ä½•æ—¶åˆ»ä¸€å®šè‡³å°‘æœ‰ä¸€ä¸ªä½ç½®ä¸å­˜æ”¾æœ‰æ•ˆå…ƒç´ ï¼Œæ‰€ä»¥ tail - 1 å–æœ€è¿‘å­˜æ”¾çš„å…ƒç´  // å‡è®¾ tail = 0 æ—¶ï¼Œtail - 1 å°±ä¼šå˜æˆè´Ÿæ•°ï¼Œä¸‹æ ‡ä¼šè¶Šç•Œï¼Œæ‰€ä»¥ tail - 1 + size) % size return data[(tail - 1 + size) % size]; } public boolean isEmpty() { return head == tail; } public boolean isFull() { return (tail + 1) % size == head; }}","link":"/2020/08/09/LeetCode/queue/01-design-circular-queue/"},{"title":"å‰‘æŒ‡ Offer 19ï¼šæ­£åˆ™è¡¨è¾¾å¼åŒ¹é…","text":"é¢˜ç›®æ¥æºäº LeetCode å‰‘æŒ‡ offer ç¬¬ 19 å·é—®é¢˜ï¼š æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…ã€‚é¢˜ç›®éš¾åº¦ä¸º Hardã€‚ ä¸­æ–‡åœ°å€ï¼šhttps://leetcode-cn.com/problems/zheng-ze-biao-da-shi-pi-pei-lcof/ é¢˜ç›®æè¿°è¯·å®ç°ä¸€ä¸ªå‡½æ•°ç”¨æ¥åŒ¹é…åŒ…å« . å’Œ * çš„æ­£åˆ™è¡¨è¾¾å¼ã€‚æ¨¡å¼ä¸­çš„å­—ç¬¦ . è¡¨ç¤ºä»»æ„ä¸€ä¸ªå­—ç¬¦ï¼Œè€Œ * è¡¨ç¤ºå®ƒå‰é¢çš„å­—ç¬¦å¯ä»¥å‡ºç°ä»»æ„æ¬¡ï¼ˆå«0æ¬¡ï¼‰ã€‚åœ¨æœ¬é¢˜ä¸­ï¼ŒåŒ¹é…æ˜¯æŒ‡å­—ç¬¦ä¸²çš„æ‰€æœ‰å­—ç¬¦åŒ¹é…æ•´ä¸ªæ¨¡å¼ã€‚ä¾‹å¦‚ï¼Œå­—ç¬¦ä¸² aaa ä¸æ¨¡å¼ a.a å’Œ ab*ac*a åŒ¹é…ï¼Œä½†ä¸ aa.a å’Œ ab*a å‡ä¸åŒ¹é…ã€‚ ç¤ºä¾‹ 1ï¼š è¾“å…¥:s = &quot;aa&quot;p = &quot;a&quot;è¾“å‡º: falseè§£é‡Š: &quot;a&quot; æ— æ³•åŒ¹é… &quot;aa&quot; æ•´ä¸ªå­—ç¬¦ä¸²ã€‚ ç¤ºä¾‹ 2ï¼š è¾“å…¥:s = &quot;aa&quot;p = &quot;a*&quot;è¾“å‡º: trueè§£é‡Š: å› ä¸º '*' ä»£è¡¨å¯ä»¥åŒ¹é…é›¶ä¸ªæˆ–å¤šä¸ªå‰é¢çš„é‚£ä¸€ä¸ªå…ƒç´ , åœ¨è¿™é‡Œå‰é¢çš„å…ƒç´ å°±æ˜¯ 'a'ã€‚å› æ­¤ï¼Œå­—ç¬¦ä¸² &quot;aa&quot; å¯è¢«è§†ä¸º 'a' é‡å¤äº†ä¸€æ¬¡ã€‚ ç¤ºä¾‹ 3ï¼š è¾“å…¥:s = &quot;ab&quot;p = &quot;.*&quot;è¾“å‡º: trueè§£é‡Š: &quot;.*&quot; è¡¨ç¤ºå¯åŒ¹é…é›¶ä¸ªæˆ–å¤šä¸ªï¼ˆ'*'ï¼‰ä»»æ„å­—ç¬¦ï¼ˆ'.'ï¼‰ã€‚ ç¤ºä¾‹ 4ï¼š è¾“å…¥:s = &quot;aab&quot;p = &quot;c*a*b&quot;è¾“å‡º: trueè§£é‡Š: å› ä¸º '*' è¡¨ç¤ºé›¶ä¸ªæˆ–å¤šä¸ªï¼Œè¿™é‡Œ 'c' ä¸º 0 ä¸ª, 'a' è¢«é‡å¤ä¸€æ¬¡ã€‚å› æ­¤å¯ä»¥åŒ¹é…å­—ç¬¦ä¸² &quot;aab&quot;ã€‚ ç¤ºä¾‹ 5ï¼š è¾“å…¥:s = &quot;mississippi&quot;p = &quot;mis*is*p*.&quot;è¾“å‡º: false è¯´æ˜ï¼š s å¯èƒ½ä¸ºç©ºï¼Œä¸”åªåŒ…å«ä» a-z çš„å°å†™å­—æ¯ p å¯èƒ½ä¸ºç©ºï¼Œä¸”åªåŒ…å«ä» a-z çš„å°å†™å­—æ¯ä»¥åŠå­—ç¬¦ . å’Œ *ï¼Œæ— è¿ç»­çš„ * æ€è·¯ï¼šæ³¨æ„ï¼š å‡è®¾è¾“å…¥çš„å­—ç¬¦ä¸² s = &quot;aab&quot; å’Œ p = &quot;c*a*b&quot;ï¼Œå…¶ä¸­ c* æˆ–è€… a* å®ƒä»¬æ˜¯ä¸€ä¸ªæ•´ä½“ï¼Œä¾‹å¦‚ c* å¯ä»¥æ˜¯ 0 ä¸ª c ï¼Œä¹Ÿå¯ä»¥æ˜¯å¤šä¸ª cã€‚ å­—ç¬¦ .* å¯ä»¥è¡¨ç¤ºä»»æ„å­—ç¬¦ï¼ˆ0 ä¸ªæˆ–è€…å¤šä¸ªï¼‰ ç®—æ³•æµç¨‹å¦‚ä¸‹ï¼š å‡è®¾ä¸»ä¸²ä¸º sï¼Œæ¨¡å¼ä¸²ä¸º pï¼Œéœ€è¦å…³æ³¨æ­£åˆ™è¡¨è¾¾å¼ p çš„æœ€åä¸€ä¸ªå­—ç¬¦æ˜¯è°ï¼Œå®ƒæœ‰ä¸‰ç§å¯èƒ½ï¼š p[j-1] = æ­£å¸¸å­—ç¬¦ p[j-1] = '.' p[j-1] = '*' åªéœ€è¦é’ˆå¯¹ä¸Šé¢ä¸‰ç§æƒ…å†µè®¨è®ºå³å¯ æƒ…å†µä¸€ï¼šp[j-1] = æ­£å¸¸å­—ç¬¦ éœ€è¦çœ‹æœ€åä¸€ä¸ªå­—ç¬¦ä¸²æ˜¯å¦ç›¸ç­‰: å¦‚æœç›¸ç­‰çš„è¯ï¼Œå°±è¦åŒ¹é…å‰é¢çš„å­—ç¬¦ä¸²æ˜¯å¦ç›¸ç­‰ï¼Œ å³ s[i-1] == p[j-1] å…¬å¼ä¸º dp[i][j] = dp[i-1][j-1] å¦‚æœä¸ç›¸ç­‰çš„è¯ï¼Œå°±è¦çœ‹æœ€åä¸€ä¸ªå­—ç¬¦ä¸²æ˜¯ . è¿˜æ˜¯ * æƒ…å†µäºŒï¼šp[j-1] = â€˜.â€™ å­—ç¬¦ . æ˜¯ä¸‡èƒ½å­—ç¬¦ï¼Œå¯ä»¥ç›´æ¥è®©å®ƒç­‰äº s[i-1]ï¼ŒåŒæƒ…å†µä¸€å¤„ç† dp[i][j] = dp[i-1][j-1] æƒ…å†µä¸‰ï¼šp[j-1] = â€˜*â€™ å­—ç¬¦ * å¯ä»¥åŒ¹é… 0 ä¸ªæˆ–å¤šä¸ªå‰é¢çš„å­—ç¬¦ï¼Œè€Œæ˜¯å¦èƒ½å– 0 ä¸ªæˆ–è€…å¤šä¸ªå­—ç¬¦ï¼Œéœ€è¦çœ‹å‰é¢çš„ p[j-2] æ˜¯å¦ç­‰äº s[i-1] å½“ p[j-2] != s[i-1] å¦‚æœå®ƒä»¬ä¸ç›¸ç­‰ï¼Œåˆ™æœ€åä¸¤ä¸ªå­—ç¬¦åºŸæ‰äº†ï¼Œå³ dp[i][j] = dp[i][j-2] å½“ p[j-2] == s[i-1] æˆ–è€… p[j-2] = '.' å­—ç¬¦ * å¯ä»¥åŒ¹é… 0 ä¸ªæˆ–å¤šä¸ªå‰é¢çš„å­—ç¬¦ï¼Œp[j-2] = '.' å¯ä»¥ç›´æ¥è®©å®ƒç­‰äº s[i-1] å– 0 ä¸ªå­—ç¬¦ ä¾‹å¦‚ï¼šs = aab, p = aabbï¼Œè™½ç„¶ j-2 å’Œ i-1 ç›¸ç­‰ï¼Œä½†æ˜¯ dp[i][j-2] å·²ç»åŒ¹é…äº†ï¼Œç›´æ¥åˆ é™¤ j-1 å’Œ j-2ï¼Œå³ dp[i][j] = dp[i][j-2] å– 1 ä¸ªå­—ç¬¦ ä¾‹å¦‚ï¼šs = aab, p = aabï¼Œå–1ä¸ªå­—ç¬¦ï¼Œç›¸å½“äºå»æ‰ p[j-1]ï¼Œå³ dp[i][j] = dp[i][j-1] å–å¤šä¸ªå­—ç¬¦ ä¾‹å¦‚ï¼šs = aabb, p = aabï¼Œéœ€è¦åˆ¤æ–­ s = aab å’Œ p = aab æ˜¯å¦åŒ¹é…ï¼Œå¦‚æœå¯ä»¥åŒ¹é…ï¼Œé‚£ä¹ˆ s åé¢å†åŠ ä¸Šä¸€ä¸ª b ä¹Ÿæ²¡å…³ç³»ï¼Œå› ä¸º * å¯ä»¥å˜æˆå¤šä¸ª bï¼Œå³ dp[i][j] = dp[i-1][j] æ€»ç»“ï¼š æƒ…å†µä¸€ å’Œ æƒ…å†µäºŒï¼Œå¯ä»¥å½“åšä¸€ç§æƒ…å†µæ¥å¤„ç†ï¼Œå³ val ms = s[i - 1]val mp = p[j - 1]if (mp == ms || mp == '.') { dp[i][j] = dp[i - 1][j - 1]} æ— è®º p[j-2] æ˜¯å¦ç­‰äº s[i-1]ï¼Œéƒ½å¯ä»¥åˆ é™¤æ‰æœ€åä¸¤ä¸ªå­—ç¬¦ dp[i][j] = dp[i][j] || dp[i][j - 2] å½“ p[j-2] == s[i-1] æˆ–è€… p[j-2] = '.' å¯ä»¥å– 1 ä¸ªæˆ–è€…å¤šä¸ªå­—ç¬¦ val mpLast = p[j - 2]if (ms == mpLast || mpLast == '.') { dp[i][j] = dp[i - 1][j] || dp[i][j - 1]} åˆå§‹åŒ– ç©ºä¸²å’Œç©ºæ­£åˆ™æ˜¯åŒ¹é…çš„ï¼Œå³ dp[0][0] = true éœ€è¦åˆå§‹åŒ–ç¬¬ä¸€è¡Œï¼Œå½“ p[i-1] ä¸º * å¯ä»¥æŠŠ i-2 å’Œ i-1 å¤„çš„å­—ç¬¦åˆ æ‰ï¼Œå¹¶ä¸”åªæœ‰ [0, i-3] ä¸º true æ‰å¯ä»¥è®© dp[0][i] = true å¤æ‚åº¦åˆ†æï¼š M æ˜¯å­—ç¬¦ä¸² s çš„é•¿åº¦ï¼Œ N æ˜¯å­—ç¬¦ä¸² p çš„é•¿åº¦ æ—¶é—´å¤æ‚åº¦ï¼šO(MN) ï¼Œéœ€è¦éå†æ¯ä¸ªå­—ç¬¦è¿›è¡ŒåŒ¹é…ï¼Œå³æ—¶é—´å¤æ‚åº¦ä¸º O(MN) ç©ºé—´å¤æ‚åº¦ï¼šO(MN)ï¼Œéœ€è¦å»ºç«‹æ•°ç»„ dp ä¿å­˜åŒ¹é…çš„ç»“æœ Kotlin å®ç°class Solution { fun isMatch(s: String, p: String): Boolean { val row = s.length val colum = p.length val dp = Array(row + 1) { BooleanArray(colum + 1) } dp[0][0] = true; for (i in 1..colum) { if (p[i - 1] == '*' &amp;&amp; dp[0][i - 2]) { dp[0][i] = true } } for (i in 1..row) { for (j in 1..colum) { val ms = s[i - 1] val mp = p[j - 1] if (mp == ms || mp == '.') { dp[i][j] = dp[i - 1][j - 1] } else if (mp == '*') { if (j &lt; 2) continue val mpLast = p[j - 2] if (ms == mpLast || mpLast == '.') { dp[i][j] = dp[i - 1][j] || dp[i][j - 1] } dp[i][j] = dp[i][j] || dp[i][j - 2] } } } return dp[row][colum] }} Java å®ç°class Solution { public boolean isMatch(String s, String p) { if (s == null || p == null) { return false; } int row = s.length(); int colum = p.length(); boolean[][] dp = new boolean[row + 1][colum + 1]; dp[0][0] = true; for (int j = 1; j &lt;= colum; j++) { if (p.charAt(j - 1) == '*' &amp;&amp; dp[0][j - 2]) { dp[0][j] = true; } } for (int i = 1; i &lt;= row; i++) { for (int j = 1; j &lt;= colum; j++) { char ms = s.charAt(i - 1); char mp = p.charAt(j - 1); /** * ä¸¤ç§æƒ…å†µ * å’Œ é* */ if (ms == mp || mp == '.') { // é* dp[i][j] = dp[i - 1][j - 1]; } else if (mp == '*') { // é‡åˆ° * å·ï¼Œåˆ™ä»£ç  P[mâˆ’2]=c å¯ä»¥é‡å¤0æ¬¡æˆ–å¤šæ¬¡ï¼Œå®ƒä»¬æ˜¯ä¸€ä¸ªæ•´ä½“ c* if (j &lt; 2) continue; char mpLast = p.charAt(j - 2); if (mpLast == ms || mpLast == '.') { dp[i][j] = dp[i - 1][j] || dp[i][j - 1]; } // P[nâˆ’1] æ˜¯ 0 ä¸ª cï¼ŒP æœ€åä¸¤ä¸ªå­—ç¬¦åºŸäº† dp[i][j] = dp[i][j] || dp[i][j - 2]; } } } return dp[row][colum]; }}","link":"/2020/08/08/LeetCode/offer/19-zheng-ze-biao-da-shi-pi-pei/"},{"title":"å‰‘æŒ‡ Offer 18ï¼šåˆ é™¤é“¾è¡¨çš„èŠ‚ç‚¹","text":"é¢˜ç›®æ¥æºäº LeetCode å‰‘æŒ‡ offer ç¬¬ 18 å·é—®é¢˜ï¼š åˆ é™¤é“¾è¡¨çš„èŠ‚ç‚¹ã€‚é¢˜ç›®éš¾åº¦ä¸º Easyã€‚ ä¸­æ–‡åœ°å€ï¼šhttps://leetcode-cn.com/problems/shan-chu-lian-biao-de-jie-dian-lcof é¢˜ç›®æè¿°ç»™å®šå•å‘é“¾è¡¨çš„å¤´æŒ‡é’ˆå’Œä¸€ä¸ªè¦åˆ é™¤çš„èŠ‚ç‚¹çš„å€¼ï¼Œå®šä¹‰ä¸€ä¸ªå‡½æ•°åˆ é™¤è¯¥èŠ‚ç‚¹ã€‚ è¿”å›åˆ é™¤åçš„é“¾è¡¨çš„å¤´èŠ‚ç‚¹ã€‚ ç¤ºä¾‹ 1ï¼š è¾“å…¥: head = [4,5,1,9], val = 5è¾“å‡º: [4,1,9]è§£é‡Š: ç»™å®šä½ é“¾è¡¨ä¸­å€¼ä¸º 5 çš„ç¬¬äºŒä¸ªèŠ‚ç‚¹ï¼Œé‚£ä¹ˆåœ¨è°ƒç”¨äº†ä½ çš„å‡½æ•°ä¹‹åï¼Œè¯¥é“¾è¡¨åº”å˜ä¸º 4 -&gt; 1 -&gt; 9. ç¤ºä¾‹ 2ï¼š è¾“å…¥: head = [4,5,1,9], val = 1è¾“å‡º: [4,5,9]è§£é‡Š: ç»™å®šä½ é“¾è¡¨ä¸­å€¼ä¸º 1 çš„ç¬¬ä¸‰ä¸ªèŠ‚ç‚¹ï¼Œé‚£ä¹ˆåœ¨è°ƒç”¨äº†ä½ çš„å‡½æ•°ä¹‹åï¼Œè¯¥é“¾è¡¨åº”å˜ä¸º 4 -&gt; 5 -&gt; 9. è¯´æ˜ï¼š é¢˜ç›®ä¿è¯é“¾è¡¨ä¸­èŠ‚ç‚¹çš„å€¼äº’ä¸ç›¸åŒ è‹¥ä½¿ç”¨ C æˆ– C++ è¯­è¨€ï¼Œä½ ä¸éœ€è¦ free æˆ– delete è¢«åˆ é™¤çš„èŠ‚ç‚¹ æ€è·¯ï¼šå¦‚ä½•åˆ é™¤èŠ‚ç‚¹ï¼š å‡è®¾ current æŒ‡å‘ head èŠ‚ç‚¹ï¼ŒtmpNode ä¸ºè¦åˆ é™¤çš„èŠ‚ç‚¹ï¼Œç®—æ³•å¦‚ä¸‹ val tmpNode = current.next;current.next = tmpNode.next ç®—æ³•æµç¨‹å¦‚ä¸‹ï¼š current æŒ‡å‘ head èŠ‚ç‚¹ å¦‚æœ head == null å³è¿”å› head èŠ‚ç‚¹ å¦‚æœå¤´èŠ‚ç‚¹æ˜¯è¦åˆ é™¤çš„èŠ‚ç‚¹ï¼Œå³ head.val == val è¿”å› head.next, åˆ é™¤å¤´èŠ‚ç‚¹ å¾ªç¯éå†ä¸‹ä¸€ä¸ªèŠ‚ç‚¹æ˜¯å¦ä¸ºç©º while (current?.next != null) { ... } åˆ¤æ–­ä¸‹ä¸€ä¸ªèŠ‚ç‚¹æ˜¯å¦æ˜¯è¦åˆ é™¤çš„èŠ‚ç‚¹ï¼Œå¦‚æœæ˜¯åˆ™è°ƒç”¨åˆ é™¤èŠ‚ç‚¹ç®—æ³• val tmpNode = current.next;current.next = tmpNode.next å¾ªç¯éå†ç»“æŸï¼Œè¿”å› head èŠ‚ç‚¹ å¤æ‚åº¦åˆ†æï¼š æ—¶é—´å¤æ‚åº¦ï¼šO(N) ï¼ŒN ä¸ºé“¾è¡¨é•¿åº¦ï¼Œå‡è®¾è¦åˆ é™¤çš„èŠ‚ç‚¹åœ¨æœ«å°¾ï¼Œå³æ—¶é—´å¤æ‚åº¦ä¸º O(N) ç©ºé—´å¤æ‚åº¦ï¼šO(1)ï¼Œcurrent å ç”¨å¸¸æ•°å¤§å°çš„ç©ºé—´ï¼Œå¯ä»¥ä¸ç”¨è®¡ç®—ï¼Œå³ç©ºé—´å¤æ‚åº¦ä¸º O(1) Kotlin å®ç°class Solution { fun deleteNode(head: ListNode?, `val`: Int): ListNode? { if (head == null) return head if (head.`val` == `val`) return head.next var current = head while (current?.next != null) { val tmpNode = current.next; if (tmpNode.`val` == `val`) { current.next = tmpNode.next break; } current = tmpNode } return head }} Java å®ç°class Solution { public ListNode deleteNode(ListNode head, int val) { if (head == null) return head; if (head.val == val) return head.next; ListNode current = head; while (current.next != null) { ListNode tmp = current.next; if (tmp.val == val) { current.next = tmp.next; break; } current = tmp; } return head; }}","link":"/2020/08/06/LeetCode/offer/18-shan-chu-lian-biao-de-jie-dian/"},{"title":"å‰‘æŒ‡ Offer 17ï¼šæ‰“å°ä»1åˆ°æœ€å¤§çš„nä½æ•°","text":"é¢˜ç›®æ¥æºäº LeetCode å‰‘æŒ‡ offer ç¬¬ 17 å·é—®é¢˜ï¼š æ‰“å°ä»1åˆ°æœ€å¤§çš„nä½æ•°ã€‚é¢˜ç›®éš¾åº¦ä¸º Easyã€‚ ä¸­æ–‡åœ°å€ï¼šhttps://leetcode-cn.com/problems/da-yin-cong-1dao-zui-da-de-nwei-shu-lcof/ é¢˜ç›®æè¿°è¾“å…¥æ•°å­— nï¼ŒæŒ‰é¡ºåºæ‰“å°å‡ºä» 1 åˆ°æœ€å¤§çš„ n ä½åè¿›åˆ¶æ•°ã€‚æ¯”å¦‚è¾“å…¥ 3ï¼Œåˆ™æ‰“å°å‡º 1ã€2ã€3 ä¸€ç›´åˆ°æœ€å¤§çš„ 3 ä½æ•° 999ã€‚ ç¤ºä¾‹ 1ï¼š è¾“å…¥: n = 1è¾“å‡º: [1,2,3,4,5,6,7,8,9] è¯´æ˜ï¼š ç”¨è¿”å›ä¸€ä¸ªæ•´æ•°åˆ—è¡¨æ¥ä»£æ›¿æ‰“å° n ä¸ºæ­£æ•´æ•° æ€è·¯ä¸€ï¼šç”±äºæœ¬é¢˜è¦æ±‚è¿”å› int ç±»å‹æ•°ç»„ï¼Œç›¸å½“äºé»˜è®¤æ‰€æœ‰æ•°å­—éƒ½åœ¨ int32 æ•´å‹å–å€¼èŒƒå›´å†…ï¼Œä½†æ˜¯åœ¨å®é™…é¢è¯•è¿‡ç¨‹ä¸­ï¼Œé¢è¯•å®˜è‚¯å®šä¼šè€ƒå¤§æ•°ï¼Œä¹Ÿå°±æ„å‘³ç€ä¼šè¶Šç•Œã€‚ ç®—æ³•æµç¨‹å¦‚ä¸‹ï¼š å¦‚æœè€ƒå¤§æ•°çš„è¯ï¼Œæ— è®º int è¿˜æ˜¯ long ç±»å‹å®ƒä»¬çš„å–å€¼èŒƒå›´éƒ½æ˜¯æœ‰é™çš„ï¼Œå› æ­¤åªèƒ½ä½¿ç”¨å­—ç¬¦ä¸² String ç±»å‹ã€‚ result è¡¨ç¤ºä¸€ä¸ªæ•´æ•°åˆ—è¡¨ï¼Œnum å­˜å‚¨ç”Ÿæˆçš„å­—ç¬¦ä¸²ï¼Œx è¡¨ç¤ºå½“å‰æ‰€åœ¨ä½æ•°ï¼Œå‡è®¾ n = 2 æ—¶ï¼Œç”Ÿæˆ 1 ~ 99 çš„å…¨æ’åˆ—æµç¨‹å¦‚ä¸‹ï¼š ä»ä¸‹æ ‡ x = 0 å¼€å§‹ï¼Œå…ˆå›ºå®šåä½ä¸º 0 ~ 9 x = x + 1, å¼€å§‹é€’å½’éå†ä¸ªä½ä¸º 0 ~ 9 å½“ x == n æ—¶ï¼Œé€’å½’éå†ç»“æŸ å¤æ‚åº¦åˆ†æï¼š n è¡¨ç¤ºéœ€è¦ç”Ÿæˆæ•°å­—çš„ä½æ•° æ—¶é—´å¤æ‚åº¦ï¼šO(10^n) ï¼Œé€’å½’ç”Ÿæˆçš„æ•°å­—çš„æ’åˆ—ä¸ªæ•°ä¸º 10^n ç©ºé—´å¤æ‚åº¦ï¼šO(n)ï¼Œå­—ç¬¦ä¸² num ä½¿ç”¨çº¿æ€§æ’åˆ— Kotlin å®ç°class Solution { val defNum = charArrayOf('0', '1', '2', '3', '4', '5', '6', '7', '8', '9'); var index = 0; fun printNumbers(n: Int): IntArray { val num = CharArray(n) var max = 1 // kotlin ä¸­ä½¿ç”¨ Math.pow è¦æ±‚å‚æ•°éƒ½æ˜¯doubleç±»å‹ï¼Œæ‰€ä»¥è¿™é‡Œè‡ªåŠ¨ç”Ÿæˆå¯¹åº”çš„ä½æ•° for (i in 1..n) { max = max * 10; } val result = IntArray(max - 1) dfs(num, result, 0) // å¼€å§‹é€’å½’éå† return result; } fun dfs(num: CharArray, result: IntArray, x: Int) { if (x == num.size) { // ç”Ÿæˆçš„æ•°å­—å‰é¢å¯èƒ½æœ‰ 0 ä¾‹å¦‚ï¼š000,001,002... ç­‰ç­‰ // parstInt æ–¹æ³•åˆ é™¤é«˜ä½å¤šä½™çš„ 0 val res = parstInt(num); // è¿‡æ»¤æ‰ç¬¬ä¸€ä¸ªæ•°å­— 0 if (res &gt; 0) { result[index] = res index = index + 1 } return; } for (c in defNum) { num[x] = c dfs(num, result, x + 1) } } fun parstInt(num: CharArray): Int { var sum = 0 var isNotZero = false for (c in num) { // ç”Ÿæˆçš„æ•°å­—å‰é¢å¯èƒ½æœ‰ 0 ä¾‹å¦‚ï¼š000,001,002... ç­‰ç­‰ // è¿‡æ»¤æ‰é«˜ä½å¤šä½™çš„ 0 if (!isNotZero) { if (c == '0') { continue } else { isNotZero = true } } sum = sum * 10 + (c - '0') } return sum; }} Java å®ç°public class Solution { char[] defNum = new char[]{'0', '1', '2', '3', '4', '5', '6', '7', '8', '9'}; int index = 0; public int[] printNumbers(int n) { char[] num = new char[n]; int[] result = new int[(int) Math.pow(10, n) - 1]; dfs(num, result, 0); // å¼€å§‹é€’å½’éå† return result; } public void dfs(char[] num, int[] result, int x) { if (x == num.length) { // ç”Ÿæˆçš„æ•°å­—å‰é¢å¯èƒ½æœ‰ 0 ä¾‹å¦‚ï¼š000,001,002... ç­‰ç­‰ // parstInt æ–¹æ³•åˆ é™¤é«˜ä½å¤šä½™çš„ 0 int res = parseInt(num); // è¿‡æ»¤æ‰ç¬¬ä¸€ä¸ªæ•°å­— 0 if (res &gt; 0) { result[index++] = res; } return; } for (char c : defNum) { num[x] = c; dfs(num, result, x + 1); } } public int parseInt(char[] num) { int sum = 0; boolean isNotZero = false; for (char c : num) { // ç”Ÿæˆçš„æ•°å­—å‰é¢å¯èƒ½æœ‰ 0 ä¾‹å¦‚ï¼š000,001,002... ç­‰ç­‰ // è¿‡æ»¤æ‰é«˜ä½å¤šä½™çš„ 0 if (!isNotZero) { if (c == '0') { continue; } else { isNotZero = true; } } sum = sum * 10 + (c - '0'); } return sum; }} æ€è·¯äºŒï¼šæ€è·¯äºŒæ¯”è¾ƒç®€å•ï¼Œé¢˜ç›®è¦æ±‚è¿”å› int ç±»å‹æ•°ç»„ï¼Œç›¸å½“äºé»˜è®¤æ‰€æœ‰æ•°å­—éƒ½åœ¨ int32 æ•´å‹å–å€¼èŒƒå›´å†…ã€‚ å‡è®¾ n = 2 æ—¶ï¼Œç”Ÿæˆ 1 ~ 99ï¼Œæ•°å­—èŒƒå›´ç­‰ä»·äº [1, 100 -1] , æœ€å¤§å–å€¼ç›¸å½“äº Math.pow(10, n) - 1 ä¹Ÿå¯ä»¥å¾ªç¯ç”Ÿæˆæœ€å¤§å–å€¼ï¼Œå¦‚ä¸‹æ‰€ç¤º var max = 1;for (i in 1..n) { max = max * 10;} Kotlinclass Solution { fun printNumbers(n: Int): IntArray { var max = 1; for (i in 1..n) { max = max * 10; } val result = IntArray(max - 1) for (i in 1 until max) { result[i - 1] = i } return result; }} Javapublic class Solution { public int[] printNumbers(int n) { int max = 1; for (int i = 1; i &lt;= n; i++) { max = max * 10; } int[] result = new int[max - 1]; for (int i = 1; i &lt; max; i++) { result[i - 1] = i; } return result; }}","link":"/2020/08/05/LeetCode/offer/17-da-yin-cong-1dao-zui-da-de-nwei-sh/"},{"title":"å‰‘æŒ‡ Offer 16ï¼šæ•°å€¼çš„æ•´æ•°æ¬¡æ–¹","text":"é¢˜ç›®æ¥æºäº LeetCode å‰‘æŒ‡ offer ç¬¬ 16 å·é—®é¢˜ï¼šæ•°å€¼çš„æ•´æ•°æ¬¡æ–¹ã€‚é¢˜ç›®éš¾åº¦ä¸º Mediumã€‚å’Œç¬¬ 50 å·é—®é¢˜ ç›¸åŒ ä¸­æ–‡åœ°å€ï¼šhttps://leetcode-cn.com/problems/shu-zhi-de-zheng-shu-ci-fang-lcof/ 50 å·é—®é¢˜-è‹±æ–‡åœ°å€ï¼šhttps://leetcode.com/problems/powx-n/ 50 å·é—®é¢˜-ä¸­æ–‡åœ°å€ï¼šhttps://leetcode-cn.com/problems/powx-n/ é¢˜ç›®æè¿°å®ç°å‡½æ•°double Power(double base, int exponent)ï¼Œæ±‚baseçš„exponentæ¬¡æ–¹ã€‚ä¸å¾—ä½¿ç”¨åº“å‡½æ•°ï¼ŒåŒæ—¶ä¸éœ€è¦è€ƒè™‘å¤§æ•°é—®é¢˜ã€‚ ç¤ºä¾‹ 1ï¼š è¾“å…¥: 2.00000, 10è¾“å‡º: 1024.00000 ç¤ºä¾‹ 2ï¼š è¾“å…¥: 2.10000, 3è¾“å‡º: 9.26100 ç¤ºä¾‹ 3ï¼š è¾“å…¥: 2.00000, -2è¾“å‡º: 0.25000è§£é‡Š: 2-2 = 1/22 = 1/4 = 0.25 è¯´æ˜ï¼š -100.0 &lt; x &lt; 100.0 n æ˜¯ 32 ä½æœ‰ç¬¦å·æ•´æ•°ï¼Œå…¶æ•°å€¼èŒƒå›´æ˜¯ [âˆ’2^31, 2^31 âˆ’ 1] ã€‚ æ€è·¯ï¼šè¿™åˆ°é¢˜ç”¨åˆ°äº†ä½è¿ç®—ç¬¦ï¼Œæˆ‘ä»¬å…ˆæ¥å›é¡¾ä¸€ä¸‹ï¼š x &gt;&gt; 1 ç­‰ä»·äº (x = x / 2)x &lt;&lt; 1 ç­‰ä»·äº (x = x * 2)x &amp; 1 ç­‰ä»·äº (x % 2 == 1) ä»¥ä¸‹å›¾ç‰‡æ¥è‡ª LeetCode ç¤¾åŒº ç®—æ³•æµç¨‹å¦‚ä¸‹ï¼š x è¡¨ç¤ºæ•´æ•°ï¼Œ m è¡¨ç¤ºå¹³æ–¹ï¼Œres ç´¯è®¡ç»“æœ å½“ x == 0 æ—¶ï¼Œè¿”å› 0 ï¼Œé¿å…åç»­çš„ x = 1 / x å‡ºé”™ å½“ x &lt; 0 æ—¶ï¼Œéœ€è¦è½¬ä¸º x &gt;= 0ï¼Œåœ¨è¿™ä¸ªèŒƒå›´å†…æ±‚è§£ï¼Œå³ x = 1 / x; m *= -1 åˆå§‹åŒ– res ä¸º 1 å¾ªç¯è®¡ç®—ï¼Œå½“ m == 0 æ—¶è·³å‡ºå¾ªç¯ å½“ (m &amp; 1) == 1 æ—¶ï¼Œå³ res = res * x æ‰§è¡Œ x = x * x å°† m å³ç§» 1 ä½ï¼Œå³ m = m &gt;&gt; 1 æ³¨æ„ï¼š m å¯ä»¥å–åˆ° -2147483648ï¼ˆæ•´å‹è´Ÿæ•°çš„æœ€å°å€¼ï¼‰ï¼Œæ‰§è¡Œ m *= -1; ä¼šå› è¶Šç•Œè€Œå‡ºé”™ï¼Œæ‰€ä»¥éœ€è¦å°† m è½¬æ¢æˆ long å‹ å¤æ‚åº¦åˆ†æï¼š æ—¶é—´å¤æ‚åº¦ï¼šO(log2^n) ï¼Œ2 åˆ†æŸ¥æ‰¾æ—¶é—´å¤æ‚åº¦ä¸ºå¯¹æ•°çº§åˆ« ç©ºé—´å¤æ‚åº¦ï¼šO(1)ï¼Œéœ€è¦å‡ ä¸ªå˜é‡ï¼Œå å¸¸æ•°å¤§å°çš„ç©ºé—´ Kotlin å®ç°class Solution { fun myPow(x: Double, n: Int): Double { if (x == 0.0) return 0.0 var x1 = x var res = 1.0 var m = n.toLong() if (m &lt; 0) { x1 = 1 / x1 m = -1 * m } while (m &gt; 0) { if ((m % 2).toInt() == 1) res = res * x1 x1 = x1 * x1 m = m / 2 } return res }} Java å®ç°class Solution { // x &gt;&gt; 1 ==&gt; (x = x / 2) // x &lt;&lt; 1 ==&gt; (x = x * 2) // x &amp; 1 ==&gt; (x % 2 == 1) public double myPow(double x, int n) { if (x == 0) return 0; long m = n; double res = 1.0; if (m &lt; 0) { x = 1 / x; m *= -1; } while (m &gt; 0) { if ((m &amp; 1) == 1) res = res * x; x = x * x; m = m &gt;&gt; 1; } return res; }}","link":"/2020/07/27/LeetCode/offer/16-shu-zhi-de-zheng-shu-ci-fang/"},{"title":"å‰‘æŒ‡ Offer 15ï¼šäºŒè¿›åˆ¶ä¸­ 1 çš„ä¸ªæ•°","text":"é¢˜ç›®æ¥æºäº LeetCode å‰‘æŒ‡ offer ç¬¬ 15 å·é—®é¢˜ï¼šäºŒè¿›åˆ¶ä¸­ 1 çš„ä¸ªæ•°ã€‚é¢˜ç›®éš¾åº¦ä¸º Easyã€‚å’Œç¬¬ 191 å·é—®é¢˜ï¼ˆä½1çš„ä¸ªæ•°ï¼‰ ç›¸åŒ ä¸­æ–‡åœ°å€ï¼šhttps://leetcode-cn.com/problems/er-jin-zhi-zhong-1de-ge-shu-lcof/ 191 å·é—®é¢˜-è‹±æ–‡åœ°å€ï¼šhttps://leetcode.com/problems/number-of-1-bits/ 191 å·é—®é¢˜-ä¸­æ–‡åœ°å€ï¼šhttps://leetcode-cn.com/problems/number-of-1-bits/ é¢˜ç›®æè¿°ç¼–å†™ä¸€ä¸ªå‡½æ•°ï¼Œè¾“å…¥æ˜¯ä¸€ä¸ªæ— ç¬¦å·æ•´æ•°ï¼Œè¿”å›å…¶äºŒè¿›åˆ¶è¡¨è¾¾å¼ä¸­æ•°å­—ä½æ•°ä¸º â€˜1â€™ çš„ä¸ªæ•°ï¼ˆä¹Ÿè¢«ç§°ä¸ºæ±‰æ˜é‡é‡ï¼‰ ç¤ºä¾‹ 1ï¼š è¾“å…¥ï¼š00000000000000000000000000001011è¾“å‡ºï¼š3è§£é‡Šï¼šè¾“å…¥çš„äºŒè¿›åˆ¶ä¸² 00000000000000000000000000001011 ä¸­ï¼Œå…±æœ‰ä¸‰ä½ä¸º '1'ã€‚ ç¤ºä¾‹ 2ï¼š è¾“å…¥ï¼š00000000000000000000000010000000è¾“å‡ºï¼š1è§£é‡Šï¼šè¾“å…¥çš„äºŒè¿›åˆ¶ä¸² 00000000000000000000000010000000 ä¸­ï¼Œå…±æœ‰ä¸€ä½ä¸º '1'ã€‚ ç¤ºä¾‹ 3ï¼š è¾“å…¥ï¼š11111111111111111111111111111101è¾“å‡ºï¼š31è§£é‡Šï¼šè¾“å…¥çš„äºŒè¿›åˆ¶ä¸² 11111111111111111111111111111101 ä¸­ï¼Œå…±æœ‰ 31 ä½ä¸º '1'ã€‚ æç¤ºï¼š è¯·æ³¨æ„ï¼Œåœ¨æŸäº›è¯­è¨€ï¼ˆå¦‚ Javaï¼‰ä¸­ï¼Œæ²¡æœ‰æ— ç¬¦å·æ•´æ•°ç±»å‹ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œè¾“å…¥å’Œè¾“å‡ºéƒ½å°†è¢«æŒ‡å®šä¸ºæœ‰ç¬¦å·æ•´æ•°ç±»å‹ï¼Œå¹¶ä¸”ä¸åº”å½±å“æ‚¨çš„å®ç°ï¼Œå› ä¸ºæ— è®ºæ•´æ•°æ˜¯æœ‰ç¬¦å·çš„è¿˜æ˜¯æ— ç¬¦å·çš„ï¼Œå…¶å†…éƒ¨çš„äºŒè¿›åˆ¶è¡¨ç¤ºå½¢å¼éƒ½æ˜¯ç›¸åŒçš„ã€‚ åœ¨ Java ä¸­ï¼Œç¼–è¯‘å™¨ä½¿ç”¨äºŒè¿›åˆ¶è¡¥ç è®°æ³•æ¥è¡¨ç¤ºæœ‰ç¬¦å·æ•´æ•°ã€‚å› æ­¤ï¼Œåœ¨ä¸Šé¢çš„ ç¤ºä¾‹ 3 ä¸­ï¼Œè¾“å…¥è¡¨ç¤ºæœ‰ç¬¦å·æ•´æ•° -3ã€‚ æ€è·¯ï¼šä½è¿ç®—ï¼šæˆ‘ä»¬å…ˆæ¥å›é¡¾ä¸€ä¸‹åŸºæœ¬çš„ä½è¿ç®—è§„åˆ™ï¼š æˆ–è¿ç®—ï¼ˆ|ï¼‰ï¼š ä¸¤ä½åŒæ—¶ä¸º 0ï¼Œç»“æœä¸º 0ï¼Œå¦åˆ™ä¸º 1 0 | 0 = 0ï¼› 0 | 1 = 1ï¼› 1 | 0 = 1ï¼› 1 | 1 = 1 ä¸è¿ç®—ç¬¦ï¼ˆ&amp;ï¼‰ï¼š ä¸¤ä½åŒæ—¶ä¸º 1ï¼Œç»“æœä¸º 1ï¼Œå¦åˆ™ä¸º 0 0 &amp; 0 = 0; 0 &amp; 1 = 0; 1 &amp; 0 = 0; 1 &amp; 1 = 1; å¼‚æˆ–è¿ç®—ï¼š ä¸¤ä¸ªç›¸åº”ä½ å€¼ä¸åŒ æ—¶ï¼Œç»“æœä¸º 1ï¼Œå¦åˆ™ä¸º 0. 0 ^ 0 = 0ï¼› 0 ^ 1 = 1ï¼› 1 ^ 0 = 1ï¼› 1 ^ 1 = 0ï¼› å–åè¿ç®—ç¬¦ï¼ˆ~ï¼‰ï¼š å¯¹ä¸€ä¸ªäºŒè¿›åˆ¶æ•°æŒ‰ä½å–åï¼Œå³å°† 0 å˜ 1ï¼Œ1 å˜ 0ã€‚ ~1 = 0ï¼› ~0 = 1ï¼› å¦‚ä¸Šæ‰€ç¤ºæ ¹æ®ä½è¿ç®—è§„åˆ™ï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨ ä¸è¿ç®—ç¬¦ï¼ˆ&amp;ï¼‰ æ¥è§£ã€‚ 1 &amp; 1 = 1 1 &amp; 0 = 0 å˜é‡å£°å®šä¹‰ï¼š result ç”¨æ¥å­˜å‚¨ç´¯åŠ çš„ç»“æœ n ä¸ºæ— ç¬¦å·æ•´æ•° æˆ‘ä»¬å¯ä»¥é€ä½å¾ªç¯åˆ¤æ–­ï¼Œç®—æ³•æµç¨‹å¦‚ä¸‹ï¼š åˆå§‹åŒ– result ä¸º 0 å½“ n == 0 æ—¶å³å¾ªç¯ç»“æŸ å°† n &amp; 1 çš„ç»“æœï¼Œç´¯åŠ åˆ° result ä¸Šï¼Œæ•… result += n &amp; 1 n ä¸ºæ— ç¬¦å·æ•´æ•°ï¼Œæ‰€ä»¥å°† n æ— ç¬¦å·å³ç§»åŠ¨ 1 ä½ï¼Œæ•… n = n &gt;&gt;&gt; 1 å¤æ‚åº¦åˆ†æï¼š æ—¶é—´å¤æ‚åº¦ï¼šO(log2^n) ï¼Œå…¶ä¸­ n ä»£è¡¨æœ€é«˜ä½ 1 æ‰€åœ¨çš„ä½æ•° ç©ºé—´å¤æ‚åº¦ï¼šO(1)ï¼Œéœ€è¦ä¸€ä¸ªé¢å¤–çš„å˜é‡ result æ¥å­˜å‚¨ç´¯åŠ ç»“æœï¼Œresult å äº†ä¸€ä¸ªå¸¸æ•°å¤§å°çš„ç©ºé—´ Java å®ç°public class Solution { public int hammingWeight(int n) { int result = 0; while (n != 0) { result += n &amp; 1; n = n &gt;&gt;&gt; 1; } return result; }}","link":"/2020/07/19/LeetCode/offer/15-er-jin-zhi-zhong-1de-ge-shu-lcof/"},{"title":"å‰‘æŒ‡ Offer 14-2ï¼šå‰ªç»³å­","text":"é¢˜ç›®æ¥æºäº LeetCode å‰‘æŒ‡ offer ç¬¬ 14-2 å·é—®é¢˜ï¼šå‰ªç»³å­ã€‚é¢˜ç›®éš¾åº¦ä¸º Mediumã€‚å’Œç¬¬ 343 å·é—®é¢˜ï¼ˆæ•´æ•°æ‹†åˆ†ï¼‰ ç›¸åŒ ä¸­æ–‡åœ°å€ï¼šhttps://leetcode-cn.com/problems/jian-sheng-zi-ii-lcof/ æ•´æ•°æ‹†åˆ†-è‹±æ–‡åœ°å€ï¼šhttps://leetcode.com/problems/integer-break/ æ•´æ•°æ‹†åˆ†-ä¸­æ–‡åœ°å€ï¼šhttps://leetcode-cn.com/problems/integer-break/ é¢˜ç›®æè¿°ç»™ä½ ä¸€æ ¹é•¿åº¦ä¸º n çš„ç»³å­ï¼Œè¯·æŠŠç»³å­å‰ªæˆæ•´æ•°é•¿åº¦çš„ m æ®µï¼ˆmã€néƒ½æ˜¯æ•´æ•°ï¼Œn&gt;1å¹¶ä¸”m&gt;1ï¼‰ï¼Œæ¯æ®µç»³å­çš„é•¿åº¦è®°ä¸º k[0],k[1]...k[m-1] ã€‚è¯·é—® k[0] * k[1] * ... * k[m-1] å¯èƒ½çš„æœ€å¤§ä¹˜ç§¯æ˜¯å¤šå°‘ï¼Ÿä¾‹å¦‚ï¼Œå½“ç»³å­çš„é•¿åº¦æ˜¯8æ—¶ï¼Œæˆ‘ä»¬æŠŠå®ƒå‰ªæˆé•¿åº¦åˆ†åˆ«ä¸º2ã€3ã€3çš„ä¸‰æ®µï¼Œæ­¤æ—¶å¾—åˆ°çš„æœ€å¤§ä¹˜ç§¯æ˜¯18ã€‚ ç­”æ¡ˆéœ€è¦å–æ¨¡ 1e9+7ï¼ˆ1000000007ï¼‰ï¼Œå¦‚è®¡ç®—åˆå§‹ç»“æœä¸ºï¼š1000000008ï¼Œè¯·è¿”å› 1ã€‚ ç¤ºä¾‹ 1ï¼š è¾“å…¥: 2è¾“å‡º: 1è§£é‡Š: 2 = 1 + 1, 1 Ã— 1 = 1 ç¤ºä¾‹ 2ï¼š è¾“å…¥: 10è¾“å‡º: 36è§£é‡Š: 10 = 3 + 3 + 4, 3 Ã— 3 Ã— 4 = 36 æç¤ºï¼š 2 &lt;= n &lt;= 1000 æ€è·¯ï¼šæ³¨æ„ï¼š é¢˜ç›®è¯´äº†è¦åšå–æ¨¡è¿ç®—ï¼Œå‡¡æ˜¯è¿™ç§é¢˜ï¼Œä¸€å®šè¦æ³¨æ„ç²¾åº¦é—®é¢˜ã€‚ ä¸€ç»³å­é•¿åº¦ä¸º nï¼Œå‡è®¾è¿™æ¡ç»³å­è¢«åˆ†ä¸º 2 æ®µæˆ–è€… 3 æ®µã€‚æŒ‰ç…§ç»éªŒåˆ‡åˆ†æˆ 3 æ®µæ¯”åˆ‡åˆ†æˆ 2 æ®µçš„ä¹˜ç§¯è¦å¤§ï¼Œä½†æ˜¯ä¹Ÿæœ‰å°‘æ•°æƒ…å†µåˆ‡åˆ†æˆ 2 æ®µæ¯” 3 æ®µä¹˜ç§¯å¤§ã€‚ ä¾‹å¦‚ n = 6, 2 æ®µ 3x3 æ¯” 3 æ®µ 2 x 2 x 2 è¦å¤§ æ•…æ‰€ä»¥æˆ‘ä»¬åˆ—å‡ºæ‰€æœ‰çš„å¯èƒ½æ€§å¯»æ‰¾è§„å¾‹ï¼š ç»³å­é•¿åº¦ä¸º n è®¡ç®—æ–¹å¼ ç»“æœ 2 1 + 1 â€”â€”&gt; 1 x 1 dp[2] = 1 3 1 + 2 â€”â€”&gt; 1 x 2 dp[3] = 2 4 2 + 2 â€”â€”&gt; 2 x 2 dp[4] = 4 5 2 + 3 = 1 + 4 â€”â€”&gt; 2 + 3 &gt; 1 + 4 dp[5] = 6 6 3 + 3 = 2 + 2+ 2 â€”â€”&gt; 3 x 3 &gt; 2 x 2 x 2 dp[6] = 9 7 3 + 4 â€”â€”&gt; 3 x dp[7-3] dp[7] = 12 8 3 + 5 â€”â€”&gt; 3 x dp[8-3] dp[8] = 18 å½“ n &gt;= 7 æ—¶å¯è½¬åŒ–ä¸ºå¤šä¸ªçŸ­ç»³ï¼ˆé•¿åº¦ 1~6ï¼‰ï¼›å…¶ç»“æœæ»¡è¶³å…¬å¼ä¸º dp [n] = (dp[n - 3] * 3) % 1000000007 å¤æ‚åº¦åˆ†æï¼š æ—¶é—´å¤æ‚åº¦ï¼šO(N)ï¼Œé•¿åº¦ä¸º N çš„ç»³å­ï¼Œéœ€è¦è®¡ç®— [1,n] ç´¯è®¡çš„æœ€å¤§å€¼ï¼Œæ•…æ—¶é—´å¤æ‚åº¦ä¸º O(N) ç©ºé—´å¤æ‚åº¦ï¼šO(N)ï¼Œéœ€è¦å»ºç«‹é•¿åº¦ä¸º N çš„æ•°ç»„ï¼Œå­˜å‚¨æ¯æ¬¡è®¡ç®—çš„å€¼ï¼Œæ‰€ä»¥ç©ºé—´å¤æ‚åº¦ä¸º O(N) Koltin å®ç°class Solution { fun cuttingRope(n: Int): Int { val dp = LongArray(if (n &lt; 7) 8 else n + 1) dp[2] = 1 dp[3] = 2 dp[4] = 4 dp[5] = 6 dp[6] = 9 dp[7] = 12 for (i in 8..n) { dp[i] = (dp[i - 3] * 3) % 1000000007 } return dp[n].toInt() }} Java å®ç°class Solution { public int cuttingRope(int n) { int m = n; if (n &lt; 7) n = 7; long[] dp = new long[n + 1]; dp[2] = 1; dp[3] = 2; dp[4] = 4; dp[5] = 6; dp[6] = 9; dp[7] = 12; for (int i = 8; i &lt;= n; i++) { dp[i] = (dp[i - 3] * 3) % 1000000007; } return (int) dp[m]; }}","link":"/2020/07/18/LeetCode/offer/14-2-jian-sheng-zi-ii-lcof/"},{"title":"å‰‘æŒ‡ Offer 14-1ï¼šå‰ªç»³å­","text":"é¢˜ç›®æ¥æºäº LeetCode å‰‘æŒ‡ offer ç¬¬ 14-1 å·é—®é¢˜ï¼šå‰ªç»³å­ã€‚é¢˜ç›®éš¾åº¦ä¸º Mediumã€‚ ä¸­æ–‡åœ°å€ï¼šhttps://leetcode-cn.com/problems/jian-sheng-zi-lcof é¢˜ç›®æè¿°ç»™ä½ ä¸€æ ¹é•¿åº¦ä¸º n çš„ç»³å­ï¼Œè¯·æŠŠç»³å­å‰ªæˆæ•´æ•°é•¿åº¦çš„ m æ®µï¼ˆmã€néƒ½æ˜¯æ•´æ•°ï¼Œn&gt;1å¹¶ä¸”m&gt;1ï¼‰ï¼Œæ¯æ®µç»³å­çš„é•¿åº¦è®°ä¸º k[0],k[1]â€¦k[m-1] ã€‚è¯·é—® k[0] * k[1] * â€¦ * k[m-1] å¯èƒ½çš„æœ€å¤§ä¹˜ç§¯æ˜¯å¤šå°‘ï¼Ÿä¾‹å¦‚ï¼Œå½“ç»³å­çš„é•¿åº¦æ˜¯8æ—¶ï¼Œæˆ‘ä»¬æŠŠå®ƒå‰ªæˆé•¿åº¦åˆ†åˆ«ä¸º2ã€3ã€3çš„ä¸‰æ®µï¼Œæ­¤æ—¶å¾—åˆ°çš„æœ€å¤§ä¹˜ç§¯æ˜¯18ã€‚ ç¤ºä¾‹ 1ï¼š è¾“å…¥: 2è¾“å‡º: 1è§£é‡Š: 2 = 1 + 1, 1 Ã— 1 = 1 ç¤ºä¾‹ 2ï¼š è¾“å…¥: 10è¾“å‡º: 36è§£é‡Š: 10 = 3 + 3 + 4, 3 Ã— 3 Ã— 4 = 36 æç¤ºï¼š 2 &lt;= n &lt;= 58 æ€è·¯ï¼šä¸€ç»³å­é•¿åº¦ä¸º nï¼Œå‡è®¾è¿™æ¡ç»³å­è¢«åˆ†ä¸º 2 æ®µæˆ–è€… 3 æ®µã€‚æŒ‰ç…§ç»éªŒåˆ‡åˆ†æˆ 3 æ®µæ¯”åˆ‡åˆ†æˆ 2 æ®µçš„ä¹˜ç§¯è¦å¤§ï¼Œä½†æ˜¯ä¹Ÿæœ‰å°‘æ•°æƒ…å†µåˆ‡åˆ†æˆ 2 æ®µæ¯” 3 æ®µä¹˜ç§¯å¤§ã€‚ ä¾‹å¦‚ n = 6, 2 æ®µ 3x3 æ¯” 3 æ®µ 2 x 2 x 2 è¦å¤§ æ•…æ‰€ä»¥æˆ‘ä»¬åˆ—å‡ºæ‰€æœ‰çš„å¯èƒ½æ€§å¯»æ‰¾è§„å¾‹ï¼š ç»³å­é•¿åº¦ä¸º n è®¡ç®—æ–¹å¼ ç»“æœ 2 1 + 1 â€”â€”&gt; 1 x 1 dp[2] = 1 3 1 + 2 â€”â€”&gt; 1 x 2 dp[3] = 2 4 2 + 2 â€”â€”&gt; 2 x 2 dp[4] = 4 5 2 + 3 = 1 + 4 â€”â€”&gt; 2 + 3 &gt; 1 + 4 dp[5] = 6 6 3 + 3 = 2 + 2+ 2 â€”â€”&gt; 3 x 3 &gt; 2 x 2 x 2 dp[6] = 9 7 3 + 4 â€”â€”&gt; 3 x dp[7-3] dp[7] = 12 8 3 + 5 â€”â€”&gt; 3 x dp[8-3] dp[8] = 18 å½“ n &gt;= 7 ï¼›å…¶ç»“æœæ»¡è¶³å…¬å¼ä¸º dp [n] = 3 * dp[n - 3] å¤æ‚åº¦åˆ†æï¼š æ—¶é—´å¤æ‚åº¦ï¼šO(N)ï¼Œé•¿åº¦ä¸º N çš„ç»³å­ï¼Œéœ€è¦è®¡ç®— [1,n] ç´¯è®¡çš„æœ€å¤§å€¼ï¼Œæ•…æ—¶é—´å¤æ‚åº¦ä¸º O(N) ç©ºé—´å¤æ‚åº¦ï¼šO(N)ï¼Œéœ€è¦å»ºç«‹é•¿åº¦ä¸º N çš„æ•°ç»„ï¼Œå­˜å‚¨æ¯æ¬¡è®¡ç®—çš„å€¼ï¼Œæ‰€ä»¥ç©ºé—´å¤æ‚åº¦ä¸º O(N) Koltin å®ç°class Solution { fun cuttingRope(n: Int): Int { val dp = IntArray(if (n &lt; 7) 8 else n + 1) dp[1] = 1 dp[2] = 1 dp[3] = 2 dp[4] = 4 dp[5] = 6 dp[6] = 9 dp[7] = 12 for (i in 8..n) { dp[i] = 3 * dp[i - 3] } return dp[n] }} Java å®ç°public class Solution { public int cuttingRope(int n) { int m = n; if (n &lt; 7) { n = 7; } int[] dp = new int[n + 1]; dp[1] = 1; dp[2] = 1; dp[3] = 2; dp[4] = 4; dp[5] = 6; dp[6] = 9; dp[7] = 12; for (int i = 8; i &lt;= n; i++) { dp[i] = 3 * dp[i - 3]; } return dp[m]; }}","link":"/2020/07/06/LeetCode/offer/14-1-jian-sheng-zi/"},{"title":"å‰‘æŒ‡ Offer 13ï¼šæœºå™¨äººçš„è¿åŠ¨èŒƒå›´","text":"é¢˜ç›®æ¥æºäº LeetCode å‰‘æŒ‡ offer ç¬¬ 13 å·é—®é¢˜ï¼šæœºå™¨äººçš„è¿åŠ¨èŒƒå›´ã€‚é¢˜ç›®éš¾åº¦ä¸º Mediumã€‚ ä¸­æ–‡åœ°å€ï¼šhttps://leetcode-cn.com/problems/ji-qi-ren-de-yun-dong-fan-wei-lcof/ é¢˜ç›®æè¿°åœ°ä¸Šæœ‰ä¸€ä¸ªmè¡Œnåˆ—çš„æ–¹æ ¼ï¼Œä»åæ ‡ [0,0] åˆ°åæ ‡ [m-1,n-1] ã€‚ä¸€ä¸ªæœºå™¨äººä»åæ ‡ [0, 0] çš„æ ¼å­å¼€å§‹ç§»åŠ¨ï¼Œå®ƒæ¯æ¬¡å¯ä»¥å‘å·¦ã€å³ã€ä¸Šã€ä¸‹ç§»åŠ¨ä¸€æ ¼ï¼ˆä¸èƒ½ç§»åŠ¨åˆ°æ–¹æ ¼å¤–ï¼‰ï¼Œä¹Ÿä¸èƒ½è¿›å…¥è¡Œåæ ‡å’Œåˆ—åæ ‡çš„æ•°ä½ä¹‹å’Œå¤§äºkçš„æ ¼å­ã€‚ä¾‹å¦‚ï¼Œå½“kä¸º18æ—¶ï¼Œæœºå™¨äººèƒ½å¤Ÿè¿›å…¥æ–¹æ ¼ [35, 37] ï¼Œå› ä¸º3+5+3+7=18ã€‚ä½†å®ƒä¸èƒ½è¿›å…¥æ–¹æ ¼ [35, 38]ï¼Œå› ä¸º3+5+3+8=19ã€‚è¯·é—®è¯¥æœºå™¨äººèƒ½å¤Ÿåˆ°è¾¾å¤šå°‘ä¸ªæ ¼å­ï¼Ÿ ç¤ºä¾‹ 1ï¼š è¾“å…¥ï¼šm = 2, n = 3, k = 1è¾“å‡ºï¼š3 ç¤ºä¾‹ 2ï¼š è¾“å…¥ï¼šm = 3, n = 1, k = 0è¾“å‡ºï¼š1 æç¤ºï¼š 1 &lt;= n,m &lt;= 100 0 &lt;= k &lt;= 20 æ€è·¯ä¸€ï¼šBFS å¹¿åº¦ä¼˜å…ˆæœç´¢ï¼ˆé˜Ÿåˆ—ï¼‰BFS: é€šå¸¸åˆ©ç”¨é˜Ÿåˆ—å®ç°å¹¿åº¦ä¼˜å…ˆéå†ã€‚ å‚æ•°è¯´æ˜ï¼š queue è¡¨ç¤ºä¸€ä¸ªé˜Ÿåˆ—ï¼Œå­˜å‚¨è®¿é—®è¿‡çš„å•å…ƒæ ¼ï¼Œrobot è¡¨ç¤ºä¸€ä¸ªäºŒç»´æ•°ç»„è®°å½•è®¿é—®è¿‡çš„å•å…ƒæ ¼ï¼Œç”¨ x è¡¨ç¤ºè¡Œçš„ä¸‹æ ‡ï¼Œy è¡¨ç¤ºåˆ—çš„ä¸‹æ ‡ã€‚ è¿‡æ»¤æ¡ä»¶ï¼š æ˜¯å¦åœ¨å•å…ƒæ ¼å†…ï¼ˆx&gt;m-1 æˆ–è€… y&gt;n-1ï¼‰ã€‚ æ˜¯å¦å·²ç»è®¿é—®è¿‡äº†ã€‚ æ•°ä½ä¹‹å’Œæ˜¯å¦è¶…è¿‡äº† kã€‚ ç®—æ³•è¿‡ç¨‹ï¼š æŒ‰ç…§é¢˜ç›®æ‰€è¯´ï¼Œæœºå™¨äººä» [0, 0] å¼€å§‹ç§»åŠ¨ï¼Œæ¯æ¬¡ç§»åŠ¨ä¸€æ ¼ï¼Œè¡¨ç¤º [0, 0] æ˜¯åŸå§‹åæ ‡ï¼Œå®ƒåªä¼šå‘å³æˆ–è€…å‘ä¸‹ç§»åŠ¨ã€‚ åˆå§‹åŒ–: å°†èµ·ç‚¹åæ ‡ [0, 0] æ”¾è¿› queue ä¸­ã€‚ å¾ªç¯éå†ï¼š å…ˆä½¿ç”¨ è¿‡æ»¤æ¡ä»¶ï¼š è¿‡æ»¤æ‰æ— ç”¨çš„åæ ‡ã€‚ æ•°ç»„ robot è®°å½•æœºå™¨äººè®¿é—®è¿‡çš„å•å…ƒæ ¼ï¼Œå¦‚æœè®¿é—®è¿‡å°†å•å…ƒæ ¼æ ‡è®°ä¸º -1ã€‚ æœç€å³ã€ä¸‹ä¸¤ä¸ªæ–¹å‘è®¿é—®ï¼Œå¹¶å°†å…¶åæ ‡æ·»åŠ è¿› queueã€‚ å¹¶ç”¨ä¸€ä¸ªè¾…åŠ©å˜é‡ res è®¡ç®—æœºå™¨äººå¯åˆ°è¾¾çš„å•å…ƒæ ¼ã€‚ å¤æ‚åº¦åˆ†æï¼š M,N åˆ†åˆ«ä¸ºçŸ©é˜µè¡Œåˆ—å¤§å°ã€‚ æ—¶é—´å¤æ‚åº¦ï¼šO(MN)ï¼ŒçŸ©é˜µä¸­æœ‰ M è¡Œ N åˆ—ï¼Œæœ€å·®çš„æƒ…å†µä¸‹éå†å®Œæ‰€æœ‰çš„å•å…ƒæ ¼ï¼Œæ‰€ä»¥æ—¶é—´å¤æ‚åº¦ä¸º O(MN)ã€‚ ç©ºé—´å¤æ‚åº¦ï¼šO(MN)ï¼Œéœ€è¦å»ºç«‹é¢å¤–çš„æ•°ç»„è®°å½•å½“å‰æ ¼å­æ˜¯å¦å·²ç»è®¿é—®è¿‡äº†ï¼Œæœ€å·®çš„æƒ…å†µä¸‹è®¿é—®äº†æ‰€æœ‰çš„å•å…ƒæ ¼ï¼Œæ•…å ç”¨é¢å¤–ç©ºé—´ O(MN) æ³¨æ„ï¼š æ¯ç§ Queue æ–¹æ³•å­˜åœ¨ä¸¤ç§å½¢å¼ï¼š å¦‚æœæ“ä½œå¤±è´¥ï¼ŒæŠ›å‡ºäº†ä¸€ä¸ªå¼‚å¸¸ å…¶ä»–çš„è¿”å›ä¸€ä¸ªç‰¹æ®Šå€¼ï¼ˆnull æˆ–è€… falseï¼Œå–å†³äºæ“ä½œï¼‰ æ“ä½œç±»å‹ æŠ›å‡ºå¼‚å¸¸ è¿”å›ç‰¹æ®Šå€¼ æ’å…¥ add(e) offer(e) ç§»é™¤ remove() poll() æŸ¥æ‰¾ element() peek() Queue çš„å®ç°å¯ä»¥é™åˆ¶æ‰€æŒæœ‰å…ƒç´ çš„æ•°é‡ï¼Œè¿™æ ·çš„é˜Ÿåˆ—ç§°ä¸ºæœ‰ç•Œï¼Œæœ‰äº› Queue å®ç° java.util.concurrent æ˜¯æœ‰ç•Œçš„ï¼Œä½†å®ç° java.util ä¸æ˜¯ï¼š add ï¼šç»§æ‰¿è‡ª Collectionï¼Œæ’å…¥ä¸€ä¸ªå…ƒç´ ï¼Œé™¤éå®ƒä¼šè¿åé˜Ÿåˆ—çš„å®¹é‡é™åˆ¶ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹æŠ›å‡º IllegalStateException offer ï¼šæ–¹æ³•ä»…ç”¨äºæœ‰ç•Œé˜Ÿåˆ—ï¼Œä¸èƒ½æ’å…¥æ—¶ï¼Œè¿”å› fasle åœ¨ remove ä¸ poll æ–¹æ³•éƒ½æ˜¯ä»é˜Ÿåˆ—ä¸­åˆ é™¤ç¬¬ä¸€ä¸ªå…ƒç´ ï¼Œå¦‚æœé˜Ÿåˆ—ä¸ºç©ºï¼š remove : removethrows NoSuchElementException poll : è¿”å› null element ä¸ peek æ–¹æ³•ç”¨äºåœ¨é˜Ÿåˆ—çš„å¤´éƒ¨æŸ¥è¯¢å…ƒç´ ï¼Œå¦‚æœé˜Ÿåˆ—ä¸ºç©ºï¼š element : æŠ›å‡º NoSuchElementException peek : è¿”å› null Koltin å®ç°class Solution { fun movingCount(m: Int, n: Int, k: Int): Int { val robot = Array(m, { IntArray(n) }) val queue = LinkedList&lt;IntArray&gt;() var res = 0 queue.offer(intArrayOf(0,0)) while(!queue.isEmpty()){ val(x,y) = queue.poll() if(x&gt;m-1 || y&gt;n-1 || robot[x][y] == -1 || count(x) + count(y) &gt; k){ continue; } robot[x][y] = -1 res +=1 queue.offer(intArrayOf(x+1,y)) queue.offer(intArrayOf(x,y+1)) } return res } fun count(x: Int): Int { var sx = x var count = 0 while (sx &gt; 0) { count += sx % 10 sx = sx / 10 } return count }} Java å®ç°class Solution { public int bfs(int m, int n, int k) { int[][] robot = new int[m][n]; int res = 0; Queue&lt;int[]&gt; queue = new LinkedList&lt;&gt;(); queue.offer(new int[]{0, 0}); while (!queue.isEmpty()) { int[] item = queue.poll(); int x = item[0]; int y = item[1]; if (x &gt; m - 1 || y &gt; n - 1 || count(x) + count(y) &gt; k || robot[x][y] == -1) { continue; } robot[x][y] = -1; res++; queue.offer(new int[]{x + 1, y}); queue.offer(new int[]{x, y + 1}); } return res; } int count(int x) { int count = 0; while (x &gt; 0) { count += x % 10; x = x / 10; } return count; }} æ€è·¯äºŒï¼šDFS æ·±åº¦ä¼˜å…ˆæœç´¢(é€’å½’)DFS: æ·±åº¦ä¼˜å…ˆæœç´¢ç®—æ³•ï¼ˆDepth-First-Searchï¼‰ï¼Œæ˜¯æœç´¢ç®—æ³•çš„ä¸€ç§, å®ƒæ²¿ç€æ ‘çš„æ·±åº¦éå†æ ‘çš„èŠ‚ç‚¹ï¼Œå°½å¯èƒ½æ·±çš„æœç´¢æ ‘çš„åˆ†æ”¯ã€‚ é€’å½’çš„ä¸¤ä¸ªç‰¹ç‚¹ï¼š é—®é¢˜å’Œå­é—®é¢˜éƒ½ä¼šè°ƒç”¨å‡½æ•°è‡ªèº«ï¼Œæ‰€ä»¥è¦æ‰¾å¯»é—®é¢˜ä¸å­é—®é¢˜çš„é€’å½’å…³ç³»ï¼Œé‡‡ç”¨è‡ªä¸Šè€Œä¸‹çš„æ€è€ƒæ–¹å¼ã€‚ æœ‰ä¸ªç»ˆæ­¢æ¡ä»¶ï¼ˆä¸´ç•Œç‚¹ï¼‰ç»“æŸå½“å‰é€’å½’ã€‚ å‚æ•°è¯´æ˜ï¼š robot è¡¨ç¤ºä¸€ä¸ªäºŒç»´æ•°ç»„è®°å½•è®¿é—®è¿‡çš„å•å…ƒæ ¼ï¼Œç”¨ x è¡¨ç¤ºè¡Œçš„ä¸‹æ ‡ï¼Œy è¡¨ç¤ºåˆ—çš„ä¸‹æ ‡ã€‚ ç»ˆæ­¢æ¡ä»¶ï¼š æ˜¯å¦åœ¨å•å…ƒæ ¼å†…ï¼ˆx&gt;m-1 æˆ–è€… y&gt;n-1ï¼‰ã€‚ æ˜¯å¦å·²ç»è®¿é—®è¿‡äº†ã€‚ æ•°ä½ä¹‹å’Œæ˜¯å¦è¶…è¿‡äº† kã€‚ ç®—æ³•è¿‡ç¨‹ï¼š æŒ‰ç…§é¢˜ç›®æ‰€è¯´ï¼Œæœºå™¨äººä» [0, 0] å¼€å§‹ç§»åŠ¨ï¼Œæ¯æ¬¡ç§»åŠ¨ä¸€æ ¼ï¼Œè¡¨ç¤º [0, 0] æ˜¯åŸå§‹åæ ‡ï¼Œå®ƒåªä¼šå‘å³æˆ–è€…å‘ä¸‹ç§»åŠ¨ã€‚ æ•°ç»„ robot è®°å½•æœºå™¨äººè®¿é—®è¿‡çš„å•å…ƒæ ¼ï¼Œå¦‚æœè®¿é—®è¿‡å°†å•å…ƒæ ¼æ ‡è®°ä¸º -1ã€‚ æœç€å³ã€ä¸‹ä¸¤ä¸ªæ–¹å‘è®¿é—®ï¼Œæœªè®¿é—®è¿‡å¹¶ä¸”åœ¨å•å…ƒæ ¼èŒƒå›´å†…ï¼Œè®¡ç®—å®ƒä»¬ä¹‹å’Œã€‚ å¤æ‚åº¦åˆ†æï¼š M,N åˆ†åˆ«ä¸ºçŸ©é˜µè¡Œåˆ—å¤§å°ã€‚ æ—¶é—´å¤æ‚åº¦ï¼šO(MN)ï¼ŒçŸ©é˜µä¸­æœ‰ M è¡Œ N åˆ—ï¼Œæœ€å·®çš„æƒ…å†µä¸‹éå†å®Œæ‰€æœ‰çš„å•å…ƒæ ¼ï¼Œæ‰€ä»¥æ—¶é—´å¤æ‚åº¦ä¸º O(MN)ã€‚ ç©ºé—´å¤æ‚åº¦ï¼šO(MN)ï¼Œéœ€è¦å»ºç«‹é¢å¤–çš„æ•°ç»„è®°å½•å½“å‰å•å…ƒæ ¼æ˜¯å¦å·²ç»è®¿é—®è¿‡äº†ï¼Œæœ€å·®çš„æƒ…å†µä¸‹è®¿é—®äº†æ‰€æœ‰çš„å•å…ƒæ ¼ï¼Œæ•…å ç”¨é¢å¤–ç©ºé—´ O(MN) Koltin å®ç°class Solution { fun movingCount(m: Int, n: Int, k: Int): Int { val robot = Array(m, { IntArray(n) }) return dfs(robot, 0, 0, m, n, k) } fun dfs(robot: Array&lt;IntArray&gt;, x: Int, y: Int, m: Int, n: Int, k: Int): Int { if (x &gt; m - 1 || y &gt; n - 1 || robot[x][y] == -1 || count(x) + count(y) &gt; k) { return 0 } robot[x][y] = -1 // èµ·ç‚¹ä¸º0ï¼Œ0ï¼Œæ¯æ¬¡åªèƒ½ç§»åŠ¨ä¸€æ ¼ï¼Œå³å‘å³ x +1 æˆ–è€…å‘ä¸‹ y +1 return dfs(robot, x + 1, y, m, n, k) + dfs(robot, x, y + 1, m, n, k) + 1 } fun count(x: Int): Int { var sx = x var count = 0 while (sx &gt; 0) { count += sx % 10 sx = sx / 10 } return count }} Java å®ç°class Solution { public int movingCount(int m, int n, int k) { int[][] robot = new int[m][n]; return dfs(robot, 0, 0, k, m, n); } int dfs(int[][] robot, int x, int y, int k, int m, int n) { if (x &gt; m - 1 || y &gt; n - 1 || robot[x][y] == -1 || count(x) + count(y) &gt; k) { return 0; } robot[x][y] = -1; // èµ·ç‚¹ä¸º0ï¼Œ0ï¼Œæ¯æ¬¡åªèƒ½ç§»åŠ¨ä¸€æ ¼ï¼Œå³å‘å³ x +1 æˆ–è€…å‘ä¸‹ y +1 return dfs(robot, x + 1, y, k, m, n) + dfs(robot, x, y + 1, k, m, n) + 1; } int count(int x) { int count = 0; while (x &gt; 0) { count += x % 10; x = x / 10; } return count; }}","link":"/2020/06/27/LeetCode/offer/13-ji-qi-ren-de-yun-dong-fan-wei/"},{"title":"å‰‘æŒ‡ Offer 12ï¼šçŸ©é˜µä¸­çš„è·¯å¾„","text":"é¢˜ç›®æ¥æºäº LeetCode å‰‘æŒ‡ offer ç¬¬ 12 å·é—®é¢˜ï¼šçŸ©é˜µä¸­çš„è·¯å¾„ã€‚é¢˜ç›®éš¾åº¦ä¸º Mediumã€‚å’Œ ç¬¬79å·é—®é¢˜ï¼šå•è¯æœç´¢ ä¸€æ · ä¸­æ–‡åœ°å€ï¼šhttps://leetcode-cn.com/problems/ju-zhen-zhong-de-lu-jing-lcof/ é¢˜ç›®æè¿°è¯·è®¾è®¡ä¸€ä¸ªå‡½æ•°ï¼Œç”¨æ¥åˆ¤æ–­åœ¨ä¸€ä¸ªçŸ©é˜µä¸­æ˜¯å¦å­˜åœ¨ä¸€æ¡åŒ…å«æŸå­—ç¬¦ä¸²æ‰€æœ‰å­—ç¬¦çš„è·¯å¾„ã€‚è·¯å¾„å¯ä»¥ä»çŸ©é˜µä¸­çš„ä»»æ„ä¸€æ ¼å¼€å§‹ï¼Œæ¯ä¸€æ­¥å¯ä»¥åœ¨çŸ©é˜µä¸­å‘å·¦ã€å³ã€ä¸Šã€ä¸‹ç§»åŠ¨ä¸€æ ¼ã€‚å¦‚æœä¸€æ¡è·¯å¾„ç»è¿‡äº†çŸ©é˜µçš„æŸä¸€æ ¼ï¼Œé‚£ä¹ˆè¯¥è·¯å¾„ä¸èƒ½å†æ¬¡è¿›å…¥è¯¥æ ¼å­ã€‚ä¾‹å¦‚ï¼Œåœ¨ä¸‹é¢çš„ 3Ã—4 çš„çŸ©é˜µä¸­åŒ…å«ä¸€æ¡å­—ç¬¦ä¸² â€œbfceâ€ çš„è·¯å¾„ï¼ˆè·¯å¾„ä¸­çš„å­—æ¯ç”¨åŠ ç²—æ ‡å‡ºï¼‰ã€‚ [[&quot;a&quot;,&quot;b&quot;,&quot;c&quot;,&quot;e&quot;],[&quot;s&quot;,&quot;f&quot;,&quot;c&quot;,&quot;s&quot;],[&quot;a&quot;,&quot;d&quot;,&quot;e&quot;,&quot;e&quot;]] ä½†çŸ©é˜µä¸­ä¸åŒ…å«å­—ç¬¦ä¸² â€œabfbâ€ çš„è·¯å¾„ï¼Œå› ä¸ºå­—ç¬¦ä¸²çš„ç¬¬ä¸€ä¸ªå­—ç¬¦ b å æ®äº†çŸ©é˜µä¸­çš„ç¬¬ä¸€è¡Œç¬¬äºŒä¸ªæ ¼å­ä¹‹åï¼Œè·¯å¾„ä¸èƒ½å†æ¬¡è¿›å…¥è¿™ä¸ªæ ¼å­ã€‚ ç¤ºä¾‹1: è¾“å…¥ï¼šboard = [[&quot;A&quot;,&quot;B&quot;,&quot;C&quot;,&quot;E&quot;],[&quot;S&quot;,&quot;F&quot;,&quot;C&quot;,&quot;S&quot;],[&quot;A&quot;,&quot;D&quot;,&quot;E&quot;,&quot;E&quot;]], word = &quot;ABCCED&quot;è¾“å‡ºï¼štrue ç¤ºä¾‹2: è¾“å…¥ï¼šboard = [[&quot;a&quot;,&quot;b&quot;],[&quot;c&quot;,&quot;d&quot;]], word = &quot;abcd&quot;è¾“å‡ºï¼šfalse æç¤ºï¼š 1 &lt;= board.length &lt;= 2001 &lt;= board[i].length &lt;= 200 æ€è·¯ï¼šDFS æ·±åº¦ä¼˜å…ˆéå†(é€’å½’)DFS: æ·±åº¦ä¼˜å…ˆæœç´¢ç®—æ³•ï¼ˆDepth-First-Searchï¼‰ï¼Œæ˜¯æœç´¢ç®—æ³•çš„ä¸€ç§, å®ƒæ²¿ç€æ ‘çš„æ·±åº¦éå†æ ‘çš„èŠ‚ç‚¹ï¼Œå°½å¯èƒ½æ·±çš„æœç´¢æ ‘çš„åˆ†æ”¯ã€‚ é€’å½’çš„ä¸¤ä¸ªç‰¹ç‚¹ï¼š é—®é¢˜å’Œå­é—®é¢˜éƒ½ä¼šè°ƒç”¨å‡½æ•°è‡ªèº«ï¼Œæ‰€ä»¥è¦æ‰¾å¯»é—®é¢˜ä¸å­é—®é¢˜çš„é€’å½’å…³ç³»ï¼Œé‡‡ç”¨è‡ªä¸Šè€Œä¸‹çš„æ€è€ƒæ–¹å¼ã€‚ æœ‰ä¸ªç»ˆæ­¢æ¡ä»¶ï¼ˆä¸´ç•Œç‚¹ï¼‰ç»“æŸå½“å‰é€’å½’ã€‚ å‚æ•°è¯´æ˜ï¼š board æ˜¯ä¸€ä¸ªäºŒç»´æ•°ç»„ï¼Œæ‰€ä»¥ç”¨ i è¡¨ç¤ºè¡Œçš„ä¸‹æ ‡ï¼Œj è¡¨ç¤ºåˆ—çš„ä¸‹æ ‡ï¼Œword æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²è½¬ä¸ºæ•°ç»„ç”¨ words è¡¨ç¤ºï¼Œk è¡¨ç¤ºæ•°ç»„ words çš„ä¸‹æ ‡ã€‚ ç®—æ³•è¿‡ç¨‹ï¼š æŒ‰ç…§é¢˜ç›®æ‰€è¯´ï¼Œæœç´¢è¿‡ç¨‹ä¸­å¯ä»¥æœç€ä¸Šã€ä¸‹ã€å·¦ã€å³å››ä¸ªæ–¹å‘å»éå†ã€‚ æ¯ä¸ªæ–¹å‘å¦‚æœè®¿é—®è¿‡äº†ï¼Œå°†å½“å‰è®¿é—®è¿‡çš„å…ƒç´ å­˜ä¸ºä¸€ä¸ªä¸´æ—¶å˜é‡ tmpï¼Œå¹¶å°†è®¿é—®è¿‡çš„å…ƒç´ ä¿®æ”¹ä¸º '/'ï¼Œè¡¨ç¤ºå·²ç»è®¿é—®è¿‡äº†ä¸åœ¨é‡å¤è®¿é—®ã€‚ å¦‚æœåŒ¹é…å¤±è´¥äº†ï¼Œè¿˜åŸæ•°ç»„ä¸­ä¿®æ”¹è¿‡åçš„å…ƒç´ ï¼Œä»å¦å¤–ä¸€ä¸ªæ–¹å‘ç»§ç»­è®¿é—®ã€‚ å¦‚æœåŒ¹é…æˆåŠŸäº†ï¼Œä¹Ÿéœ€è¦è¿˜åŸæ•°ç»„ä¸­ä¿®æ”¹è¿‡åçš„å…ƒç´ ï¼Œå›æº¯è¿‡ç¨‹ä¸­ï¼Œå†æ¬¡éªŒè¯æ˜¯å¦æ­£ç¡®ã€‚ å¤æ‚åº¦åˆ†æï¼š M,N åˆ†åˆ«ä¸ºçŸ©é˜µè¡Œåˆ—å¤§å°ï¼ŒK ä¸ºå­—ç¬¦ä¸² word é•¿åº¦ã€‚ æ—¶é—´å¤æ‚åº¦ï¼šO(3^k MN)ï¼Œå› ä¸ºçŸ©é˜µä¸­æœ‰ M è¡Œ N åˆ—ï¼Œæ‰€ä»¥æ—¶é—´å¤æ‚åº¦ä¸º O(MN)ï¼Œæœç´¢è¿‡ç¨‹ä¸­å¯ä»¥æœç€ä¸Šã€ä¸‹ã€å·¦ã€å³å››ä¸ªæ–¹å‘å»éå†ï¼Œèˆå¼ƒå›æº¯é‚£ä¸ªæ–¹å‘ï¼Œå®é™…ä¸Šåªæœç€ä¸‰ä¸ªæ–¹å‘å»éå†ï¼Œæ‰€ä»¥æ—¶é—´å¤æ‚åº¦ä¸º O(3^k)ã€‚ ç©ºé—´å¤æ‚åº¦ï¼šO(K)ï¼Œé€’å½’è°ƒç”¨å ç”¨æ ˆçš„ç©ºé—´ï¼Œé€’å½’è°ƒç”¨ç»“æŸåï¼Œæ ˆç©ºé—´ä¼šè¢«é‡Šæ”¾ï¼Œåªæ˜¯ä½¿ç”¨äº†å‡ ä¸ªæ ‡ç¤ºå˜é‡ä½œä¸ºé¢å¤–ç©ºé—´ï¼Œè¿™éƒ¨åˆ†å¯ä»¥å¿½ç•¥ä¸è®¡ï¼Œæ¯æ¬¡æœç´¢ä¸­æ·±åº¦ä¸ä¼šè¶…è¿‡ Kï¼Œå› ä¸ºå ç”¨æ ˆçš„ç©ºé—´å¤§å°ä¸ä¼šè¶…è¿‡ O(K)ã€‚ Koltin å®ç°class Solution { fun exist(board: Array&lt;CharArray&gt;, word: String): Boolean { if (board.size &lt;= 0 || board[0].size &lt;= 0) { return false } val row = board.size val colum = board[0].size val words = word.toCharArray() for (i in 0 until row) { for (j in 0 until colum) { if (dfs(board, words, i, j, 0, row, colum)) { return true } } } return false } fun dfs(board: Array&lt;CharArray&gt;, words: CharArray, i: Int, j: Int, k: Int, row: Int, colum: Int): Boolean { if (i &gt; row - 1 || i &lt; 0 || j &gt; colum - 1 || j &lt; 0 || board[i][j] != words[k]) { return false } if (k == words.size - 1) { return true } val tmp = board[i][j] board[i][j] = '/' val result = dfs(board, words, i + 1, j, k + 1, row, colum) || dfs(board, words, i - 1, j, k + 1, row, colum) || dfs(board, words, i, j + 1, k + 1, row, colum) || dfs(board, words, i, j - 1, k + 1, row, colum) board[i][j] = tmp return result }} Java å®ç°class Solution { public boolean exist(char[][] board, String word) { if (board.length &lt;= 0 || board[0].length &lt;= 0) { return false; } char[] words = word.toCharArray(); int row = board.length; int colum = board[0].length; for (int i = 0; i &lt; row; i++) { for (int j = 0; j &lt; colum; j++) { if (dfs(board, words, i, j, 0, row, colum)) { return true; } } } return false; } boolean dfs(char[][] borad, char[] words, int i, int j, int k, int row, int colum) { if (i &gt; row - 1 || i &lt; 0 || j &gt; colum - 1 || j &lt; 0 || borad[i][j] != words[k]) { return false; } if (k == words.length - 1) { return true; } char tmp = borad[i][j]; borad[i][j] = '/'; boolean result = dfs(borad, words, i + 1, j, k + 1, row, colum) || dfs(borad, words, i - 1, j, k + 1, row, colum) || dfs(borad, words, i, j + 1, k + 1, row, colum) || dfs(borad, words, i, j - 1, k + 1, row, colum); borad[i][j] = tmp; return result; }}","link":"/2020/06/27/LeetCode/offer/12-ju-zhen-zhong-de-lu-jing/"},{"title":"å‰‘æŒ‡ offer 11ï¼šæ—‹è½¬æ•°ç»„çš„æœ€å°æ•°å­—","text":"é¢˜ç›®æ¥æºäº LeetCode å‰‘æŒ‡ offer ç¬¬ 11 å·é—®é¢˜ï¼šæ—‹è½¬æ•°ç»„çš„æœ€å°æ•°å­—ã€‚é¢˜ç›®éš¾åº¦ä¸º Easyã€‚å’Œ ç¬¬154å·é—®é¢˜ï¼šå¯»æ‰¾æ—‹è½¬æ’åºæ•°ç»„ä¸­çš„æœ€å°å€¼ II ä¸€æ · ä¸­æ–‡åœ°å€ï¼šhttps://leetcode-cn.com/problems/xuan-zhuan-shu-zu-de-zui-xiao-shu-zi-lcof/ é¢˜ç›®æè¿°æŠŠä¸€ä¸ªæ•°ç»„æœ€å¼€å§‹çš„è‹¥å¹²ä¸ªå…ƒç´ æ¬åˆ°æ•°ç»„çš„æœ«å°¾ï¼Œæˆ‘ä»¬ç§°ä¹‹ä¸ºæ•°ç»„çš„æ—‹è½¬ã€‚è¾“å…¥ä¸€ä¸ªé€’å¢æ’åºçš„æ•°ç»„çš„ä¸€ä¸ªæ—‹è½¬ï¼Œè¾“å‡ºæ—‹è½¬æ•°ç»„çš„æœ€å°å…ƒç´ ã€‚ä¾‹å¦‚ï¼Œæ•°ç»„ [3,4,5,1,2] ä¸º [1,2,3,4,5] çš„ä¸€ä¸ªæ—‹è½¬ï¼Œè¯¥æ•°ç»„çš„æœ€å°å€¼ä¸º1ã€‚ ç¤ºä¾‹1: è¾“å…¥ï¼š[3,4,5,1,2]è¾“å‡ºï¼š1 ç¤ºä¾‹2: è¾“å…¥ï¼š[2,2,2,0,1]è¾“å‡ºï¼š0 æ€è·¯ï¼šäºŒåˆ†æŸ¥æ‰¾è¿™é“é¢˜ç›®ç»™å‡ºä¸€ä¸ªæœ‰åºæ•°ç»„ï¼Œä¹‹åè½¬æ¢æˆä¸€ä¸ªæ—‹è½¬æ•°ç»„ä½œä¸ºè¾“å…¥æ•°æ®ï¼Œæ±‚æ—‹è½¬æ•°ç»„çš„æœ€å°æ•°å­—ã€‚ ä¾‹å¦‚ åŸæ•°ç»„ [1,2,3,4,5] è½¬æ¢ä¹‹åçš„æ—‹è½¬æ•°ç»„æ˜¯ [3,4,5,1,2] ä¹Ÿæœ‰å¯èƒ½æ˜¯ [4,5,1,2,3] ç­‰ç­‰ï¼Œæ—‹è½¬æ•°ç»„æœ€å°çš„æ•°å­—æ˜¯1ã€‚ äºŒåˆ†æŸ¥æ‰¾ä¸ä»…èƒ½ç”¨åœ¨æœ‰åºæ•°ç»„ä¸Šï¼Œè€Œä¸”è¿˜èƒ½ç”¨åœ¨å‡æ²»çš„é—®é¢˜ä¸Šï¼Œè¿™é“é¢˜ä¹Ÿæ˜¯å‡æ²»é—®é¢˜ã€‚ ç”¨äºŒåˆ†æŸ¥æ‰¾å°±é¦–å…ˆåº”è¯¥å¯»æ‰¾æ¯”è¾ƒç‚¹ï¼Œè¿™æ˜¯ä¸€ä¸ªæ—‹è½¬æ•°ç»„æ‰€ä»¥æœ€å·¦è¾¹å’Œæœ€å³è¾¹ä¹Ÿå°±æ˜¯æˆ‘ä»¬çš„æ¯”è¾ƒç‚¹ï¼Œé‚£ä¹ˆå¦‚ä½•è¿›è¡Œé€‰æ‹©å‘¢ å¦‚æœç”¨æœ€å·¦è¾¹ä½ç½® left å’Œä¸­é—´ä½ç½® mid çš„å€¼è¿›è¡Œæ¯”è¾ƒæ˜¯å¦å¯ä»¥ï¼Ÿ ä¾‹å¦‚ï¼š æ—‹è½¬æ•°ç»„ [3, 4, 5, 1, 2] ä¸­çš„å€¼éƒ½æ¯”å·¦è¾¹å¤§ï¼Œä½†æ˜¯æœ€å°çš„åœ¨å³è¾¹ï¼Œå› æ­¤ä¸åˆé€‚ã€‚ å¦‚æœç”¨æœ€å³è¾¹è¾¹ä½ç½® right å’Œä¸­é—´ä½ç½® mid çš„å€¼è¿›è¡Œæ¯”è¾ƒæ˜¯å¦å¯ä»¥ï¼Ÿ ä¾‹å¦‚ï¼šæ—‹è½¬æ•°ç»„ [3, 4, 5, 1, 2] å’Œ [2,3,4,5,1] æˆ–è€… [4,5,1,2,3]ï¼Œæœ€åå°çš„åœ¨å³è¾¹ï¼Œé‚£ä¹ˆç”¨å³è¾¹ä½ç½®å’Œä¸­é—´ä½ç½®çš„å…ƒç´ æ¯”è¾ƒï¼Œä¸æ–­ç¼©å°èŒƒå›´å»æŸ¥æ‰¾ å¤æ‚åº¦åˆ†æï¼š æ—¶é—´å¤æ‚åº¦ï¼šO(log_2 N)ï¼Œä½¿ç”¨çš„äºŒåˆ†æŸ¥æ‰¾ç®—æ³•ï¼Œå› æ­¤æ—¶é—´å¤æ‚åº¦ä¸º O(log_2 N) ç©ºé—´å¤æ‚åº¦ï¼šO(1)ï¼Œåªæ˜¯ä½¿ç”¨äº†å‡ ä¸ªæ ‡ç¤ºå˜é‡ä½œä¸ºé¢å¤–ç©ºé—´ï¼Œå¯ä»¥å¿½ç•¥ä¸è®¡ï¼Œå› æ­¤ç©ºé—´å¤æ‚åº¦ O(1) Koltin å®ç°class Solution { fun minArray(numbers: IntArray): Int { var left = 0 var right = numbers.size - 1 while (left &lt; right) { val mid = (left + right) ushr 1 when { numbers[mid] &gt; numbers[right] -&gt; left = mid + 1 numbers[mid] &lt; numbers[right] -&gt; right = mid else -&gt; right = right - 1 } } return numbers[left] }} Java å®ç°class Solution { public int minArray(int[] numbers) { int left = 0; int right = numbers.length - 1; while (left &lt; right) { int mid = (left + right) &gt;&gt; 1; if (numbers[mid] &gt; numbers[right]) { left = mid + 1; } else if (numbers[mid] &gt; numbers[right]) { right = mid; } else { right--; } } return numbers[left]; }}","link":"/2020/06/22/LeetCode/offer/11-xuan-zhuan-shu-zu-de-zui-xiao-shu-zi-lcof/"},{"title":"å‰‘æŒ‡ offer 10-2ï¼šé’è›™è·³å°é˜¶é—®é¢˜","text":"é¢˜ç›®æ¥æºäº LeetCode å‰‘æŒ‡ offer ç¬¬ 10_2 å·é—®é¢˜ï¼šé’è›™è·³å°é˜¶é—®é¢˜ã€‚é¢˜ç›®éš¾åº¦ä¸º Easyã€‚è¿™é“é¢˜å’Œ ç¬¬70å·é—®é¢˜ï¼šçˆ¬æ¥¼æ¢¯ ä¸€æ · ä¸­æ–‡åœ°å€ï¼šhttps://leetcode-cn.com/problems/qing-wa-tiao-tai-jie-wen-ti-lcof/ é¢˜ç›®æè¿°ä¸€åªé’è›™ä¸€æ¬¡å¯ä»¥è·³ä¸Š1çº§å°é˜¶ï¼Œä¹Ÿå¯ä»¥è·³ä¸Š2çº§å°é˜¶ã€‚æ±‚è¯¥é’è›™è·³ä¸Šä¸€ä¸ª n çº§çš„å°é˜¶æ€»å…±æœ‰å¤šå°‘ç§è·³æ³•ã€‚ ç­”æ¡ˆéœ€è¦å–æ¨¡ 1e9+7ï¼ˆ1000000007ï¼‰ï¼Œå¦‚è®¡ç®—åˆå§‹ç»“æœä¸ºï¼š1000000008ï¼Œè¯·è¿”å› 1ã€‚ ç¤ºä¾‹1: è¾“å…¥ï¼šn = 2è¾“å‡ºï¼š2 ç¤ºä¾‹2: è¾“å…¥ï¼šn = 7è¾“å‡ºï¼š21 æç¤ºï¼š * 0 &lt;= n &lt;= 100æ€è·¯ï¼šè¿™é“é¢˜ æ–æ³¢é‚£å¥‘ï¼ˆFibonacciï¼‰é—®é¢˜ä¸€æ ·ï¼Œå®ƒä»¬åœ¨å…¬å¼ç¨å¾®ä¸€äº›ä¸åŒ æ–æ³¢é‚£å¥‘ï¼ˆFibonacciï¼‰å…¬å¼å¦‚ä¸‹æ‰€ç¤ºï¼š F(0) = 0, F(1) = 1F(N) = F(N - 1) + F(N - 2), å…¶ä¸­ N &gt; 1. é’è›™è·³å°é˜¶ å…¬å¼å¦‚ä¸‹æ‰€ç¤ºï¼š f(0)=1 , f(1)=1F(N) = F(N - 1) + F(N - 2), å…¶ä¸­ N &gt; 1. å¤æ‚åº¦åˆ†æï¼š æ—¶é—´å¤æ‚åº¦ï¼šO(n)ï¼ŒF(N) éœ€è¦å¾ªç¯ N æ¬¡ï¼Œå› æ­¤æ—¶é—´å¤æ‚åº¦ä¸º O(n) ç©ºé—´å¤æ‚åº¦ï¼šO(1)ï¼Œåªæ˜¯ä½¿ç”¨äº†å‡ ä¸ªæ ‡ç¤ºå˜é‡ä½œä¸ºé¢å¤–ç©ºé—´ï¼Œå¯ä»¥å¿½ç•¥ä¸è®¡ï¼Œå› æ­¤ç©ºé—´å¤æ‚åº¦ O(1) Koltin å®ç°class Solution { fun numWays(n: Int): Int { if (n == 1 || n == 0) { return 1; } var a = 1; var b = 2; var sum = b; for (i in 2 until n) { sum = (a + b) % 1000000007 a = b.also { b = sum } } return sum }} Java å®ç°class Solution { public int numWays(int n) { if (n == 0 || n == 1) { return 1; } int a = 1; int b = 2; int sum = b; for (int i = 2; i &lt; n; i++) { sum = (a + b) % 1000000007; a = b; b = sum; } return sum; }}","link":"/2020/06/22/LeetCode/offer/10-2-qing-wa-tiao-tai-jie-wen-ti-lcof:/"},{"title":"å‰‘æŒ‡ offer 10-1ï¼šæ–æ³¢é‚£å¥‘æ•°åˆ—","text":"é¢˜ç›®æ¥æºäº LeetCode ä¸Šç¬¬ 10 å·é—®é¢˜ï¼šæ–æ³¢é‚£å¥‘æ•°åˆ—ã€‚é¢˜ç›®éš¾åº¦ä¸º Easyã€‚ ä¸­æ–‡åœ°å€ï¼šhttps://leetcode-cn.com/problems/fei-bo-na-qi-shu-lie-lcof/ é¢˜ç›®æè¿°å†™ä¸€ä¸ªå‡½æ•°ï¼Œè¾“å…¥ n ï¼Œæ±‚æ–æ³¢é‚£å¥‘ï¼ˆFibonacciï¼‰æ•°åˆ—çš„ç¬¬ n é¡¹ã€‚æ–æ³¢é‚£å¥‘æ•°åˆ—çš„å®šä¹‰å¦‚ä¸‹ï¼š F(0) = 0, F(1) = 1F(N) = F(N - 1) + F(N - 2), å…¶ä¸­ N &gt; 1. æ–æ³¢é‚£å¥‘æ•°åˆ—ç”± 0 å’Œ 1 å¼€å§‹ï¼Œä¹‹åçš„æ–æ³¢é‚£å¥‘æ•°å°±æ˜¯ç”±ä¹‹å‰çš„ä¸¤æ•°ç›¸åŠ è€Œå¾—å‡ºã€‚ ç­”æ¡ˆéœ€è¦å–æ¨¡ 1e9+7ï¼ˆ1000000007ï¼‰ï¼Œå¦‚è®¡ç®—åˆå§‹ç»“æœä¸ºï¼š1000000008ï¼Œè¯·è¿”å› 1ã€‚ ç¤ºä¾‹ 1ï¼š è¾“å…¥ï¼šn = 2è¾“å‡ºï¼š1 ç¤ºä¾‹ 2ï¼š è¾“å…¥ï¼šn = 5è¾“å‡ºï¼š5 æç¤ºï¼š 0 &lt;= n &lt;= 100 æ€è·¯ï¼šæ ¹æ® æ–æ³¢é‚£å¥‘æ•°åˆ— å…¬å¼æ±‚è§£å³å¯ï¼Œå…¬å¼å¦‚ä¸‹æ‰€ç¤ºï¼š F(0) = 0, F(1) = 1F(N) = F(N - 1) + F(N - 2) PS: éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œæ¯æ¬¡è®¡ç®—çš„ç»“æœéœ€è¦å–æ¨¡ Kotlin å®ç°class Solution { fun fib(n: Int): Int { return when { n == 0 -&gt; return 0 n == 1 -&gt; return 1 else -&gt; { val data = mutableListOf&lt;Int&gt;() data.add(0) data.add(1) for (i in 2..n) { data.add((data[i - 1] + data[i - 2]) % 1000000007) } return data[n] } } }} Java å®ç°public class Solution { public int fib(int n) { if (n == 0) { return 0; } int[] data = new int[n + 1]; data[0] = 0; data[1] = 1; for (int i = 2; i &lt;= n; i++) { data[i] = (data[i - 1] + data[i - 2]) % 1000000007; } return data[n]; }}","link":"/2020/06/15/LeetCode/offer/10-fei-bo-na-qi-shu-lie-lcof/"},{"title":"å‰‘æŒ‡ offer 09ï¼šç”¨ä¸¤ä¸ªæ ˆå®ç°é˜Ÿåˆ—","text":"LeetCode å‰‘æŒ‡ offerï¼šç”¨ä¸¤ä¸ªæ ˆå®ç°é˜Ÿåˆ—é¢˜ç›®æ¥æºäº LeetCode ä¸Šç¬¬ 09 å·é—®é¢˜ï¼šç”¨ä¸¤ä¸ªæ ˆå®ç°é˜Ÿåˆ—ã€‚é¢˜ç›®éš¾åº¦ä¸º Easyã€‚å’Œ ä¸»ç«™ 509 å·é—®é¢˜ç›¸åŒã€‚ ä¸­æ–‡åœ°å€ï¼šhttps://leetcode-cn.com/problems/yongâ€¦â€¦ã€‚ é¢˜ç›®æè¿°ç”¨ä¸¤ä¸ªæ ˆå®ç°ä¸€ä¸ªé˜Ÿåˆ—ã€‚é˜Ÿåˆ—çš„å£°æ˜å¦‚ä¸‹ï¼Œè¯·å®ç°å®ƒçš„ä¸¤ä¸ªå‡½æ•° appendTail å’Œ deleteHead ï¼Œåˆ†åˆ«å®Œæˆåœ¨é˜Ÿåˆ—å°¾éƒ¨æ’å…¥æ•´æ•°å’Œåœ¨é˜Ÿåˆ—å¤´éƒ¨åˆ é™¤æ•´æ•°çš„åŠŸèƒ½ã€‚(è‹¥é˜Ÿåˆ—ä¸­æ²¡æœ‰å…ƒç´ ï¼ŒdeleteHead æ“ä½œè¿”å› -1 )ã€‚ ç¤ºä¾‹ 1: è¾“å…¥ï¼š[&quot;CQueue&quot;,&quot;appendTail&quot;,&quot;deleteHead&quot;,&quot;deleteHead&quot;][[],[3],[],[]]è¾“å‡ºï¼š[null,null,3,-1] ç¤ºä¾‹ 2: è¾“å…¥ï¼š[&quot;CQueue&quot;,&quot;deleteHead&quot;,&quot;appendTail&quot;,&quot;appendTail&quot;,&quot;deleteHead&quot;,&quot;deleteHead&quot;][[],[],[5],[2],[],[]]è¾“å‡ºï¼š[null,-1,null,null,5,2] æ€è·¯ï¼šå…ˆæ¥äº†è§£ä¸€ä¸‹æ ˆå’Œé˜Ÿåˆ—çš„åŸºæœ¬æ¦‚å¿µ æ ˆ (Stack)ï¼šæ˜¯ä¸€ç§åè¿›å…ˆå‡º(last in first offï¼ŒLIFO)çš„æ•°æ®ç»“æ„ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š é˜Ÿåˆ—ï¼šæ˜¯ä¸€ç§å…ˆè¿›å…ˆå‡ºçš„ç»“æ„ã€‚ï¼Œä¸€ç«¯ç”¨æ¥åŠ å…¥æ–°å…ƒç´ ï¼Œå¦ä¸€ç«¯ç”¨æ¥åˆ é™¤å…ƒç´ ã€‚ ç®—æ³•æ­¥éª¤ï¼š ä¸¤ä¸ªæ ˆåˆ†åˆ«ä¸º Stack 1 å’Œ Stack 2ï¼ŒStack 1 ç”¨äºå­˜å‚¨å…ƒç´ ï¼ŒStack 2 ä½œä¸ºè¾…åŠ©æ ˆã€‚ æ’å…¥å…ƒç´ ï¼šå°†å…ƒç´ å­˜å‚¨åœ¨ Stack 1 ä¸­ã€‚åˆ é™¤å…ƒç´ ï¼šå¦‚æœ Stack 1 å’Œ Stack 2 éƒ½ä¸ºç©ºè¿”å› -1ï¼Œ ä¸ä¸ºç©ºï¼Œå°† Stack 1 ä¸­çš„å…ƒç´  pop å‡ºæ¥æ”¾åˆ° Stack 2 ä¸­ä¹‹åè¿”å› Stack 2 æ ˆé¡¶å…ƒç´ ï¼Œå³å¯å®ç°é˜Ÿåˆ—åŠŸèƒ½ï¼Œå‡è®¾ï¼š ä¸€ç»„è¾“å…¥æ•°æ® [1ï¼Œ2ï¼Œ3ï¼Œ4],å¦‚æœæ”¾åˆ°é˜Ÿé‡Œä¸­ï¼Œé˜Ÿåˆ—æ˜¯ä¸€ç§å…ˆè¿›å…ˆå‡ºçš„ç»“æ„ï¼Œå³è¾“å‡ºç»“æœä¸ºï¼š[1ï¼Œ2ï¼Œ3ï¼Œ4], æˆ‘çœ‹ä¸€ä¸‹æ ˆæ˜¯å¦‚ä½•å®ç°çš„ï¼š Stack 1 å…ƒç´  [1ï¼Œ2ï¼Œ3ï¼Œ4] pop å‡ºæ¥æ”¾åˆ° Stack 2 ä¸­ï¼ŒStack 2 ä¸­çš„å…ƒç´ ä¸º [4ï¼Œ3ï¼Œ2ï¼Œ1]ã€‚ æ ˆæ˜¯åè¿›å…ˆå‡ºçš„ç»“æ„ï¼Œç„¶åä¾æ¬¡å¼¹å‡º Stack 2 ä¸­çš„å…ƒç´ ï¼Œå³è¾“å‡ºç»“æœä¸ºï¼š[1ï¼Œ 2ï¼Œ3ï¼Œ4]ã€‚ Koltin å®ç°class CQueue() { val stack1 = Stack&lt;Int&gt;() val stack2 = Stack&lt;Int&gt;() fun appendTail(value: Int) { stack1.push(value); } fun deleteHead(): Int { return when { !stack2.isEmpty() -&gt; stack2.pop() stack1.isEmpty() -&gt; -1 else -&gt; { while (!stack1.isEmpty()) { stack2.push(stack1.pop()) } return stack2.pop() } } }} Java å®ç°class CQueue { private Stack&lt;Integer&gt; stack1; private Stack&lt;Integer&gt; stack2; public CQueue() { stack1 = new Stack(); stack2 = new Stack(); } public void appendTail(int value) { stack1.push(value); } public int deleteHead() { if (!stack2.isEmpty()) { return stack2.pop(); } else if (stack1.isEmpty()) { return -1; } else { while (!stack1.isEmpty()) { stack2.push(stack1.pop()); } return stack2.pop(); } }}","link":"/2020/06/15/LeetCode/offer/09-yong-liang-ge-zhan-shi-xian-dui-lie/"},{"title":"å‰‘æŒ‡ offer 06ï¼šä»å°¾åˆ°å¤´æ‰“å°é“¾è¡¨","text":"é¢˜ç›®æ¥æºäº LeetCode å‰‘æŒ‡ offer ç¬¬ 06 å·é—®é¢˜ï¼šä»å°¾åˆ°å¤´æ‰“å°é“¾è¡¨ã€‚é¢˜ç›®éš¾åº¦ä¸º Easyã€‚ ä¸­æ–‡åœ°å€ï¼šhttps://leetcode-cn.com/problems/cong-wei-dao-tou-da-yin-lian-biao-lcof/ é¢˜ç›®æè¿°è¾“å…¥ä¸€ä¸ªé“¾è¡¨çš„å¤´èŠ‚ç‚¹ï¼Œä»å°¾åˆ°å¤´åè¿‡æ¥è¿”å›æ¯ä¸ªèŠ‚ç‚¹çš„å€¼ï¼ˆç”¨æ•°ç»„è¿”å›ï¼‰ã€‚ ç¤ºä¾‹: è¾“å…¥ï¼šhead = [1,3,2]è¾“å‡ºï¼š[2,3,1] é™åˆ¶ï¼š 0 &lt;= é“¾è¡¨é•¿åº¦ &lt;= 10000 æ€è·¯ ç¬¬ä¸€æ¬¡éå†è®¡ç®—é“¾è¡¨çš„é•¿åº¦ï¼Œåˆ›å»ºç›¸åŒé•¿åº¦çš„æ•°ç»„ reverse ç¬¬äºŒæ¬¡éå†å°†å€¼ é€†åº æ·»åŠ è¿› reverse ä¸­ å¤æ‚åº¦åˆ†æï¼š æ—¶é—´å¤æ‚åº¦ï¼šO(n)ï¼Œç¬¬ä¸€æ¬¡éå†è®¡ç®—é“¾è¡¨çš„é•¿åº¦ï¼Œç¬¬äºŒæ¬¡éå†æ·»åŠ è¿›æ•°ç»„ ç©ºé—´å¤æ‚åº¦ï¼šO(n)ï¼Œéœ€è¦é¢å¤–ä½¿ç”¨ä¸€ä¸ªæ•°ç»„å­˜å‚¨ Kotlin å®ç°class Solution { fun reversePrint(head: ListNode?): IntArray = head?.let { var count = 0 var currentNode = head while (currentNode != null) { count++ currentNode = currentNode.next } val reverse = IntArray(count) { 0 } currentNode = head while (currentNode != null) { reverse[--count] = currentNode.`val` currentNode = currentNode.next } reverse } ?: intArrayOf()} Java å®ç°class Solution { public int[] reversePrint(ListNode head) { if (head == null) { return new int[]{}; } int count = 0; ListNode currentNode = head; while (currentNode != null) { count++; currentNode = currentNode.next; } int[] reverse = new int[count]; currentNode = head; while (currentNode != null) { reverse[--count] = currentNode.val; currentNode = currentNode.next; } return reverse; }}","link":"/2020/06/07/LeetCode/offer/06-list/"},{"title":"å‰‘æŒ‡ Offer 05ï¼šæ›¿æ¢ç©ºæ ¼","text":"é¢˜ç›®æ¥æºäº LeetCode å‰‘æŒ‡ offer ç¬¬ 05 å·é—®é¢˜ï¼šæ›¿æ¢ç©ºæ ¼ã€‚é¢˜ç›®éš¾åº¦ä¸º Easyã€‚ ä¸­æ–‡åœ°å€ï¼šhttps://leetcode-cn.com/problems/ti-huan-kong-ge-lcof/ é¢˜ç›®æè¿°è¯·å®ç°ä¸€ä¸ªå‡½æ•°ï¼ŒæŠŠå­—ç¬¦ä¸² s ä¸­çš„æ¯ä¸ªç©ºæ ¼æ›¿æ¢æˆâ€%20â€ã€‚ ç¤ºä¾‹: è¾“å…¥ï¼šs = &quot;We are happy.&quot;è¾“å‡ºï¼š&quot;We%20are%20happy.&quot; é™åˆ¶ï¼š 0 &lt;= s çš„é•¿åº¦ &lt;= 10000 æ€è·¯å£°æ˜ä¸€ä¸ª StringBufferï¼Œéå†å­—ç¬¦ä¸²ï¼Œå¦‚æœé‡è§ç©ºæ ¼ï¼Œæ·»åŠ  %20 åˆ° buffer ä¸­, å¦åˆ™æ·»åŠ å½“å‰å­—ç¬¦ å¤æ‚åº¦åˆ†æï¼š æ—¶é—´å¤æ‚åº¦ï¼šO(n)ï¼Œå½“ä¸€ä¸ªå­—ç¬¦ä¸²çš„é•¿åº¦ä¸º n æ—¶ï¼Œéå†å­—ç¬¦ä¸²ä¸€éï¼Œæ—¶é—´å¤æ‚åº¦ä¸º O(n) ç©ºé—´å¤æ‚åº¦ï¼š0(n)ï¼Œéœ€è¦åˆ›å»º StringBuffer æœ‰é¢å¤–çš„å¼€é”€ï¼Œæ¯æ¬¡é‡è§ç©ºæ ¼ï¼Œå°±æ›¿æ¢ä¸º %20ï¼Œæœ€åçš„æƒ…å†µä¸‹ï¼Œé•¿åº¦æ˜¯åŸæ¥çš„ 3 å€ Kotlin å®ç°class Solution { fun replaceSpace(s: String): String { val buffer = StringBuffer() var i = 0 val len = s.length while (i &lt; len) { if (s[i] == ' ') { buffer.append(&quot;%20&quot;) } else { buffer.append(s[i]) } i++ } return buffer.toString() }} Java å®ç°class Solution { public String replaceSpace(String s) { StringBuffer buffer = new StringBuffer(); for (int i = 0; i &lt; s.length(); i++) { if (s.charAt(i) == ' ') { buffer.append(&quot;%20&quot;); } else { buffer.append(s.charAt(i)); } } return buffer.toString(); }}","link":"/2020/05/31/LeetCode/offer/05-space/"},{"title":"å‰‘æŒ‡ Offer 04ï¼šäºŒç»´æ•°ç»„ä¸­çš„æŸ¥æ‰¾","text":"é¢˜ç›®æ¥æºäº LeetCode å‰‘æŒ‡ offer ç¬¬ 04 å·é—®é¢˜ï¼šäºŒç»´æ•°ç»„ä¸­çš„æŸ¥æ‰¾ã€‚é¢˜ç›®éš¾åº¦ä¸º Easyã€‚ ä¸­æ–‡åœ°å€ï¼šhttps://leetcode-cn.com/problems/er-wei-shu-zu-zhong-de-cha-zhao-lcof/ é¢˜ç›®æè¿°åœ¨ä¸€ä¸ª n * m çš„äºŒç»´æ•°ç»„ä¸­ï¼Œæ¯ä¸€è¡Œéƒ½æŒ‰ç…§ä»å·¦åˆ°å³é€’å¢çš„é¡ºåºæ’åºï¼Œæ¯ä¸€åˆ—éƒ½æŒ‰ç…§ä»ä¸Šåˆ°ä¸‹é€’å¢çš„é¡ºåºæ’åºã€‚è¯·å®Œæˆä¸€ä¸ªå‡½æ•°ï¼Œè¾“å…¥è¿™æ ·çš„ä¸€ä¸ªäºŒç»´æ•°ç»„å’Œä¸€ä¸ªæ•´æ•°ï¼Œåˆ¤æ–­æ•°ç»„ä¸­æ˜¯å¦å«æœ‰è¯¥æ•´æ•°ã€‚ ç¤ºä¾‹: ç°æœ‰çŸ©é˜µ matrix å¦‚ä¸‹ï¼š [ [1, 4, 7, 11, 15], [2, 5, 8, 12, 19], [3, 6, 9, 16, 22], [10, 13, 14, 17, 24], [18, 21, 23, 26, 30]] ç»™å®š target = 5ï¼Œè¿”å› trueã€‚ ç»™å®š target = 20ï¼Œè¿”å› falseã€‚ é™åˆ¶ï¼š 0 &lt;= n &lt;= 10000 &lt;= m &lt;= 1000 æ€è·¯ï¼šçº¿æ€§æŸ¥æ‰¾ç”±é¢˜æ„å¾—çŸ¥ï¼Œæ¯ä¸ªäºŒç»´æ•°ç»„éƒ½æœ‰ä»¥ä¸‹ç‰¹ç‚¹ï¼š æ¯ä¸€è¡Œéƒ½æŒ‰ç…§ä»å·¦åˆ°å³é€’å¢çš„é¡ºåºæ’åº æ¯ä¸€åˆ—éƒ½æŒ‰ç…§ä»ä¸Šåˆ°ä¸‹é€’å¢çš„é¡ºåºæ’åº å› ä¸ºéƒ½æ˜¯æœ‰åºçš„ï¼Œæ‰€ä»¥å¯ä»¥é€‰æ‹©å°†å·¦ä¸Šè§’ æˆ–è€… å³ä¸Šè§’ä½œä¸ºèµ·ç‚¹ï¼Œå¯»æ‰¾ä¸€ä¸ªå’Œç›®æ ‡æ•°å­—ç›¸ç­‰çš„æ•°ï¼Œåœ¨è¿™é‡Œæˆ‘é€‰æ‹©å³ä¸Šè§’ä½œä¸ºèµ·ç‚¹å³ matrix[0][maxColumn] å…¶ä¸­ maxColumn = matrix[0].size - 1 å³æ¯ä¸€è¡Œçš„æœ€å¤§åˆ—æ•°ï¼Œç®—æ³•æ­¥éª¤å¦‚ä¸‹ åˆå§‹åŒ– raw = 0ï¼Œcolumn = maxColumn å¦‚æœ matrix[raw][column] == targetï¼Œè¯´æ˜å­˜åœ¨å’Œç›®æ ‡æ•°å­—ç›¸ç­‰çš„æ•°è¿”å› true å¦‚æœ matrix[raw][column] &gt; target, è¯´æ˜å½“å‰å…ƒç´ å¤§äºç›®æ ‡å€¼ï¼Œæ‰€ä»¥å½“å‰å…ƒç´ æ‰€åœ¨çš„ä¸‹é¢æ‰€æœ‰å…ƒç´ éƒ½å¤§äºç›®æ ‡å€¼ï¼Œå› æ­¤ column - 1ï¼Œå¾€å·¦è¾¹å¯»æ‰¾ å¦‚æœ matrix[raw][column] &lt; targetï¼Œè¯´æ˜å½“å‰å…ƒç´ å°äºç›®æ ‡å€¼ï¼Œæ‰€ä»¥å½“å‰å…ƒç´ æ‰€åœ¨çš„å·¦è¾¹æ‰€æœ‰å…ƒç´ éƒ½å°äºç›®æ ‡å€¼ï¼Œå› æ­¤ raw + 1ï¼Œå¾€ä¸‹é¢å¯»æ‰¾ éå†ç»“æŸä¹‹åï¼Œå¦‚æœæ²¡æœ‰æ‰¾åˆ°å³è¿”å› false å¤æ‚åº¦åˆ†æï¼š æ—¶é—´å¤æ‚åº¦ï¼šO(n+m)ï¼Œå¦‚æœäºŒç»´æ•°ç»„çš„æœ‰ n è¡Œ m åˆ—ï¼Œé‚£ä¹ˆåœ¨å¾ªç¯è¿‡ç¨‹ä¸­è¡Œæ•°ä¸ä¼šè¶…è¿‡ n è¡Œï¼Œåˆ—æ•°ä¸ä¼šè¶…è¿‡ m åˆ—ï¼Œå› æ­¤åœ¨å¾ªç¯ç»“æŸä¹‹åæ€»çš„æ¬¡æ•°ä¸ä¼šè¶…è¿‡ n+m æ¬¡ ç©ºé—´å¤æ‚åº¦ï¼š0(1)ï¼Œå› ä¸ºæ²¡æœ‰é¢å¤–çš„å¼€é”€ï¼Œåœ¨å†…å­˜ä¸­ä¸€ç›´éƒ½æ˜¯æ’å®šçš„ Kotlin å®ç°class Solution { fun findNumberIn2DArray(matrix: Array&lt;IntArray&gt;, target: Int): Boolean { if (matrix == null || matrix.size &lt;= 0 || matrix[0].size &lt;= 0) { return false; } var raw = 0 var column = matrix[0].size - 1; val maxRaw = matrix.size - 1; while (raw &lt;= maxRaw &amp;&amp; column &gt;= 0) { when { matrix[raw][column] == target -&gt; return true matrix[raw][column] &gt; target -&gt; column-- else -&gt; raw++ } } return false }} Java å®ç°class Solution { public boolean findNumberIn2DArray(int[][] matrix, int target) { if (matrix == null || matrix.length &lt;= 0 || matrix[0].length &lt;= 0) { return false; } int row = 0; int column = matrix[0].length - 1; int maxRow = matrix.length - 1; while (row &lt;= maxRow &amp;&amp; column &gt;= 0) { if (matrix[row][column] == target) { return true; } else if (matrix[row][column] &gt; target) { column--; } else { row++; } } return false; }}","link":"/2020/05/31/LeetCode/offer/04-arrays/"},{"title":"å‰‘æŒ‡ Offer 03ï¼šæ•°ç»„ä¸­é‡å¤çš„æ•°å­—","text":"é¢˜ç›®æ¥æºäº LeetCode å‰‘æŒ‡ offer ç¬¬ 03 å·é—®é¢˜ï¼šæ•°ç»„ä¸­é‡å¤çš„æ•°å­—ã€‚é¢˜ç›®éš¾åº¦ä¸º Easyã€‚ ä¸­æ–‡åœ°å€ï¼šhttps://leetcode-cn.com/problems/shu-zu-zhong-zhong-fu-de-shu-zi-lcof/ é¢˜ç›®æè¿°æ‰¾å‡ºæ•°ç»„ä¸­é‡å¤çš„æ•°å­—ã€‚ åœ¨ä¸€ä¸ªé•¿åº¦ä¸º n çš„æ•°ç»„ nums é‡Œçš„æ‰€æœ‰æ•°å­—éƒ½åœ¨ 0ï½n-1 çš„èŒƒå›´å†…ã€‚æ•°ç»„ä¸­æŸäº›æ•°å­—æ˜¯é‡å¤çš„ï¼Œä½†ä¸çŸ¥é“æœ‰å‡ ä¸ªæ•°å­—é‡å¤äº†ï¼Œä¹Ÿä¸çŸ¥é“æ¯ä¸ªæ•°å­—é‡å¤äº†å‡ æ¬¡ã€‚è¯·æ‰¾å‡ºæ•°ç»„ä¸­ä»»æ„ä¸€ä¸ªé‡å¤çš„æ•°å­—ã€‚ ç¤ºä¾‹ 1: è¾“å…¥ï¼š[2, 3, 1, 0, 2, 5, 3]è¾“å‡ºï¼š2 æˆ– 3 é™åˆ¶ï¼š 2 &lt;= n &lt;= 100000 æ€è·¯ä¸€ï¼šåŸåœ°ç½®æ¢æ³•é¢˜ç›®æŒ‡å‡º åœ¨ä¸€ä¸ªé•¿åº¦ä¸º n çš„æ•°ç»„ nums é‡Œçš„æ‰€æœ‰æ•°å­—éƒ½åœ¨ [0,n-1] çš„èŒƒå›´å†…ï¼Œå¯éå†æ•°ç»„å¹¶é€šè¿‡äº¤æ¢æ“ä½œä½¿å…ƒç´ çš„ ç´¢å¼• ä¸ å€¼ï¼Œé€šè¿‡ç´¢å¼•æ‰¾åˆ°å¯¹åº”çš„å€¼ï¼Œç®—æ³•æµç¨‹å¦‚ä¸‹ï¼š å½“ nums[i] == i æ—¶ï¼Œå³ å€¼ å’Œ ç´¢å¼•ï¼Œä¸€ä¸€å¯¹åº”æ— éœ€äº¤æ¢ å½“ nums[nums[i]] == nums[i]ï¼Œå³ç´¢å¼• nums[i] å¯¹åº”çš„å€¼ å’Œ nums[i] ç›¸ç­‰ï¼Œæ‰¾åˆ°ç›¸åŒçš„å€¼ï¼Œè¿”å›æ­¤å€¼ nums[i] ä¸Šé¢æ¡ä»¶éƒ½ä¸æ»¡è¶³ï¼Œå³äº¤æ¢ç´¢å¼•ä¸º i å’Œ nums[i] çš„å…ƒç´ å€¼ï¼Œå°†æ•°å­—äº¤æ¢åˆ°å¯¹åº”ç´¢å¼•ä½ç½® æ²¡æœ‰æ‰¾åˆ°è¿”å› -1ï¼Œå³ä»£è¡¨æ•°ç»„ä¸­æ— ç›¸åŒå€¼ ä¾‹å¦‚æ•°ç»„ [2,0,1] äº¤æ¢é€»è¾‘å¦‚ä¸‹, å½“ i = 0 æ—¶ï¼š temp = num[i], å³ temp = 2 num[i] = num[temp]ï¼Œå³ num[i] = 1 num[temp] = temp, å³ num[temp] = 2 å°† å³ å€¼ å’Œ ç´¢å¼• ä¸€ä¸€å¯¹åº” Javaå®ç°public class Solution { public int findRepeatNumber(int[] nums) { int len = nums.length; for (int i = 0; i &lt; len; i++) { if (nums[i] == i) continue; if (nums[nums[i]] == nums[i]) { return nums[i]; } int temp = nums[i]; nums[nums[i]] = nums[temp]; nums[temp] = temp; } return -1; }} Koltinå®ç°class Solution { fun findRepeatNumber(nums: IntArray): Int { for ((index, value) in nums.withIndex()) { if (value == index) continue if (nums[value] == nums[index]) { return nums[index] } val temp = value nums[value] = nums[temp] nums[temp] = temp } return -1 }} æ€è·¯äºŒï¼šå“ˆå¸Œç®—æ³•åˆ©ç”¨ Haset API çš„ç‰¹æ€§ï¼Œå¦‚æœæ·»åŠ é‡å¤çš„å…ƒç´ ä¼šè¿”å› false Java å®ç°public class Solution { public int findRepeatNumber2(int[] nums) { int len = nums.length; Set&lt;Integer&gt; set = new HashSet&lt;Integer&gt;(); for (int i = 0; i &lt; len; i++) { if (!set.add(nums[i])) { return nums[i]; } } return -1; }} Koltin å®ç°class Solution { fun findRepeatNumber(nums: IntArray): Int { val set = HashSet&lt;Int&gt;() for ((index, value) in nums.withIndex()) { if (!set.add(value)) { return value; } } return -1 }}","link":"/2020/05/24/LeetCode/offer/03-number/"},{"title":"å‰‘æŒ‡ Offer 07ï¼šé‡å»ºäºŒå‰æ ‘","text":"é¢˜ç›®æ¥æºäº LeetCode å‰‘æŒ‡ offer ç¬¬ 07 å·é—®é¢˜ï¼šé‡å»ºäºŒå‰æ ‘ã€‚é¢˜ç›®éš¾åº¦ä¸º Mediumã€‚å’Œç¬¬ 105 å·é—®é¢˜ ç›¸åŒ å‰‘æŒ‡offer 07 é‡å»ºäºŒå‰æ ‘ï¼šhttps://leetcode-cn.com/problems/zhong-jianâ€¦â€¦ 105 å·é—®é¢˜-è‹±æ–‡åœ°å€ï¼šhttps://leetcode.com/problems/construct-binary-tree-from-preorder-and-inorder-traversal/ 105 å·é—®é¢˜-ä¸­æ–‡åœ°å€ï¼šhttps://leetcode-cn.com/problems/construct-binary-tree-from-preorder-and-inorder-traversal/ é¢˜ç›®æè¿°è¾“å…¥æŸäºŒå‰æ ‘çš„å‰åºéå†å’Œä¸­åºéå†çš„ç»“æœï¼Œè¯·é‡å»ºè¯¥äºŒå‰æ ‘ã€‚å‡è®¾è¾“å…¥çš„å‰åºéå†å’Œä¸­åºéå†çš„ç»“æœä¸­éƒ½ä¸å«é‡å¤çš„æ•°å­—ã€‚ ä¾‹å¦‚ï¼Œç»™å‡º å‰åºéå† preorder = [3,9,20,15,7]ä¸­åºéå† inorder = [9,3,15,20,7] è¿”å›å¦‚ä¸‹çš„äºŒå‰æ ‘ï¼š 3 / \\9 20 / \\ 15 7 é™åˆ¶ï¼š 0 &lt;= èŠ‚ç‚¹ä¸ªæ•° &lt;= 5000 æ€è·¯ï¼šå¦‚æœè¿˜ä¸äº†è§£å‰åºéå†å’Œä¸­åºéå†ç®—æ³•å¯ä»¥ç‚¹å‡»ä¸‹æ–¹é“¾æ¥å‰å¾€ å‰åºéå†ä¸­åºéå† å‰åºéå†å’Œä¸­åºéå†è¿‡ç¨‹å¦‚ä¸‹ï¼š å‰åºéå†ï¼šæ ¹ç»“ç‚¹ â€”&gt; å·¦èŠ‚ç‚¹ â€”&gt; å³èŠ‚ç‚¹ ä¸­åºéå†ï¼šå·¦èŠ‚ç‚¹â€”&gt; æ ¹ç»“ç‚¹ â€”&gt; å³èŠ‚ç‚¹ æ ¹æ®å‰åºéå†çš„è§„åˆ™ï¼Œå¯çŸ¥ preorder[0] ä¸€å®šæ˜¯æ•´æ£µäºŒå‰æ ‘çš„æ ¹èŠ‚ç‚¹ï¼Œå¦‚æœæ ¹èŠ‚ç‚¹æ‰€åœ¨çš„ä¸‹æ ‡ä¸º indexï¼Œæ ¹æ®ä¸­åºéå†çš„è§„åˆ™ï¼Œå¯çŸ¥ä¸­åºåºåˆ— inorderï¼š åŒºé—´ inorder[0, index - 1] å±äºæ ¹èŠ‚ç‚¹çš„å·¦å­æ ‘ åŒºé—´ inorder[index + 1, n - 1] å±äºæ ¹èŠ‚ç‚¹çš„å³å­æ ‘ æ ¹æ®å‰åºéå†çš„è§„åˆ™ä¸€å®šæ˜¯å…ˆéå†å®Œå·¦å­æ ‘ï¼Œç„¶åæ‰ä¼šéå†å³å­æ ‘ï¼Œæ‰€ä»¥å‰åºåºåˆ— preorderï¼š åŒºé—´ preorder[1, index] åœ¨æ ¹èŠ‚ç‚¹çš„ preorder[0] çš„å·¦è¾¹ åŒºé—´ preorder[index+1, n] åœ¨æ ¹èŠ‚ç‚¹çš„ preorder[0] çš„å³è¾¹ æ‰€ä»¥ç®—æ³•æ€è·¯å¦‚ä¸‹ï¼š æ ¹èŠ‚ç‚¹æ˜¯Preorderæ•°ç»„ä¸­çš„ç¬¬ä¸€ä¸ªå…ƒç´ ï¼Œå³ preorder[0] åœ¨Inorderæ•°ç»„ä¸­æŸ¥æ‰¾æ ¹çš„ä½ç½® index åœ¨Inorderæ•°ç»„ä¸­ï¼Œæ ¹å…ƒç´ å·¦è¾¹çš„å…ƒç´ æ˜¯å·¦å­æ ‘ï¼Œå³åŒºé—´ inorder[0, index - 1] åœ¨Inorderæ•°ç»„ä¸­ï¼Œæ ¹å…ƒç´ å³è¾¹çš„å…ƒç´ æ˜¯å³å­æ ‘ï¼Œå³åŒºé—´ inorder[index + 1, n - 1] åœ¨preorderæ•°ç»„ä¸­ï¼ŒåŒºé—´ preorder[1, index] åœ¨æ ¹èŠ‚ç‚¹çš„preorder[0] çš„å·¦è¾¹ åœ¨preorderæ•°ç»„ä¸­ï¼Œpreorder[index+1, n] åœ¨æ ¹èŠ‚ç‚¹çš„preorder[0] çš„å³è¾¹ åœ¨ç”±å·¦å­æ ‘ä¸­çš„å…ƒç´ ç»„æˆçš„å­æ•°ç»„ä¸Šé€’å½’è°ƒç”¨ åœ¨ç”±å³å­æ ‘ä¸­çš„å…ƒç´ ç»„æˆçš„å­æ•°ç»„ä¸Šé€’å½’åœ°è°ƒç”¨ å¤æ‚åº¦åˆ†æï¼š æ—¶é—´å¤æ‚åº¦ï¼šO(n), éå†æ¯ä¸€ä¸ªèŠ‚ç‚¹ï¼Œé‡å»ºäºŒå‰æ ‘ ç©ºé—´å¤æ‚åº¦ï¼šO(n)ï¼Œéœ€è¦å­˜å‚¨å»ºç«‹çš„äºŒå‰æ ‘ Kotlin å°¾é€’å½’å®ç°class Solution { fun buildTree(preorder: IntArray, inorder: IntArray): TreeNode? { return tailrecOrder(preorder, inorder) } tailrec fun tailrecOrder(preorder: IntArray, inorder: IntArray): TreeNode? { if (preorder.size &lt;= 0 || inorder.size &lt;= 0) { return null; } val key = preorder[0] val root = TreeNode(key) if (preorder.size == 1) { return root } val index = getRootIndex(inorder, key) if (index &gt; 0 || index &lt; preorder.size) { // è®¡ç®—å·¦å­æ ‘ï¼Œæ‰€ä»¥æ ¹èŠ‚ç‚¹é™¤å¤–ï¼Œä»ä¸‹æ ‡1å¼€å§‹ var pre = Arrays.copyOfRange(preorder, 1, index + 1) var inor = Arrays.copyOfRange(inorder, 0, index) root.left = tailrecOrder(pre, inor) pre = Arrays.copyOfRange(preorder, index + 1, preorder.size) inor = Arrays.copyOfRange(inorder, index + 1, inorder.size) root.right = tailrecOrder(pre, inor) } return root } fun getRootIndex(inorder: IntArray, key: Int): Int { inorder.forEachIndexed { index, item -&gt; if (item == key) { return index } } return -1 }} Java å®ç°class Solution { public TreeNode buildTree(int[] preorder, int[] inorder) { if (preorder.length &lt;= 0 || inorder.length &lt;= 0) { return null; } int key = preorder[0]; TreeNode root = new TreeNode(key); if (preorder.length == 1) { return root; } int index = getRootIndex(inorder, key); if (index &gt; 0 || index &lt; preorder.length) { // è®¡ç®—å·¦å­æ ‘ï¼Œæ‰€ä»¥æ ¹èŠ‚ç‚¹é™¤å¤–ï¼Œä»ä¸‹æ ‡1å¼€å§‹ int[] pre = Arrays.copyOfRange(preorder, 1, index + 1); int[] inor = Arrays.copyOfRange(inorder, 0, index); root.left = buildTree(pre, inor); pre = Arrays.copyOfRange(preorder, index + 1, preorder.length); inor = Arrays.copyOfRange(inorder, index + 1, inorder.length); root.right = buildTree(pre, inor); } return root; } private final int getRootIndex(int[] inorder, int key) { for (int i = 0; i &lt; preorder.length; i++) { if (preorder[i] == key) { return i; } } return -1; }}","link":"/2020/07/19/LeetCode/offer/07-zhong-jian-er-cha-shu-lcof/"},{"title":"LeetCode æœç´¢ï¼šå®Œå…¨å¹³æ–¹æ•°","text":"é¢˜ç›®æ¥æºäº LeetCode ä¸Š ç¬¬ 279 å·é—®é¢˜ï¼šå²›å±¿æ•°é‡ã€‚é¢˜ç›®éš¾åº¦ä¸º Mediumã€‚ è‹±æ–‡åœ°å€ï¼šhttps://leetcode.com/problems/perfect-squares/ ä¸­æ–‡åœ°å€ï¼šhttps://leetcode-cn.com/problems/perfect-squares/ é¢˜ç›®æè¿°ç»™å®šæ­£æ•´æ•° nï¼Œæ‰¾åˆ°è‹¥å¹²ä¸ªå®Œå…¨å¹³æ–¹æ•°ï¼ˆæ¯”å¦‚ 1, 4, 9, 16, ...ï¼‰ä½¿å¾—å®ƒä»¬çš„å’Œç­‰äº nã€‚ä½ éœ€è¦è®©ç»„æˆå’Œçš„å®Œå…¨å¹³æ–¹æ•°çš„ä¸ªæ•°æœ€å°‘ã€‚ ç¤ºä¾‹ 1ï¼š è¾“å…¥: n = 12è¾“å‡º: 3 è§£é‡Š: 12 = 4 + 4 + 4. ç¤ºä¾‹ 2ï¼š è¾“å…¥: n = 13è¾“å‡º: 2è§£é‡Š: 13 = 4 + 9. æ€è·¯ï¼šå¹¿åº¦ä¼˜å…ˆéå†å¹¿åº¦ä¼˜å…ˆæœç´¢ï¼ˆBFSï¼‰çš„ä¸€ä¸ªå¸¸è§åº”ç”¨æ˜¯æ‰¾å‡ºä»æ ¹ç»“ç‚¹åˆ°ç›®æ ‡ç»“ç‚¹çš„æœ€çŸ­è·¯å¾„ã€‚ åœ¨ BFS ä¸­ä½¿ç”¨é˜Ÿåˆ—çš„åŸå› ï¼Ÿ ç»“ç‚¹çš„å¤„ç†é¡ºåºä¸å®ƒä»¬æ·»åŠ åˆ°é˜Ÿåˆ—çš„é¡ºåºæ˜¯å®Œå…¨ç›¸åŒçš„é¡ºåºï¼Œå³å…ˆè¿›å…ˆå‡ºï¼ˆFIFOï¼‰ã€‚è¿™å°±æ˜¯æˆ‘ä»¬åœ¨ BFS ä¸­ä½¿ç”¨é˜Ÿåˆ—çš„åŸå› ã€‚ é˜Ÿåˆ—çš„åŸºæœ¬ä½¿ç”¨ æ¯ç§ Queue æ–¹æ³•å­˜åœ¨ä¸¤ç§å½¢å¼ï¼š å¦‚æœæ“ä½œå¤±è´¥ï¼ŒæŠ›å‡ºäº†ä¸€ä¸ªå¼‚å¸¸ å…¶ä»–çš„è¿”å›ä¸€ä¸ªç‰¹æ®Šå€¼ï¼ˆnull æˆ–è€… falseï¼Œå–å†³äºæ“ä½œï¼‰ æ“ä½œç±»å‹ æŠ›å‡ºå¼‚å¸¸ è¿”å›ç‰¹æ®Šå€¼ æ’å…¥ add(e) offer(e) ç§»é™¤ remove() poll() æŸ¥æ‰¾ element() peek() Queue çš„å®ç°å¯ä»¥é™åˆ¶æ‰€æŒæœ‰å…ƒç´ çš„æ•°é‡ï¼Œè¿™æ ·çš„é˜Ÿåˆ—ç§°ä¸ºæœ‰ç•Œï¼Œæœ‰äº› Queue å®ç° java.util.concurrent æ˜¯æœ‰ç•Œçš„ï¼Œä½†å®ç° java.util ä¸æ˜¯ï¼š add ï¼šç»§æ‰¿è‡ª Collectionï¼Œæ’å…¥ä¸€ä¸ªå…ƒç´ ï¼Œé™¤éå®ƒä¼šè¿åé˜Ÿåˆ—çš„å®¹é‡é™åˆ¶ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹æŠ›å‡º IllegalStateException offer ï¼šæ–¹æ³•ä»…ç”¨äºæœ‰ç•Œé˜Ÿåˆ—ï¼Œä¸èƒ½æ’å…¥æ—¶ï¼Œè¿”å› fasle åœ¨ remove ä¸ poll æ–¹æ³•éƒ½æ˜¯ä»é˜Ÿåˆ—ä¸­åˆ é™¤ç¬¬ä¸€ä¸ªå…ƒç´ ï¼Œå¦‚æœé˜Ÿåˆ—ä¸ºç©ºï¼š remove : removethrows NoSuchElementException poll : è¿”å› null element ä¸ peek æ–¹æ³•ç”¨äºåœ¨é˜Ÿåˆ—çš„å¤´éƒ¨æŸ¥è¯¢å…ƒç´ ï¼Œå¦‚æœé˜Ÿåˆ—ä¸ºç©ºï¼š element : æŠ›å‡º NoSuchElementException peek : è¿”å› null ç®—æ³•æµç¨‹å¦‚ä¸‹ï¼š å°†æ•°å­— N è½¬æ¢ä¸ºå¤šæ ‘ï¼ŒæŒ‰æ ‘çš„å±‚æ¬¡éå†å³å¯ï¼ˆåˆ†è§£å‡º N å¯èƒ½çš„ç»„åˆï¼‰ï¼Œæ¯ä¸€å±‚çš„èŠ‚ç‚¹ = ç”¨ä¸Šä¸€å±‚çš„èŠ‚ç‚¹ - å®Œå…¨å¹³æ–¹æ•° æ–°å»ºä¸€ä¸ª queueï¼Œç”¨æ¥å­˜å‚¨è®¿é—®çš„æ¯ä¸ªèŠ‚ç‚¹ ç”¨ HashSet è¿‡æ»¤æ‰è®¡ç®—è¿‡çš„ç»„åˆï¼Œé¿å…é‡å¤è®¡ç®— å¾ªç¯åˆ¤æ–­é˜Ÿåˆ—æ˜¯å¦ä¸ºç©ºï¼Œå¦‚æœé˜Ÿåˆ—ä¸ºç©ºå³å¾ªç¯ç»ˆæ­¢ è·å–æ¯å±‚çš„é•¿åº¦ï¼Œéå†æ¯ä¸€å±‚ï¼Œè®¡ç®—å‡ºä¸‹ä¸€å±‚çš„ç»„åˆï¼Œæ·»åŠ åˆ° queue é‡å¤æ‰§è¡Œ 3ã€4 éå†ç»“æŸæ—¶ï¼Œå±‚æ•°å³æ˜¯èƒ½ç»„æˆå®Œå…¨å¹³æ–¹æ•°çš„æœ€å°‘ä¸ªæ•° Kotlin å®ç°class Solution { fun numSquares(n: Int): Int { val square = mutableListOf&lt;Int&gt;() for (i in 1..n) { square.add(i * i) } val set = hashSetOf&lt;Int&gt;() val queue = LinkedList&lt;Int&gt;() queue.offer(n) var step = 0 while (queue.size &gt; 0) { step = step + 1 val count = queue.size for (i in 0 until count) { val item = queue.poll() loop@ for (j in square) { when { item == j -&gt; return step item &lt; j -&gt; break@loop else -&gt; { val sub = item - j; if (set.add(sub)) { queue.offer(sub) } } } } } } return step }} Java å®ç°class Solution { public int numSquares(int n) { List&lt;Integer&gt; square = new ArrayList&lt;&gt;(); for (int i = 1; i &lt; n; i++) { square.add(i * i); } int step = 0; Set&lt;Integer&gt; set = new HashSet&lt;&gt;(); Queue&lt;Integer&gt; queue = new LinkedList&lt;&gt;(); queue.add(n); while (queue.size() &gt; 0) { step = step + 1; int count = queue.size(); for (int i = 0; i &lt; count; i++) { int item = queue.poll(); for (Integer subItem : square) { if (item == subItem) { return step; } else if (item &lt; subItem) { break; } else { int sub = item - subItem; if (set.add(sub)) { queue.offer(sub); } } } } } return step; }}","link":"/2020/08/01/LeetCode/search/02-perfect-squares/"},{"title":"LeetCode æœç´¢ï¼šå²›å±¿æ•°é‡","text":"é¢˜ç›®æ¥æºäº LeetCode ä¸Š ç¬¬ 200 å·é—®é¢˜ï¼šå²›å±¿æ•°é‡ã€‚é¢˜ç›®éš¾åº¦ä¸º Mediumã€‚ è‹±æ–‡åœ°å€ï¼šhttps://leetcode.com/problems/number-of-islands/ ä¸­æ–‡åœ°å€ï¼šhttps://leetcode-cn.com/problems/number-of-islands/ é¢˜ç›®æè¿°ç»™ä½ ä¸€ä¸ªç”± '1'ï¼ˆé™†åœ°ï¼‰å’Œ '0'ï¼ˆæ°´ï¼‰ç»„æˆçš„çš„äºŒç»´ç½‘æ ¼ï¼Œè¯·ä½ è®¡ç®—ç½‘æ ¼ä¸­å²›å±¿çš„æ•°é‡ã€‚ å²›å±¿æ€»æ˜¯è¢«æ°´åŒ…å›´ï¼Œå¹¶ä¸”æ¯åº§å²›å±¿åªèƒ½ç”±æ°´å¹³æ–¹å‘æˆ–ç«–ç›´æ–¹å‘ä¸Šç›¸é‚»çš„é™†åœ°è¿æ¥å½¢æˆã€‚ æ­¤å¤–ï¼Œä½ å¯ä»¥å‡è®¾è¯¥ç½‘æ ¼çš„å››æ¡è¾¹å‡è¢«æ°´åŒ…å›´ã€‚ ç¤ºä¾‹ 1ï¼š è¾“å…¥:[['1','1','1','1','0'],['1','1','0','1','0'],['1','1','0','0','0'],['0','0','0','0','0']]è¾“å‡º: 1 ç¤ºä¾‹ 2ï¼š è¾“å…¥:[['1','1','0','0','0'],['1','1','0','0','0'],['0','0','1','0','0'],['0','0','0','1','1']]è¾“å‡º: 3è§£é‡Š: æ¯åº§å²›å±¿åªèƒ½ç”±æ°´å¹³å’Œ/æˆ–ç«–ç›´æ–¹å‘ä¸Šç›¸é‚»çš„é™†åœ°è¿æ¥è€Œæˆã€‚ æ€è·¯ä¸€ï¼šå¹¿åº¦ä¼˜å…ˆéå†å¹¿åº¦ä¼˜å…ˆæœç´¢ï¼ˆBFSï¼‰çš„ä¸€ä¸ªå¸¸è§åº”ç”¨æ˜¯æ‰¾å‡ºä»æ ¹ç»“ç‚¹åˆ°ç›®æ ‡ç»“ç‚¹çš„æœ€çŸ­è·¯å¾„ã€‚ åœ¨ BFS ä¸­ä½¿ç”¨é˜Ÿåˆ—çš„åŸå› ï¼Ÿ ç»“ç‚¹çš„å¤„ç†é¡ºåºä¸å®ƒä»¬æ·»åŠ åˆ°é˜Ÿåˆ—çš„é¡ºåºæ˜¯å®Œå…¨ç›¸åŒçš„é¡ºåºï¼Œå³å…ˆè¿›å…ˆå‡ºï¼ˆFIFOï¼‰ã€‚è¿™å°±æ˜¯æˆ‘ä»¬åœ¨ BFS ä¸­ä½¿ç”¨é˜Ÿåˆ—çš„åŸå› ã€‚ é˜Ÿåˆ—çš„åŸºæœ¬ä½¿ç”¨ æ¯ç§ Queue æ–¹æ³•å­˜åœ¨ä¸¤ç§å½¢å¼ï¼š å¦‚æœæ“ä½œå¤±è´¥ï¼ŒæŠ›å‡ºäº†ä¸€ä¸ªå¼‚å¸¸ å…¶ä»–çš„è¿”å›ä¸€ä¸ªç‰¹æ®Šå€¼ï¼ˆnull æˆ–è€… falseï¼Œå–å†³äºæ“ä½œï¼‰ æ“ä½œç±»å‹ æŠ›å‡ºå¼‚å¸¸ è¿”å›ç‰¹æ®Šå€¼ æ’å…¥ add(e) offer(e) ç§»é™¤ remove() poll() æŸ¥æ‰¾ element() peek() Queue çš„å®ç°å¯ä»¥é™åˆ¶æ‰€æŒæœ‰å…ƒç´ çš„æ•°é‡ï¼Œè¿™æ ·çš„é˜Ÿåˆ—ç§°ä¸ºæœ‰ç•Œï¼Œæœ‰äº› Queue å®ç° java.util.concurrent æ˜¯æœ‰ç•Œçš„ï¼Œä½†å®ç° java.util ä¸æ˜¯ï¼š add ï¼šç»§æ‰¿è‡ª Collectionï¼Œæ’å…¥ä¸€ä¸ªå…ƒç´ ï¼Œé™¤éå®ƒä¼šè¿åé˜Ÿåˆ—çš„å®¹é‡é™åˆ¶ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹æŠ›å‡º IllegalStateException offer ï¼šæ–¹æ³•ä»…ç”¨äºæœ‰ç•Œé˜Ÿåˆ—ï¼Œä¸èƒ½æ’å…¥æ—¶ï¼Œè¿”å› fasle åœ¨ remove ä¸ poll æ–¹æ³•éƒ½æ˜¯ä»é˜Ÿåˆ—ä¸­åˆ é™¤ç¬¬ä¸€ä¸ªå…ƒç´ ï¼Œå¦‚æœé˜Ÿåˆ—ä¸ºç©ºï¼š remove : removethrows NoSuchElementException poll : è¿”å› null element ä¸ peek æ–¹æ³•ç”¨äºåœ¨é˜Ÿåˆ—çš„å¤´éƒ¨æŸ¥è¯¢å…ƒç´ ï¼Œå¦‚æœé˜Ÿåˆ—ä¸ºç©ºï¼š element : æŠ›å‡º NoSuchElementException peek : è¿”å› null ç®—æ³•æµç¨‹å¦‚ä¸‹ï¼š å¹¿åº¦ä¼˜å…ˆæœç´¢å°±æ˜¯æ‰«ææ•´ä¸ªäºŒç»´ç½‘æ ¼ï¼Œé‡åˆ° 1 å°†å…¶åŠ å…¥é˜Ÿåˆ—ä¸­ï¼Œç„¶åå°†å…¶æ ‡è®°ä¸º 0, ç›´åˆ°é˜Ÿåˆ—ä¸ºç©ºï¼Œæœç´¢ç»“æŸã€‚ å¤æ‚åº¦åˆ†æï¼š æ—¶é—´å¤æ‚åº¦ï¼š0(MN) ï¼ŒM æ˜¯è¡Œæ•°ï¼ŒN æ˜¯åˆ—æ•° ç©ºé—´å¤æ‚åº¦ï¼šO(MN)ï¼Œæœ€åçš„æƒ…å†µæ·±åº¦è¾¾åˆ°ç¬¬ M è¡Œ N åˆ— Kotlin å®ç°class Solution { fun numIslands(grid: Array&lt;CharArray&gt;): Int { if (grid.size == 0) { return 0; } var step = 0; val queue = LinkedList&lt;IntArray&gt;() val row = grid.size val colum = grid[0].size for (i in 0 until row) { for (j in 0 until colum) { if (grid[i][j] == '1') { step = step + 1 queue.offer(intArrayOf(i, j)) while (!queue.isEmpty()) { val (x1, y1) = queue.poll() if (x1 &lt; 0 || x1 &gt;= row || y1 &lt; 0 || y1 &gt;= colum || grid[x1][y1] == '0') { continue; } grid[x1][y1] = '0' queue.offer(intArrayOf(x1 + 1, y1)) queue.offer(intArrayOf(x1 - 1, y1)) queue.offer(intArrayOf(x1, y1 + 1)) queue.offer(intArrayOf(x1, y1 - 1)) } } } } return step }} Java å®ç°class Solution { public int numIslands(char[][] grid) { if (grid == null || grid.length == 0) { return 0; } int row = grid.length; int colum = grid[0].length; Queue&lt;int[]&gt; queue = new LinkedList&lt;&gt;(); int step = 0; for (int i = 0; i &lt; row; i++) { for (int j = 0; j &lt; colum; j++) { if (grid[i][j] == '1') { queue.offer(new int[]{i, j}); step++; while (!queue.isEmpty()) { int[] tmp = queue.poll(); int x1 = tmp[0]; int y1 = tmp[1]; if (x1 &lt; 0 || x1 &gt;= row || y1 &lt; 0 || y1 &gt;= colum || grid[x1][y1] == '0') { continue; } grid[x1][y1] = '0'; queue.offer(new int[]{x1 + 1, y1}); queue.offer(new int[]{x1 - 1, y1}); queue.offer(new int[]{x1, y1 + 1}); queue.offer(new int[]{x1, y1 - 1}); } } } } return step; }} æ€è·¯äºŒï¼šæ·±åº¦ä¼˜å…ˆæœç´¢DFS: æ·±åº¦ä¼˜å…ˆæœç´¢ç®—æ³•ï¼ˆDepth-First-Searchï¼‰ï¼Œæ˜¯æœç´¢ç®—æ³•çš„ä¸€ç§, å®ƒæ²¿ç€æ ‘çš„æ·±åº¦éå†æ ‘çš„èŠ‚ç‚¹ï¼Œå°½å¯èƒ½æ·±çš„æœç´¢æ ‘çš„åˆ†æ”¯ã€‚ é€’å½’çš„ä¸¤ä¸ªç‰¹ç‚¹ï¼š é—®é¢˜å’Œå­é—®é¢˜éƒ½ä¼šè°ƒç”¨å‡½æ•°è‡ªèº«ï¼Œæ‰€ä»¥è¦æ‰¾å¯»é—®é¢˜ä¸å­é—®é¢˜çš„é€’å½’å…³ç³»ï¼Œé‡‡ç”¨è‡ªä¸Šè€Œä¸‹çš„æ€è€ƒæ–¹å¼ã€‚ æœ‰ä¸ªç»ˆæ­¢æ¡ä»¶ï¼ˆä¸´ç•Œç‚¹ï¼‰ç»“æŸå½“å‰é€’å½’ã€‚ å‚æ•°è¯´æ˜ï¼š grid è¡¨ç¤ºä¸€ä¸ªäºŒç»´ç½‘æ ¼ ç”¨ i è¡¨ç¤ºè¡Œçš„ä¸‹æ ‡ï¼Œj è¡¨ç¤ºåˆ—çš„ä¸‹æ ‡ x1 è¡¨ç¤ºå½“å‰æ‰€åœ¨çš„æ ¼å­çš„æ¨ªåæ ‡ y1 è¡¨ç¤ºå½“å‰æ‰€åœ¨çš„æ ¼å­çš„çºµåæ ‡ ç»ˆæ­¢æ¡ä»¶ï¼š æ˜¯å¦åœ¨å•å…ƒæ ¼å†…ï¼ˆx &gt;= row æˆ–è€… y &gt;= columï¼‰ã€‚ å¦‚æœå½“å‰æ ¼å­å·²ç»è®¿é—®è¿‡äº†ï¼Œæ»¡è¶³äº grid[x1][y1] == '0' ç®—æ³•è¿‡ç¨‹ï¼š éå†æ•´ä¸ªç½‘æ ¼ ä»åæ ‡ [0, 0] å¼€å§‹è¿›è¡Œæ·±åº¦ä¼˜å…ˆæœç´¢ï¼Œåœ¨æ·±åº¦ä¼˜å…ˆæœç´¢çš„è¿‡ç¨‹ä¸­ï¼Œæ¯ä¸ªæœç´¢åˆ°çš„ 1 éƒ½ä¼šè¢«é‡æ–°æ ‡è®°ä¸º 0 å²›å±¿çš„æ•°é‡å°±æ˜¯è¿›è¡Œæ·±åº¦ä¼˜å…ˆæœç´¢çš„æ¬¡æ•° Kotlinclass Solution { fun numIslands(grid: Array&lt;CharArray&gt;): Int { if (grid.size == 0) { return 0; } var step = 0; val row = grid.size val colum = grid[0].size for (i in 0 until row) { for (j in 0 until colum) { if (grid[i][j] == '1') { step = step + 1 dfs(i, j, row, colum, grid) } } } return step } fun dfs(x1: Int, y1: Int, row: Int, colum: Int, grid: Array&lt;CharArray&gt;) { if (x1 &lt; 0 || x1 &gt;= row || y1 &lt; 0 || y1 &gt;= colum || grid[x1][y1] == '0') { return; } grid[x1][y1] = '0' dfs(x1 + 1, y1, row, colum, grid) dfs(x1 - 1, y1, row, colum, grid) dfs(x1, y1 + 1, row, colum, grid) dfs(x1, y1 - 1, row, colum, grid) }} Javaclass Solution { public int numIslands(char[][] grid) { if (grid == null || grid.length == 0) { return 0; } int row = grid.length; int colum = grid[0].length; int step = 0; for (int i = 0; i &lt; row; i++) { for (int j = 0; j &lt; colum; j++) { if (grid[i][j] == '1') { step++; dfs(i, j, row, colum, grid); } } } return step; } void dfs(int x1, int y1, int row, int colum, char[][] grid) { if (x1 &lt; 0 || x1 &gt;= row || y1 &lt; 0 || y1 &gt;= colum || grid[x1][y1] == '0') { return; } grid[x1][y1] = '0'; dfs(x1 + 1, y1, row, colum, grid); dfs(x1 - 1, y1, row, colum, grid); dfs(x1, y1 + 1, row, colum, grid); dfs(x1, y1 - 1, row, colum, grid); }}","link":"/2020/07/31/LeetCode/search/01-number-of-islands/"},{"title":"LeetCode å­—ç¬¦ä¸²ï¼šæ— é‡å¤å­—ç¬¦çš„æœ€é•¿å­ä¸²","text":"é¢˜ç›®æ¥æºäº LeetCode ä¸Š ç¬¬ 3 å·é—®é¢˜ï¼šæœ€é•¿å…¬å…±å‰ç¼€ã€‚é¢˜ç›®éš¾åº¦ä¸º Mediumã€‚ è‹±æ–‡åœ°å€ï¼šhttps://leetcode-cn.com/problems/longest-substring-without-repeating-characters/ ä¸­æ–‡åœ°å€ï¼šhttps://leetcode.com/problems/longest-substring-without-repeating-characters/ é¢˜ç›®æè¿°ç»™å®šä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œè¯·ä½ æ‰¾å‡ºå…¶ä¸­ä¸å«æœ‰é‡å¤å­—ç¬¦çš„ æœ€é•¿å­ä¸² çš„é•¿åº¦ã€‚ ç¤ºä¾‹ 1ï¼š è¾“å…¥: &quot;abcabcbb&quot;è¾“å‡º: 3 è§£é‡Š: å› ä¸ºæ— é‡å¤å­—ç¬¦çš„æœ€é•¿å­ä¸²æ˜¯ &quot;abc&quot;ï¼Œæ‰€ä»¥å…¶é•¿åº¦ä¸º 3ã€‚ ç¤ºä¾‹ 2ï¼š è¾“å…¥: &quot;pwwkew&quot;è¾“å‡º: 3è§£é‡Š: å› ä¸ºæ— é‡å¤å­—ç¬¦çš„æœ€é•¿å­ä¸²æ˜¯ &quot;wke&quot;ï¼Œæ‰€ä»¥å…¶é•¿åº¦ä¸º 3ã€‚ è¯·æ³¨æ„ï¼Œä½ çš„ç­”æ¡ˆå¿…é¡»æ˜¯ å­ä¸² çš„é•¿åº¦ï¼Œ&quot;pwke&quot; æ˜¯ä¸€ä¸ªå­åºåˆ—ï¼Œä¸æ˜¯å­ä¸²ã€‚ æ€è·¯ï¼šæ»‘åŠ¨çª—å£ä»€ä¹ˆæ˜¯æ»‘åŠ¨çª—å£ï¼Ÿ åœ¨å­—ç¬¦ä¸² s ä¸­ä½¿ç”¨å·¦å³æŒ‡é’ˆï¼Œå·¦æŒ‡é’ˆ leftï¼Œå³æŒ‡é’ˆ rightï¼Œåˆå§‹åŒ– left = right = 0ï¼Œä¸æ–­å¢åŠ  right æ‰©å¤§çª—å£å¤§å°ï¼Œæ»¡è¶³ä¸€å®šæ¡ä»¶çš„æ—¶å€™ï¼Œleft å‘å³ç§»åŠ¨ç¼©å°çª—å£ï¼Œè¡¨ç¤º å¼€å§‹æšä¸¾ä¸‹ä¸€ä¸ªå­—ç¬¦ä½œä¸ºèµ·å§‹ä½ç½®ã€‚ ç®—æ³•æµç¨‹å¦‚ä¸‹ï¼š ä»¥ç¤ºä¾‹ä¸€ä¸­çš„å­—ç¬¦ä¸² abcabcbb ä¸ºä¾‹ï¼Œä»æ¯ä¸€ä¸ªå­—ç¬¦å¼€å§‹çš„ï¼Œä¸åŒ…å«é‡å¤å­—ç¬¦çš„æœ€é•¿å­ä¸²ï¼Œåˆ—ä¸¾å‡ºæ‰€æœ‰çš„å¯èƒ½æ€§ï¼Œå…¶ä¸­æ‹¬å·ä¸­è¡¨ç¤ºé€‰ä¸­çš„å­—ç¬¦ä»¥åŠæœ€é•¿çš„å­—ç¬¦ä¸²ï¼š ä»¥ (a)bcabcbb å¼€å§‹çš„æœ€é•¿å­—ç¬¦ä¸²ä¸º (abc)abcbb ä»¥ a(b)cabcbb å¼€å§‹çš„æœ€é•¿å­—ç¬¦ä¸²ä¸º a(bca)bcbb ä»¥ a(b)cabcbb å¼€å§‹çš„æœ€é•¿å­—ç¬¦ä¸²ä¸º a(bca)bcbb ä»¥ abc(a)bcbb å¼€å§‹çš„æœ€é•¿å­—ç¬¦ä¸²ä¸º abc(abc)bb ä»¥ abca(b)cbb å¼€å§‹çš„æœ€é•¿å­—ç¬¦ä¸²ä¸º abca(bc)bb ä»¥ abcab(c)bb å¼€å§‹çš„æœ€é•¿å­—ç¬¦ä¸²ä¸º abcab(cb)b ä»¥ abcabc(b)b å¼€å§‹çš„æœ€é•¿å­—ç¬¦ä¸²ä¸º abcabc(b)b ä»¥ abcabcb(b) å¼€å§‹çš„æœ€é•¿å­—ç¬¦ä¸²ä¸º abcabcb(b) è§‚å¯Ÿè§„å¾‹ï¼Œå½“å³æŒ‡é’ˆå‡ºç°é‡å¤å­—ç¬¦çš„æ—¶å€™ï¼Œæ›´æ”¹äº†å·¦æŒ‡é’ˆçš„èµ·å§‹ä½ç½®ï¼Œç»§ç»­ä¸æ–­çš„å¾ªç¯ä¸‹å»ï¼Œç›´åˆ°æ‰€æœ‰å­—ç¬¦éƒ½æ¯”è¾ƒå®Œï¼Œæ»¡è¶³ æ»‘åŠ¨çª—å£ çš„å®šä¹‰ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ æ»‘åŠ¨çª—å£ æ¥è§£å†³è¿™ä¸ªé—®é¢˜ï¼š æ£€æŸ¥å½“å‰æ•°ç»„é•¿åº¦æ˜¯å¦ä¸º 0 ï¼Œå¦‚æœæ˜¯åˆ™è¿”å›ç©ºå­—ç¬¦ä¸² &quot;&quot; å·¦æŒ‡é’ˆ leftï¼Œå³æŒ‡é’ˆ rightï¼Œåˆå§‹åŒ– left = right = 0 ä¸æ–­å¢åŠ  right æ‰©å¤§çª—å£å¤§å°ï¼Œç›´åˆ°å³ä¾§å‡ºç°äº†é‡å¤å­—ç¬¦ä¸ºæ­¢ ç§»é™¤å·¦æŒ‡é’ˆæŒ‡å‘çš„å…ƒç´ ï¼Œå¹¶å°†å·¦æŒ‡é’ˆå‘å³ç§»åŠ¨ä¸€æ ¼ï¼Œè¡¨ç¤º å¼€å§‹æšä¸¾ä¸‹ä¸€ä¸ªå­—ç¬¦ä½œä¸ºèµ·å§‹ä½ç½® ä¸æ–­é‡å¤ 3ã€4 ç›´åˆ°æ‰€æœ‰å­—ç¬¦éƒ½æ¯”è¾ƒå®Œ å¦‚ä½•åˆ¤æ–­é‡å¤å­—ç¬¦ å¯ä»¥ä½¿ç”¨ HashSet æˆ–è€… HashMap æ¥åˆ¤æ–­æ˜¯å¦å‡ºç°é‡å¤å­—ç¬¦ï¼ŒHashSet å’Œ HashMap é‡‡ç”¨çš„æ—¶å€™å“ˆå¸Œç®—æ³•ï¼Œæ—¶é—´å¤æ‚åº¦ 0(1)ã€‚ å¤æ‚åº¦åˆ†æï¼š æ—¶é—´å¤æ‚åº¦ï¼š0(n) ï¼Œn æ˜¯å­—ç¬¦ä¸²çš„é•¿åº¦ï¼Œä¼šå°†æ•´ä¸ªå­—ç¬¦ä¸²éå†ä¸€æ¬¡ ç©ºé—´å¤æ‚åº¦ï¼šO(âˆ£Î£âˆ£)ï¼Œä½¿ç”¨å“ˆå¸Œé›†åˆæ¥å­˜å‚¨å‡ºç°è¿‡çš„å­—ç¬¦ï¼Œâˆ£Î£âˆ£ è¡¨ç¤ºå­—ç¬¦ä¸²ä¸­æœ€å¤šå¯ä»¥å‡ºç°çš„å­—ç¬¦çš„ä¸ªæ•° Java å®ç°class Solution { /** * æ–¹æ³•ä¸€ï¼šæ»‘åŠ¨çª—å£ hashSet * * @param s * @return */ public int lengthOfLongestSubstring(String s) { if (s == null || s.length() &lt;= 0) { return 0; } int r = 0; int count = 0; int len = s.length(); Set&lt;Character&gt; hashSet = new HashSet&lt;Character&gt;(); for (int i = 0; i &lt; len; i++) { if (i != 0) { hashSet.remove(s.charAt(i - 1)); } while (r &lt; len &amp;&amp; !hashSet.contains(s.charAt(r))) { hashSet.add(s.charAt(r)); r++; } count = Math.max(count, r - i); } return count; } /** * æ–¹æ³•äºŒï¼šæ»‘åŠ¨çª—å£ hashMap * * @param s * @return */ public int lengthOfLongestSubstring2(String s) { if (s == null || s.length() &lt;= 0) { return 0; } int left = 0; int count = 0; int len = s.length(); Map&lt;Character, Integer&gt; hashMap = new HashMap&lt;Character, Integer&gt;(); for (int i = 0; i &lt; len; i++) { if (hashMap.containsKey(s.charAt(i))) { left = Math.max(left, hashMap.get(s.charAt(i)) + 1); } hashMap.put(s.charAt(i), i); count = Math.max(count, i - left + 1); } return count; }} Kotlin å®ç°class Solution { // æ–¹æ³•ä¸€ï¼šæ»‘åŠ¨çª—å£ hashSet fun lengthOfLongestSubstring(s: String): Int { val len = s.length if (len &lt;= 0) return 0 var r = 0 var count = 0 val hashSet = mutableSetOf&lt;Char&gt;() for (i in 0 until len) { if (i != 0) { hashSet.remove(s[i - 1]) } while (r &lt; len &amp;&amp; !hashSet.contains(s[r])) { hashSet.add(s[r]) r++ } count = Math.max(count, r - i) } return count } // æ–¹æ³•äºŒï¼šæ»‘åŠ¨çª—å£ hashMap fun lengthOfLongestSubstring2(s: String): Int { val len = s.length; if (len == 0) { return 0 } var left = 0 var count = 0 val map = mutableMapOf&lt;Char, Int&gt;() for (i in 0 until len) { if (map.containsKey(s[i])) { left = Math.max(left, map.get(s[i])?.let { it + 1 } ?: left) } map.put(s[i], i) count = Math.max(count, i - left + 1) } return count }}","link":"/2020/07/30/LeetCode/character/02-longest-substring-without-repeating-characters/"},{"title":"LeetCode å­—ç¬¦ä¸²ï¼šæœ€é•¿å…¬å…±å‰ç¼€","text":"é¢˜ç›®æ¥æºäº LeetCode ä¸Š ç¬¬ 14 å·é—®é¢˜ï¼šæœ€é•¿å…¬å…±å‰ç¼€ã€‚é¢˜ç›®éš¾åº¦ä¸º Easyã€‚ è‹±æ–‡åœ°å€ï¼šhttps://leetcode.com/problems/longest-common-prefix/ ä¸­æ–‡åœ°å€ï¼šhttps://leetcode-cn.com/problems/longest-common-prefix/ é¢˜ç›®æè¿°ç¼–å†™ä¸€ä¸ªå‡½æ•°æ¥æŸ¥æ‰¾å­—ç¬¦ä¸²æ•°ç»„ä¸­çš„æœ€é•¿å…¬å…±å‰ç¼€ã€‚ å¦‚æœä¸å­˜åœ¨å…¬å…±å‰ç¼€ï¼Œè¿”å›ç©ºå­—ç¬¦ä¸² &quot;&quot;ã€‚ ç¤ºä¾‹ 1ï¼š è¾“å…¥: [&quot;flower&quot;,&quot;flow&quot;,&quot;flight&quot;]è¾“å‡º: &quot;fl&quot; ç¤ºä¾‹ 2ï¼š è¾“å…¥: [&quot;dog&quot;,&quot;racecar&quot;,&quot;car&quot;]è¾“å‡º: &quot;&quot;è§£é‡Š: è¾“å…¥ä¸å­˜åœ¨å…¬å…±å‰ç¼€ã€‚ è¯´æ˜ï¼š æ‰€æœ‰è¾“å…¥åªåŒ…å«å°å†™å­—æ¯ a-z ã€‚ æ€è·¯ä¸€ï¼šç®—æ³•æµç¨‹å¦‚ä¸‹ï¼š æ£€æŸ¥å½“å‰æ•°ç»„é•¿åº¦æ˜¯å¦ä¸º 0 ï¼Œå¦‚æœæ˜¯åˆ™è¿”å›ç©ºå­—ç¬¦ä¸² &quot;&quot; å‡è®¾ç¬¬ä¸€ä¸ªå­—ç¬¦ä¸²ä¸ºæœ€é•¿å…¬å…±å‰ç¼€ ä»å‰å¾€åéå†æ‰€æœ‰å­—ç¬¦ä¸²çš„æ¯ä¸€åˆ—ï¼Œæ¯”è¾ƒç¬¬ä¸€ä¸ªå­—ç¬¦ä¸²ç›¸åŒåˆ—ä¸Šçš„å­—ç¬¦æ˜¯å¦ç›¸åŒ å¦‚æœç›¸åŒåˆ™ç»§ç»­å¯¹ä¸‹ä¸€åˆ—è¿›è¡Œæ¯”è¾ƒ å¦‚æœä¸ç›¸åŒåˆ™å½“å‰åˆ—ä¸å†å±äºå…¬å…±å‰ç¼€ï¼Œè¿”å›å½“å‰åˆ—ä¹‹å‰çš„éƒ¨åˆ†ä¸ºæœ€é•¿å…¬å…±å‰ç¼€ ä»¥ä¸‹å›¾ç‰‡æ¥è‡ª LeetCode å®˜æ–¹ï¼š å¤æ‚åº¦åˆ†æï¼š æ—¶é—´å¤æ‚åº¦ï¼š0(mn) ï¼Œm æ˜¯å­—ç¬¦ä¸²çš„æ•°é‡ï¼Œ n æ˜¯æ¯ä¸ªå­—ç¬¦ä¸²çš„é•¿åº¦ï¼Œæœ€åçš„æƒ…å†µä¸‹ï¼Œæ¯ä¸ªå­—ç¬¦éƒ½æ¯”è¾ƒä¸€é ç©ºé—´å¤æ‚åº¦ï¼šO(1)ï¼Œä½¿ç”¨äº†ä¸€äº›å˜é‡ï¼Œå å¸¸æ•°å¤§å°çš„ç©ºé—´ Kotlin å®ç°class Solution { fun longestCommonPrefix(strs: Array&lt;String&gt;): String { if (strs.size &lt;= 0) { return &quot;&quot; } val str0 = strs[0] val len = str0.length val count = strs.size for (i in 0 until len) { val c = str0[i] for (j in 1 until count) { if (i == strs[j].length || c != strs[j][i]) { return str0.substring(0, i) } } } return str0 }} Java å®ç°public class Solution { // æ–¹æ³•ä¸€ public String longestCommonPrefix(String[] strs) { if (strs == null || strs.length &lt;= 0) { return &quot;&quot;; } String str0 = strs[0]; int len = str0.length(); int count = strs.length; for (int i = 0; i &lt; len; i++) { char c1 = str0.charAt(i); for (int j = 1; j &lt; count; j++) { if (i == strs[j].length() || c1 != strs[j].charAt(i)) { return str0.substring(0, i); } } } return str0; }} æ€è·¯äºŒï¼šç®—æ³•æµç¨‹å¦‚ä¸‹ï¼š æ£€æŸ¥å½“å‰æ•°ç»„é•¿åº¦æ˜¯å¦ä¸º 0 ï¼Œå¦‚æœæ˜¯åˆ™è¿”å›ç©ºå­—ç¬¦ä¸² &quot;&quot; å‡è®¾ç¬¬ä¸€ä¸ªå­—ç¬¦ä¸²ä¸ºæœ€é•¿å…¬å…±å‰ç¼€ éå†åé¢å­—ç¬¦ä¸²å’Œç¬¬ä¸€ä¸ªå­—ç¬¦ä¸²åšæ¯”è¾ƒ å¦‚æœä¸ç›¸åŒåˆ™é€€å‡ºå¾ªç¯ï¼Œè¿”å›ä¹‹å‰çš„å­—ç¬¦ä¸²ä¸ºæœ€é•¿å…¬å…±å‰ç¼€ å¤æ‚åº¦åˆ†æï¼š æ—¶é—´å¤æ‚åº¦ï¼š0(mn) ï¼Œm æ˜¯å­—ç¬¦ä¸²çš„æ•°é‡ï¼Œ n æ˜¯æ¯ä¸ªå­—ç¬¦ä¸²çš„é•¿åº¦ï¼Œæœ€åçš„æƒ…å†µä¸‹ï¼Œæ¯ä¸ªå­—ç¬¦éƒ½æ¯”è¾ƒä¸€é ç©ºé—´å¤æ‚åº¦ï¼šO(1)ï¼Œä½¿ç”¨äº†ä¸€äº›å˜é‡ï¼Œå å¸¸æ•°å¤§å°çš„ç©ºé—´ Java å®ç°public class Solution { public String longestCommonPrefix(String[] strs) { if (strs == null || strs.length &lt;= 0) { return &quot;&quot;; } int count = strs.length; String str0 = strs[0]; for (int i = 0; i &lt; count; i++) { int j = 0; for (; j &lt; str0.length() &amp;&amp; j &lt; strs[i].length(); j++) { if (str0.charAt(j) != strs[i].charAt(j)) { break; } } str0 = str0.substring(0, j); } return str0; }}","link":"/2020/07/29/LeetCode/character/01-longest-common-prefix/"},{"title":"LeetCode æ•°ç»„ï¼š2020 åŠ›æ‰£æ¯ï¼šæ‹¿ç¡¬å¸","text":"é¢˜ç›®æ¥æºäº 2020 åŠ›æ‰£æ¯ï¼Code Your Future æ˜¥å­£å…¨å›½ç¼–ç¨‹å¤§èµ› 01ï¼šæ‹¿ç¡¬å¸ã€‚é¢˜ç›®éš¾åº¦ä¸º Easyã€‚ ä¸­æ–‡åœ°å€ï¼šhttps://leetcode-cn.com/problems/na-ying-bi/ é¢˜ç›®æè¿°æ¡Œä¸Šæœ‰ n å †åŠ›æ‰£å¸ï¼Œæ¯å †çš„æ•°é‡ä¿å­˜åœ¨æ•°ç»„ coins ä¸­ã€‚æˆ‘ä»¬æ¯æ¬¡å¯ä»¥é€‰æ‹©ä»»æ„ä¸€å †ï¼Œæ‹¿èµ°å…¶ä¸­çš„ä¸€æšæˆ–è€…ä¸¤æšï¼Œæ±‚æ‹¿å®Œæ‰€æœ‰åŠ›æ‰£å¸çš„æœ€å°‘æ¬¡æ•°ã€‚ ç¤ºä¾‹ 1ï¼š è¾“å…¥ï¼š[4,2,1]è¾“å‡ºï¼š4è§£é‡Šï¼šç¬¬ä¸€å †åŠ›æ‰£å¸æœ€å°‘éœ€è¦æ‹¿ 2 æ¬¡ï¼Œç¬¬äºŒå †æœ€å°‘éœ€è¦æ‹¿ 1 æ¬¡ï¼Œç¬¬ä¸‰å †æœ€å°‘éœ€è¦æ‹¿ 1 æ¬¡ï¼Œæ€»å…± 4 æ¬¡å³å¯æ‹¿å®Œã€‚ ç¤ºä¾‹ 2ï¼š è¾“å…¥ï¼š[2,3,10]è¾“å‡ºï¼š8 é™åˆ¶ï¼š 1 &lt;= n &lt;= 41 &lt;= coins[i] &lt;= 10 æ€è·¯æ ¹æ®é¢˜æ„æ¯æ¬¡è‡³å°‘å¯ä»¥æ‹¿ä¸€æšæˆ–è€…ä¸¤æšåŠ›å£å¸ï¼Œæ±‚æ‹¿å®Œæ‰€æœ‰åŠ›æ‰£å¸çš„æœ€å°‘æ¬¡æ•°ï¼Œæ ¹æ®å®ƒçš„é™åˆ¶æ¡ä»¶ 1 &lt;= coins[i] &lt;= 10 åˆ—ä¸¾å¯èƒ½æ€§æ‰¾è§„å¾‹ å½“coins[1]æ—¶ï¼Œç¬¬ä¸€æ¬¡æ‹¿ä¸€æšï¼Œè‡³å°‘1æ¬¡ å½“coins[2]æ—¶ï¼Œç¬¬ä¸€æ¬¡æ‹¿ä¸¤æšï¼Œè‡³å°‘1æ¬¡ å½“coins[3]æ—¶ï¼Œç¬¬ä¸€æ¬¡æ‹¿ä¸¤æšï¼Œç¬¬äºŒæ¬¡æ‹¿ä¸€æšï¼Œè‡³å°‘2æ¬¡ å½“coins[4]æ—¶ï¼Œç¬¬ä¸€æ¬¡æ‹¿ä¸¤æšï¼Œç¬¬äºŒæ¬¡æ‹¿ä¸¤æšï¼Œè‡³å°‘2æ¬¡ å½“coins[5]æ—¶ï¼Œç¬¬ä¸€æ¬¡æ‹¿ä¸¤æšï¼Œç¬¬äºŒæ¬¡æ‹¿ä¸¤æšï¼Œç¬¬ä¸‰æ¬¡æ‹¿ä¸€æšï¼Œè‡³å°‘3æ¬¡ å½“coins[6]æ—¶ï¼Œç¬¬ä¸€æ¬¡æ‹¿ä¸¤æšï¼Œç¬¬äºŒæ¬¡æ‹¿ä¸¤æšï¼Œç¬¬ä¸‰æ¬¡æ‹¿ä¸¤æšï¼Œè‡³å°‘3æ¬¡ â€¦â€¦ ç»¼åˆä»¥ä¸Šæƒ…å†µï¼Œå¯ä»¥å‘ç°å½“ i ä¸ºå¶æ•°æ—¶ï¼Œè‡³å°‘æ¬¡æ•° = i/2ï¼Œå½“ i ä¸ºå¥‡æ•°æ—¶ï¼Œè‡³å°‘æ¬¡æ•° = i/2 + i%2ï¼Œä»£ç å¦‚ä¸‹ï¼š Javaå®ç°class Solution { public int minCount(int[] coins) { int sum = 0; for (int i = 0; i &lt; coins.length; i++) { sum += coins[i] / 2; if (coins[i] % 2 != 0) { sum += 1; } } return sum; }} Koltinå®ç°class Solution { fun minCount(coins: IntArray): Int { var sum = 0 coins.forEach { value -&gt; sum += value / 2 if (value % 2 != 0) sum += 1 } return sum }}","link":"/2020/06/28/LeetCode/2020code/01-na-ying-bi/"},{"title":"LeetCode æ•°ç»„ï¼šä¸¤æ•°ä¹‹å’Œ2 - è¾“å…¥æ•°ç»„æœ‰åº","text":"é¢˜ç›®æ¥æºäº LeetCode ä¸Šç¬¬ 167å·ï¼ˆTwo Sum II - Input array is sortedï¼‰é—®é¢˜ï¼šä¸¤æ•°ä¹‹å’Œ2 - è¾“å…¥æ•°ç»„æœ‰åºã€‚é¢˜ç›®éš¾åº¦ä¸º Easyã€‚ è‹±æ–‡åœ°å€ï¼šhttps://leetcode.com/problems/two-sum-ii-input-array-is-sorted/ ä¸­æ–‡åœ°å€ï¼šhttps://leetcode-cn.com/problems/two-sum-ii-input-array-is-sorted/ é¢˜ç›®æè¿°Given an array of integers that is already sorted in ascending order, find two numbers such that they add up to a specific target number. The function twoSum should return indices of the two numbers such that they add up to the target, where index1 must be less than index2. Note: Your returned answers (both index1 and index2) are not zero-based. You may assume that each input would have exactly one solution and you may not use the same element twice. ç¤ºä¾‹ï¼š Input: numbers = [2,7,11,15], target = 9Output: [1,2]Explanation: 2 ä¸ 7 ä¹‹å’Œç­‰äºç›®æ ‡æ•° 9 ã€‚å› æ­¤ index1 = 1, index2 = 2 æ€è·¯ä¸€ï¼šå·¦å³æŒ‡é’ˆæ³•åˆå§‹åŒ–å·¦æŒ‡é’ˆlowæŒ‡å‘æ•°ç»„èµ·å§‹ä½ç½®ï¼Œå³æŒ‡é’ˆheightæŒ‡å‘æ•°ç»„ç»“æŸä½ç½®ï¼Œæ—¶é—´å¤æ‚åº¦o(n) å¦‚æœnumbers[low] å’Œ numbers[height]çš„å’Œsumç­‰äºtargetï¼Œè¿”å›low+,height+1 å¦‚æœnumbers[low] å’Œ numbers[height]çš„å’Œsumå°äºtargetï¼Œåˆ™low++ å¦‚æœnumbers[low] å’Œ numbers[height]çš„å’Œsumå¤§äºtargetï¼Œåˆ™heightâ€“ Javaå®ç°public class Solution { public int[] twoSum(int[] numbers, int target) { int low = 0; int height = numbers.length - 1; while (low &lt; height) { int sum = numbers[low] + numbers[height]; if (sum == target) { return new int[]{low + 1, height + 1}; } else if (sum &lt; target) { low++; } else { height--; } } return new int[2]; }} Kotlinå®ç°class Solution { fun twoSum(numbers: IntArray, target: Int): IntArray { var height = numbers.size - 1 var low = 0; while (low &lt; height) { val sum = numbers[low] + numbers[height] when { sum == target -&gt; return intArrayOf(low + 1, height + 1) sum &lt; target -&gt; low++ else -&gt; height-- } } return intArrayOf() }} æ€è·¯äºŒï¼šäºŒåˆ†æ³•æŸ¥æ‰¾é¢˜ç›®å¯çŸ¥æ‰¾ä¸¤ä¸ªæ•°ä¹‹å’Œ a+b = tagetï¼Œå¾ªç¯æ•°ç»„æ¯ä¸€ä¸ªå…ƒç´ a, ä»å‰©ä½™çš„å…ƒç´ é‡Œé¢ç”¨äºŒåˆ†æ³•æŸ¥æ‰¾å¦å¤–ä¸€ä¸ªå…ƒç´  b= taget-a å³å¯ï¼Œæ—¶é—´å¤æ‚åº¦ä¸ºo(nlogn) å¾ªç¯æ¯ä¸ªå…ƒç´ a ä»å‰©ä½™å…ƒç´ ç”¨äºŒåˆ†æ³•æŸ¥æ‰¾å…ƒç´ b = taget-aï¼Œè¿”å›ç´¢å¼•idnex, å¦‚æœindex ==-1 ï¼Œåˆ™æ— ç»“æœè¿”å›ï¼Œå¦‚æœindex!=-1ï¼Œåˆ™ç›´æ¥è¿”å›a+1,index+1 Javaå®ç°public class Solution { public int[] twoSum(int[] numbers, int target) { for (int a = 0; a &lt; numbers.length; a++) { int index = binarySearch(numbers, a + 1, target - numbers[a]); if (index != -1) return new int[]{a + 1, index + 1}; } return new int[2]; } public int binarySearch(int[] numbers, int start, int target) { int low = start; int height = numbers.length - 1; while (low &lt;= height) { int mind = (low + height) &gt;&gt;&gt; 1; if (numbers[mind] == target) return mind; if (numbers[mind] &lt; target) low = mind + 1; if (numbers[mind] &gt; target) height = mind - 1; } return -1; }} kotlin å®ç°class Solution { fun twoSum(numbers: IntArray, target: Int): IntArray { numbers.forEachIndexed { i, value -&gt; val index = binarySearch(numbers, i + 1, target - value) if (index != -1) { return intArrayOf(i + 1, index + 1) } } return intArrayOf() } fun binarySearch(numbers: IntArray, start: Int, target: Int): Int { var low = start var height = numbers.size - 1 while (low &lt;= height) { val mind = (low + height) ushr 1 when { numbers[mind] == target -&gt; return mind numbers[mind] &lt; target -&gt; low = mind + 1 else -&gt; height = mind - 1 } } return -1 }}","link":"/2020/06/28/LeetCode/arrays/01-two-sum-ii-input-array-is-sorted/"},{"title":"LeetCode äºŒå‰æ ‘ï¼šåˆ¤æ–­ä¸¤æ£µäºŒå‰æ ‘æ˜¯å¦ç»“æ„ç›¸åŒ","text":"é¢˜ç›®æ¥æºäº LeetCode ä¸Šç¬¬ 100å·ï¼ˆsame-treeï¼‰é—®é¢˜ï¼šåˆ¤æ–­ä¸¤æ£µäºŒå‰æ ‘æ˜¯å¦ç»“æ„ç›¸åŒã€‚é¢˜ç›®éš¾åº¦ä¸º Easyã€‚ è‹±æ–‡åœ°å€ï¼šhttps://leetcode.com/problems/same-tree/ ä¸­æ–‡åœ°å€ï¼šhttps://leetcode-cn.com/problems/same-tree/ é¢˜ç›®æè¿°Given two binary trees, write a function to check if they are the same or not. Two binary trees are considered the same if they are structurally identical and the nodes have the same value. Example 1: Input: 1 1 / \\ / \\ 2 3 2 3 [1,2,3], [1,2,3]Output: true Example 2: Input: 1 1 / \\ 2 2 [1,2], [1,null,2]Output: false æ€è·¯ä¸€ï¼šéé€’å½’ä¸¤æ£µäºŒå‰æ ‘ç»“æ„ç›¸åŒï¼Œéœ€è¦æ»¡è¶³ä»¥ä¸‹æ¡ä»¶ï¼š äºŒå‰æ ‘ç»“æ„ç›¸åŒ äºŒå‰æ ‘å¯¹åº”èŠ‚ç‚¹å€¼ç›¸åŒ æ ¹æ®å±‚æ¬¡éå†ç®—æ³•ï¼Œè®¿é—®æ¯ä¸€ä¸ªèŠ‚ç‚¹ï¼Œæ£€æŸ¥æ¯ä¸ªèŠ‚ç‚¹æ˜¯å¦ç›¸åŒï¼Œæ ¸å¿ƒç®—æ³•å¦‚ä¸‹ï¼š if (p == null &amp;&amp; q == null) { continue;}if (p == null || q == null) { return false;}if (p.val != q.val) { return false;} Javaå®ç°class Solution { public boolean isSameTree(TreeNode p, TreeNode q) { if (p == null &amp;&amp; q == null) { return true; } if (p == null || q == null) { return false; } Queue&lt;TreeNode&gt; pWrapQueue = new LinkedList&lt;&gt;(); Queue&lt;TreeNode&gt; qWrapQueue = new LinkedList(); pWrapQueue.offer(p); qWrapQueue.offer(q); while (!pWrapQueue.isEmpty() &amp;&amp; !qWrapQueue.isEmpty()) { TreeNode pNode = pWrapQueue.poll(); TreeNode qNode = qWrapQueue.poll(); if (pNode == null &amp;&amp; qNode == null) { continue; } if (pNode == null || qNode == null) { return false; } if (pNode.val != qNode.val) { return false; } pWrapQueue.offer(pNode.left); qWrapQueue.offer(qNode.left); pWrapQueue.offer(pNode.right); qWrapQueue.offer(qNode.right); } return pWrapQueue.size() == qWrapQueue.size(); }} Koltinå®ç°class Solution { fun isSameTree(p: TreeNode?, q: TreeNode?): Boolean { if (p == null &amp;&amp; q == null) { return true } if (p == null || q == null) { return false } val pWrapQueue = LinkedList&lt;TreeNode&gt;() val qWrapQueue = LinkedList&lt;TreeNode&gt;() pWrapQueue.offer(p) qWrapQueue.offer(q) while (!pWrapQueue.isEmpty() &amp;&amp; !qWrapQueue.isEmpty()) { val pNode = pWrapQueue.poll() val qNode = qWrapQueue.poll() if (pNode == null &amp;&amp; qNode == null) { continue; } if (pNode == null || qNode == null) { return false; } if (pNode.`val` != qNode.`val`) { return false; } pWrapQueue.offer(pNode.left) pWrapQueue.offer(pNode.right) qWrapQueue.offer(qNode.left) qWrapQueue.offer(qNode.right) } return pWrapQueue.size == qWrapQueue.size }} æ€è·¯äºŒï¼šé€’å½’Javaå®ç°class Solution { public boolean isSameTree(TreeNode p, TreeNode q) { if (p == null &amp;&amp; q == null) { return true; } if (p == null || q == null) { return false; } if (p.val == q.val) { return isSameTree(p.left, q.left) &amp;&amp; isSameTree(p.right, q.right); } return false; }} Koltinå®ç°class Solution { tailrec fun isSameTree(p: TreeNode?, q: TreeNode?): Boolean { if (p == null &amp;&amp; q == null) { return true } if (p == null || q == null) { return false } if (p.`val` == q.`val`) { return isSameTree(p.left, q.left) &amp;&amp; isSameTree(p.right, q.right) } return false }}","link":"/2020/06/28/LeetCode/binary-tree/11-same-tree/"},{"title":"LeetCode äºŒå‰æ ‘ï¼šæ±‚äºŒå‰æ ‘ä¸­çš„èŠ‚ç‚¹ä¸ªæ•°","text":"é¢˜ç›®æ¥æºäº LeetCode ä¸Šç¬¬ 222 å·ï¼ˆ Count Complete Tree Nodesï¼‰é—®é¢˜ï¼šæ±‚äºŒå‰æ ‘ä¸­çš„èŠ‚ç‚¹ä¸ªæ•°ã€‚é¢˜ç›®éš¾åº¦ä¸º Mediumã€‚ è‹±æ–‡åœ°å€ï¼šhttps://leetcode.com/problems/count-complete-tree-nodes/ ä¸­æ–‡åœ°å€ï¼šhttps://leetcode-cn.com/problems/count-complete-tree-nodes/ é¢˜ç›®æè¿°Given a complete binary tree, count the number of nodes. Note: Definition of a complete binary tree from Wikipedia:In a complete binary tree every level, except possibly the last, is completely filled, and all nodes in the last level are as far left as possible. It can have between 1 and 2h nodes inclusive at the last level h. Example: Input: 1 / \\ 2 3 / \\ /4 5 6Output: 6 æ€è·¯ä¸€ï¼šDFSå‡è®¾æ¯ä¸ªèŠ‚ç‚¹éƒ½æ ‡è®°ä¸º1ï¼Œç©ºèŠ‚ç‚¹æ ‡è®°ä¸º0ï¼Œå°†æ¯ä¸ªèŠ‚ç‚¹çš„å’Œç´¯åŠ èµ·æ¥å³å¯ Javaå®ç°class Solution { public int countNodes(TreeNode root) { if (root == null) { return 0; } return countNodes(root.left) + countNodes(root.right) + 1; }} Koltinå®ç°class Solution { private tailrec fun countNodes(root: TreeNode?): Int { if (root == null) { return 0 } return countNodes(root.left) + countNodes(root.right) + 1 } } æ€è·¯äºŒï¼šBFSå‡è®¾æ¯ä¸ªèŠ‚ç‚¹éƒ½æ ‡è®°ä¸º1ï¼Œç©ºèŠ‚ç‚¹æ ‡è®°ä¸º0ï¼Œæ ¹æ®å‰åºã€ä¸­åºã€ååºã€å±‚æ¬¡éå†è®¿é—®æ¯ä¸ªèŠ‚ç‚¹ï¼Œé‡åˆ°ä¸ä¸ºç©ºçš„èŠ‚ç‚¹+1ï¼Œå±‚æ¬¡éå†ç®—æ³•å¦‚ä¸‹ï¼Œå‰åºã€ä¸­åºã€ååºéå†åŸç†ç›¸åŒ Javaå®ç°class Solution { public int countNodes(TreeNode root) { if (root == null) { return 0; } Queue&lt;TreeNode&gt; queue = new LinkedList&lt;&gt;(); queue.offer(root); int count = 0; while (!queue.isEmpty()) { count++; TreeNode node = queue.poll(); if (node.left != null) { queue.offer(node.left); } if (node.right != null) { queue.offer(node.right); } } return count; }} Koltinå®ç°class Solution { fun countNodes(root: TreeNode?): Int { var count = 0 root?.let { it -&gt; val queue = LinkedList&lt;TreeNode&gt;() queue.offer(root) while (!queue.isEmpty()) { count++ val node = queue.poll() if (node.left != null) { queue.offer(node.left) } if (node.right != null) { queue.offer(node.right) } } } return count }} æ‰©å±•é¢˜ç›®1. æ±‚äºŒå‰æ ‘ä¸­ç¬¬Kå±‚ç»“ç‚¹çš„ä¸ªæ•°æ„å»ºä¸€æ£µäºŒå‰æ ‘ï¼ˆä¸ä¸€å®šæ˜¯äºŒå‰æŸ¥æ‰¾æ ‘ï¼‰ï¼Œæ±‚å‡ºè¯¥äºŒå‰æ ‘ä¸­ç¬¬Kå±‚ä¸­çš„ç»“ç‚¹ä¸ªæ•°ï¼ˆæ ¹ç»“ç‚¹ä¸ºç¬¬0å±‚ï¼‰ ä»£ç å¦‚ä¸‹ class Solution { public int countLevelNodes(TreeNode root, int k) { if (root == null || k &lt;= 0) { return 0; } if (k == 1) { return 1; } return countLevelNodes(root.left, k - 1) + countLevelNodes(root.right, k - 1); }} 2. æ±‚äºŒå‰æ ‘ç¬¬Kå±‚çš„å¶å­èŠ‚ç‚¹ä¸ªæ•°ä»£ç å¦‚ä¸‹ï¼š class Solution { public int countLevelNodes(TreeNode root, int k) { if (root == null || k &lt;= 0) { return 0; } if (k == 1) { if (root.left != null &amp;&amp; root.right != null) { return 1; } else { return 0; } } return countLevelNodes(root.left, k - 1) + countLevelNodes(root.right, k - 1); }}","link":"/2020/06/28/LeetCode/binary-tree/10-count-complete-tree-nodes/"},{"title":"LeetCode äºŒå‰æ ‘ï¼šè‡ªä¸‹è€Œä¸Šåˆ†å±‚éå†","text":"é¢˜ç›®æ¥æºäº LeetCode ä¸Šç¬¬ 107 å·ï¼ˆBinary Tree Level Order Traversal IIï¼‰é—®é¢˜ï¼šè‡ªä¸‹è€Œä¸Šåˆ†å±‚éå†ã€‚é¢˜ç›®éš¾åº¦ä¸º Easyã€‚ è‹±æ–‡åœ°å€ï¼šhttps://leetcode.com/problems/binary-tree-level-order-traversal-ii/ ä¸­æ–‡åœ°å€ï¼šhttps://leetcode-cn.com/problems/binary-tree-level-order-traversal-ii/ é¢˜ç›®æè¿°Given a binary tree, return the bottom-up level order traversal of its nodesâ€™ values. (ie, from left to right, level by level from leaf to root). Example: Given binary tree [3,9,20,null,null,15,7], 3 / \\9 20 / \\ 15 7 return its bottom-up level order traversal as: [ [15,7], [9,20], [3]] æ€è·¯ä¸€ï¼šBFSBFS: å¹¿åº¦ä¼˜å…ˆæœç´¢ç®—æ³•ï¼ˆBreadth-First-Searchï¼‰ï¼Œæ˜¯ä¸€ç§å›¾å½¢æœç´¢ç®—æ³•ï¼Œä»æ ¹èŠ‚ç‚¹å¼€å§‹ï¼Œæ²¿ç€æ ‘(å›¾)çš„å®½åº¦éå†æ ‘(å›¾)çš„èŠ‚ç‚¹ï¼Œå¦‚æœæ‰€æœ‰èŠ‚ç‚¹å‡è¢«è®¿é—®ï¼Œåˆ™ç®—æ³•ä¸­æ­¢ äºŒå‰æ ‘çš„è‡ªä¸‹è€Œä¸Šåˆ†å±‚éå†ï¼Œå’Œå±‚æ¬¡éå†ç›¸åŒï¼Œåªä¸è¿‡åœ¨æ·»åŠ æ•°æ®çš„æ—¶å€™ï¼Œé€†åºæ·»åŠ ï¼Œå…·ä½“æ­¥éª¤å¦‚ä¸‹ï¼š æ–°å»ºä¸€ä¸ª queueï¼Œç”¨æ¥å­˜å‚¨è®¿é—®çš„æ¯ä¸ªèŠ‚ç‚¹ æ–°å»ºä¸€ä¸ª wrapList é›†åˆï¼Œä¿å­˜æ¯å±‚çš„æ•°æ® å¾ªç¯åˆ¤æ–­é˜Ÿåˆ—æ˜¯å¦ä¸ºç©ºï¼Œå¦‚æœé˜Ÿåˆ—ä¸ºç©ºå³å¾ªç¯ç»ˆæ­¢ è·å–æ¯ä¸€å±‚çš„æ•°æ®çš„é•¿åº¦ï¼Œå°†æ•°æ®ä¿å­˜åˆ° subList ä¸­ éå†æ¯å±‚æ•°æ®æ—¶ï¼Œå°†ä¸‹ä¸€å±‚çš„èŠ‚ç‚¹ä¿å­˜åˆ° queue ä¸­ æ¯å±‚éå†ç»“æŸï¼Œå°†å½“å‰å±‚ subList æ•°æ® é€†åºæ·»åŠ åˆ° wrapListï¼Œå¦‚ï¼šwrapList.add(0, subList); å†æ¬¡æ‰§è¡Œ3~6ï¼Œç›´åˆ° queue ä¸ºç©ºå³ç»“æŸå¾ªç¯ æ³¨æ„ï¼š æ¯ç§ Queue æ–¹æ³•å­˜åœ¨ä¸¤ç§å½¢å¼ï¼š å¦‚æœæ“ä½œå¤±è´¥ï¼ŒæŠ›å‡ºäº†ä¸€ä¸ªå¼‚å¸¸ å…¶ä»–çš„è¿”å›ä¸€ä¸ªç‰¹æ®Šå€¼ï¼ˆnull æˆ–è€… falseï¼Œå–å†³äºæ“ä½œï¼‰ æ“ä½œç±»å‹ æŠ›å‡ºå¼‚å¸¸ è¿”å›ç‰¹æ®Šå€¼ æ’å…¥ add(e) offer(e) ç§»é™¤ remove() poll() æŸ¥æ‰¾ element() peek() Queue çš„å®ç°å¯ä»¥é™åˆ¶æ‰€æŒæœ‰å…ƒç´ çš„æ•°é‡ï¼Œè¿™æ ·çš„é˜Ÿåˆ—ç§°ä¸ºæœ‰ç•Œï¼Œæœ‰äº› Queue å®ç° java.util.concurrent æ˜¯æœ‰ç•Œçš„ï¼Œä½†å®ç° java.util ä¸æ˜¯ï¼š add ï¼šç»§æ‰¿è‡ª Collectionï¼Œæ’å…¥ä¸€ä¸ªå…ƒç´ ï¼Œé™¤éå®ƒä¼šè¿åé˜Ÿåˆ—çš„å®¹é‡é™åˆ¶ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹æŠ›å‡º IllegalStateException offer ï¼šæ–¹æ³•ä»…ç”¨äºæœ‰ç•Œé˜Ÿåˆ—ï¼Œä¸èƒ½æ’å…¥æ—¶ï¼Œè¿”å› fasle åœ¨ remove ä¸ poll æ–¹æ³•éƒ½æ˜¯ä»é˜Ÿåˆ—ä¸­åˆ é™¤ç¬¬ä¸€ä¸ªå…ƒç´ ï¼Œå¦‚æœé˜Ÿåˆ—ä¸ºç©ºï¼š remove : removethrows NoSuchElementException poll : è¿”å› null element ä¸ peek æ–¹æ³•ç”¨äºåœ¨é˜Ÿåˆ—çš„å¤´éƒ¨æŸ¥è¯¢å…ƒç´ ï¼Œå¦‚æœé˜Ÿåˆ—ä¸ºç©ºï¼š element : æŠ›å‡º NoSuchElementException peek : è¿”å› null Javaå®ç°class Solution { public List&lt;List&lt;Integer&gt;&gt; levelOrderBottom(TreeNode root) { List&lt;List&lt;Integer&gt;&gt; wrapList = new LinkedList(); Queue&lt;TreeNode&gt; queue = new LinkedList&lt;TreeNode&gt;(); if (root == null) { return wrapList; } queue.offer(root); while (!queue.isEmpty()) { int size = queue.size(); List&lt;Integer&gt; subList = new LinkedList(); for (int i = 0; i &lt; size; i++) { TreeNode node = queue.poll(); subList.add(node.val); if (node.left != null) { queue.offer(node.left); } if (node.right != null) { queue.offer(node.right); } } wrapList.add(0, subList); } return wrapList; }} Koltinå®ç°class Solution { fun levelOrderBottom(root: TreeNode?): List&lt;List&lt;Int&gt;&gt; { val wrapList = mutableListOf&lt;MutableList&lt;Int&gt;&gt;() root?.let { val queue = ArrayDeque&lt;TreeNode&gt;() queue.offer(root) while (!queue.isEmpty()) { val subList = mutableListOf&lt;Int&gt;() var size = queue.size while (size &gt; 0) { val node = queue.poll() subList.add(node.`val`) if (node.left != null) queue.offer(node.left) if (node.right != null) queue.offer(node.right) size-- } wrapList.add(0, subList) } } return wrapList }} æ€è·¯äºŒï¼šDFSDFS: æ·±åº¦ä¼˜å…ˆæœç´¢ç®—æ³•ï¼ˆDepth-First-Searchï¼‰ï¼Œæ˜¯æœç´¢ç®—æ³•çš„ä¸€ç§, å®ƒæ²¿ç€æ ‘çš„æ·±åº¦éå†æ ‘çš„èŠ‚ç‚¹ï¼Œå°½å¯èƒ½æ·±çš„æœç´¢æ ‘çš„åˆ†æ”¯ã€‚ Javaå®ç°class Solution { public List&lt;List&lt;Integer&gt;&gt; levelOrderBottom(TreeNode root) { List&lt;List&lt;Integer&gt;&gt; wrapList = new LinkedList(); dfs(wrapList, root, 0); return wrapList; } public void dfs(List&lt;List&lt;Integer&gt;&gt; subList, TreeNode root, int level) { if (root == null) { return; } if (level &gt;= subList.size()) { subList.add(0, new LinkedList&lt;Integer&gt;()); } subList.get(subList.size() - 1 - level).add(root.val); dfs(subList, root.left, level + 1); dfs(subList, root.right, level + 1); }} Koltinå°¾é€’å½’å®ç°class Solution { fun levelOrderBottom(root: TreeNode?): List&lt;List&lt;Int&gt;&gt; { val wrapList = mutableListOf&lt;MutableList&lt;Int&gt;&gt;() dfs(wrapList, root, 0) return wrapList } tailrec fun dfs(subList: MutableList&lt;MutableList&lt;Int&gt;&gt;, root: TreeNode?, level: Int) { if (root == null) { return } if (level &gt;= subList.size) { subList.add(0, mutableListOf&lt;Int&gt;()) } subList[subList.size - 1 - level].add(root.`val`) dfs(subList, root.left, level + 1) dfs(subList, root.right, level + 1) }}","link":"/2020/06/28/LeetCode/binary-tree/09-binary-tree-level-order-traversal/"},{"title":"LeetCode äºŒå‰æ ‘ï¼šåˆ¤æ–­äºŒå‰æ ‘æ˜¯ä¸æ˜¯å¹³è¡¡äºŒå‰æ ‘","text":"é¢˜ç›®æ¥æºäº LeetCode ä¸Šç¬¬ 110 å·ï¼ˆBalanced Binary Treeï¼‰é—®é¢˜ï¼šåˆ¤æ–­äºŒå‰æ ‘æ˜¯ä¸æ˜¯å¹³è¡¡äºŒå‰æ ‘ã€‚é¢˜ç›®éš¾åº¦ä¸º Easyã€‚ è‹±æ–‡åœ°å€ï¼šhttps://leetcode.com/problems/balanced-binary-tree/ ä¸­æ–‡åœ°å€ï¼šhttps://leetcode-cn.com/problems/balanced-binary-tree/ é¢˜ç›®æè¿°GGiven a binary tree, determine if it is height-balanced. For this problem, a height-balanced binary tree is defined as: a binary tree in which the left and right subtrees of every node differ in height by no more than 1.ä¸€ä¸ªäºŒå‰æ ‘å…¶ä¸­æ¯ä¸ªèŠ‚ç‚¹çš„ä¸¤ä¸ªå­æ ‘çš„æ·±åº¦å·®ä¸ç›¸å·®è¶…è¿‡1 Example 1: Given the following tree [3,9,20,null,null,15,7]: 3 / \\9 20 / \\ 15 7 Return true. Example 1: Given the following tree [1,2,2,3,3,null,null,4,4]: 1 / \\ 2 2 / \\ 3 3 / \\4 4 Return false. æ€è·¯:å¹³è¡¡äºŒå‰æ ‘: å·¦å³ä¸¤ä¸ªå­æ ‘çš„æ·±åº¦å·®çš„ç»å¯¹å€¼ä¸è¶…è¿‡ 1 ä»»æ„ä¸€ä¸ªèŠ‚ç‚¹çš„æ·±åº¦æ˜¯ç”±å®ƒå·¦å³ä¸¤ä¸ªå­èŠ‚ç‚¹çš„æ·±åº¦å†³å®šçš„, å¦‚æœå·¦å³ä¸¤ä¸ªèŠ‚ç‚¹çš„æœ€å¤§æ·±åº¦åˆ†åˆ«ä¸ºL1å’ŒR1ï¼Œä»»æ„ä¸€ä¸ªèŠ‚ç‚¹çš„å·®éƒ½æ»¡è¶³ abs(L1 - R1)&lt;=1ï¼Œé‚£ä¹ˆå°±æ˜¯å¹³è¡¡äºŒå‰æ ‘ Javaå®ç°public boolean isBalanced(TreeNode root) { return maxDepth(root) != -1;}public int maxDepth(TreeNode root) { if (root == null) { return 0; } int left = maxDepth(root.left); int right = maxDepth(root.right); if (left == -1 || right == -1 || Math.abs(left - right) &gt; 1) { return -1; } return Math.max(left, right) + 1;} Koltinå°¾é€’å½’å®ç°fun isBalanced(root: TreeNode?): Boolean { return maxDepth(root) != -1}tailrec fun maxDepth(root: TreeNode?): Int { if (root == null) { return 0; } val left = maxDepth(root.left); val right = maxDepth(root.right); return if (left == -1 || right == -1 || Math.abs(left - right) &gt; 1) -1 else Math.max(left, right) + 1}","link":"/2020/06/28/LeetCode/binary-tree/08-balanced-binary-tree/"},{"title":"LeetCode äºŒå‰æ ‘ï¼šè®¡ç®—äºŒå‰æ ‘çš„æœ€å¤§æ·±åº¦","text":"é¢˜ç›®æ¥æºäº LeetCode ä¸Šç¬¬ 111 å·ï¼ˆMinimum Depth of Binary Treeï¼‰é—®é¢˜ï¼šè®¡ç®—äºŒå‰æ ‘çš„æœ€å°æ·±åº¦ã€‚é¢˜ç›®éš¾åº¦ä¸º Easyã€‚ è‹±æ–‡åœ°å€ï¼šhttps://leetcode.com/problems/minimum-depth-of-binary-tree/ ä¸­æ–‡åœ°å€ï¼šhttps://leetcode-cn.com/problems/minimum-depth-of-binary-tree/ é¢˜ç›®æè¿°Given a binary tree, find its minimum depth. The minimum depth is the number of nodes along the shortest path from the root node down to the nearest leaf node. Note: A leaf is a node with no children. Example: Given binary tree [3,9,20,null,null,15,7], 3 / \\9 20 / \\ 15 7 return its minimum depth = 2. æ€è·¯:äºŒå‰æ ‘çš„æœ€å°æ·±åº¦: ä»æ ¹èŠ‚ç‚¹åˆ°å¶å­èŠ‚ç‚¹çš„æœ€çŸ­è·¯å¾„ä¸Šçš„èŠ‚ç‚¹ä¸ªæ•°æ³¨æ„ï¼šå¶å­èŠ‚ç‚¹å³æ²¡æœ‰å·¦å³å­èŠ‚ç‚¹ ä»»æ„ä¸€ä¸ªèŠ‚ç‚¹çš„æ·±åº¦æ˜¯ç”±å®ƒå·¦å³ä¸¤ä¸ªå­èŠ‚ç‚¹çš„æ·±åº¦å†³å®šçš„ï¼Œå¦‚æœå·¦å³ä¸¤ä¸ªå­èŠ‚ç‚¹çš„æ·±åº¦åˆ†åˆ«ä¸ºL1å’ŒR1ï¼Œå½“å‰èŠ‚ç‚¹çš„æœ€å°æ·±åº¦å°±æ˜¯ min(L1,R1)+1ï¼Œå…¬å¼å¦‚ä¸‹ï¼š minDepth(root) = Math.min(minDepth(root.left), minDepth(root.right)) + 1 ä½†æ˜¯éœ€è¦æ³¨æ„çš„æ˜¯ä¸èƒ½åªåˆ¤æ–­å·¦å³ä¸¤ä¸ªå­èŠ‚ç‚¹çš„æ·±åº¦çš„æœ€å°å€¼ï¼Œå› ä¸ºå³ä½¿æŸä¸ªèŠ‚ç‚¹ä¸æ˜¯å¶å­èŠ‚ç‚¹ï¼Œä½†æ˜¯å®ƒçš„ä¸€ä¸ªå­èŠ‚ç‚¹æ˜¯ç©ºèŠ‚ç‚¹ï¼Œé‚£ä¹ˆé€’å½’å°±ä¼šè¿”å›ï¼Œä»è€Œè¯¯åˆ¤è¿™æ¡è·¯å¾„æ˜¯æœ€çŸ­çš„ï¼Œä¾‹å¦‚ï¼š 1 / 2 å¦‚æœåªæ˜¯åˆ¤æ–­å·¦å³ä¸¤ä¸ªå­èŠ‚ç‚¹çš„æ·±åº¦çš„æœ€å°å€¼ï¼Œé‚£ä¹ˆè¿”å›ç»“æœæ˜¯1ï¼Œä½†æ˜¯å®é™…ä¸Šè¿™ä¸ªäºŒå‰æ ‘çš„æœ€å°æ·±åº¦æ˜¯2 Javaå®ç°public int minDepth(TreeNode root) { if (root == null) return 0; int left = minDepth(root.left); int right = minDepth(root.right); if (left == 0 || right == 0) { return left + right + 1; } else { return Math.min(left, right) + 1; }} Koltinå°¾é€’å½’å®ç°tailrec fun minDepth(root: TreeNode?): Int { if (root == null) { return 0; } val left = minDepth(root.left) val right = minDepth(root.right) return if (left == 0 || right == 0) left + right + 1 else Math.min(left, right) + 1}","link":"/2020/06/28/LeetCode/binary-tree/07-minimum-depth-of-binary-tree/"},{"title":"LeetCode äºŒå‰æ ‘ï¼šè®¡ç®—äºŒå‰æ ‘çš„æœ€å¤§æ·±åº¦","text":"é¢˜ç›®æ¥æºäº LeetCode ä¸Šç¬¬ 104 å·ï¼ˆMaximum Depth of Binary Treeï¼‰é—®é¢˜ï¼šè®¡ç®—äºŒå‰æ ‘çš„æœ€å¤§æ·±åº¦ã€‚é¢˜ç›®éš¾åº¦ä¸º Easyã€‚ è‹±æ–‡åœ°å€ï¼šhttps://leetcode.com/problems/maximum-depth-of-binary-tree/ ä¸­æ–‡åœ°å€ï¼šhttps://leetcode-cn.com/problems/maximum-depth-of-binary-tree/ é¢˜ç›®æè¿°Given a binary tree, find its maximum depth. The maximum depth is the number of nodes along the longest path from the root node down to the farthest leaf node. Note: A leaf is a node with no children. Example: Given binary tree [3,9,20,null,null,15,7], 3 / \\9 20 / \\ 15 7 return its depth = 3. æ€è·¯:äºŒå‰æ ‘çš„æœ€å¤§æ·±åº¦: ä»æ ¹èŠ‚ç‚¹åˆ°å¶å­èŠ‚ç‚¹çš„æœ€é•¿è·¯å¾„ä¸Šçš„èŠ‚ç‚¹ä¸ªæ•°æ³¨æ„ï¼šå¶å­èŠ‚ç‚¹å³æ²¡æœ‰å·¦å³å­èŠ‚ç‚¹ ä»»æ„ä¸€ä¸ªèŠ‚ç‚¹çš„æ·±åº¦æ˜¯ç”±å®ƒå·¦å³ä¸¤ä¸ªå­èŠ‚ç‚¹çš„æ·±åº¦å†³å®šçš„ï¼Œå¦‚æœå·¦å³ä¸¤ä¸ªå­èŠ‚ç‚¹çš„æ·±åº¦åˆ†åˆ«ä¸ºL1å’ŒR1ï¼Œå½“å‰èŠ‚ç‚¹çš„æœ€å¤§æ·±åº¦å°±æ˜¯ max(L1,R1)+1ï¼Œå…¬å¼å¦‚ä¸‹ï¼š maxDepth(root) = Math.max(maxDepth(root.left), maxDepth(root.right)) + 1 Javaå®ç°public int maxDepth(TreeNode root) { if (root == null) { return 0; } return Math.max(maxDepth(root.left), maxDepth(root.right)) + 1;} Koltinå°¾é€’å½’å®ç°tailrec fun maxDepth(root: TreeNode?): Int { if (root == null) { return 0; } return Math.max(maxDepth(root.left), maxDepth(root.right)) + 1}","link":"/2020/06/28/LeetCode/binary-tree/06-maximum-depth-of-binary-tree/"},{"title":"LeetCode äºŒå‰æ ‘ï¼šä»å‰åºä¸ä¸­åºéå†åºåˆ—æ„é€ äºŒå‰æ ‘","text":"é¢˜ç›®æ¥æºäº LeetCode ä¸Šç¬¬ 105å·ï¼ˆConstruct Binary Tree from Preorder and Inorder Traversalï¼‰é—®é¢˜ï¼šä»å‰åºä¸ä¸­åºéå†åºåˆ—æ„é€ äºŒå‰æ ‘ã€‚é¢˜ç›®éš¾åº¦ä¸º Mediumã€‚è¿™é“é¢˜ç›®å’Œ å‰‘æŒ‡offerï¼š 07 é‡å»ºäºŒå‰æ ‘ ä¸€æ · è‹±æ–‡åœ°å€ï¼šhttps://leetcode.com/problems/construct-binary-tree-from-preorder-and-inorder-traversal/ ä¸­æ–‡åœ°å€ï¼šhttps://leetcode-cn.com/problems/construct-binary-tree-from-preorder-and-inorder-traversal/ å‰‘æŒ‡offer 07 é‡å»ºäºŒå‰æ ‘ï¼šhttps://leetcode-cn.com/problems/zhong-jianâ€¦â€¦ é¢˜ç›®æè¿°Given preorder and inorder traversal of a tree, construct the binary tree. Note:You may assume that duplicates do not exist in the tree. For example, given preorder = [3,9,20,15,7]inorder = [9,3,15,20,7] Return the following binary tree: 3 / \\9 20 / \\ 15 7 æ€è·¯ï¼šå¦‚æœè¿˜ä¸äº†è§£å‰åºéå†å’Œä¸­åºéå†ç®—æ³•å¯ä»¥ç‚¹å‡»ä¸‹æ–¹é“¾æ¥å‰å¾€ å‰åºéå†ä¸­åºéå† å‰åºéå†å’Œä¸­åºéå†è¿‡ç¨‹å¦‚ä¸‹ï¼š å‰åºéå†ï¼šæ ¹ç»“ç‚¹ â€”&gt; å·¦èŠ‚ç‚¹ â€”&gt; å³èŠ‚ç‚¹ ä¸­åºéå†ï¼šå·¦èŠ‚ç‚¹â€”&gt; æ ¹ç»“ç‚¹ â€”&gt; å³èŠ‚ç‚¹ æ ¹æ®å‰åºéå†çš„è§„åˆ™ï¼Œå¯çŸ¥ preorder[0] ä¸€å®šæ˜¯æ•´æ£µäºŒå‰æ ‘çš„æ ¹èŠ‚ç‚¹ï¼Œå¦‚æœæ ¹èŠ‚ç‚¹æ‰€åœ¨çš„ä¸‹æ ‡ä¸º indexï¼Œæ ¹æ®ä¸­åºéå†çš„è§„åˆ™ï¼Œå¯çŸ¥ä¸­åºåºåˆ— inorderï¼š åŒºé—´ inorder[0, index - 1] å±äºæ ¹èŠ‚ç‚¹çš„å·¦å­æ ‘ åŒºé—´ inorder[index + 1, n - 1] å±äºæ ¹èŠ‚ç‚¹çš„å³å­æ ‘ æ ¹æ®å‰åºéå†çš„è§„åˆ™ä¸€å®šæ˜¯å…ˆéå†å®Œå·¦å­æ ‘ï¼Œç„¶åæ‰ä¼šéå†å³å­æ ‘ï¼Œæ‰€ä»¥å‰åºåºåˆ— preorderï¼š åŒºé—´ preorder[1, index] åœ¨æ ¹èŠ‚ç‚¹çš„ preorder[0] çš„å·¦è¾¹ åŒºé—´ preorder[index+1, n] åœ¨æ ¹èŠ‚ç‚¹çš„ preorder[0] çš„å³è¾¹ æ‰€ä»¥ç®—æ³•æ€è·¯å¦‚ä¸‹ï¼š æ ¹èŠ‚ç‚¹æ˜¯Preorderæ•°ç»„ä¸­çš„ç¬¬ä¸€ä¸ªå…ƒç´ ï¼Œå³ preorder[0] åœ¨Inorderæ•°ç»„ä¸­æŸ¥æ‰¾æ ¹çš„ä½ç½® index åœ¨Inorderæ•°ç»„ä¸­ï¼Œæ ¹å…ƒç´ å·¦è¾¹çš„å…ƒç´ æ˜¯å·¦å­æ ‘ï¼Œå³åŒºé—´ inorder[0, index - 1] åœ¨Inorderæ•°ç»„ä¸­ï¼Œæ ¹å…ƒç´ å³è¾¹çš„å…ƒç´ æ˜¯å³å­æ ‘ï¼Œå³åŒºé—´ inorder[index + 1, n - 1] åœ¨preorderæ•°ç»„ä¸­ï¼ŒåŒºé—´ preorder[1, index] åœ¨æ ¹èŠ‚ç‚¹çš„preorder[0] çš„å·¦è¾¹ åœ¨preorderæ•°ç»„ä¸­ï¼Œpreorder[index+1, n] åœ¨æ ¹èŠ‚ç‚¹çš„preorder[0] çš„å³è¾¹ åœ¨ç”±å·¦å­æ ‘ä¸­çš„å…ƒç´ ç»„æˆçš„å­æ•°ç»„ä¸Šé€’å½’è°ƒç”¨ åœ¨ç”±å³å­æ ‘ä¸­çš„å…ƒç´ ç»„æˆçš„å­æ•°ç»„ä¸Šé€’å½’åœ°è°ƒç”¨ å¤æ‚åº¦åˆ†æï¼š æ—¶é—´å¤æ‚åº¦ï¼šO(n), éå†æ¯ä¸€ä¸ªèŠ‚ç‚¹ï¼Œé‡å»ºäºŒå‰æ ‘ ç©ºé—´å¤æ‚åº¦ï¼šO(n)ï¼Œéœ€è¦å­˜å‚¨å»ºç«‹çš„äºŒå‰æ ‘ Kotlin å°¾é€’å½’å®ç°class Solution { fun buildTree(preorder: IntArray, inorder: IntArray): TreeNode? { return tailrecOrder(preorder, inorder) } tailrec fun tailrecOrder(preorder: IntArray, inorder: IntArray): TreeNode? { if (preorder.size &lt;= 0 || inorder.size &lt;= 0) { return null; } val key = preorder[0] val root = TreeNode(key) if (preorder.size == 1) { return root } val index = getRootIndex(inorder, key) if (index &gt; 0 || index &lt; preorder.size) { // è®¡ç®—å·¦å­æ ‘ï¼Œæ‰€ä»¥æ ¹èŠ‚ç‚¹é™¤å¤–ï¼Œä»ä¸‹æ ‡1å¼€å§‹ var pre = Arrays.copyOfRange(preorder, 1, index + 1) var inor = Arrays.copyOfRange(inorder, 0, index) root.left = tailrecOrder(pre, inor) pre = Arrays.copyOfRange(preorder, index + 1, preorder.size) inor = Arrays.copyOfRange(inorder, index + 1, inorder.size) root.right = tailrecOrder(pre, inor) } return root } fun getRootIndex(inorder: IntArray, key: Int): Int { inorder.forEachIndexed { index, item -&gt; if (item == key) { return index } } return -1 }} Java å®ç°class Solution { public TreeNode buildTree(int[] preorder, int[] inorder) { if (preorder.length &lt;= 0 || inorder.length &lt;= 0) { return null; } int key = preorder[0]; TreeNode root = new TreeNode(key); if (preorder.length == 1) { return root; } int index = getRootIndex(inorder, key); if (index &gt; 0 || index &lt; preorder.length) { // è®¡ç®—å·¦å­æ ‘ï¼Œæ‰€ä»¥æ ¹èŠ‚ç‚¹é™¤å¤–ï¼Œä»ä¸‹æ ‡1å¼€å§‹ int[] pre = Arrays.copyOfRange(preorder, 1, index + 1); int[] inor = Arrays.copyOfRange(inorder, 0, index); root.left = buildTree(pre, inor); pre = Arrays.copyOfRange(preorder, index + 1, preorder.length); inor = Arrays.copyOfRange(inorder, index + 1, inorder.length); root.right = buildTree(pre, inor); } return root; } private final int getRootIndex(int[] inorder, int key) { for (int i = 0; i &lt; preorder.length; i++) { if (preorder[i] == key) { return i; } } return -1; }}","link":"/2020/06/28/LeetCode/binary-tree/05-binary-tree-construct/"},{"title":"LeetCode äºŒå‰æ ‘ï¼šå±‚æ¬¡éå†","text":"é¢˜ç›®æ¥æºäº LeetCode ä¸Šç¬¬ 102å·ï¼ˆBinary Tree Level Order Traversalï¼‰é—®é¢˜ï¼šäºŒå‰æ ‘çš„å±‚æ¬¡éå†ã€‚é¢˜ç›®éš¾åº¦ä¸º Mediumã€‚ è‹±æ–‡åœ°å€: https://leetcode.com/problems/binary-tree-level-order-traversal/ä¸­æ–‡åœ°å€: https://leetcode-cn.com/problems/binary-tree-level-order-traversal/ é¢˜ç›®æè¿°Given a binary tree, return the level order traversal of its nodesâ€™ values. (ie, from left to right, level by level). Example: Given binary tree [3,9,20,null,null,15,7] 3 / \\ 9 20 / \\ 15 7return its level order traversal as:[ [3], [9,20], [15,7]] äºŒå‰æ ‘çš„å±‚æ¬¡éå†è¿‡ç¨‹ï¼šé€å±‚éå† ç»“æœä¸ºï¼š4 2 6 1 3 5 7 æ€è·¯ä¸€ï¼šBFSBFS: å¹¿åº¦ä¼˜å…ˆæœç´¢ç®—æ³•ï¼ˆBreadth-First-Searchï¼‰ï¼Œæ˜¯ä¸€ç§å›¾å½¢æœç´¢ç®—æ³•ï¼Œä»æ ¹èŠ‚ç‚¹å¼€å§‹ï¼Œæ²¿ç€æ ‘(å›¾)çš„å®½åº¦éå†æ ‘(å›¾)çš„èŠ‚ç‚¹ï¼Œå¦‚æœæ‰€æœ‰èŠ‚ç‚¹å‡è¢«è®¿é—®ï¼Œåˆ™ç®—æ³•ä¸­æ­¢ äºŒå‰æ ‘çš„å±‚æ¬¡éå†å³é€å±‚éå†ï¼Œç”±ä¸Šå›¾æ‰€ç¤ºæŒ‰ç…§è®¿é—®çš„é¡ºåºä¾æ¬¡è¾“å‡ºï¼Œå¾—å‡ºéœ€è¦ç”¨åˆ°é˜Ÿåˆ— æ–°å»ºä¸€ä¸ª queueï¼Œç”¨æ¥å­˜å‚¨è®¿é—®çš„æ¯ä¸ªèŠ‚ç‚¹ æ–°å»ºä¸€ä¸ª wrapList é›†åˆï¼Œä¿å­˜æ¯å±‚çš„æ•°æ® å¾ªç¯åˆ¤æ–­é˜Ÿåˆ—æ˜¯å¦ä¸ºç©ºï¼Œå¦‚æœé˜Ÿåˆ—ä¸ºç©ºå³å¾ªç¯ç»ˆæ­¢ è·å–æ¯ä¸€å±‚çš„æ•°æ®çš„é•¿åº¦ï¼Œä¾æ¬¡éå†ï¼Œå°†æ•°æ®ä¿å­˜åˆ° currLevelList ä¸­ éå†æ¯å±‚æ•°æ®æ—¶ï¼Œå°†ä¸‹ä¸€å±‚çš„èŠ‚ç‚¹ä¿å­˜åˆ° queue ä¸­ æ¯å±‚éå†ç»“æŸï¼Œå°†å½“å‰å±‚ currLevelList æ•°æ®ä¿å­˜åˆ° wrapList å†æ¬¡æ‰§è¡Œ3~6ï¼Œç›´åˆ° queue ä¸ºç©ºå³ç»“æŸå¾ªç¯ æ³¨æ„ï¼š æ¯ç§ Queue æ–¹æ³•å­˜åœ¨ä¸¤ç§å½¢å¼ï¼š å¦‚æœæ“ä½œå¤±è´¥ï¼ŒæŠ›å‡ºäº†ä¸€ä¸ªå¼‚å¸¸ å…¶ä»–çš„è¿”å›ä¸€ä¸ªç‰¹æ®Šå€¼ï¼ˆnull æˆ–è€… falseï¼Œå–å†³äºæ“ä½œï¼‰ æ“ä½œç±»å‹ æŠ›å‡ºå¼‚å¸¸ è¿”å›ç‰¹æ®Šå€¼ æ’å…¥ add(e) offer(e) ç§»é™¤ å¼¹å‡º poll() æŸ¥æ‰¾ å¼¹å‡º peek() Queue çš„å®ç°å¯ä»¥é™åˆ¶æ‰€æŒæœ‰å…ƒç´ çš„æ•°é‡ï¼Œè¿™æ ·çš„é˜Ÿåˆ—ç§°ä¸ºæœ‰ç•Œï¼Œæœ‰äº› Queue å®ç° java.util.concurrent æ˜¯æœ‰ç•Œçš„ï¼Œä½†å®ç° java.util ä¸æ˜¯ï¼š add ï¼šç»§æ‰¿è‡ª Collectionï¼Œæ’å…¥ä¸€ä¸ªå…ƒç´ ï¼Œé™¤éå®ƒä¼šè¿åé˜Ÿåˆ—çš„å®¹é‡é™åˆ¶ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹æŠ›å‡º IllegalStateException offer ï¼šæ–¹æ³•ä»…ç”¨äºæœ‰ç•Œé˜Ÿåˆ—ï¼Œä¸èƒ½æ’å…¥æ—¶ï¼Œè¿”å› fasle åœ¨ remove ä¸ poll æ–¹æ³•éƒ½æ˜¯ä»é˜Ÿåˆ—ä¸­åˆ é™¤ç¬¬ä¸€ä¸ªå…ƒç´ ï¼Œå¦‚æœé˜Ÿåˆ—ä¸ºç©ºï¼š remove : removethrows NoSuchElementException poll : è¿”å› null element ä¸ peek æ–¹æ³•ç”¨äºåœ¨é˜Ÿåˆ—çš„å¤´éƒ¨æŸ¥è¯¢å…ƒç´ ï¼Œå¦‚æœé˜Ÿåˆ—ä¸ºç©ºï¼š element : æŠ›å‡º NoSuchElementException peek : è¿”å› null Javaå®ç°class Solution { public List&lt;List&lt;Integer&gt;&gt; levelOrder(TreeNode root) { // å­˜å‚¨æ¯å±‚çš„æ•°æ® List&lt;List&lt;Integer&gt;&gt; wrapList = new LinkedList(); if (root == null) return wrapList; // å­˜å‚¨è®¿é—®è¿‡çš„æ¯å±‚èŠ‚ç‚¹ Queue&lt;TreeNode&gt; queue = new LinkedList(); queue.offer(root); while (!queue.isEmpty()) { int len = queue.size(); // è·å–æ¯å±‚çš„æ•°æ®çš„é•¿åº¦ List&lt;Integer&gt; currLevelList = new LinkedList(); // éå†æ¯æ¬¡æ¯å±‚çš„æ•°æ® for (int i = 0; i &lt; len; i++) { root = queue.poll(); // æŒ‰ç…§æ¯å±‚éå†çš„é¡ºåºï¼Œå­˜å‚¨æ¯å±‚çš„èŠ‚ç‚¹ currLevelList.add(root.val); // å°†ä¸‹ä¸€å±‚çš„èŠ‚ç‚¹å…¥é˜Ÿ if (root.left != null) queue.add(root.left); if (root.right != null) queue.add(root.right); } wrapList.add(currLevelList); } return wrapList; }} Kotlinå®ç°class Solution { fun levelOrder(root: TreeNode?): List&lt;List&lt;Int&gt;&gt; { val wrapList = mutableListOf&lt;MutableList&lt;Int&gt;&gt;() root?.let { val queue = ArrayDeque&lt;TreeNode&gt;() queue.offer(root) while (queue.isNotEmpty()) { val currLevelList = mutableListOf&lt;Int&gt;() var len = queue.size while (len &gt; 0) { queue.poll()?.let { curNode -&gt; currLevelList.add(curNode.`val`) if (curNode.left != null) queue.offer(curNode.left) if (curNode.right != null) queue.offer(curNode.right) } len-- } wrapList.add(currLevelList) } } return wrapList }} æ€è·¯äºŒï¼šDFSDFS: æ·±åº¦ä¼˜å…ˆæœç´¢ç®—æ³•ï¼ˆDepth-First-Searchï¼‰ï¼Œæ˜¯æœç´¢ç®—æ³•çš„ä¸€ç§, å®ƒæ²¿ç€æ ‘çš„æ·±åº¦éå†æ ‘çš„èŠ‚ç‚¹ï¼Œå°½å¯èƒ½æ·±çš„æœç´¢æ ‘çš„åˆ†æ”¯ã€‚ Java å®ç°class Solution { public List&lt;List&lt;Integer&gt;&gt; levelOrder(TreeNode root) { List&lt;List&lt;Integer&gt;&gt; wrapList = new LinkedList(); dfs(wrapList, root, 0); return wrapList; } public void dfs(List&lt;List&lt;Integer&gt;&gt; wrapList, TreeNode root, int level) { if (root == null) return; if (level &gt;= wrapList.size()) { wrapList.add(new LinkedList&lt;Integer&gt;()); } List&lt;Integer&gt; currLevelList = wrapList.get(level); currLevelList.add(root.val); dfs(wrapList, root.left, level + 1); dfs(wrapList, root.right, level + 1); }} Kotlin å°¾é€’å½’class Solution { fun levelOrder(root: TreeNode?): List&lt;List&lt;Int&gt;&gt; { val wrapList = mutableListOf&lt;MutableList&lt;Int&gt;&gt;() dfs(wrapList, root, 0) return wrapList } tailrec fun dfs(wrapList: MutableList&lt;MutableList&lt;Int&gt;&gt;, root: TreeNode?, level: Int) { if (root == null) return if (level &gt;= wrapList.size) { wrapList.add(mutableListOf&lt;Int&gt;()) } wrapList[level].add(root.`val`) dfs(wrapList, root.left, level + 1) dfs(wrapList, root.right, level + 1) }}","link":"/2020/06/28/LeetCode/binary-tree/04-binary-tree-level-order/"},{"title":"LeetCode äºŒå‰æ ‘ï¼šååºéå†","text":"é¢˜ç›®æ¥æºäº LeetCode ä¸Šç¬¬ 145å·ï¼ˆBinary Tree Postorder Traversalï¼‰é—®é¢˜ï¼šäºŒå‰æ ‘çš„ååºéå†ã€‚é¢˜ç›®éš¾åº¦ä¸º Mediumã€‚ è‹±æ–‡åœ°å€: https://leetcode.com/problems/binary-tree-postorder-traversal/ ä¸­æ–‡åœ°å€: https://leetcode-cn.com/problems/binary-tree-postorder-traversal/ é¢˜ç›®æè¿°Given a binary tree, return the postorder traversal of its nodesâ€™ values. Example: Input: [1,null,2,3] 1 \\ 2 / 3Output: [3,2,1] äºŒå‰æ ‘çš„ååºéå†è¿‡ç¨‹: å·¦èŠ‚ç‚¹ -&gt; å³èŠ‚ç‚¹ -&gt; æ ¹èŠ‚ç‚¹ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š ç»“æœä¸ºï¼š1 3 2 5 7 6 4 æ€è·¯ä¸€ï¼šéé€’å½’ä¸€èˆ¬åˆ†æé—®é¢˜æˆ‘ä»¬éœ€è¦é‡‡ç”¨è‡ªä¸Šè€Œä¸‹çš„æ€ç»´ï¼Œè€Œè§£å†³é—®é¢˜æœ‰æ—¶å€™é‡‡ç”¨è‡ªä¸‹è€Œä¸Šçš„æ–¹å¼ï¼Œæ­£å¦‚ä¸Šå›¾åç»­éå†çš„ç»“æœï¼š1 3 2 5 7 6 4ï¼Œæˆ‘ä»¬é‡‡ç”¨é€†å‘æ€ç»´ï¼Œ4æ˜¯2ã€6çš„æ ¹èŠ‚ç‚¹ï¼Œè€Œ6æ˜¯5ã€7çš„æ ¹èŠ‚ç‚¹ï¼Œä¾æ¬¡ç±»æ¨é€†å‘è¾“å‡ºçš„è¿‡ç¨‹ï¼šæ ¹èŠ‚ç‚¹ -&gt; å³èŠ‚ç‚¹ -&gt; å·¦èŠ‚ç‚¹, æˆ‘å¯ä»¥ç»“åˆæ ˆçš„ç‰¹æ€§ï¼Œä»¥åŠå‰åºéå†çš„è¿‡ç¨‹ï¼šæ ¹èŠ‚ç‚¹ -&gt; å·¦èŠ‚ç‚¹ -&gt; å³èŠ‚ç‚¹ï¼Œå»æ€è€ƒï¼Œå¤§æ¦‚è¿‡ç¨‹å¦‚ä¸‹ï¼š å…ˆå°†æ ¹èŠ‚ç‚¹å…¥æ ˆ å¾ªç¯åˆ¤æ–­åˆ¤æ–­æ ˆä¸ä¸ºç©º å–å‡ºæ ˆé¡¶å…ƒç´ ï¼Œå¹¶æ·»åŠ åˆ°listé›†åˆï¼ˆé€†åºæ·»åŠ ï¼‰ å¦‚æœå·¦èŠ‚ç‚¹ä¸ä¸ºç©ºï¼Œå¹¶å°†å·¦èŠ‚ç‚¹å…¥æ ˆ å¦‚æœå³èŠ‚ç‚¹ä¸ä¸ºç©ºï¼Œå¹¶å°†å³èŠ‚ç‚¹å…¥æ ˆ Javaå®ç°class Solution { public List&lt;Integer&gt; postorderTraversal(TreeNode root) { Stack&lt;TreeNode&gt; stack = new Stack(); List&lt;Integer&gt; list = new LinkedList&lt;&gt;(); if(root == null) return list; // å…ˆå°†æ ¹èŠ‚ç‚¹å…¥æ ˆ stack.push(root); // å¾ªç¯åˆ¤æ–­åˆ¤æ–­æ ˆä¸ä¸ºç©º while(!stack.isEmpty()){ root = stack.pop(); // å–å‡ºæ ˆé¡¶å…ƒç´ ï¼Œå¹¶æ·»åŠ åˆ°listé›†åˆï¼ˆé€†åºæ·»åŠ ï¼‰ list.add(0,root.val); //å¦‚æœå·¦èŠ‚ç‚¹ä¸ä¸ºç©ºï¼Œå¹¶å°†å·¦èŠ‚ç‚¹å…¥æ ˆ if(root.left!=null) stack.push(root.left); // å¦‚æœå³èŠ‚ç‚¹ä¸ä¸ºç©ºï¼Œå¹¶å°†å³èŠ‚ç‚¹å…¥æ ˆ if(root.right!=null) stack.push(root.right); } return list; } } Kotlinå®ç°class Solution { fun postorderTraversal(root: TreeNode?): List&lt;Int&gt; { val list = mutableListOf&lt;Int&gt;() root?.let { val stack = Stack&lt;TreeNode&gt;() stack.push(it) while (!stack.isEmpty()) { val current = stack.pop() list.add(0, current.`val`) if (current.left != null) stack.push(current.left) if (current.right != null) stack.push(current.right) } } return list }} æ€è·¯äºŒï¼šé€’å½’ååºéå†çš„é€’å½’æ€è·¯å’Œä¸­åºéå†ã€å‰åºéå†å¤§æ¦‚ä¸€è‡´ï¼Œæ ¹æ®é€’å½’çš„ä¸¤ä¸ªç‰¹ç‚¹å»æ€è€ƒ é€’å½’çš„ä¸¤ä¸ªç‰¹ç‚¹ï¼š 1. é—®é¢˜ä¸å­é—®é¢˜çš„é€’å½’å…³ç³»ï¼Œé‡‡ç”¨è‡ªä¸Šè€Œä¸‹çš„æ€è€ƒæ–¹å¼2. é€’å½’çš„ç»ˆæ­¢æ¡ä»¶æ˜¯å½“ç»“ç‚¹ä¸ºå¶å­ç»“ç‚¹æ—¶ç»ˆæ­¢ï¼ˆå› ä¸ºå¶å­èŠ‚ç‚¹æ²¡æœ‰å·¦å³ç»“ç‚¹ï¼‰ Javaå®ç°class Solution { List&lt;Integer&gt; list = new LinkedList&lt;Integer&gt;(); public List&lt;Integer&gt; postorderTraversal(TreeNode root) { if (root == null) return list; postorderTraversal(root.left); postorderTraversal(root.right); list.add(root.val); return list; }} Kotlin å°¾é€’å½’å®ç°class Solution { fun postorderTraversal(root: TreeNode?): List&lt;Int&gt; { val list = mutableListOf&lt;Int&gt;() tailrecPreorder(root, list) return list } tailrec fun tailrecPreorder(root: TreeNode?, list: MutableList&lt;Int&gt;) { if (root == null) { return } tailrecPreorder(root.left, list) tailrecPreorder(root.right, list) list.add(root.`val`) }}","link":"/2020/06/28/LeetCode/binary-tree/03-binary-tree-postorder/"},{"title":"LeetCode äºŒå‰æ ‘ï¼šä¸­åºéå†","text":"é¢˜ç›®æ¥æºäº LeetCode ä¸Šç¬¬ 94å·ï¼ˆBinary Tree Inorder Traversalï¼‰é—®é¢˜ï¼šäºŒå‰æ ‘çš„ä¸­åºéå†ã€‚é¢˜ç›®éš¾åº¦ä¸º Mediumã€‚ è‹±æ–‡åœ°å€: https://leetcode.com/problems/binary-tree-inorder-traversal/ ä¸­æ–‡åœ°å€: https://leetcode-cn.com/problems/binary-tree-postorder-traversal/ é¢˜ç›®æè¿°Given a binary tree, return the inorder traversal of its nodesâ€™ values Example: Input: [1,null,2,3] 1 \\ 2 / 3Output: [1,3,2] äºŒå‰æ ‘çš„ä¸­åºéå†è¿‡ç¨‹: å·¦èŠ‚ç‚¹ -&gt; æ ¹èŠ‚ç‚¹ -&gt; å³èŠ‚ç‚¹ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š ç»“æœä¸ºï¼š1 2 3 4 5 6 7 æ€è·¯ä¸€ï¼šéé€’å½’ å¾ªç¯æ£€æµ‹æ ˆæ˜¯å¦ä¸ºç©ºï¼Œæˆ–è€…æ ¹èŠ‚ç‚¹æ˜¯å¦ä¸ºç©º å¾ªç¯æ£€æµ‹å·¦èŠ‚ç‚¹ï¼Œä¿å­˜åœ¨æ ˆä¸­ å¼¹å‡ºæ ˆé¡¶å…ƒç´ ï¼Œå†å°†å½“å‰æŒ‡é’ˆç§»åˆ°å…¶å³å­èŠ‚ç‚¹ä¸Šï¼Œè‹¥å­˜åœ¨å³å­èŠ‚ç‚¹ï¼Œåœ¨æ¬¡æ‰§è¡Œæ­¥éª¤2 Javaå®ç°class Solution { public List&lt;Integer&gt; inorderTraversal(TreeNode root) { Stack&lt;TreeNode&gt; stack = new Stack(); List&lt;Integer&gt; list = new LinkedList&lt;&gt;(); // å¾ªç¯æ£€æµ‹æ ˆæ˜¯å¦ä¸ºç©ºï¼Œæˆ–è€…æ ¹èŠ‚ç‚¹æ˜¯å¦ä¸ºç©º while (!stack.isEmpty() || root != null) { // å¾ªç¯æ£€æµ‹å·¦èŠ‚ç‚¹ï¼Œä¿å­˜åœ¨æ ˆä¸­ while (root != null) { stack.push(root); root = root.left; } // å¼¹å‡ºæ ˆé¡¶å…ƒç´  root = stack.pop(); list.add(root.val); // å†å°†å½“å‰æŒ‡é’ˆç§»åˆ°å…¶å³å­èŠ‚ç‚¹ä¸Šï¼Œè‹¥å­˜åœ¨å³å­èŠ‚ç‚¹ï¼Œåœ¨æ¬¡æ‰§è¡Œæ­¥éª¤2 root = root.right; } return list; }} kotlin å®ç°class Solution { fun inorderTraversal(root: TreeNode?): List&lt;Int&gt; { val list = mutableListOf&lt;Int&gt;() val stack = Stack&lt;TreeNode&gt;() var current = root while (!stack.isEmpty() || current != null) { while (current != null) { stack.push(current) current = current.left } stack.pop()?.let { item -&gt; list.add(item.`val`) current = item.right } } return list; }} æ€è·¯äºŒï¼šé€’å½’ä¸­åºéå†é€’å½’æ€è·¯å’Œå‰åºéå†å¤§æ¦‚ä¸€è‡´ï¼Œæ ¹æ®é€’å½’çš„ä¸¤ä¸ªç‰¹ç‚¹å»æ€è€ƒ é€’å½’çš„ä¸¤ä¸ªç‰¹ç‚¹ï¼š 1. é—®é¢˜ä¸å­é—®é¢˜çš„é€’å½’å…³ç³»ï¼Œé‡‡ç”¨è‡ªä¸Šè€Œä¸‹çš„æ€è€ƒæ–¹å¼2. é€’å½’çš„ç»ˆæ­¢æ¡ä»¶æ˜¯å½“ç»“ç‚¹ä¸ºå¶å­ç»“ç‚¹æ—¶ç»ˆæ­¢ï¼ˆå› ä¸ºå¶å­èŠ‚ç‚¹æ²¡æœ‰å·¦å³ç»“ç‚¹ï¼‰ java å®ç°class Solution { List&lt;Integer&gt; list = new LinkedList&lt;Integer&gt;(); public List&lt;Integer&gt; inorderTraversal(TreeNode root) { if (root == null) return list; inorderTraversal(root.left); list.add(root.val); inorderTraversal(root.right); return list; }} kotlin å°¾é€’å½’å®ç°class Solution { fun inorderTraversal(root: TreeNode?): List&lt;Int&gt; { val list = mutableListOf&lt;Int&gt;() tailrecInorder(root, list) return list; } tailrec fun tailrecInorder(root: TreeNode?, list: MutableList&lt;Int&gt; = mutableListOf()) { if (root == null) { return } tailrecInorder(root.left, list) list.add(root.`val`) tailrecInorder(root.right, list) }}","link":"/2020/06/28/LeetCode/binary-tree/02-binary-tree-inorder/"},{"title":"LeetCode äºŒå‰æ ‘ï¼š å‰åºéå†","text":"é¢˜ç›®æ¥æºäº LeetCode ä¸Šç¬¬ 144å·ï¼ˆBinary Tree Preorder Traversalï¼‰é—®é¢˜ï¼šäºŒå‰æ ‘çš„å‰åºéå†ï¼Œé¢˜ç›®éš¾åº¦ä¸º Mediumã€‚ è‹±æ–‡åœ°å€: https://leetcode.com/problems/binary-tree-preorder-traversal/ ä¸­æ–‡åœ°å€ï¼šhttps://leetcode-cn.com/problems/binary-tree-preorder-traversal/ é¢˜ç›®æè¿°Given a binary tree, return the preorder traversal of its nodesâ€™ values. Example: Input: [1,null,2,3] 1 \\ 2 / 3Output: [1,2,3] äºŒå‰æ ‘çš„å‰åºéå†è¿‡ç¨‹: æ ¹èŠ‚ç‚¹ -&gt; å·¦èŠ‚ç‚¹ -&gt; å³èŠ‚ç‚¹ï¼Œå¦‚å›¾æ‰€ç¤ºï¼š ç»“æœä¸º: 4 2 1 3 6 5 7 æ€è·¯ä¸€ï¼šéé€’å½’å¯ä»¥åˆ©ç”¨æ ˆçš„ç‰¹æ€§æ¥è§£è¿™é“é¢˜ï¼Œä¸»è¦æ­¥éª¤å¦‚ä¸‹ï¼š å¾ªç¯æ£€æµ‹æ ˆæ˜¯å¦ä¸ºç©ºï¼Œæˆ–è€…æ ¹èŠ‚ç‚¹æ˜¯å¦ä¸ºç©º å¾ªç¯æ£€æµ‹å·¦èŠ‚ç‚¹ï¼Œä¿å­˜åˆ°æ ˆä¸­ å½“å·¦èŠ‚ç‚¹éå†ç»“æŸä¹‹åï¼Œå–å‡ºæ ˆé¡¶çš„å³èŠ‚ç‚¹ï¼Œå†æ¬¡æ‰§è¡Œæ­¥éª¤2 Javaå®ç°class Solution { public List&lt;Integer&gt; preorderTraversal(TreeNode root) { Stack&lt;TreeNode&gt; stack = new Stack(); List&lt;Integer&gt; list = new LinkedList(); // å¾ªç¯æ£€æµ‹æ ˆæ˜¯å¦ä¸ºç©ºï¼Œæˆ–è€…æ ¹èŠ‚ç‚¹æ˜¯å¦ä¸ºç©º while (!stack.isEmpty() || root != null) { // å¾ªç¯æ£€æµ‹å·¦èŠ‚ç‚¹ï¼Œä¿å­˜åˆ°æ ˆä¸­ while (root != null) { stack.push(root); list.add(root.val); root = root.left; } // å–å‡ºæ ˆé¡¶çš„å³èŠ‚ç‚¹ï¼Œå†æ¬¡æ‰§è¡Œæ­¥éª¤2 if (!stack.isEmpty()) { root = stack.pop().right; } } return list; }} Kotlin å®ç°class Solution { fun preorderTraversal(root: TreeNode?): List&lt;Int&gt; { val list = mutableListOf&lt;Int&gt;() val stack = Stack&lt;TreeNode&gt;() stack.push(root); while (!stack.isEmpty()) { stack.pop()?.let { root -&gt; list.add(root.`val`) if (root.right != null) stack.push(root.right) if (root.left != null) stack.push(root.left) } } return list }} æ€è·¯äºŒï¼šé€’å½’é€’å½’çš„ä¸¤ä¸ªç‰¹ç‚¹ï¼š é—®é¢˜å’Œå­é—®é¢˜éƒ½ä¼šè°ƒç”¨å‡½æ•°è‡ªèº«ï¼Œæ‰€ä»¥è¦æ‰¾å¯»é—®é¢˜ä¸å­é—®é¢˜çš„é€’å½’å…³ç³»ï¼Œé‡‡ç”¨è‡ªä¸Šè€Œä¸‹çš„æ€è€ƒæ–¹å¼ æœ‰ä¸ªç»ˆæ­¢æ¡ä»¶ï¼ˆä¸´ç•Œç‚¹ï¼‰ç»“æŸå½“å‰é€’å½’ å› æ­¤äºŒå‰æ ‘å‰åºéå†æŒ‰ç…§ä¸Šé¢ä¸¤æ­¥è¿›è¡Œåˆ†è§£ 1. é—®é¢˜ä¸å­é—®é¢˜çš„é€’å½’å…³ç³»ï¼Œé‡‡ç”¨è‡ªä¸Šè€Œä¸‹çš„æ€è€ƒæ–¹å¼ æŒ‰ç…§äºŒå‰æ ‘çš„å‰åºéå†è¿‡ç¨‹: æ ¹èŠ‚ç‚¹ -&gt; å·¦èŠ‚ç‚¹ -&gt; å³èŠ‚ç‚¹ å¯¹äºæ ¹èŠ‚ç‚¹4ï¼Œå®ƒçš„å·¦å³èŠ‚ç‚¹åˆ†åˆ«æ˜¯2ã€6ï¼Œç»§ç»­å¾€ä¸‹é€’æ¨ å‡è®¾æ ¹èŠ‚ç‚¹æ˜¯2ï¼Œå®ƒçš„å·¦å³èŠ‚ç‚¹æ˜¯åˆ†åˆ«1ã€3ï¼Œç»§ç»­å¾€ä¸‹é€’æ¨ å‡è®¾æ ¹èŠ‚ç‚¹æ˜¯1ï¼Œå®ƒæ²¡æœ‰å·¦å³èŠ‚ç‚¹ï¼Œæ­¤æ—¶é€’æ¨ç»“æŸäº†ï¼Œç„¶åå¾€ä¸Šå›æº¯ï¼Œä»¥å³èŠ‚ç‚¹3ä½œä¸ºæ ¹èŠ‚ç‚¹ï¼Œä»¥æ­¤ç±»æ¨ å› æ­¤é—®é¢˜ä¸å­é—®é¢˜çš„é€’å½’å…³ç³»ï¼špreorder(root) = preorder(root-&gt;left) + preorder(root-&gt;right) 2. é€’å½’çš„ç»ˆæ­¢æ¡ä»¶æ˜¯å½“ç»“ç‚¹ä¸ºå¶å­ç»“ç‚¹æ—¶ç»ˆæ­¢ï¼ˆå› ä¸ºå¶å­èŠ‚ç‚¹æ²¡æœ‰å·¦å³å­ç»“ç‚¹ï¼‰ å°†ä¸Šé¢æ€è·¯ç”¨ä»£ç è¡¨ç¤ºå¦‚ä¸‹ Javaå®ç°class Solution { List&lt;Integer&gt; list = new LinkedList&lt;Integer&gt;(); public List&lt;Integer&gt; preorderTraversal(TreeNode root) { // å¶å­èŠ‚ç‚¹æ²¡æœ‰å·¦å³å­ç»“ç‚¹ if (root == null) return list; list.add(root.val); preorderTraversal(root.left); preorderTraversal(root.right); return list; }} Kotlin å®ç°class Solution { fun preorderTraversal(root: TreeNode?): List&lt;Int&gt; { val list = mutableListOf&lt;Int&gt;() tailrecPreorder(root, list) return list } tailrec fun tailrecPreorder(root: TreeNode?, list: MutableList&lt;Int&gt;) { if (root == null) { return } list.add(root.`val`) tailrecPreorder(root.left, list) tailrecPreorder(root.right, list) }}#","link":"/2020/06/28/LeetCode/binary-tree/01-binary-tree-preorder/"},{"title":"åŸºäº Smali æ–‡ä»¶ Android Studio åŠ¨æ€è°ƒè¯• APP","text":"æœ€è¿‘åœ¨ç ”ç©¶åŠ¨æ€è°ƒè¯•æŠ€æœ¯ï¼Œç½‘ä¸Šå…³äºåŸºäº Smali åŠ¨æ€è°ƒè¯•Appçš„æ•™ç¨‹å¾ˆå¤šï¼Œå¾ˆå¤šç»†èŠ‚éƒ½æ²¡æœ‰è´´å‡ºæ¥ï¼Œèµ°äº†å¾ˆå¤šå¼¯è·¯ï¼Œå°†è°ƒç ”ç»“æœåˆ†äº«ä¸€ä¸‹ï¼Œå¦‚æœæœ‰å†™çš„ä¸å¥½åœ°æ–¹ï¼Œæ¬¢è¿æŒ‡æ­£ Githubï¼šhttps://github.com/hi-dhl/DebugApkSmali å‡†å¤‡å·¥ä½œ ä¸€éƒ¨ Root è¿‡çš„ Android æ‰‹æœºï¼Œæ‰“å¼€å¼€å‘è€…æ¨¡å¼ Xposed çš„è¿è¡Œçš„ç¯å¢ƒ å®‰è£… smalidea æ’ä»¶ï¼Œç‚¹å‡»è¿™é‡Œä¸‹è½½ å®‰è£… BDOpener.apk æˆ–è€… XDebug.apk åç¼–è¯‘ Apk(apktool)ç‚¹å‡» è¿™é‡Œä¸‹è½½ æœ€æ–°çš„ apktool , å¹¶é…ç½®å¥½ç¯å¢ƒï¼ˆä¸åŒç¯å¢ƒé…ç½®çš„æ–¹å¼ä¸åŒï¼Œå‚è€ƒ å®˜ç½‘ï¼‰ ä¸‹è½½ä½ éœ€è¦åç¼–è¯‘çš„ Apk æ–‡ä»¶ï¼Œæ‰§è¡Œ apktool d åç¼–è¯‘Apkåå­—.apk å¦‚æœåç¼–è¯‘å‡ºæ¥å¤šä¸ªsmaliæ–‡ä»¶å¤¹ï¼Œå¯ä»¥ç”¨antå†™ä¸ªè„šæœ¬ï¼Œå¤šä¸ªæ–‡ä»¶å¤¹åˆå¹¶æˆä¸€ä¸ª smalideaAndroidStudio å¦‚æœè¦è°ƒè¯•smaliä»£ç ï¼Œéœ€è¦å®‰è£…ç¬¬ä¸‰æ–¹æ’ä»¶: smalidea ASä¸­ã€Android Studioâ€“&gt;Preferencesâ€“&gt;Pluginsâ€“&gt;Install plugin from deskâ€¦ã€‘ï¼Œå®‰è£…æ’ä»¶ Android Studio å¯¼å…¥ smali æ–°ç–†ä¸€ä¸ª Android å·¥ç¨‹é¡¹ç›®ï¼ˆps: ä¸€å®šè¦æ–°å»ºAndroidé¡¹ç›®ï¼Œå¦åˆ™å¯èƒ½ä¼šæ‰¾ä¸åˆ° â€œAttach debuger to Android Processâ€ï¼‰åˆ æ‰è‡ªåŠ¨åˆ›å»ºçš„èµ„æºå’Œä»£ç æ–‡ä»¶ å¤åˆ¶åç¼–è¯‘å¥½çš„ smali æ–‡ä»¶, åˆ°æ–°å»º Android é¡¹ç›® java æ–‡ä»¶å¤¹ä¸‹ PS: ä¹Ÿå¯ä»¥ä½¿ç”¨æˆ‘é…ç½®å¥½çš„é¡¹ç›® â€œApkSampleSmaliâ€ , éœ€è¦å®‰è£…æä¾›çš„ Sample.apkè¿›è¡Œæµ‹è¯• Android Studio åŠ¨æ€è°ƒè¯•é…ç½®æ–°å»ºè°ƒè¯•é…ç½®ï¼Œã€Runâ€“&gt;Edit Configurationsâ€“&gt; + â€“&gt;Remoteã€‘ï¼Œname éšæ„ï¼Œç«¯å£ 8700 åŠ¨æ€è°ƒè¯• åœ¨ smali ä»£ç ä¸­æ‰“å…¥æ–­ç‚¹ï¼Œå¦‚ä¸‹å›¾æ ‡è®°1 ç„¶åç‚¹å‡» â€œAttach debuger to Android Processâ€ ï¼Œå¦‚ä¸‹å›¾æ ‡è®°2 é€‰æ‹©ä½ è¦è°ƒè¯•çš„è¿›ç¨‹ï¼Œæ‰‹åŠ¨è¿›å…¥å¯¹åº”åŠŸèƒ½, å³è¿›å…¥æ–­ç‚¹åŠ¨æ€è°ƒè¯•ï¼ˆps: å¦‚æœä½ æƒ³è¦çš„è¿›ç¨‹æ²¡æœ‰å±•ç¤ºå‡ºæ¥ï¼Œè¯·é‡æ–°å‹¾é€‰ xposed module(BDOpener), é‡å¯æ‰‹æœºï¼‰ è¿è¡Œç¯å¢ƒä¿¡æ¯ Xposed Version90-beta3 BDOpener 1.0 AndoridStudio 3.3.2 smalidea 0.0.5 apktool 2.4.0","link":"/2020/05/30/AndroidStudio/02-smalidea/"},{"title":"è§£å†³åœ¨ Android Studio 3.2 æ‰¾ä¸åˆ° Android Device Monitor å·¥å…·","text":"å‡çº§åˆ° AndroidStudio æœ€æ–°ç‰ˆæœ¬( &gt;3.2 )æœ‹å‹ä»¬éƒ½ä¼šé‡åˆ°ä¸€ä¸ªé—®é¢˜ï¼Œæ‰¾ä¸åˆ° DDMS [Android Device Monitor], åªèƒ½ä» SDK ç›®å½•ä¸‹æ‰¾åˆ° monitor å¯åŠ¨ DDMS [Android Device Monitor]ï¼Œæ‰€ä»¥å†™äº†ä¸€ä¸ªæ’ä»¶å¿«é€Ÿå¯åŠ¨ Android Device Monitor æºç åŠä½¿ç”¨æ–¹å¼å¼€å‘å·¥å…·ï¼šIntelliJ IDEA Githubåœ°å€ï¼šhttps://github.com/hi-dhl/DeviceMonitorPlugin æ’ä»¶ä¸‹è½½åœ°å€ï¼šhttps://github.com/hi-dhl/DeviceMonitorPlugin/releases/download/1.0/DeviceMonitorPlugin.jar å®‰è£…æ–¹å¼ï¼š æ‰“å¼€ AndroidStudio é€‰æ‹© Preference -&gt; Plugins-&gt; install plugin from disk é€‰æ‹©ä¸‹è½½å¥½çš„æ’ä»¶ [DeviceMonitorPlugin.jar] -&gt; é‡å¯ AndroidStudio å¦‚ä½•å¯åŠ¨ï¼š æ‰“å¼€ AndroidStudio èœå•æ  tools -&gt; å•å‡» DeviceMonitor PS: Google è™½ç„¶åˆ é™¤äº† AdnroidStudio å¯åŠ¨å…¥å£ï¼Œä½†æ˜¯æœ¬åœ° SDK ä¸­è¿˜æ˜¯å­˜åœ¨ï¼Œæ’ä»¶é€šè¿‡åŠ¨æ€è·å–æœ¬åœ° SDK è·¯å¾„å¯åŠ¨ AndroidDeviceMonitor, ç”±äºç”µè„‘æ€§èƒ½ä¸åŒï¼Œå¯åŠ¨é€Ÿåº¦ä¼šæœ‰ä¸åŒ Google ä¸ºä»€ä¹ˆå¼ƒç”¨ Android Device MonitorAndroid Developerså®˜ç½‘ä¸Šçš„åŸæ–‡é“¾æ¥ Android Device Monitor æ˜¯ä¸€ä¸ª Android åº”ç”¨è°ƒè¯•å’Œåˆ†æå·¥å…·æä¾›äº†ä¸€ä¸ª UI å·¥å…·ï¼Œä½†æ˜¯å¤§éƒ¨åˆ†ç»„ä»¶åœ¨ Android Studio 3.1 å·²ç»å¼ƒç”¨äº†, å¹¶ä¸”ä¼šåœ¨ Android Studio 3.2 ä¸­ç§»é™¤ï¼Œå°†ä¼šç”¨æ–°çš„å·¥å…·å¸®åŠ©å¼€å‘äººå‘˜è°ƒè¯•å’Œåˆ†æ Android åº”ç”¨ è¯¦æƒ…æˆ³è¿™é‡Œ æ’ä»¶æ ¸å¿ƒä»£ç public class Monitor extends AnAction { @Override public void actionPerformed(AnActionEvent anActionEvent) { try { Project project = anActionEvent.getData(PlatformDataKeys.PROJECT); String os = AndroidUtils.getPlatformName(); String sdkPath = AndroidUtils.getApkLocalProperties(project); if (os.toLowerCase().startsWith(&quot;win&quot;)) { sdkPath += File.separator + &quot;tools&quot; + File.separator + &quot;monitor.bat&quot;; } else { sdkPath += File.separator + &quot;tools&quot; + File.separator + &quot;monitor&quot;; } Runtime.getRuntime().exec(sdkPath); } catch (Exception e) { } }} /** * åŠ¨æ€è·å–æœ¬åœ°Android SDKçš„è·¯å¾„ * * @param project * @return */public static String getApkLocalProperties(Project project) { String sdkPath = &quot;&quot;; try { String path = project.getBasePath() + File.separator + &quot;local.properties&quot;; Properties properties = new Properties(); InputStream inputStream = new FileInputStream(path); properties.load(inputStream); sdkPath = properties.getProperty(&quot;sdk.dir&quot;); } catch (Exception e) { } return sdkPath;} Githubåœ°å€ï¼šhttps://github.com/hi-dhl/DeviceMonitorPlugin","link":"/2020/05/30/AndroidStudio/01-monitor/"},{"title":"LeetCodeäºŒåˆ†æŸ¥æ‰¾ï¼šå¯»æ‰¾æ¯”ç›®æ ‡å­—æ¯å¤§çš„æœ€å°å­—æ¯","text":"é¢˜ç›®æ¥æºäº LeetCode ä¸Šç¬¬ 744 å·ï¼ˆFind Smallest Letter Greater Than Targetï¼‰é—®é¢˜ï¼šå¯»æ‰¾æ¯”ç›®æ ‡å­—æ¯å¤§çš„æœ€å°å­—æ¯ã€‚é¢˜ç›®éš¾åº¦ä¸º Easyã€‚ è‹±æ–‡åœ°å€ï¼šhttps://leetcode.com/problems/find-smallest-letter-greater-than-target/ ä¸­æ–‡åœ°å€ï¼šhttps://leetcode-cn.com/problems/find-smallest-letter-greater-than-target/ é¢˜ç›®æè¿°Given a list of sorted characters letters containing only lowercase letters, and given a target letter target, find the smallest element in the list that is larger than the given target. Letters also wrap around. For example, if the target is target = â€˜zâ€™ and letters = [â€˜aâ€™, â€˜bâ€™], the answer is â€˜aâ€™. Examples: Input: letters = [&quot;c&quot;, &quot;f&quot;, &quot;j&quot;] target = &quot;a&quot; Output: &quot;c&quot; Input: letters = [&quot;c&quot;, &quot;f&quot;, &quot;j&quot;] target = &quot;c&quot; Output: &quot;f&quot; Input: letters = [&quot;c&quot;, &quot;f&quot;, &quot;j&quot;] target = &quot;d&quot; Output: &quot;f&quot; Input: letters = [&quot;c&quot;, &quot;f&quot;, &quot;j&quot;] target = &quot;g&quot; Output: &quot;j&quot; Input: letters = [&quot;c&quot;, &quot;f&quot;, &quot;j&quot;] target = &quot;j&quot; Output: &quot;c&quot; Input: letters = [&quot;c&quot;, &quot;f&quot;, &quot;j&quot;] target = &quot;k&quot; Output: &quot;c&quot;Note: 1. letters has a length in range [2, 10000]. 2. letters consists of lowercase letters, and contains at least 2 unique letters. 3. target is a lowercase letter. äºŒåˆ†æŸ¥æ‰¾ä»é¢˜æ„åˆ†æä»æœ‰åºåˆ—è¡¨ä¸­æ‰¾æ¯”ç›®æ ‡å­—æ¯å¤§çš„æœ€å°å­—æ¯å¾—çŸ¥ï¼Œè¿™é¢˜åº”è¯¥ä½¿ç”¨äºŒåˆ†æŸ¥æ‰¾ï¼Œå› ä¸ºäºŒåˆ†æŸ¥æ‰¾çš„æ—¶é—´å¤æ‚åº¦ O(logn) ä½†æ˜¯è¿™é¢˜ç›®æœ‰ä¸ªå‘ï¼Œå°±æ˜¯é¢˜æ„ç»™çš„ä¸å‡†ç¡®ï¼Œç¬”è€…ä¹Ÿæäº¤å‡ æ¬¡æ‰é€šè¿‡ï¼Œæ€»ç»“è§„å¾‹å¦‚ä¸‹ï¼š å½“ target &lt; letters[0] æ—¶ï¼Œå³ letters[0] æ˜¯æ¯”ç›®æ ‡å­—æ¯å¤§çš„æœ€å°å­—æ¯ï¼Œè¿”å› letters[0] å½“ target &gt;= letters[height -1], å³è¿”å› letters[0] Java å®ç°class Solution { public char nextGreatestLetter(char[] letters, char target) { int low = 0; int height = letters.length - 1; if (target &lt; letters[0] || target &gt;= letters[height]) return letters[0]; while (low &lt;= height) { int mind = (low + height) &gt;&gt;&gt; 1; if (letters[mind] &lt;= target) { low = mind + 1; } else { height = mind - 1; } } return letters[low]; }} Koltin å®ç°class Solution { fun nextGreatestLetter(letters: CharArray, target: Char): Char { var low = 0 var height = letters.size - 1 if (target &lt; letters[0] || target &gt;= letters[height]) { return letters[0] } while (low &lt;= height) { val mid = (low + height) ushr 1 when { letters[mid] &lt;= target -&gt; low = mid + 1 else -&gt; height = mid - 1 } } return letters[low] }}","link":"/2020/05/24/LeetCode/binary-search/03-find-letter/"},{"title":"LeetCodeäºŒåˆ†æŸ¥æ‰¾ï¼šXçš„å¹³æ–¹æ ¹","text":"é¢˜ç›®æ¥æºäº LeetCode ä¸Šç¬¬ 69å·ï¼ˆSqrt(x)ï¼‰é—®é¢˜ï¼šXçš„å¹³æ–¹æ ¹ã€‚é¢˜ç›®éš¾åº¦ä¸º Easyã€‚ è‹±æ–‡åœ°å€ï¼šhttps://leetcode.com/problems/sqrtx/ ä¸­æ–‡åœ°å€ï¼šhttps://leetcode-cn.com/problems/sqrtx/ é¢˜ç›®æè¿°Compute and return the square root of x, where x is guaranteed to be a non-negative integer. Since the return type is an integer, the decimal digits are truncated and only the integer part of the result is returned. Example 1: Input: 4Output: 2 Example 2: Input: 8Output: 2 Explanation: The square root of 8 is 2.82842..., and since the decimal part is truncated, 2 is returned. æ€è·¯ï¼šäºŒåˆ†æŸ¥æ‰¾äºŒåˆ†æ³•çš„è§£é¢˜æ€è·¯å¤§è‡´ä»¥ä¸‹å‡ ä¸ªæ­¥éª¤ï¼š å¯»æ‰¾å¹³æ–¹æ ¹ x çš„åŒºé—´èŒƒå›´ï¼š[low, height] ç”¨äºŒåˆ†æ³•åœ¨åŒºé—´ [low, height] å†…å¯»æ‰¾å¹³æ–¹æ ¹ å½“ low &lt;= height æ—¶ï¼šä»¤ mind = (low + height) / 2ï¼Œsquare = mind * mind æ¯”è¾ƒ square ä¸ xï¼š å¦‚æœ square &gt; xï¼Œåˆ™ height = mind -1ã€‚ å¦‚æœ square &lt; xï¼Œåˆ™ low = mind + 1ã€‚ å¦‚æœ square == xï¼Œå³å¹³æ–¹æ ¹ä¸º mindï¼Œè¿”å› mindã€‚ å¦‚æœåœ¨åŒºé—´å†…æ²¡æœ‰æ‰¾åˆ°ï¼Œåˆ™è¿”å› heightã€‚ å¦‚ä½•ç¡®å®š x çš„åŒºé—´èŒƒå›´ï¼š[low, height]ï¼Ÿ å½“ x &gt;= 2 æ—¶ï¼šå®ƒçš„æ•´æ•°å¹³æ–¹æ ¹ä¸€å®šå°äº x / 2 ä¸”å¤§äº 0ï¼Œå³ 0 &lt; a &lt; x / 2ï¼Œä¾‹å¦‚ 9 çš„çš„å¹³æ–¹æ ¹æ˜¯ 3ï¼Œ16 çš„å¹³æ–¹æ ¹æ˜¯ 4ï¼Œ8 çš„å¹³æ–¹æ ¹æ˜¯ 2.82842â€¦ å–æ•´æ•°éƒ¨åˆ†å³æ˜¯ 2ï¼Œä»¥æ­¤ç±»ç±»æ¨å¯ä»¥å°†åŒºé—´èŒƒå›´åœ¨æ¬¡ç¼©å° å³ 0 &lt; a &lt; x / 4 å½“ x =1 æ—¶ï¼šå³ 1 / 4 çš„å€¼ä¸º0äº†ï¼Œæ‰€ä»¥ä¸ºäº†å…¼é¡¾ 1 çš„ç‰¹æ®Šæƒ…å†µï¼Œéœ€è¦å°†è¾¹ç•Œè®¾ä¸º x / 4 +1 ç»¼åˆä»¥ä¸Šä¸¤ç§æƒ…å†µ x çš„åŒºé—´èŒƒå›´ï¼š[0, x / 4 + 1]ï¼Œä¸ºäº†æé«˜æ•ˆç‡æ‰€ä»¥ä½¿ç”¨äº†ä½è¿ç®—ç¬¦ï¼Œå³ x/4 ç­‰ä»·äº x &gt;&gt;&gt; 2 Javaå®ç°class Solution { public int mySqrt(int x) { long low = 0; long height = (x &gt;&gt;&gt; 2) + 1; long lx = (long) x; while (low &lt;= height) { long mind = (low + height) &gt;&gt;&gt; 1; long square = mind * mind; if (square == lx) { return (int) mind; } else if (square &lt; lx) { low = mind + 1; } else { height = mind - 1; } } return (int)height; }} Kotlin å®ç°class Solution { fun mySqrt(x: Int): Int { var low = 0L var height = (x ushr 2).toLong() + 1 val target = x.toLong() while (low &lt;= height) { val mind = (low + height) ushr 1 val square: Long = mind * mind when { square == target -&gt; return mind.toInt() square &lt; target -&gt; low = mind + 1 else -&gt; height = mind - 1 } } return height.toInt() }}","link":"/2020/05/24/LeetCode/binary-search/02-x-square/"},{"title":"LeetCodeäºŒåˆ†æŸ¥æ‰¾ï¼šæœ‰æ•ˆçš„å®Œå…¨å¹³æ–¹æ•°","text":"é¢˜ç›®æ¥æºäº LeetCode ä¸Šç¬¬ 367 å·ï¼ˆValid Perfect Squareï¼‰é—®é¢˜ï¼šæœ‰æ•ˆçš„å®Œå…¨å¹³æ–¹æ•°ã€‚é¢˜ç›®éš¾åº¦ä¸º Easyã€‚ è‹±æ–‡åœ°å€ï¼šhttps://leetcode.com/problems/valid-perfect-square/ ä¸­æ–‡åœ°å€ï¼šhttps://leetcode-cn.com/problems/valid-perfect-square/ é¢˜ç›®æè¿°Given a positive integer num, write a function which returns True if num is a perfect square else False. Note: Do not use any built-in library function such as sqrt. Example 1: Input: 16Output: true Example 2: Input: 14Output: false æ€è·¯ï¼šäºŒåˆ†æŸ¥æ‰¾ä»€ä¹ˆæ˜¯å®Œå…¨å¹³æ–¹æ•°ï¼Ÿç»´åŸºç™¾ç§‘ æ•°å­¦ä¸Šï¼Œå¹³æ–¹æ•°ï¼Œæˆ–ç§°å®Œå…¨å¹³æ–¹æ•°ï¼Œæ˜¯æŒ‡å¯ä»¥å†™æˆæŸä¸ªæ•´æ•°çš„å¹³æ–¹çš„æ•°ï¼Œå³å…¶å¹³æ–¹æ ¹ä¸ºæ•´æ•°çš„æ•°ã€‚ä¾‹å¦‚ï¼Œ9 = 3 Ã— 3ï¼Œå®ƒæ˜¯ä¸€ä¸ªå¹³æ–¹æ•°ã€‚ äºŒåˆ†æ³•çš„è§£é¢˜æ€è·¯å¤§è‡´ä»¥ä¸‹å‡ ä¸ªæ­¥éª¤ï¼š å¯»æ‰¾å®Œå…¨å¹³æ–¹æ•° x çš„åŒºé—´èŒƒå›´ï¼š[low, height] ç”¨äºŒåˆ†æ³•åœ¨åŒºé—´ [low, height] å†…å¯»æ‰¾å®Œå…¨å¹³æ–¹æ•° å½“ low &lt;= height æ—¶ï¼šä»¤ mind = (low + height) / 2ï¼Œsquare = mind * mind æ¯”è¾ƒ square ä¸ xï¼š å¦‚æœ square &gt; xï¼Œåˆ™ height = mind -1ã€‚ å¦‚æœ square &lt; xï¼Œåˆ™ low = mind + 1ã€‚ å¦‚æœ square == xï¼Œå³å®Œå…¨å¹³æ–¹æ•°ä¸º mindï¼Œè¿”å› trueã€‚ å¦‚æœåœ¨åŒºé—´å†…æ²¡æœ‰æ‰¾åˆ°ï¼Œåˆ™è¿”å› falseã€‚ å¦‚ä½•ç¡®å®š x çš„åŒºé—´èŒƒå›´ï¼š[low, height]ï¼Ÿ æ ¹æ®ä¸Šé¢çš„æ¦‚å¿µ å®Œå…¨å¹³æ–¹æ•° æ˜¯æŸä¸ªæ•´æ•°çš„å¹³æ–¹çš„æ•°ï¼Œä¹Ÿå°±æ˜¯è¯´ å®Œå…¨å¹³æ–¹æ•° = n *nï¼Œä¾‹å¦‚ï¼Œ9 = 3 Ã— 3 å½“ x &gt;= 2 æ—¶ï¼šå®ƒçš„æ•´æ•°å¹³æ–¹æ ¹ä¸€å®šå°äº x / 2 ä¸”å¤§äº 0ï¼Œå³ 0 &lt; a &lt; x / 2 å½“ x =1 æ—¶ï¼šå³ 1 / 2 çš„å€¼ä¸º0äº†ï¼Œæ‰€ä»¥ä¸ºäº†å…¼é¡¾ 1 çš„ç‰¹æ®Šæƒ…å†µï¼Œéœ€è¦å°†è¾¹ç•Œè®¾ä¸º x / 2 +1 ç»¼åˆä»¥ä¸Šä¸¤ç§æƒ…å†µ x çš„åŒºé—´èŒƒå›´ï¼š[0, x / 2 + 1]ï¼Œä¸ºäº†æé«˜æ•ˆç‡æ‰€ä»¥ä½¿ç”¨äº†ä½è¿ç®—ç¬¦ï¼Œå³ x/2 ç­‰ä»·äº x &gt;&gt;&gt; 1 Javaå®ç°public class Solution { public boolean isPerfectSquare(int num) { long low = 0; long height = (num &gt;&gt;&gt; 1) + 1; while (low &lt;= height) { long mind = (low + height) &gt;&gt;&gt; 1; long square = mind * mind; if (square == num) { return true; } else if (square &lt; num) { low = mind + 1; } else { height = mind - 1; } } return false; }} Koltinå®ç°class Solution { fun isPerfectSquare(num: Int): Boolean { var low = 0L var height = (num ushr 1).toLong() + 1 var target = num.toLong() while (low &lt;= height) { val mind: Long = (low + height) ushr 1 val square = mind * mind when { square == target -&gt; return true square &lt; target -&gt; low = mind + 1 else -&gt; height = mind - 1 } } return false }}","link":"/2020/05/23/LeetCode/binary-search/01-square/"},{"title":"10åˆ†é’Ÿå…¥é—¨Shellè„šæœ¬ç¼–ç¨‹","text":"å‰è¨€å†™ä¸‹è¿™ç¯‡æ–‡ç« ï¼Œæ˜¯å¯¹è‡ªå·±åœ¨å­¦ä¹ å’Œä½¿ç”¨è¿‡ç¨‹ä¸­çš„æ€»ç»“ï¼Œæ–‡ç¬”ä¸æ˜¯å¾ˆå¥½ï¼Œå¦‚æœæœ‰ä»€ä¹ˆé—®é¢˜æ¬¢è¿æ²Ÿé€šäº¤æµ Githubåœ°å€ï¼šhttps://github.com/hi-dhl/fast_guides Shellæ˜¯ä»€ä¹ˆShellæ˜¯æŒ‡ä¸€ç§åº”ç”¨ç¨‹åºï¼Œè¿™ä¸ªåº”ç”¨ç¨‹åºæä¾›äº†ä¸€ä¸ªç•Œé¢ï¼Œç”¨æˆ·é€šè¿‡è¿™ä¸ªç•Œé¢è®¿é—®æ“ä½œç³»ç»Ÿå†…æ ¸çš„æœåŠ¡, Shellè„šæœ¬ï¼ˆshell scriptï¼‰ï¼Œæ˜¯ä¸€ç§ä¸ºShellç¼–å†™çš„è„šæœ¬ç¨‹åºã€‚æˆ‘ä»¬ç»å¸¸è¯´çš„shellé€šå¸¸éƒ½æ˜¯æŒ‡shellè„šæœ¬ã€‚ ç¯å¢ƒå’Œå·¥å…·Shellè·Ÿjavaã€phpã€Pythonç¼–ç¨‹ä¸€æ ·ï¼Œåªè¦æœ‰ä¸€ä¸ªèƒ½ç¼–å†™ä»£ç çš„æ–‡æœ¬ç¼–è¾‘å™¨å’Œä¸€ä¸ªèƒ½è§£é‡Šæ‰§è¡Œçš„è„šæœ¬è§£é‡Šå™¨å°±å¯ä»¥äº†ã€‚ Mac OSï¼ŒLinux è‡ªå¸¦äº†shellè§£é‡Šå™¨ï¼ŒWindowsæ¯”è¾ƒéº»çƒ¦ï¼Œå› ä¸ºWin7ä¸“ä¸šç‰ˆå’Œæ——èˆ°ç‰ˆé»˜è®¤å®‰è£…PowerShellï¼Œæ ‡å‡†ç‰ˆå’Œå®¶åº­ç‰ˆä¸­å°±æ²¡æœ‰å®‰è£…çš„ï¼Œä¸ºäº†æ–¹ä¾¿å»ºè®®å®‰è£…cygwin PHPã€Python ä¹Ÿå¯ä»¥ä½œä¸ºShellç¼–ç¨‹PHPã€Pythonæ˜¯å±äºé«˜çº§ç¼–ç¨‹è¯­è¨€ï¼Œä½†æ˜¯ä¹Ÿå¯ä»¥åšShellç¼–ç¨‹ï¼Œå› ä¸ºåªè¦æœ‰è§£é‡Šå™¨ï¼Œä¹Ÿå¯ä»¥ç”¨ä½œè„šæœ¬ç¼–ç¨‹ å¦‚ä¸‹æ˜¯ä¸€ä¸ªPython Shell Scriptç¤ºä¾‹ï¼ˆå‡è®¾æ–‡ä»¶åå«op_python_base.pyï¼‰ï¼š #!/usr/bin/env python3 //å‘Šè¯‰Pythonä»ç³»ç»Ÿç¯å¢ƒä¸­æ‰¾python# -*- coding: utf-8 -*- //è®¾ç½®ä¸ºUTF-8ç¼–ç for index in range(10): print(index); æºç ï¼šop_python_base å¦‚ä¸‹æ˜¯ä¸€ä¸ªPHP Shell Scriptç¤ºä¾‹ï¼ˆå‡è®¾æ–‡ä»¶åå«op_php_base.phpï¼‰ï¼š #!/usr/bin/php&lt;?phpfor($i=0 ;$i&lt;10; $i++){ echo $i;}?&gt; æºç ï¼šop_php_base ä¸ºä»€ä¹ˆè¦å­¦ä¹ Shellæ—¢ç„¶PHPã€Pythonéƒ½å¯ä»¥ç”¨æ¥å†™è„šæœ¬ç¼–ç¨‹ï¼Œé‚£ä¸ºä»€ä¹ˆè¿˜è¦å­¦ä¹ é™Œç”Ÿã€æ™¦æ¶©éš¾æ‡‚çš„Shellï¼Œä¸»è¦æœ‰ä¸€ä¸‹å‡ ä¸ªåŸå›  ç¯å¢ƒå…¼å®¹æ€§ï¼ŒWin7ä¸“ä¸šç‰ˆå’Œæ——èˆ°ç‰ˆé»˜è®¤å®‰è£…PowerShellï¼Œæ ‡å‡†ç‰ˆå’Œå®¶åº­ç‰ˆä¸­å°±æ²¡æœ‰å®‰è£…çš„ï¼Œå…¶ä»–ä¸»æµçš„æ“ä½œç³»ç»Ÿéƒ½é¢„åˆ¶äº†Shellè§£é‡Šå™¨ï¼Œæ‰€ä»¥ä½¿ç”¨shã€bashç¼–å†™ï¼Œæä¾›ç»™å…¶ä»–äººä½¿ç”¨æ˜¯éå¸¸æ–¹ä¾¿çš„ï¼Œä½†æ˜¯PHPã€Python ç­‰ç­‰éœ€è¦å®‰è£…ç›¸åº”çš„ç¯å¢ƒ å¦‚æœä½ æƒ³åšä¸€äº›å®šæ—¶ä»»åŠ¡æ¯”å¦‚è¯´æ£€æµ‹è¿›ç¨‹æ˜¯å¦å­˜åœ¨ï¼Œè‡ªåŠ¨å¤‡ä»½ï¼Œæˆ–è€…è¯´è‡ªåŠ¨éƒ¨ç½²ç¯å¢ƒã€æœåŠ¡å™¨ä¹‹é—´çš„æ•°æ®åŒæ­¥ç­‰ç­‰shã€bashä¼šæ˜¯ä½ æœ€å¥½çš„é€‰æ‹© shä¸bashsh: Bourne shellï¼ŒPOSIXï¼ˆPortable Operating System Interfaceï¼‰æ ‡å‡†çš„shellè§£é‡Šå™¨ï¼Œå®ƒçš„äºŒè¿›åˆ¶æ–‡ä»¶è·¯å¾„é€šå¸¸æ˜¯/bin/sh bash: Bashæ˜¯Bourne shellçš„æ›¿ä»£å“ï¼Œå±GNU Projectï¼ŒäºŒè¿›åˆ¶æ–‡ä»¶è·¯å¾„é€šå¸¸æ˜¯/bin/bash ç¬¬ä¸€ä¸ªshellè„šæœ¬æˆ‘ä»¬å…ˆæ¥çœ‹ä¸€ä¸ªä¾‹å­æˆ‘ç›¸ä¿¡å†™è¿‡ä»£ç çš„ç«¥é‹ï¼Œåº”è¯¥å¯¹ä¸‹é¢çš„ä»£ç å¾ˆç†Ÿæ‚‰å¹¶ä¸é™Œç”Ÿï¼Œï¼ˆå‡è®¾æ–‡ä»¶åå«op_base.shï¼‰ï¼š #!/usr/bin/env bashmkdir codecd codefor ((i=0; i&lt;3; i++)); do touch test_${i}.txt echo &quot;shellå¾ˆç®€å•&quot; &gt;&gt; test_${i}.txtdone ç¬¬ä¸€è¡Œï¼šä»ç³»ç»Ÿpathä¸­å¯»æ‰¾æŒ‡å®šè„šæœ¬çš„è§£é‡Šç¨‹åºç¬¬äºŒè¡Œï¼šåˆ›å»º åå«codeæ–‡ä»¶å¤¹ç¬¬ä¸‰è¡Œï¼šè¿›å…¥åˆ›å»ºçš„æ–‡ä»¶å¤¹ç¬¬å››è¡Œï¼šforå¾ªç¯3æ¬¡ç¬¬å››è¡Œï¼šåˆ›å»ºæ–‡ä»¶ç¬¬äº”è¡Œï¼šå¾€åˆ›å»ºçš„æ–‡ä»¶ä¸­å†™å…¥ä¿¡æ¯ç¬¬å…­è¡Œï¼šç»“æŸå¾ªç¯ mkdir, touchï¼Œcdï¼Œtouchï¼Œechoéƒ½æ˜¯ç³»ç»Ÿå‘½ä»¤ï¼Œåœ¨å‘½ä»¤è¡Œä¸‹å¯ä»¥ç›´æ¥æ‰§è¡Œfor, do, done æ˜¯shellè„šæœ¬è¯­è¨€ forå¾ªç¯çš„è¯­æ³• æºç ï¼šop_base.sh ç¼–å†™Shellæ–°å»ºä¸€ä¸ªæ–‡ä»¶ï¼Œæ‰©å±•åä¸ºshï¼ˆshä»£è¡¨shellï¼‰ï¼Œæ‰©å±•åå¹¶ä¸å½±å“è„šæœ¬æ‰§è¡Œï¼Œè§åçŸ¥æ„å°±å¥½ï¼Œå¦‚æœä½ ç”¨phpï¼Œæ‰©å±•åä¸ºphpï¼Œå¦‚æœä½ ç”¨Pythonï¼Œæ‰©å±•åä¸ºpython ç¬¬ä¸€è¡Œä¸€èˆ¬æ˜¯è¿™æ ·ï¼š #!/usr/bin/php#!/usr/bin/env python3#!/usr/bin/env bash #!â€æ˜¯ä¸€ä¸ªçº¦å®šçš„æ ‡è®°ï¼Œå®ƒå‘Šè¯‰ç³»ç»Ÿè¿™ä¸ªè„šæœ¬éœ€è¦ä»€ä¹ˆè§£é‡Šå™¨æ¥æ‰§è¡Œ /env æ˜¯ç³»ç»Ÿçš„PATHç›®å½•ä¸­æŸ¥æ‰¾ è¿è¡Œ Shell è„šæœ¬æœ‰ä¸¤ç§æ–¹æ³•ï¼šä½œä¸ºå¯æ‰§è¡Œç¨‹åºchmod +x op_base.sh./op_base.sh ç¬¬ä¸€è¡Œè®¾ç½® op_base.shå¯æ‰§è¡Œæƒé™ç¬¬äºŒè¡Œæ‰§è¡Œop_base.sh ä½œä¸ºå‚æ•°/bin/sh op_base.sh å˜é‡å®šä¹‰å˜é‡æ—¶ï¼Œå˜é‡åå‰ä¸éœ€è¦åŠ ç¬¦å·å’ŒPythonä¸€æ ·ä½†æ˜¯åœ¨PHPè¯­è¨€ä¸­å˜é‡éœ€è¦åŠ $ï¼Œå¦‚ï¼š my_name=&quot;jack&quot;my_name='jack'; ps: å˜é‡åå’Œç­‰å·ä¹‹é—´ä¸èƒ½æœ‰ç©ºæ ¼,å˜é‡åé¢ä¸èƒ½æœ‰; Shellä¸­çš„å¼•å·å’ŒPHPç±»ä¼¼ï¼Œå­—ç¬¦ä¸²å¯ä»¥ç”¨å•å¼•å·ï¼Œä¹Ÿå¯ä»¥ç”¨åŒå¼•å· å•å¼•å·å­—ç¬¦ä¸²çš„é™åˆ¶ï¼š å•å¼•å·é‡Œçš„ä»»ä½•å­—ç¬¦éƒ½ä¼šåŸæ ·è¾“å‡ºï¼Œå•å¼•å·å­—ç¬¦ä¸²ä¸­çš„å˜é‡æ˜¯æ— æ•ˆçš„ å•å¼•å·å­—ä¸²ä¸­ä¸èƒ½å‡ºç°å•å¼•å·ï¼ˆå¯¹å•å¼•å·ä½¿ç”¨è½¬ä¹‰ç¬¦åä¹Ÿä¸è¡Œ åŒå¼•å·ï¼š åŒå¼•å·é‡Œå¯ä»¥æœ‰å˜é‡ åŒå¼•å·é‡Œå¯ä»¥å‡ºç°è½¬ä¹‰å­—ç¬¦ ä½†æ˜¯åœ¨Pythonä¸­å•å¼•å·å’ŒåŒå¼•å·æ˜¯æ²¡æœ‰åŒºåˆ«ï¼Œä½†æ˜¯Python è¿˜æœ‰ä¸‰ä¸ªå¼•å·ï¼Œåœ¨ä¸‰ä¸ªå¼•å·å†…å­—ç¬¦éƒ½ä¸ä¼šè¢«è½¬ä¹‰ ä½¿ç”¨å˜é‡å¯¹äºå·²ç»å®šä¹‰è¿‡çš„å˜é‡ï¼Œä½¿ç”¨çš„é€‚åˆåœ¨å‰é¢æ·»åŠ $ echo $my_nameecho ${my_name} å˜é‡åå¤–é¢çš„èŠ±æ‹¬å·æ˜¯å¯é€‰çš„ï¼ŒåŠ ä¸åŠ éƒ½è¡Œ,å»ºè®®ä½¿ç”¨ç¬¬äºŒç§å½¢å¼ æ³¨é‡Šä»¥â€œ#â€å¼€å¤´çš„è¡Œå°±æ˜¯æ³¨é‡Šï¼Œä¼šè¢«è§£é‡Šå™¨å¿½ç•¥ã€‚ å¤šè¡Œæ³¨é‡Šshé‡Œæ²¡æœ‰å¤šè¡Œæ³¨é‡Šï¼Œåªèƒ½æ¯ä¸€è¡ŒåŠ ä¸€ä¸ª#å·ã€‚å°±åƒè¿™æ ·ï¼š #--------------------------------------------# Author: jack ## Notes: 10åˆ†é’Ÿå…¥é—¨Shellè„šæœ¬ç¼–ç¨‹## Project home page:# https://github.com/hi-dhl/fast_guides#-------------------------------------------- å­—ç¬¦ä¸²å­—ç¬¦ä¸²å¯ä»¥ç”¨å•å¼•å·ï¼Œä¹Ÿå¯ä»¥ç”¨åŒå¼•å·ï¼Œä¹Ÿå¯ä»¥ä¸ç”¨å¼•å·ã€‚å•åŒå¼•å·çš„åŒºåˆ«è·ŸPHPç±»ä¼¼ Shellä¸åƒå…¶ä»–è¯­è¨€æœ‰phpã€python æœ‰å¾ˆå¤šæ•°æ®ç±»å‹ï¼Œåœ¨Shellä¸­å¸¸ç”¨çš„æ•°æ®ç±»å‹å­—ç¬¦ä¸²æ•°å­—å’Œå­—ç¬¦ä¸²ï¼ˆps: é™¤äº†æ•°å­—å’Œå­—ç¬¦ä¸²ï¼Œä¹Ÿæ²¡å•¥å…¶å®ƒç±»å‹å¥½ç”¨äº†ï¼Œå“ˆå“ˆï¼‰ å•å¼•å·å­—ç¬¦ä¸²çš„é™åˆ¶ï¼š å•å¼•å·é‡Œçš„ä»»ä½•å­—ç¬¦éƒ½ä¼šåŸæ ·è¾“å‡ºï¼Œå•å¼•å·å­—ç¬¦ä¸²ä¸­çš„å˜é‡æ˜¯æ— æ•ˆçš„ å•å¼•å·å­—ä¸²ä¸­ä¸èƒ½å‡ºç°å•å¼•å·ï¼ˆå¯¹å•å¼•å·ä½¿ç”¨è½¬ä¹‰ç¬¦åä¹Ÿä¸è¡Œ åŒå¼•å·ï¼š åŒå¼•å·é‡Œå¯ä»¥æœ‰å˜é‡ åŒå¼•å·é‡Œå¯ä»¥å‡ºç°è½¬ä¹‰å­—ç¬¦ å­—ç¬¦ä¸²æ“ä½œæ‹¼æ¥å­—ç¬¦ä¸²my_name=&quot;jack&quot;;my_age=&quot;20å²&quot;echo $my_name $my_ageecho $my_name$my_age è·å–å­—ç¬¦ä¸²é•¿åº¦echo ${#my_name} æˆªå–å­—ç¬¦ä¸²echo ${my_name:0:2} æºç ï¼šop_str.sh Shell æ•°ç»„å®šä¹‰æ•°ç»„åœ¨Shellä¸­ï¼Œç”¨æ‹¬å·æ¥è¡¨ç¤ºæ•°ç»„ï¼Œæ•°ç»„å…ƒç´ ç”¨â€ç©ºæ ¼â€ç¬¦å·åˆ†å‰²å¼€ã€‚å®šä¹‰æ•°ç»„çš„ä¸€èˆ¬å½¢å¼ä¸ºï¼š name=(name1 name2 name3) è¿˜å¯ä»¥å•ç‹¬å®šä¹‰æ•°ç»„çš„å„ä¸ªåˆ†é‡ï¼š ary[0]=name1ary[1]=name2ary[3]=name3 ps: å¯ä»¥ä¸ä½¿ç”¨è¿ç»­çš„ä¸‹æ ‡ï¼Œè€Œä¸”ä¸‹æ ‡çš„èŒƒå›´æ²¡æœ‰é™åˆ¶ è¯»å–æ•°ç»„è¯»å–æ•°ç»„å…ƒç´ å€¼çš„ä¸€èˆ¬æ ¼å¼æ˜¯ï¼š ${æ•°ç»„å[ä¸‹æ ‡]} ä¾‹å¦‚ï¼š echo ${name[0]} ä½¿ç”¨@ç¬¦å·å¯ä»¥è·å–æ•°ç»„ä¸­çš„æ‰€æœ‰å…ƒç´ ï¼Œä¾‹å¦‚ï¼š echo ${name[@]} è·å–æ•°ç»„çš„é•¿åº¦è·å–æ•°ç»„é•¿åº¦çš„æ–¹æ³•ä¸è·å–å­—ç¬¦ä¸²é•¿åº¦çš„æ–¹æ³•ç›¸åŒï¼Œä¾‹å¦‚ï¼š # å–å¾—æ•°ç»„å…ƒç´ çš„ä¸ªæ•°length=${#name[@]}echo $length# æˆ–è€…length=${#name[*]}echo $length# å–å¾—æ•°ç»„å•ä¸ªå…ƒç´ çš„é•¿åº¦lengthn=${#name[n]}echo $length æºç ï¼šop_arry.sh Shell æµç¨‹æ§åˆ¶å’ŒJavaã€PHPã€Pythonç­‰è¯­è¨€ä¸ä¸€æ ·ï¼Œshçš„æµç¨‹æ§åˆ¶ä¸å¯ä¸ºç©ºï¼Œå¦‚(ä»¥ä¸‹ä¸ºPHPæµç¨‹æ§åˆ¶å†™æ³•)ï¼š &lt;?phpif (isset($_GET[&quot;q&quot;])) { search(q);}else { // ä¸åšä»»ä½•äº‹æƒ…} åœ¨sh/bashé‡Œå¯ä¸èƒ½è¿™ä¹ˆå†™ï¼Œå¦‚æœelseåˆ†æ”¯æ²¡æœ‰è¯­å¥æ‰§è¡Œï¼Œå°±ä¸è¦å†™è¿™ä¸ªelse ifif condition1then command1elif condition2 then command2else commandNfi ä¾‹å­ï¼š #!/usr/bin/env basha=1b=2if [ $a == $b ] then echo &quot;a ç­‰äº b&quot; elif [ $a -gt $b ] then echo &quot;a å¤§äº b&quot; elif [ $a -lt $b ] then echo &quot;a å°äº b&quot; else echo &quot;æ²¡æœ‰ç¬¦åˆçš„æ¡ä»¶&quot; fi æºç ï¼šop_if.sh for å¾ªç¯Shellçš„forå¾ªç¯å’ŒPython æœ‰ç‚¹ç±»ä¼¼ Pythonçš„forå¾ªç¯for index in 1,2,3,4,5: print(index); Shellçš„forå¾ªç¯ï¼Œç¬¬ä¸€ç§å†™æ³•for index in 1 2 3 4 5; do echo &quot;index=&quot;$indexdone Shellçš„forå¾ªç¯ï¼Œç¬¬äºŒç§å†™æ³•for ((i=0; i&lt;5; i++)); do echo &quot;i=&quot;$idone æºç ï¼šop_for.sh while è¯­å¥whileå¾ªç¯ç”¨äºä¸æ–­æ‰§è¡Œä¸€ç³»åˆ—å‘½ä»¤ï¼Œä¹Ÿç”¨äºä»è¾“å…¥æ–‡ä»¶ä¸­è¯»å–æ•°æ®ï¼›å‘½ä»¤é€šå¸¸ä¸ºæµ‹è¯•æ¡ä»¶ã€‚ int=1while(( $int&lt;=5 ))do echo $int let &quot;int++&quot;done æºç ï¼šop_while.sh Shellç»“åˆç³»ç»Ÿå‘½ä»¤shè„šæœ¬ç»“åˆç³»ç»Ÿå‘½ä»¤ä¾¿æœ‰äº†å¼ºå¤§çš„å¨åŠ›ï¼Œåœ¨å­—ç¬¦å¤„ç†é¢†åŸŸï¼Œæœ‰grepã€awkã€sedä¸‰å‰‘å®¢ï¼Œgrepè´Ÿè´£æ‰¾å‡ºç‰¹å®šçš„è¡Œï¼Œawkèƒ½å°†è¡Œæ‹†åˆ†æˆå¤šä¸ªå­—æ®µï¼Œsedåˆ™å¯ä»¥å®ç°æ›´æ–°æ’å…¥åˆ é™¤ç­‰å†™æ“ä½œã€‚ ä¾‹å¦‚å®šæ—¶æ£€æµ‹nginxã€mysqlæ˜¯å¦è¢«å…³é—­path=/var/loglog=${path}/httpd-mysql.logname=(apache mysql)exs_init[0]=&quot;service httpd start&quot;exs_init[1]=&quot;/etc/init.d/mysqld restart&quot;for ((i=0; i&lt;2; i++)); do echo &quot;æ£€æŸ¥${name[i]}è¿›ç¨‹æ˜¯å¦å­˜åœ¨&quot; ps -ef|grep ${name[i]} |grep -v grep if [ $? -eq 0 ]; then pid=$(pgrep -f ${name[i]}) echo &quot;`date +&quot;%Y-%m-%d %H:%M:%S&quot;` ${name[$i]} is running with pid $pid&quot; &gt;&gt; ${log} else $(${exs_init[i]}) echo &quot;`date +&quot;%Y-%m-%d %H:%M:%S&quot;` ${name[$i]} start success&quot; &gt;&gt; ${log} fidone è§£é‡Šï¼šæ£€æµ‹ nginxã€mysqlè¿›ç¨‹æ˜¯å¦å­˜åœ¨ï¼Œå¦‚æœä¸å­˜åœ¨äº†ä¼šè‡ªåŠ¨é‡æ–°å¯åŠ¨ã€‚è„šæœ¬æ¯æ¬¡è¿è¡Œä¼šå†™æ—¥å¿—çš„ï¼Œæ²¡äº‹å¯ä»¥å»çœ‹çœ‹è¯¥æ—¥å¿—æ–‡ä»¶ï¼Œå¦‚æœè¿›ç¨‹æ˜¯ä¸æ˜¯çœŸçš„ç»å¸¸æ€§ä¸å­˜åœ¨ï¼Œææ€•å°±è¦æ’æŸ¥ä¸€ä¸‹æ·±å±‚åŸå› äº†ã€‚ æºç ï¼šcheck_nginx.sh ç¼–è¾‘ /etc/crontab æ–‡ä»¶crontab -e åœ¨æ–‡ä»¶æœ€åæ·»åŠ ä¸€è¡Œï¼š */5 * * * * /xxx/check_nginx.sh &gt; /dev/null 2&gt;&amp;1 ä¸Šè¡¨ç¤ºæ¯ 5 åˆ†é’Ÿï¼Œæ‰§è¡Œä¸€ä¸‹è„šæœ¬ /xxx/check_nginx.shï¼Œå…¶ä¸­xxxä»£è¡¨è·¯å¾„ /dev/null 2&gt;&amp;1 çš„æ„æ€æ˜¯è¯¥æ¡shellå‘½ä»¤å°†ä¸ä¼šè¾“å‡ºä»»ä½•ä¿¡æ¯åˆ°æ§åˆ¶å°ï¼Œä¹Ÿä¸ä¼šæœ‰ä»»ä½•ä¿¡æ¯è¾“å‡ºåˆ°æ–‡ä»¶ä¸­ã€‚ # For details see man 4 crontabs# Example of job definition:# .---------------- minute (0 - 59)# | .------------- hour (0 - 23)# | | .---------- day of month (1 - 31)# | | | .------- month (1 - 12) OR jan,feb,mar,apr ...# | | | | .---- day of week (0 - 6) (Sunday=0 or 7) OR sun,mon,tue,wed,thu,fri,sat# | | | | |# * * * * * command to be executed æ·»åŠ å®Œé…ç½®ï¼Œéœ€è¦é‡å¯æ‰èƒ½ç”Ÿæ•ˆservice crond restart","link":"/2020/05/21/Linux/01-shell/"}],"tags":[{"name":"AndroidStudio","slug":"AndroidStudio","link":"/tags/AndroidStudio/"},{"name":"è¯‘æ–‡","slug":"è¯‘æ–‡","link":"/tags/%E8%AF%91%E6%96%87/"},{"name":"Fragment","slug":"Fragment","link":"/tags/Fragment/"},{"name":"Koin","slug":"Koin","link":"/tags/Koin/"},{"name":"Kotlin","slug":"Kotlin","link":"/tags/Kotlin/"},{"name":"Linux","slug":"Linux","link":"/tags/Linux/"},{"name":"Shell","slug":"Shell","link":"/tags/Shell/"},{"name":"RxJava","slug":"RxJava","link":"/tags/RxJava/"},{"name":"äºŒåˆ†æŸ¥æ‰¾","slug":"äºŒåˆ†æŸ¥æ‰¾","link":"/tags/%E4%BA%8C%E5%88%86%E6%9F%A5%E6%89%BE/"},{"name":"LeetCode","slug":"LeetCode","link":"/tags/LeetCode/"},{"name":"äºŒå‰æ ‘","slug":"äºŒå‰æ ‘","link":"/tags/%E4%BA%8C%E5%8F%89%E6%A0%91/"},{"name":"å­—ç¬¦ä¸²","slug":"å­—ç¬¦ä¸²","link":"/tags/%E5%AD%97%E7%AC%A6%E4%B8%B2/"},{"name":"é“¾è¡¨","slug":"é“¾è¡¨","link":"/tags/%E9%93%BE%E8%A1%A8/"},{"name":"å‰‘æŒ‡Offer","slug":"å‰‘æŒ‡Offer","link":"/tags/%E5%89%91%E6%8C%87Offer/"},{"name":"æ·±åº¦ä¼˜å…ˆæœç´¢","slug":"æ·±åº¦ä¼˜å…ˆæœç´¢","link":"/tags/%E6%B7%B1%E5%BA%A6%E4%BC%98%E5%85%88%E6%90%9C%E7%B4%A2/"},{"name":"å¹¿åº¦ä¼˜å…ˆæœç´¢","slug":"å¹¿åº¦ä¼˜å…ˆæœç´¢","link":"/tags/%E5%B9%BF%E5%BA%A6%E4%BC%98%E5%85%88%E6%90%9C%E7%B4%A2/"},{"name":"åŠ¨æ€è§„åˆ’","slug":"åŠ¨æ€è§„åˆ’","link":"/tags/%E5%8A%A8%E6%80%81%E8%A7%84%E5%88%92/"},{"name":"ä½è¿ç®—","slug":"ä½è¿ç®—","link":"/tags/%E4%BD%8D%E8%BF%90%E7%AE%97/"},{"name":"æ•°å­¦","slug":"æ•°å­¦","link":"/tags/%E6%95%B0%E5%AD%A6/"},{"name":"æ ˆ","slug":"æ ˆ","link":"/tags/%E6%A0%88/"},{"name":"é˜Ÿåˆ—","slug":"é˜Ÿåˆ—","link":"/tags/%E9%98%9F%E5%88%97/"},{"name":"Androidæºç ","slug":"Androidæºç ","link":"/tags/Android%E6%BA%90%E7%A0%81/"},{"name":"Android10-åŒ…ç®¡ç†ç³»ç»Ÿ","slug":"Android10-åŒ…ç®¡ç†ç³»ç»Ÿ","link":"/tags/Android10-%E5%8C%85%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F/"},{"name":"Android10-çª—å£ç®¡ç†ç³»ç»Ÿ","slug":"Android10-çª—å£ç®¡ç†ç³»ç»Ÿ","link":"/tags/Android10-%E7%AA%97%E5%8F%A3%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F/"},{"name":"Android10-èµ„æºç®¡ç†ç³»ç»Ÿ","slug":"Android10-èµ„æºç®¡ç†ç³»ç»Ÿ","link":"/tags/Android10-%E8%B5%84%E6%BA%90%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F/"}],"categories":[{"name":"é€†å‘","slug":"é€†å‘","link":"/categories/%E9%80%86%E5%90%91/"},{"name":"ç²¾é€‰è¯‘æ–‡","slug":"ç²¾é€‰è¯‘æ–‡","link":"/categories/%E7%B2%BE%E9%80%89%E8%AF%91%E6%96%87/"},{"name":"Linux","slug":"Linux","link":"/categories/Linux/"},{"name":"LeetCode","slug":"LeetCode","link":"/categories/LeetCode/"},{"name":"å‰‘æŒ‡Offer","slug":"offer-algorithms","link":"/categories/offer-algorithms/"},{"name":"Android10","slug":"Android10","link":"/categories/Android10/"}]}